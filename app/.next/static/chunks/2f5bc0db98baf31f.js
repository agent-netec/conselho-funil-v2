(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,240925,977031,e=>{"use strict";var t,n,r,i,s,a,o,l,u,h,c,d,f,m,g=e.i(331712),p=e.i(868725),y=e.i(151495),w=e.i(37283),v=e.i(344588),b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,I={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var r=function(){this.blockSize=-1};function i(){}function s(e,t,n){n||(n=0);let r=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^n&(i^s))+r[0]+0xd76aa478|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[1]+0xe8c7b756|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[2]+0x242070db|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[3]+0xc1bdceee|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[4]+0xf57c0faf|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[5]+0x4787c62a|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[6]+0xa8304613|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[7]+0xfd469501|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[8]+0x698098d8|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[9]+0x8b44f7af|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[10]+0xffff5bb1|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[11]+0x895cd7be|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[12]+0x6b901122|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[13]+0xfd987193|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[14]+0xa679438e|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(a<<22|a>>>10),a=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,a=t+((n=i+(a<<20|a>>>12))^i^s)+r[5]+0xfffa3942|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[11]+0x6d9d6122|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[14]+0xfde5380c|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[1]+0xa4beea44|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[7]+0xf6bb4b60|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[10]+0xbebfbc70|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[13]+0x289b7ec6|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[3]+0xd4ef3085|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[6]+0x4881d05|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[9]+0xd9d4d039|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[15]+0x1fa27cf8|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(a<<23|a>>>9),a=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function a(e,t){this.h=t;let n=[],r=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}i.prototype=r.prototype,e.F=r.prototype,e.prototype=new i,e.prototype.constructor=e,e.D=function(e,t,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return r.prototype[t].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let n=t-this.blockSize,r=this.C,i=this.h,a=0;for(;a<t;){if(0==i)for(;a<=n;)s(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(r[i++]=e.charCodeAt(a++),i==this.blockSize){s(this,r),i=0;break}}else for(;a<t;)if(r[i++]=e[a++],i==this.blockSize){s(this,r),i=0;break}}this.h=i,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};var o,l={};function u(e){var t;return -128<=e&&e<128?(t=function(e){return new a([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(l,e)?l[e]:l[e]=t(e)):new a([0|e],e<0?-1:0)}function h(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return p(h(-e));let t=[],n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new a(t,0)}var c=u(0),d=u(1),f=u(0x1000000);function m(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return -1==e.h}function p(e){let t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new a(n,~e.h).add(d)}function y(e,t){return e.add(p(t))}function w(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function b(e,t){if(m(t))throw Error("division by zero");if(m(e))return new v(c,c);if(g(e))return t=b(p(e),t),new v(p(t.g),p(t.h));if(g(t))return t=b(e,p(t)),new v(p(t.g),t.h);if(e.g.length>30){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var n=d,r=t;0>=r.l(e);)n=T(n),r=T(r);var i=E(n,1),s=E(r,1);for(r=E(r,2),n=E(n,2);!m(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=E(r,1),n=E(n,1)}return t=y(e,i.j(t)),new v(i,t)}for(i=c;e.l(t)>=0;){for(r=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,r-48),a=(s=h(n)).j(t);g(a)||a.l(e)>0;)n-=r,a=(s=h(n)).j(t);m(s)&&(s=d),i=i.add(s),e=y(e,a)}return new v(i,e)}function T(e){let t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new a(n,e.h)}function E(e,t){let n=t>>5;t%=32;let r=e.g.length-n,i=[];for(let s=0;s<r;s++)i[s]=t>0?e.i(s+n)>>>t|e.i(s+n+1)<<32-t:e.i(s+n);return new a(i,e.h)}(o=a.prototype).m=function(){if(g(this))return-p(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){let r=this.i(n);e+=(r>=0?r:0x100000000+r)*t,t*=0x100000000}return e},o.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(m(this))return"0";if(g(this))return"-"+p(this).toString(e);let t=h(Math.pow(e,6));var n=this;let r="";for(;;){let i=b(n,t).g,s=(((n=y(n,i.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(m(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},o.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},o.l=function(e){return g(e=y(this,e))?-1:+!m(e)},o.abs=function(){return g(this)?p(this):this},o.add=function(e){let t=Math.max(this.g.length,e.g.length),n=[],r=0;for(let i=0;i<=t;i++){let t=r+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=s>>>16,t&=65535,s&=65535,n[i]=s<<16|t}return new a(n,-0x80000000&n[n.length-1]?-1:0)},o.j=function(e){if(m(this)||m(e))return c;if(g(this))return g(e)?p(this).j(p(e)):p(p(this).j(e));if(g(e))return p(this.j(p(e)));if(0>this.l(f)&&0>e.l(f))return h(this.m()*e.m());let t=this.g.length+e.g.length,n=[];for(var r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){let i=this.i(r)>>>16,s=65535&this.i(r),a=e.i(t)>>>16,o=65535&e.i(t);n[2*r+2*t]+=s*o,w(n,2*r+2*t),n[2*r+2*t+1]+=i*o,w(n,2*r+2*t+1),n[2*r+2*t+1]+=s*a,w(n,2*r+2*t+1),n[2*r+2*t+2]+=i*a,w(n,2*r+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new a(n,0)},o.B=function(e){return b(this,e).h},o.and=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new a(n,this.h&e.h)},o.or=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new a(n,this.h|e.h)},o.xor=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new a(n,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,n=I.Md5=e,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return p(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let r=h(Math.pow(n,8)),i=c;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),n);s<8?(s=h(Math.pow(n,s)),i=i.j(s).add(h(a))):i=(i=i.j(r)).add(h(a))}return i},t=I.Integer=a}).apply(void 0!==b?b:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var T=e.i(477815),E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,_={};(function(){var e,t,n=Object.defineProperty,c=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof E&&E];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function d(e,t){if(t)e:{var r=c;e=e.split(".");for(var i=0;i<e.length-1;i++){var s=e[i];if(!(s in r))break e;r=r[s]}(t=t(i=r[e=e[e.length-1]]))!=i&&null!=t&&n(r,e,{configurable:!0,writable:!0,value:t})}}d("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),d("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),d("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var f=f||{},m=this||self;function g(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function p(e,t,n){return e.call.apply(e.bind,arguments)}function y(e,t,n){return(y=p).apply(null,arguments)}function w(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function v(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}var b="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function I(e){let t=e.length;if(t>0){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function T(e,t){for(let t=1;t<arguments.length;t++){let r=arguments[t];var n=typeof r;if("array"==(n="object"!=n?n:r?Array.isArray(r)?"array":n:"null")||"object"==n&&"number"==typeof r.length){n=e.length||0;let t=r.length||0;e.length=n+t;for(let i=0;i<t;i++)e[n+i]=r[i]}else e.push(r)}}var S=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new x,e=>e.reset());class x{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let C,A=!1,D=new class{constructor(){this.h=this.g=null}add(e,t){let n=S.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},N=()=>{let e=Promise.resolve(void 0);C=()=>{e.then(k)}};function k(){let e;for(var t;e=null,D.g&&(e=D.g,D.g=D.g.next,D.g||(D.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){m.setTimeout(()=>{throw e},0)}(e)}S.j(t),S.h<100&&(S.h++,t.next=S.g,S.g=t)}A=!1}function R(){this.u=this.u,this.C=this.C}function M(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}R.prototype.u=!1,R.prototype.dispose=function(){this.u||(this.u=!0,this.N())},R.prototype[Symbol.dispose]=function(){this.dispose()},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},M.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!m.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};m.addEventListener("test",e,t),m.removeEventListener("test",e,t)}catch(e){}return e}();function P(e){return/^[\s\xa0]*$/.test(e)}function V(e,t){M.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}v(V,M),V.prototype.init=function(e,t){let n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&V.Z.h.call(this)},V.prototype.h=function(){V.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var L="closure_listenable_"+(1e6*Math.random()|0),F=0;function q(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++F,this.da=this.fa=!1}function U(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function j(e){let t={};for(let n in e)t[n]=e[n];return t}let z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function G(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<z.length;t++)n=z[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function K(e){this.src=e,this.g={},this.h=0}function $(e,t){let n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=s>=0)&&Array.prototype.splice.call(i,s,1),r&&(U(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Q(e,t,n,r){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}K.prototype.add=function(e,t,n,r,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=Q(e,t,r,i);return a>-1?(t=e[a],n||(t.fa=!1)):((t=new q(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var H="closure_lm_"+(1e6*Math.random()|0),W={};function J(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");let a=g(i)?!!i.capture:!!i,o=ee(e);if(o||(e[H]=o=new K(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return Z.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)O||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(X(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Y(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[L])$(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(X(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ee(t))?($(n,e),0==n.h&&(n.src=null,t[H]=null)):U(e)}}}function X(e){return e in W?W[e]:W[e]="on"+e}function Z(e,t){if(e.da)e=!0;else{t=new V(t,this);let n=e.listener,r=e.ha||e.src;e.fa&&Y(e),e=n.call(r,t)}return e}function ee(e){return(e=e[H])instanceof K?e:null}var et="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(e){return"function"==typeof e?e:(e[et]||(e[et]=function(t){return e.handleEvent(t)}),e[et])}function er(){R.call(this),this.i=new K(this),this.M=this,this.G=null}function ei(e,t){let n,r;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new M(t,e);else if(t instanceof M)t.target=t.target||e;else{var a=t;G(t=new M(s,e),a)}if(a=!0,i)for(r=i.length-1;r>=0;r--)a=es(n=t.g=i[r],s,!0,t)&&a;if(a=es(n=t.g=e,s,!0,t)&&a,a=es(n,s,!1,t)&&a,i)for(r=0;r<i.length;r++)a=es(n=t.g=i[r],s,!1,t)&&a}function es(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==n){let t=a.listener,n=a.ha||a.src;a.fa&&$(e.i,a),i=!1!==t.call(n,r)&&i}}return i&&!r.defaultPrevented}v(er,R),er.prototype[L]=!0,er.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else(i=g(i)?!!i.capture:!!i,r=en(r),t&&t[L])?(t=t.i,(a=String(n).toString())in t.g&&(r=Q(n=t.g[a],r,i,s))>-1&&(U(n[r]),Array.prototype.splice.call(n,r,1),0==n.length&&(delete t.g[a],t.h--))):t&&(t=ee(t))&&(n=t.g[n.toString()],t=-1,n&&(t=Q(n,r,i,s)),(r=t>-1?n[t]:null)&&Y(r))}(this,e,t,n,r)},er.prototype.N=function(){if(er.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let n=e.g[t];for(let e=0;e<n.length;e++)U(n[e]);delete e.g[t],e.h--}}this.G=null},er.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},er.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ea extends R{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=y(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:m.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(m.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function eo(e){R.call(this),this.h=e,this.g={}}v(eo,R);var el=[];function eu(e){B(e.g,function(e,t){this.g.hasOwnProperty(t)&&Y(e)},e),e.g={}}eo.prototype.N=function(){eo.Z.N.call(this),eu(this)},eo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var eh=m.JSON.stringify,ec=m.JSON.parse,ed=class{stringify(e){return m.JSON.stringify(e,void 0)}parse(e){return m.JSON.parse(e,void 0)}};function ef(){}function em(){}var eg={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ep(){M.call(this,"d")}function ey(){M.call(this,"c")}v(ep,M),v(ey,M);var ew={},ev=null;function eb(){return ev=ev||new er}function eI(e){M.call(this,ew.Ia,e)}function eT(e){let t=eb();ei(t,new eI(t))}function eE(e,t){M.call(this,ew.STAT_EVENT,e),this.stat=t}function e_(e){let t=eb();ei(t,new eE(t,e))}function eS(e,t){M.call(this,ew.Ja,e),this.size=t}function ex(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return m.setTimeout(function(){e()},t)}function eC(){this.g=!0}function eA(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var n=s[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<r.length;e++)r[e]=""}}}}return eh(s)}catch(e){return t}}(e,n)+(r?" "+r:"")})}ew.Ia="serverreachability",v(eI,M),ew.STAT_EVENT="statevent",v(eE,M),ew.Ja="timingevent",v(eS,M),eC.prototype.ua=function(){this.g=!1},eC.prototype.info=function(){};var eD={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eN={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function ek(){}function eR(e){return encodeURIComponent(String(e))}function eM(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new eo(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eO}function eO(){this.i=null,this.g="",this.h=!1}v(ek,ef),ek.prototype.g=function(){return new XMLHttpRequest},e=new ek;var eP={},eV={};function eL(e,t,n){e.M=1,e.A=e8(e2(t)),e.u=n,e.R=!0,eF(e,null)}function eF(e,t){e.F=Date.now(),eU(e),e.B=e2(e.A);var n,r,i,s,a,o,l=e.B,u=e.S;Array.isArray(u)||(u=[String(u)]),tc(l.i,"t",u),e.C=0,l=e.j.L,e.h=new eO,e.g=tY(e.j,l?t:null,!e.u),e.P>0&&(e.O=new ea(y(e.Y,e,e.g),e.P)),t=e.V,l=e.g,u=e.ba;var h="readystatechange";Array.isArray(h)||(h&&(el[0]=h.toString()),h=el);for(let e=0;e<h.length;e++){let n=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(let a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=en(r),t&&t[L]?t.K(n,r,g(i)?!!i.capture:!!i,s):J(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(let a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=en(r),t&&t[L]?t.J(n,r,g(i)?!!i.capture:!!i,s):J(t,n,r,!1,i,s)}(l,h[e],u||t.handleEvent,!1,t.h||t);if(!n)break;t.g[n.key]=n}t=e.J?j(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),eT(),n=e.i,r=e.v,i=e.B,s=e.l,a=e.S,o=e.u,n.info(function(){if(n.g)if(o){var e="",t=o.split("&");for(let n=0;n<t.length;n++){var l=t[n].split("=");if(l.length>1){let t=l[0];l=l[1];let n=t.split("_");e=n.length>=2&&"type"==n[1]?e+(t+"=")+l+"&":e+(t+"=redacted&")}}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+r+"\n"+i+"\n"+e})}function eq(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eU(e){e.T=Date.now()+e.H,eB(e,e.H)}function eB(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=ex(y(e.aa,e),t)}function ej(e){e.D&&(m.clearTimeout(e.D),e.D=null)}function ez(e){0==e.j.I||e.K||t$(e.j,e)}function eG(e){ej(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eu(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function eK(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||eJ(n.h,e))){if(!e.L&&eJ(n.h,e)&&3==n.I){try{var r=n.Ba.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.v){if(n.g)if(n.g.F+3e3<e.F)tK(n),tP(n);else break e;tj(n),e_(18)}}else n.xa=i[1],0<n.xa-n.K&&i[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=ex(y(n.Va,n),6e3));1>=eW(n.h)&&n.ta&&(n.ta=void 0)}else tH(n,11)}else if((e.L||n.g==e)&&tK(n),!P(t))for(i=n.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=n.K))if(n.K=l,o=o[1],2==n.I)if("c"==o[0]){n.M=o[1],n.ba=o[2];let t=o[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));let i=o[4];null!=i&&(n.za=i,n.j.info("SVER="+n.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(n.O=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eY(s,s.h),s.h=null))}if(r.G){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,e6(r.J,r.G,e))}}if(n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms")),(r=n).na=tJ(r,r.L?r.ba:null,r.W),e.L){eX(r.h,e);var a=r.O;a&&(e.H=a),e.D&&(ej(e),eU(e)),r.g=e}else tB(r);n.i.length>0&&tL(n)}else"stop"!=o[0]&&"close"!=o[0]||tH(n,7);else 3==n.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tH(n,7):tO(n):"noop"!=o[0]&&n.l&&n.l.qa(o),n.A=0)}}eT(4)}catch(e){}}eM.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tN(e)?t.j():this.Y(e)},eM.prototype.Y=function(e){try{if(e==this.g)e:{let d=tN(this.g),f=this.g.ya(),g=this.g.ca();if(!(d<3)&&(3!=d||this.g&&(this.h.h||this.g.la()||tk(this.g)))){this.K||4!=d||7==f||(8==f||g<=0?eT(3):eT(2)),ej(this);var t=this.g.ca();this.X=t;var n=function(e){if(!eq(e))return e.g.la();let t=tk(e.g);if(""===t)return"";let n="",r=t.length,i=4==tN(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return eG(e),ez(e),"";e.h.i=new m.TextDecoder}for(let s=0;s<r;s++)e.h.h=!0,n+=e.h.i.decode(t[s],{stream:!(i&&s==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,r=this.i,i=this.v,s=this.B,a=this.l,o=this.S,r.info(function(){return"XMLHTTP RESP ("+a+") [ attempt "+o+"]: "+i+"\n"+s+"\n"+d+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var r,i,s,a,o,l,u=this.g;if((l=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(l)){var h=l;break t}}h=null}if(e=h)eA(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,eK(this,e);else{this.o=!1,this.m=3,e_(12),eG(this),ez(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;)if((t=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?eV:isNaN(n=Number(t.substring(n,r)))?eP:(r+=1)+n>t.length?eV:(t=t.slice(r,r+n),e.C=r+n,t)}(this,n))==eV){4==d&&(this.m=4,e_(14),e=!1),eA(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eP){this.m=4,e_(15),eA(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}else eA(this.i,this.l,t,null),eK(this,t);if(eq(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=n.length||this.h.h||(this.m=1,e_(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var c=this.j;c.g==this&&c.aa&&!c.P&&(c.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),tz(c),c.P=!0,e_(11))}}else eA(this.i,this.l,n,"[Invalid Chunked Response]"),eG(this),ez(this)}else eA(this.i,this.l,n,null),eK(this,n);4==d&&eG(this),this.o&&!this.K&&(4==d?t$(this.j,this):(this.o=!1,eU(this)))}else(function(e){let t={};e=(e.g&&tN(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(P(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,e_(12)):(this.m=0,e_(13)),eG(this),ez(this)}}}catch(e){}finally{}},eM.prototype.cancel=function(){this.K=!0,eG(this)},eM.prototype.aa=function(){var e,t;this.D=null;let n=Date.now();n-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(eT(),e_(17)),eG(this),this.m=2,ez(this)):eB(this,this.T-n)};var e$=class{constructor(e,t){this.g=e,this.map=t}};function eQ(e){this.l=e||10,e=m.PerformanceNavigationTiming?(e=m.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(m.chrome&&m.chrome.loadTimes&&m.chrome.loadTimes()&&m.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eH(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eW(e){return e.h?1:e.g?e.g.size:0}function eJ(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eY(e,t){e.g?e.g.add(t):e.h=t}function eX(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eZ(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.G);return t}return I(e.i)}eQ.prototype.cancel=function(){if(this.i=eZ(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e0=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e1(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof e1?(this.l=e.l,e5(this,e.j),this.o=e.o,this.g=e.g,e3(this,e.u),this.h=e.h,e4(this,td(e.i)),this.m=e.m):e&&(t=String(e).match(e0))?(this.l=!1,e5(this,t[1]||"",!0),this.o=e7(t[2]||""),this.g=e7(t[3]||"",!0),e3(this,t[4]),this.h=e7(t[5]||"",!0),e4(this,t[6]||"",!0),this.m=e7(t[7]||"")):(this.l=!1,this.i=new ta(null,this.l))}function e2(e){return new e1(e)}function e5(e,t,n){e.j=n?e7(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e3(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e4(e,t,n){var r,i;t instanceof ta?(e.i=t,r=e.i,(i=e.l)&&!r.j&&(to(r),r.i=null,r.g.forEach(function(e,t){let n=t.toLowerCase();t!=n&&(tl(this,t),tc(this,n,e))},r)),r.j=i):(n||(t=e9(t,ti)),e.i=new ta(t,e.l))}function e6(e,t,n){e.i.set(t,n)}function e8(e){return e6(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e7(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e9(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,te),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function te(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e1.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e9(t,tt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e9(t,tt,!0),"@"),e.push(eR(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(e9(n,"/"==n.charAt(0)?tr:tn,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",e9(n,ts)),e.join("")},e1.prototype.resolve=function(e){let t=e2(this),n=!!e.j;n?e5(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var r=e.h;if(n)e3(t,e.u);else if(n=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var i=t.h.lastIndexOf("/");-1!=i&&(r=t.h.slice(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let n=i[t++];"."==n?r&&t==i.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==i.length&&e.push("")):(e.push(n),r=!0)}r=e.join("/")}else r=i}return n?t.h=r:n=""!==e.i.toString(),n?e4(t,td(e.i)):n=!!e.m,n&&(t.m=e.m),t};var tt=/[#\/\?@]/g,tn=/[#\?:]/g,tr=/[#\?]/g,ti=/[#\?@]/g,ts=/#/g;function ta(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function to(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){let r=e[n].indexOf("="),i,s=null;r>=0?(i=e[n].substring(0,r),s=e[n].substring(r+1)):i=e[n],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tl(e,t){to(e),t=tf(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tu(e,t){return to(e),t=tf(e,t),e.g.has(t)}function th(e,t){to(e);let n=[];if("string"==typeof t)tu(e,t)&&(n=n.concat(e.g.get(tf(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function tc(e,t,n){tl(e,t),n.length>0&&(e.i=null,e.g.set(tf(e,t),I(n)),e.h+=n.length)}function td(e){let t=new ta;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tf(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tm(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tg(){this.g=new ed}function tp(e){this.i=e.Sb||null,this.h=e.ab||!1}function ty(e,t){er.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tw(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function tv(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tb(e)}function tb(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tI(e){let t="";return B(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tT(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tI(n),"string"==typeof e?null!=n&&eR(n):e6(e,t,n))}function tE(e){er.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ta.prototype).add=function(e,t){to(this),this.i=null,e=tf(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},t.forEach=function(e,t){to(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},t.set=function(e,t){return to(this),this.i=null,tu(this,e=tf(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=th(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];let i=eR(n);n=th(this,n);for(let t=0;t<n.length;t++){let r=i;""!==n[t]&&(r+="="+eR(n[t])),e.push(r)}}return this.i=e.join("&")},v(tp,ef),tp.prototype.g=function(){return new ty(this.i,this.h)},v(ty,er),(t=ty.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tb(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||m).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,tv(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tb(this)),this.g&&(this.readyState=3,tb(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==m.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tw(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tv(this):tb(this),3==this.readyState&&tw(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,tv(this))},t.Na=function(e){this.g&&(this.response=e,tv(this))},t.ga=function(){this.g&&tv(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(ty.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),v(tE,er);var t_=/^https?$/i,tS=["POST","PUT"];function tx(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tC(e),tD(e)}function tC(e){e.A||(e.A=!0,ei(e,"complete"),ei(e,"error"))}function tA(e){if(e.h&&void 0!==f){if(e.v&&4==tN(e))setTimeout(e.Ca.bind(e),0);else if(ei(e,"readystatechange"),4==tN(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===s){let t=String(e.D).match(e0)[1]||null;!t&&m.self&&m.self.location&&(t=m.self.location.protocol.slice(0,-1)),n=!t_.test(t?t.toLowerCase():"")}t=n}if(t)ei(e,"complete"),ei(e,"success");else{e.o=6;try{var i=tN(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tC(e)}}finally{tD(e)}}}}function tD(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let n=e.g;e.g=null,t||ei(e,"ready");try{n.onreadystatechange=null}catch(e){}}}function tN(e){return e.g?e.g.readyState:0}function tk(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tR(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tM(e){this.za=0,this.i=[],this.j=new eC,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tR("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tR("baseRetryDelayMs",5e3,e),this.Za=tR("retryDelaySeedMs",1e4,e),this.Ta=tR("forwardChannelMaxRetries",2,e),this.va=tR("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eQ(e&&e.concurrentRequestLimit),this.Ba=new tg,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tO(e){if(tV(e),3==e.I){var t=e.V++,n=e2(e.J);if(e6(n,"SID",e.M),e6(n,"RID",t),e6(n,"TYPE","terminate"),tq(e,n),(t=new eM(e,e.j,t)).M=2,t.A=e8(e2(n)),n=!1,m.navigator&&m.navigator.sendBeacon)try{n=m.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&m.Image&&((new Image).src=t.A,n=!0),n||(t.g=tY(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eU(t)}tW(e)}function tP(e){e.g&&(tz(e),e.g.cancel(),e.g=null)}function tV(e){tP(e),e.v&&(m.clearTimeout(e.v),e.v=null),tK(e),e.h.cancel(),e.m&&("number"==typeof e.m&&m.clearTimeout(e.m),e.m=null)}function tL(e){if(!eH(e.h)&&!e.m){e.m=!0;var t=e.Ea;C||N(),A||(C(),A=!0),D.add(t,e),e.D=0}}function tF(e,t){var n;n=t?t.l:e.V++;let r=e2(e.J);e6(r,"SID",e.M),e6(r,"RID",n),e6(r,"AID",e.K),tq(e,r),e.u&&e.o&&tT(r,e.u,e.o),n=new eM(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tU(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eY(e.h,n),eL(n,r,t)}function tq(e,t){e.H&&B(e.H,function(e,n){e6(t,n,e)}),e.l&&B({},function(e,n){e6(t,n,e)})}function tU(e,t,n){n=Math.min(e.i.length,n);let r=e.l?y(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?n>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let o=!0;for(let l=0;l<n;l++){var s=i[l].g;let n=i[l].map;if((s-=t)<0)t=Math.max(0,i[l].g-100),o=!1;else try{s="req"+s+"_";try{var a=n instanceof Map?n:Object.entries(n);for(let[t,n]of a){let r=n;g(n)&&(r=eh(n)),e.push(s+t+"="+encodeURIComponent(r))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){r&&r(n)}}if(o){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,n),a}function tB(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;C||N(),A||(C(),A=!0),D.add(t,e),e.A=0}}function tj(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=ex(y(e.Da,e),tQ(e,e.A)),e.A++,!0)}function tz(e){null!=e.B&&(m.clearTimeout(e.B),e.B=null)}function tG(e){e.g=new eM(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e2(e.na);e6(t,"RID","rpc"),e6(t,"SID",e.M),e6(t,"AID",e.K),e6(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e6(t,"TO",e.ia),e6(t,"TYPE","xmlhttp"),tq(e,t),e.u&&e.o&&tT(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=e8(e2(t)),n.u=null,n.R=!0,eF(n,e)}function tK(e){null!=e.C&&(m.clearTimeout(e.C),e.C=null)}function t$(e,t){var n,r=null;if(e.g==t){tK(e),tz(e),e.g=null;var i=2}else{if(!eJ(e.h,t))return;r=t.G,eX(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){r=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;ei(i=eb(),new eS(i,r)),tL(e)}else tB(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(n=t,!(eW(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=n.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=ex(y(e.Ea,e,n),tQ(e,e.D)),e.D++,!0)))||2==i&&tj(e)))switch(r&&r.length>0&&((t=e.h).i=t.i.concat(r)),s){case 1:tH(e,5);break;case 4:tH(e,10);break;case 3:tH(e,6);break;default:tH(e,2)}}}function tQ(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function tH(e,t){if(e.j.info("Error code "+t),2==t){let t,s,a;var n,r=y(e.bb,e),i=e.Ua;let o=!i;i=new e1(i||"//www.google.com/images/cleardot.gif"),m.location&&"http"==m.location.protocol||e5(i,"https"),e8(i),o?function(e,t){let n=new eC;if(m.Image){let r=new Image;r.onload=w(tm,n,"TestLoadImage: loaded",!0,t,r),r.onerror=w(tm,n,"TestLoadImage: error",!1,t,r),r.onabort=w(tm,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=w(tm,n,"TestLoadImage: timeout",!1,t,r),m.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(i.toString(),r):(n=i.toString(),t=new eC,s=new AbortController,a=setTimeout(()=>{s.abort(),tm(t,"TestPingServer: timeout",!1,r)},1e4),fetch(n,{signal:s.signal}).then(e=>{clearTimeout(a),e.ok?tm(t,"TestPingServer: ok",!0,r):tm(t,"TestPingServer: server error",!1,r)}).catch(()=>{clearTimeout(a),tm(t,"TestPingServer: error",!1,r)}))}else e_(2);e.I=0,e.l&&e.l.pa(t),tW(e),tV(e)}function tW(e){if(e.I=0,e.ja=[],e.l){let t=eZ(e.h);(0!=t.length||0!=e.i.length)&&(T(e.ja,t),T(e.ja,e.i),e.h.i.length=0,I(e.i),e.i.length=0),e.l.oa()}}function tJ(e,t,n){var r=n instanceof e1?e2(n):new e1(n);if(""!=r.g)t&&(r.g=t+"."+r.g),e3(r,r.u);else{var i=m.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new e1(null);r&&e5(e,r),t&&(e.g=t),i&&e3(e,i),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&e6(r,n,t),e6(r,"VER",e.ka),tq(e,r),r}function tY(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tE(e.Aa&&!e.ma?new tp({ab:n}):e.ma)).Fa(e.L),t}function tX(){}function tZ(){}function t0(e,t){er.call(this),this.g=new tM(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!P(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!P(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t5(this)}function t1(e){ep.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t2(){ey.call(this),this.status=1}function t5(e){this.g=e}(t=tE.prototype).Fa=function(e){this.H=e},t.ea=function(t,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);n=n?n.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=b(y(this.Ca,this));try{this.B=!0,this.g.open(n,String(t),!0),this.B=!1}catch(e){tx(this,e);return}if(t=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,a]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=m.FormData&&t instanceof m.FormData,!(Array.prototype.indexOf.call(tS,n,void 0)>=0)||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(e,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tx(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,ei(this,"complete"),ei(this,"abort"),tD(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tD(this,!0)),tE.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tA(this):this.Xa())},t.Xa=function(){tA(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tN(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ec(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tM.prototype).ka=8,t.I=1,t.connect=function(e,t,n,r){e_(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=tJ(this,null,this.W),tL(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new eM(this,this.j,e),s=this.o;if(this.U&&(s?G(s=j(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if((t+=r)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tU(this,i,t),e6(n=e2(this.J),"RID",e),e6(n,"CVER",22),this.G&&e6(n,"X-HTTP-Session-Id",this.G),tq(this,n),s&&(this.R?t="headers="+eR(tI(s))+"&"+t:this.u&&tT(n,this.u,s)),eY(this.h,i),this.Ra&&e6(n,"TYPE","init"),this.S?(e6(n,"$req",t),e6(n,"SID","null"),i.U=!0,eL(i,n,null)):eL(i,n,t),this.I=2}}else 3==this.I&&(e?tF(this,e):0==this.i.length||eH(this.h)||tF(this))},t.Da=function(){if(this.v=null,tG(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=ex(y(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,e_(10),tP(this),tG(this))},t.Va=function(){null!=this.C&&(this.C=null,tP(this),tj(this),e_(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),e_(2)):(this.j.info("Failed to ping google.com"),e_(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tX.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tZ.prototype.g=function(e,t){return new t0(e,t)},v(t0,er),t0.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},t0.prototype.close=function(){tO(this.g)},t0.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=eh(e),e=n);t.i.push(new e$(t.Ya++,e)),3==t.I&&tL(t)},t0.prototype.N=function(){this.g.l=null,delete this.j,tO(this.g),delete this.g,t0.Z.N.call(this)},v(t1,ep),v(t2,ey),v(t5,tX),t5.prototype.ra=function(){ei(this.g,"a")},t5.prototype.qa=function(e){ei(this.g,new t1(e))},t5.prototype.pa=function(e){ei(this.g,new t2)},t5.prototype.oa=function(){ei(this.g,"b")},tZ.prototype.createWebChannel=tZ.prototype.g,t0.prototype.send=t0.prototype.o,t0.prototype.open=t0.prototype.m,t0.prototype.close=t0.prototype.close,h=_.createWebChannelTransport=function(){return new tZ},u=_.getStatEventTarget=function(){return eb()},l=_.Event=ew,o=_.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eD.NO_ERROR=0,eD.TIMEOUT=8,eD.HTTP_ERROR=6,a=_.ErrorCode=eD,eN.COMPLETE="complete",s=_.EventType=eN,em.EventType=eg,eg.OPEN="a",eg.CLOSE="b",eg.ERROR="c",eg.MESSAGE="d",er.prototype.listen=er.prototype.J,i=_.WebChannel=em,_.FetchXmlHttpFactory=tp,tE.prototype.listenOnce=tE.prototype.K,tE.prototype.getLastError=tE.prototype.Ha,tE.prototype.getLastErrorCode=tE.prototype.ya,tE.prototype.getStatus=tE.prototype.ca,tE.prototype.getResponseJson=tE.prototype.La,tE.prototype.getResponseText=tE.prototype.la,tE.prototype.send=tE.prototype.ea,tE.prototype.setWithCredentials=tE.prototype.Fa,r=_.XhrIo=tE}).apply(void 0!==E?E:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});class S{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}S.UNAUTHENTICATED=new S(null),S.GOOGLE_CREDENTIALS=new S("google-credentials-uid"),S.FIRST_PARTY=new S("first-party-uid"),S.MOCK_USER=new S("mock-user");let x="12.8.0",C=new T.Logger("@firebase/firestore");function A(){return C.logLevel}function D(e,...t){if(C.logLevel<=T.LogLevel.DEBUG){let n=t.map(R);C.debug(`Firestore (${x}): ${e}`,...n)}}function N(e,...t){if(C.logLevel<=T.LogLevel.ERROR){let n=t.map(R);C.error(`Firestore (${x}): ${e}`,...n)}}function k(e,...t){if(C.logLevel<=T.LogLevel.WARN){let n=t.map(R);C.warn(`Firestore (${x}): ${e}`,...n)}}function R(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function M(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,O(e,r,n)}function O(e,t,n){let r=`FIRESTORE (${x}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw N(r),Error(r)}function P(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||O(t,i,r)}let V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class L extends v.FirebaseError{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class F{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class q{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class U{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(S.UNAUTHENTICATED))}shutdown(){}}class B{constructor(e){this.t=e,this.currentUser=S.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){P(void 0===this.o,42304);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new F;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new F,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new F)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(P("string"==typeof t.accessToken,31837,{l:t}),new q(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return P(null===e||"string"==typeof e,2055,{h:e}),new S(e)}}class j{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=S.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class z{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new j(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(S.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class G{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class K{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,g._isFirebaseServerApp)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){P(void 0===this.o,3512);let n=e=>{null!=e.error&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,D("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new G(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(P("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new G(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class ${static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function Q(e,t){return e<t?-1:+(e>t)}function H(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.charAt(r),i=t.charAt(r);if(n!==i)return W(n)===W(i)?Q(n,i):W(n)?1:-1}return Q(e.length,t.length)}function W(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function J(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}let Y="__name__";class X{constructor(e,t,n){void 0===t?t=0:t>e.length&&M(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&M(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===X.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof X?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=X.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return Q(e.length,t.length)}static compareSegments(e,t){let n=X.isNumericId(e),r=X.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?X.extractNumericId(e).compare(X.extractNumericId(t)):H(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return t.fromString(e.substring(4,e.length-2))}}class Z extends X{construct(e,t,n){return new Z(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new L(V.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new Z(t)}static emptyPath(){return new Z([])}}let ee=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class et extends X{construct(e,t,n){return new et(e,t,n)}static isValidIdentifier(e){return ee.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),et.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Y}static keyField(){return new et([Y])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new L(V.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new L(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new L(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new L(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new et(t)}static emptyPath(){return new et([])}}class en{constructor(e){this.path=e}static fromPath(e){return new en(Z.fromString(e))}static fromName(e){return new en(Z.fromString(e).popFirst(5))}static empty(){return new en(Z.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Z.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Z.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new en(new Z(e.slice()))}}function er(e,t,n){if(!n)throw new L(V.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function ei(e){if(!en.isDocumentKey(e))throw new L(V.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function es(e){if(en.isDocumentKey(e))throw new L(V.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function ea(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function eo(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":M(12329,{type:typeof e})}function el(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new L(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=eo(e);throw new L(V.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function eu(e,t){if(t<=0)throw new L(V.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function eh(e,t){let n={typeString:e};return t&&(n.value=t),n}function ec(e,t){let n;if(!ea(e))throw new L(V.INVALID_ARGUMENT,"JSON must be an object");for(let r in t)if(t[r]){let i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}let a=e[r];if(i&&typeof a!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new L(V.INVALID_ARGUMENT,n);return!0}class ed{static now(){return ed.fromMillis(Date.now())}static fromDate(e){return ed.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new ed(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new L(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new L(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ed._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ec(e,ed._jsonSchema))return new ed(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ed._jsonSchemaVersion="firestore/timestamp/1.0",ed._jsonSchema={type:eh("string",ed._jsonSchemaVersion),seconds:eh("number"),nanoseconds:eh("number")};class ef{static fromTimestamp(e){return new ef(e)}static min(){return new ef(new ed(0,0))}static max(){return new ef(new ed(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class em{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function eg(e){return e.fields.find(e=>2===e.kind)}function ep(e){return e.fields.filter(e=>2!==e.kind)}function ey(e,t){let n=Q(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=function(e,t){let n=et.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:Q(e.kind,t.kind)}(e.fields[r],t.fields[r])))return n;return Q(e.fields.length,t.fields.length)}em.UNKNOWN_ID=-1;class ew{constructor(e,t){this.fieldPath=e,this.kind=t}}class ev{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ev(0,eT.min())}}function eb(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new eT(ef.fromTimestamp(1e9===r?new ed(n+1,0):new ed(n,r)),en.empty(),t)}function eI(e){return new eT(e.readTime,e.key,-1)}class eT{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new eT(ef.min(),en.empty(),-1)}static max(){return new eT(ef.max(),en.empty(),-1)}}function eE(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=en.comparator(e.documentKey,t.documentKey))?n:Q(e.largestBatchId,t.largestBatchId)}let e_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class eS{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function ex(e){if(e.code!==V.FAILED_PRECONDITION||e.message!==e_)throw e;D("LocalStore","Unexpectedly lost primary lease")}class eC{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&M(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new eC((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof eC?t:eC.resolve(t)}catch(e){return eC.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):eC.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):eC.reject(t)}static resolve(e){return new eC((t,n)=>{t(e)})}static reject(e){return new eC((t,n)=>{n(e)})}static waitFor(e){return new eC((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=eC.resolve(!1);for(let n of e)t=t.next(e=>e?eC.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new eC((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new eC((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}let eA="SimpleDb";class eD{static open(e,t,n,r){try{return new eD(t,e.transaction(r,n))}catch(e){throw new eM(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new F,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new eM(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let n=eF(t.target.error);this.S.reject(new eM(e,n))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(D(eA,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new eP(this.transaction.objectStore(e))}}class eN{static delete(e){return D(eA,"Removing database:",e),eV((0,v.getGlobal)().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!(0,v.isIndexedDBAvailable)())return!1;if(eN.F())return!0;let e=(0,v.getUA)(),t=eN.M(e),n=ek(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static F(){return void 0!==y.default&&"YES"===y.default.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,n){this.name=e,this.version=t,this.N=n,this.B=null,12.2===eN.M((0,v.getUA)())&&N("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(D(eA,"Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new eM(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new L(V.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new L(V.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new eM(e,r))},r.onupgradeneeded=e=>{D(eA,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,r.transaction,e.oldVersion,this.version).next(()=>{D(eA,"Database upgrade to version "+this.version+" complete")})}})),this.K&&(this.db.onversionchange=e=>this.K(e)),this.db}q(e){this.K=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.L(e);let t=eD.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),eC.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(D(eA,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ek(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class eR{constructor(e){this.U=e,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(e){this.U=e}done(){this.$=!0}j(e){this.W=e}delete(){return eV(this.U.delete())}}class eM extends L{constructor(e,t){super(V.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function eO(e){return"IndexedDbTransactionError"===e.name}class eP{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(D(eA,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(D(eA,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),eV(n)}add(e){return D(eA,"ADD",this.store.name,e,e),eV(this.store.add(e))}get(e){return eV(this.store.get(e)).next(t=>(void 0===t&&(t=null),D(eA,"GET",this.store.name,e,t),t))}delete(e){return D(eA,"DELETE",this.store.name,e),eV(this.store.delete(e))}count(){return D(eA,"COUNT",this.store.name),eV(this.store.count())}H(e,t){let n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(n.range);return new eC((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),t=[];return this.J(e,(e,n)=>{t.push(n)}).next(()=>t)}}Z(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new eC((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}X(e,t){D(eA,"DELETE ALL",this.store.name);let n=this.options(e,t);n.Y=!1;let r=this.cursor(n);return this.J(r,(e,t,n)=>n.delete())}ee(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.J(r,t)}te(e){let t=this.cursor({});return new eC((n,r)=>{t.onerror=e=>{r(eF(e.target.error))},t.onsuccess=t=>{let r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}J(e,t){let n=[];return new eC((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new eR(i),a=t(i.primaryKey,i.value,s);if(a instanceof eC){let e=a.catch(e=>(s.done(),eC.reject(e)));n.push(e)}s.isDone?r():null===s.G?i.continue():i.continue(s.G)}}).next(()=>eC.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function eV(e){return new eC((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(eF(e.target.error))}})}let eL=!1;function eF(e){let t=eN.M((0,v.getUA)());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new L("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return eL||(eL=!0,setTimeout(()=>{throw e},0)),e}}return e}let eq="IndexBackfiller";class eU{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){D(eq,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();D(eq,`Documents written: ${e}`)}catch(e){eO(e)?D(eq,"Ignoring IndexedDB error during index backfill: ",e):await ex(e)}await this.re(6e4)})}}class eB{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let n=new Set,r=t,i=!0;return eC.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return D(eq,`Processing collection: ${t}`),this.oe(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}oe(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(r,n)).next(n=>(D(eq,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}_e(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=eI(t);eE(r,n)>0&&(n=r)}),new eT(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ej{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}function ez(e){return null==e}function eG(e){return 0===e&&1/e==-1/0}function eK(e){return"number"==typeof e&&Number.isInteger(e)&&!eG(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function e$(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"}ej.ce=-1;function eQ(e){let t=e.length;if(P(t>=2,64408,{path:e}),2===t)return P("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),Z.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&M(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:M(61167,{path:e})}s=t+2}return new Z(r)}let eH="remoteDocuments",eW="owner",eJ="owner",eY="mutationQueues",eX="mutations",eZ="batchId",e0="userMutationsIndex",e1=["userId","batchId"],e2={},e5="documentMutations",e3="remoteDocumentsV14",e4=["prefixPath","collectionGroup","readTime","documentId"],e6="documentKeyIndex",e8=["prefixPath","collectionGroup","documentId"],e7="collectionGroupIndex",e9=["collectionGroup","readTime","prefixPath","documentId"],te="remoteDocumentGlobal",tt="remoteDocumentGlobalKey",tn="targets",tr="queryTargetsIndex",ti=["canonicalId","targetId"],ts="targetDocuments",ta=["targetId","path"],to="documentTargetsIndex",tl=["path","targetId"],tu="targetGlobalKey",th="targetGlobal",tc="collectionParents",td=["collectionId","parent"],tf="clientMetadata",tm="bundles",tg="namedQueries",tp="indexConfiguration",ty="collectionGroupIndex",tw="indexState",tv=["indexId","uid"],tb="sequenceNumberIndex",tI=["uid","sequenceNumber"],tT="indexEntries",tE=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],t_="documentKeyIndex",tS=["indexId","uid","orderedDocumentKey"],tx="documentOverlays",tC=["userId","collectionPath","documentId"],tA="collectionPathOverlayIndex",tD=["userId","collectionPath","largestBatchId"],tN="collectionGroupOverlayIndex",tk=["userId","collectionGroup","largestBatchId"],tR="globals",tM=[eY,eX,e5,eH,tn,eW,th,ts,tf,te,tc,tm,tg],tO=[...tM,tx],tP=[eY,eX,e5,e3,tn,eW,th,ts,tf,te,tc,tm,tg,tx],tV=[...tP,tp,tw,tT],tL=[...tV,tR];class tF extends eS{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function tq(e,t){return eN.O(e.le,t)}function tU(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function tB(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function tj(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class tz{constructor(e,t){this.comparator=e,this.root=t||tK.EMPTY}insert(e,t){return new tz(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,tK.BLACK,null,null))}remove(e){return new tz(this.comparator,this.root.remove(e,this.comparator).copy(null,null,tK.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new tG(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new tG(this.root,e,this.comparator,!1)}getReverseIterator(){return new tG(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new tG(this.root,e,this.comparator,!0)}}class tG{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class tK{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:tK.RED,this.left=null!=r?r:tK.EMPTY,this.right=null!=i?i:tK.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new tK(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return tK.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return tK.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,tK.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,tK.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw M(43730,{key:this.key,value:this.value});if(this.right.isRed())throw M(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw M(27949);return e+ +!this.isRed()}}tK.EMPTY=null,tK.RED=!0,tK.BLACK=!1,tK.EMPTY=new class{constructor(){this.size=0}get key(){throw M(57766)}get value(){throw M(16141)}get color(){throw M(16727)}get left(){throw M(29726)}get right(){throw M(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new tK(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class t${constructor(e){this.comparator=e,this.data=new tz(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new tQ(this.data.getIterator())}getIteratorFrom(e){return new tQ(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof t$)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new t$(this.comparator);return t.data=e,t}}class tQ{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function tH(e){return e.hasNext()?e.getNext():void 0}class tW{constructor(e){this.fields=e,e.sort(et.comparator)}static empty(){return new tW([])}unionWith(e){let t=new t$(et.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new tW(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return J(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class tJ extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class tY{constructor(e){this.binaryString=e}static fromBase64String(e){return new tY(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new tJ("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new tY(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}tY.EMPTY_BYTE_STRING=new tY("");let tX=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function tZ(e){if(P(!!e,39018),"string"==typeof e){let t=0,n=tX.exec(e);if(P(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:t0(e.seconds),nanos:t0(e.nanos)}}function t0(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function t1(e){return"string"==typeof e?tY.fromBase64String(e):tY.fromUint8Array(e)}let t2="server_timestamp",t5="__type__",t3="__previous_value__",t4="__local_write_time__";function t6(e){return(e?.mapValue?.fields||{})[t5]?.stringValue===t2}function t8(e){let t=e.mapValue.fields[t3];return t6(t)?t8(t):t}function t7(e){let t=tZ(e.mapValue.fields[t4].timestampValue);return new ed(t.seconds,t.nanos)}class t9{constructor(e,t,n,r,i,s,a,o,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u,this.apiKey=h}}let ne="(default)";class nt{constructor(e,t){this.projectId=e,this.database=t||ne}static empty(){return new nt("","")}get isDefaultDatabase(){return this.database===ne}isEqual(e){return e instanceof nt&&e.projectId===this.projectId&&e.database===this.database}}let nn="__type__",nr="__max__",ni={mapValue:{fields:{__type__:{stringValue:nr}}}},ns="__vector__",na="value",no={nullValue:"NULL_VALUE"};function nl(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?t6(e)?4:nE(e)?0x1fffffffffffff:nI(e)?10:11:M(28295,{value:e})}function nu(e,t){if(e===t)return!0;let n=nl(e);if(n!==nl(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return t7(e).isEqual(t7(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=tZ(e.timestampValue),i=tZ(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return t1(e.bytesValue).isEqual(t1(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return t0(e.geoPointValue.latitude)===t0(t.geoPointValue.latitude)&&t0(e.geoPointValue.longitude)===t0(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return t0(e.integerValue)===t0(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=t0(e.doubleValue),r=t0(t.doubleValue);return n===r?eG(n)===eG(r):isNaN(n)&&isNaN(r)}return!1;case 9:return J(e.arrayValue.values||[],t.arrayValue.values||[],nu);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(tU(s)!==tU(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!nu(s[e],a[e])))return!1;return!0;default:return M(52216,{left:e})}}function nh(e,t){return void 0!==(e.values||[]).find(e=>nu(e,t))}function nc(e,t){var n,r,i,s,a,o;if(e===t)return 0;let l=nl(e),u=nl(t);if(l!==u)return Q(l,u);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return Q(e.booleanValue,t.booleanValue);case 2:let h,c;return h=t0(e.integerValue||e.doubleValue),h<(c=t0(t.integerValue||t.doubleValue))?-1:h>c?1:h===c?0:isNaN(h)?isNaN(c)?0:-1:1;case 3:return nd(e.timestampValue,t.timestampValue);case 4:return nd(t7(e),t7(t));case 5:return H(e.stringValue,t.stringValue);case 6:let d,f;return n=e.bytesValue,r=t.bytesValue,d=t1(n),f=t1(r),d.compareTo(f);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=Q(n[e],r[e]);if(0!==t)return t}return Q(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:let m;return i=e.geoPointValue,s=t.geoPointValue,0!==(m=Q(t0(i.latitude),t0(s.latitude)))?m:Q(t0(i.longitude),t0(s.longitude));case 9:return nf(e.arrayValue,t.arrayValue);case 10:let g,p,y,w,v;return a=e.mapValue,o=t.mapValue,g=a.fields||{},p=o.fields||{},y=g[na]?.arrayValue,w=p[na]?.arrayValue,0!==(v=Q(y?.values?.length||0,w?.values?.length||0))?v:nf(y,w);case 11:return function(e,t){if(e===ni.mapValue&&t===ni.mapValue)return 0;if(e===ni.mapValue)return 1;if(t===ni.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=H(r[e],s[e]);if(0!==t)return t;let a=nc(n[r[e]],i[s[e]]);if(0!==a)return a}return Q(r.length,s.length)}(e.mapValue,t.mapValue);default:throw M(23264,{he:l})}}function nd(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Q(e,t);let n=tZ(e),r=tZ(t),i=Q(n.seconds,r.seconds);return 0!==i?i:Q(n.nanos,r.nanos)}function nf(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=nc(n[e],r[e]);if(t)return t}return Q(n.length,r.length)}function nm(e){var t,n;let r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(r=tZ(e.timestampValue),`time(${r.seconds},${r.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?t1(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,en.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=nm(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${nm(e.fields[i])}`;return n+"}"}(e.mapValue):M(61005,{value:e})}function ng(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function np(e){return!!e&&"integerValue"in e}function ny(e){return!!e&&"arrayValue"in e}function nw(e){return!!e&&"nullValue"in e}function nv(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function nb(e){return!!e&&"mapValue"in e}function nI(e){return(e?.mapValue?.fields||{})[nn]?.stringValue===ns}function nT(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return tB(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=nT(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=nT(e.arrayValue.values[n]);return t}return{...e}}function nE(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===nr}let n_={mapValue:{fields:{[nn]:{stringValue:ns},[na]:{arrayValue:{}}}}};function nS(e,t){let n=nc(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function nx(e,t){let n=nc(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class nC{constructor(e){this.value=e}static empty(){return new nC({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!nb(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=nT(t)}setAll(e){let t=et.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=nT(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());nb(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return nu(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];nb(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(tB(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new nC(nT(this.value))}}class nA{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new nA(e,0,ef.min(),ef.min(),ef.min(),nC.empty(),0)}static newFoundDocument(e,t,n,r){return new nA(e,1,t,ef.min(),n,r,0)}static newNoDocument(e,t){return new nA(e,2,t,ef.min(),ef.min(),nC.empty(),0)}static newUnknownDocument(e,t){return new nA(e,3,t,ef.min(),ef.min(),nC.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(ef.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=nC.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=nC.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ef.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof nA&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new nA(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class nD{constructor(e,t){this.position=e,this.inclusive=t}}function nN(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?en.comparator(en.fromName(a.referenceValue),n.key):nc(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function nk(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!nu(e.position[n],t.position[n]))return!1;return!0}class nR{constructor(e,t="asc"){this.field=e,this.dir=t}}class nM{}class nO extends nM{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new nB(e,t,n):"array-contains"===t?new nK(e,n):"in"===t?new n$(e,n):"not-in"===t?new nQ(e,n):"array-contains-any"===t?new nH(e,n):new nO(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new nj(e,n):new nz(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(nc(t,this.value)):null!==t&&nl(this.value)===nl(t)&&this.matchesComparison(nc(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return M(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class nP extends nM{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new nP(e,t)}matches(e){return nV(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function nV(e){return"and"===e.op}function nL(e){return"or"===e.op}function nF(e){return nq(e)&&nV(e)}function nq(e){for(let t of e.filters)if(t instanceof nP)return!1;return!0}function nU(e,t){let n=e.filters.concat(t);return nP.create(n,e.op)}class nB extends nO{constructor(e,t,n){super(e,t,n),this.key=en.fromName(n.referenceValue)}matches(e){let t=en.comparator(e.key,this.key);return this.matchesComparison(t)}}class nj extends nO{constructor(e,t){super(e,"in",t),this.keys=nG("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class nz extends nO{constructor(e,t){super(e,"not-in",t),this.keys=nG("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function nG(e,t){return(t.arrayValue?.values||[]).map(e=>en.fromName(e.referenceValue))}class nK extends nO{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return ny(t)&&nh(t.arrayValue,this.value)}}class n$ extends nO{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&nh(this.value.arrayValue,t)}}class nQ extends nO{constructor(e,t){super(e,"not-in",t)}matches(e){if(nh(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!nh(this.value.arrayValue,t)}}class nH extends nO{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!ny(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>nh(this.value.arrayValue,e))}}class nW{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function nJ(e,t=null,n=[],r=[],i=null,s=null,a=null){return new nW(e,t,n,r,i,s,a)}function nY(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof nO)return t.field.canonicalString()+t.op.toString()+nm(t.value);if(nF(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),ez(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>nm(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>nm(e)).join(",")),e.Te=t}return e.Te}function nX(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof nO?n instanceof nO&&t.op===n.op&&t.field.isEqual(n.field)&&nu(t.value,n.value):t instanceof nP?n instanceof nP&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void M(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!nk(e.startAt,t.startAt)&&nk(e.endAt,t.endAt)}function nZ(e){return en.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function n0(e,t){return e.filters.filter(e=>e instanceof nO&&e.field.isEqual(t))}function n1(e,t,n){let r=no,i=!0;for(let n of n0(e,t)){let e=no,t=!0;switch(n.op){case"<":case"<=":var s;e="nullValue"in(s=n.value)?no:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?ng(nt.empty(),en.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?nI(s)?n_:{mapValue:{}}:M(35942,{value:s});break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=no}0>nS({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>nS({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function n2(e,t,n){let r=ni,i=!0;for(let n of n0(e,t)){let e=ni,t=!0;switch(n.op){case">=":case">":var s;e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?ng(nt.empty(),en.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?n_:"mapValue"in s?nI(s)?{mapValue:{}}:ni:M(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=ni}nx({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];nx({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}class n5{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function n3(e){return new n5(e)}function n4(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function n6(e){return null!==e.collectionGroup}function n8(e){if(null===e.Ie){let t;e.Ie=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new t$(et.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new nR(t,r))}),n.has(et.keyField().canonicalString())||e.Ie.push(new nR(et.keyField(),r))}return e.Ie}function n7(e){return e.Ee||(e.Ee=n9(e,n8(e))),e.Ee}function n9(e,t){if("F"===e.limitType)return nJ(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new nR(e.field,t)});let n=e.endAt?new nD(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new nD(e.startAt.position,e.startAt.inclusive):null;return nJ(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function re(e,t){let n=e.filters.concat([t]);return new n5(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function rt(e,t,n){return new n5(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function rn(e,t){return nX(n7(e),n7(t))&&e.limitType===t.limitType}function rr(e){return`${nY(n7(e))}|lt:${e.limitType}`}function ri(e){var t;let n;return`Query(target=${n=(t=n7(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof nO?`${t.field.canonicalString()} ${t.op} ${nm(t.value)}`:t instanceof nP?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),ez(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>nm(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>nm(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function rs(e,t){var n,r,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):en.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let n of n8(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(n=e,r=t,(!n.startAt||(i=n.startAt,o=nN(i,n8(n),r),i.inclusive?!!(o<=0):!!(o<0)))&&(!n.endAt||(s=n.endAt,l=nN(s,n8(n),r),s.inclusive?!!(l>=0):!!(l>0))))}function ra(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function ro(e){return(t,n)=>{let r=!1;for(let i of n8(e)){let e=function(e,t,n){var r;let i,s,a=e.field.isKeyField()?en.comparator(t.key,n.key):(r=e.field,i=t.data.field(r),s=n.data.field(r),null!==i&&null!==s?nc(i,s):M(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return M(19790,{direction:e.dir})}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class rl{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){tB(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return tj(this.inner)}size(){return this.innerSize}}let ru=new tz(en.comparator),rh=new tz(en.comparator);function rc(...e){let t=rh;for(let n of e)t=t.insert(n.key,n);return t}function rd(e){let t=rh;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function rf(){return new rl(e=>e.toString(),(e,t)=>e.isEqual(t))}let rm=new tz(en.comparator),rg=new t$(en.comparator);function rp(...e){let t=rg;for(let n of e)t=t.add(n);return t}let ry=new t$(Q);function rw(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:eG(t)?"-0":t}}function rv(e){return{integerValue:""+e}}function rb(e,t){return eK(t)?rv(t):rw(e,t)}class rI{constructor(){this._=void 0}}function rT(e,t){return e instanceof rA?np(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class rE extends rI{}class r_ extends rI{constructor(e){super(),this.elements=e}}function rS(e,t){let n=rN(t);for(let t of e.elements)n.some(e=>nu(e,t))||n.push(t);return{arrayValue:{values:n}}}class rx extends rI{constructor(e){super(),this.elements=e}}function rC(e,t){let n=rN(t);for(let t of e.elements)n=n.filter(e=>!nu(e,t));return{arrayValue:{values:n}}}class rA extends rI{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function rD(e){return t0(e.integerValue||e.doubleValue)}function rN(e){return ny(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class rk{constructor(e,t){this.field=e,this.transform=t}}class rR{constructor(e,t){this.version=e,this.transformResults=t}}class rM{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new rM}static exists(e){return new rM(void 0,e)}static updateTime(e){return new rM(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function rO(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class rP{}function rV(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new rG(e.key,rM.none()):new rq(e.key,e.data,rM.none());{let n=e.data,r=nC.empty(),i=new t$(et.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new rU(e.key,r,new tW(i.toArray()),rM.none())}}function rL(e,t,n,r){return e instanceof rq?function(e,t,n,r){if(!rO(e.precondition,t))return n;let i=e.value.clone(),s=rz(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof rU?function(e,t,n,r){if(!rO(e.precondition,t))return n;let i=rz(e.fieldTransforms,r,t),s=t.data;return(s.setAll(rB(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):rO(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function rF(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&J(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof r_&&r instanceof r_||n instanceof rx&&r instanceof rx?J(n.elements,r.elements,nu):n instanceof rA&&r instanceof rA?nu(n.Ae,r.Ae):n instanceof rE&&r instanceof rE)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class rq extends rP{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class rU extends rP{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function rB(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function rj(e,t,n){let r=new Map;P(e.length===n.length,32656,{Ve:n.length,de:e.length});for(let s=0;s<n.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);r.set(a.field,(i=n[s],o instanceof r_?rS(o,l):o instanceof rx?rC(o,l):i))}return r}function rz(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,function(e,t,n){var r;let i,s,a;return e instanceof rE?(r=t,i={fields:{[t5]:{stringValue:t2},[t4]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},r&&t6(r)&&(r=t8(r)),r&&(i.fields[t3]=r),{mapValue:i}):e instanceof r_?rS(e,t):e instanceof rx?rC(e,t):(a=rD(s=rT(e,t))+rD(e.Ae),np(s)&&np(e.Ae)?rv(a):rw(e.serializer,a))}(e,s,t))}return r}class rG extends rP{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class rK extends rP{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class r${constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){let r,i;e instanceof rq?(r=e.value.clone(),i=rj(e.fieldTransforms,t,n.transformResults),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()):e instanceof rU?function(e,t,n){if(!rO(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=rj(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(rB(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=rL(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=rL(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=rf();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=rV(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(ef.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),rp())}isEqual(e){return this.batchId===e.batchId&&J(this.mutations,e.mutations,(e,t)=>rF(e,t))&&J(this.baseMutations,e.baseMutations,(e,t)=>rF(e,t))}}class rQ{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){P(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=rm,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new rQ(e,t,n,r)}}class rH{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class rW{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}class rJ{constructor(e,t){this.count=e,this.unchangedNames=t}}function rY(e){switch(e){case V.OK:return M(64938);case V.CANCELLED:case V.UNKNOWN:case V.DEADLINE_EXCEEDED:case V.RESOURCE_EXHAUSTED:case V.INTERNAL:case V.UNAVAILABLE:case V.UNAUTHENTICATED:return!1;case V.INVALID_ARGUMENT:case V.NOT_FOUND:case V.ALREADY_EXISTS:case V.PERMISSION_DENIED:case V.FAILED_PRECONDITION:case V.ABORTED:case V.OUT_OF_RANGE:case V.UNIMPLEMENTED:case V.DATA_LOSS:return!0;default:return M(15467,{code:e})}}function rX(e){if(void 0===e)return N("GRPC error has no .code"),V.UNKNOWN;switch(e){case c.OK:return V.OK;case c.CANCELLED:return V.CANCELLED;case c.UNKNOWN:return V.UNKNOWN;case c.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case c.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case c.INTERNAL:return V.INTERNAL;case c.UNAVAILABLE:return V.UNAVAILABLE;case c.UNAUTHENTICATED:return V.UNAUTHENTICATED;case c.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case c.NOT_FOUND:return V.NOT_FOUND;case c.ALREADY_EXISTS:return V.ALREADY_EXISTS;case c.PERMISSION_DENIED:return V.PERMISSION_DENIED;case c.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case c.ABORTED:return V.ABORTED;case c.OUT_OF_RANGE:return V.OUT_OF_RANGE;case c.UNIMPLEMENTED:return V.UNIMPLEMENTED;case c.DATA_LOSS:return V.DATA_LOSS;default:return M(39323,{code:e})}}(d=c||(c={}))[d.OK=0]="OK",d[d.CANCELLED=1]="CANCELLED",d[d.UNKNOWN=2]="UNKNOWN",d[d.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",d[d.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",d[d.NOT_FOUND=5]="NOT_FOUND",d[d.ALREADY_EXISTS=6]="ALREADY_EXISTS",d[d.PERMISSION_DENIED=7]="PERMISSION_DENIED",d[d.UNAUTHENTICATED=16]="UNAUTHENTICATED",d[d.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",d[d.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",d[d.ABORTED=10]="ABORTED",d[d.OUT_OF_RANGE=11]="OUT_OF_RANGE",d[d.UNIMPLEMENTED=12]="UNIMPLEMENTED",d[d.INTERNAL=13]="INTERNAL",d[d.UNAVAILABLE=14]="UNAVAILABLE",d[d.DATA_LOSS=15]="DATA_LOSS";let rZ=null;function r0(){return new TextEncoder}let r1=new t([0xffffffff,0xffffffff],0);function r2(e){let t=r0().encode(e),r=new n;return r.update(t),new Uint8Array(r.digest())}function r5(e){let n=new DataView(e.buffer),r=n.getUint32(0,!0),i=n.getUint32(4,!0),s=n.getUint32(8,!0),a=n.getUint32(12,!0);return[new t([r,i],0),new t([s,a],0)]}class r3{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new r4(`Invalid padding: ${n}`);if(r<0||e.length>0&&0===this.hashCount)throw new r4(`Invalid hash count: ${r}`);if(0===e.length&&0!==n)throw new r4(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=t.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(t.fromNumber(r)));return 1===i.compare(r1)&&(i=new t([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,n]=r5(r2(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);if(!this.we(r))return!1}return!0}static create(e,t,n){let r=new r3(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.ge)return;let[t,n]=r5(r2(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);this.be(r)}}be(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class r4 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class r6{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,r8.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new r6(ef.min(),r,new tz(Q),ru,rp())}}class r8{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new r8(n,t,rp(),rp(),rp())}}class r7{constructor(e,t,n,r){this.Se=e,this.removedTargetIds=t,this.key=n,this.De=r}}class r9{constructor(e,t){this.targetId=e,this.Ce=t}}class ie{constructor(e,t,n=tY.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class it{constructor(){this.ve=0,this.Fe=is(),this.Me=tY.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=rp(),t=rp(),n=rp();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:M(38017,{changeType:i})}}),new r8(this.Me,this.xe,e,t,n)}Ke(){this.Oe=!1,this.Fe=is()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,P(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class ir{constructor(e){this.Ge=e,this.ze=new Map,this.je=ru,this.He=ii(),this.Je=ii(),this.Ze=new tz(Q)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.We(),n.Ne||n.Ke(),n.Le(e.resumeToken);break;case 2:n.We(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.Qe(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:M(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){let t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){let a=r.target;if(nZ(a))if(0===n){let e=new en(a.path);this.et(t,e,nA.newNoDocument(e,ef.min()))}else P(1===n,20013,{expectedCount:n});else{let r=this._t(t);if(r!==n){var i,s;let n,a,o=this.ut(e),l=o?this.ct(o,e,r):1;0!==l&&(this.it(t),this.Ze=this.Ze.insert(t,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),rZ?.lt((i=e.Ce,s=this.Ge.ht(),n={localCacheCount:r,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(a=i.unchangedNames)&&(n.bloomFilter={applied:0===l,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>o?.mightContain(e)??!1}),n))}}}}ut(e){let t,n,r=e.Ce.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=t1(i).toUint8Array()}catch(e){if(e instanceof tJ)return k("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new r3(t,s,a)}catch(e){return k(e instanceof r4?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.ge?null:n}ct(e,t,n){return 2*(t.Ce.count!==n-this.Pt(e,t.targetId))}Pt(e,t){let n=this.Ge.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.et(t,n,null),r++)}),r}Tt(e){let t=new Map;this.ze.forEach((n,r)=>{let i=this.ot(r);if(i){if(n.current&&nZ(i.target)){let t=new en(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,nA.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.Ke())}});let n=rp();this.Je.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));let r=new r6(e,t,this.Ze,this.je,n);return this.je=ru,this.He=ii(),this.Je=ii(),this.Ze=new tz(Q),r}Ye(e,t){if(!this.rt(e))return;let n=2*!!this.Et(e,t.key);this.nt(e).qe(t.key,n),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;let r=this.nt(e);this.Et(e,t)?r.qe(t,1):r.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new it,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new t$(Q),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new t$(Q),this.He=this.He.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||D("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new it),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ii(){return new tz(en.comparator)}function is(){return new tz(en.comparator)}let ia={asc:"ASCENDING",desc:"DESCENDING"},io={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},il={and:"AND",or:"OR"};class iu{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ih(e,t){return e.useProto3Json||ez(t)?t:{value:t}}function ic(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function id(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function im(e){let t;return P(!!e,49232),ef.fromTimestamp(new ed((t=tZ(e)).seconds,t.nanos))}function ig(e,t){return ip(e,t).canonicalString()}function ip(e,t){let n=new Z(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function iy(e){let t=Z.fromString(e);return P(iM(t),10190,{key:t.toString()}),t}function iw(e,t){return ig(e.databaseId,t.path)}function iv(e,t){let n=iy(t);if(n.get(1)!==e.databaseId.projectId)throw new L(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new L(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new en(iE(n))}function ib(e,t){return ig(e.databaseId,t)}function iI(e){let t=iy(e);return 4===t.length?Z.emptyPath():iE(t)}function iT(e){return new Z(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function iE(e){return P(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function i_(e,t,n){return{name:iw(e,t),fields:n.value.mapValue.fields}}function iS(e,t,n){let r=iv(e,t.name),i=im(t.updateTime),s=t.createTime?im(t.createTime):ef.min(),a=new nC({mapValue:{fields:t.fields}}),o=nA.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function ix(e,t){var n,r;let i;if(t instanceof rq)i={update:i_(e,t.key,t.value)};else if(t instanceof rG)i={delete:iw(e,t.key)};else if(t instanceof rU){let n;i={update:i_(e,t.key,t.data),updateMask:(r=t.fieldMask,n=[],r.fields.forEach(e=>n.push(e.canonicalString())),{fieldPaths:n})}}else{if(!(t instanceof rK))return M(16599,{dt:t.type});i={verify:iw(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof rE)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof r_)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof rx)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof rA)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw M(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:ic(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:M(27497)),i}function iC(e,t){var n;let r=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?rM.updateTime(im(n.updateTime)):void 0!==n.exists?rM.exists(n.exists):rM.none():rM.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let n;return n=null,"setToServerValue"in t?(P("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),n=new rE):"appendMissingElements"in t?n=new r_(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new rx(t.removeAllFromArray.values||[]):"increment"in t?n=new rA(e,t.increment):M(16584,{proto:t}),new rk(et.fromServerFormat(t.fieldPath),n)}):[];if(t.update){t.update.name;let n=iv(e,t.update.name),s=new nC({mapValue:{fields:t.update.fields}});return t.updateMask?new rU(n,s,new tW((t.updateMask.fieldPaths||[]).map(e=>et.fromServerFormat(e))),r,i):new rq(n,s,r,i)}return t.delete?new rG(iv(e,t.delete),r):t.verify?new rK(iv(e,t.verify),r):M(1463,{proto:t})}function iA(e,t){return{documents:[ib(e,t.path)]}}function iD(e,t){var n,r;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=ib(e,i);let o=function(e){if(0!==e.length)return function e(t){var n;let r;return t instanceof nO?function(e){if("=="===e.op){if(nv(e.value))return{unaryFilter:{field:ik(e.field),op:"IS_NAN"}};if(nw(e.value))return{unaryFilter:{field:ik(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(nv(e.value))return{unaryFilter:{field:ik(e.field),op:"IS_NOT_NAN"}};if(nw(e.value))return{unaryFilter:{field:ik(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ik(e.field),op:io[e.op],value:e.value}}}(t):t instanceof nP?1===(r=(n=t).getFilters().map(t=>e(t))).length?r[0]:{compositeFilter:{op:il[n.op],filters:r}}:M(54877,{filter:t})}(nP.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:ik(e.field),direction:ia[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=ih(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),{ft:s,parent:i}}function iN(e){var t,n,r;let i,s,a,o,l=iI(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){P(1===h,65062);let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=iR(e.unaryFilter.field);return nO.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=iR(e.unaryFilter.field);return nO.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=iR(e.unaryFilter.field);return nO.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=iR(e.unaryFilter.field);return nO.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return M(61313);default:return M(60726)}}(t):void 0!==t.fieldFilter?nO.create(iR(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return M(58110);default:return M(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?nP.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return M(1026)}}(t.compositeFilter.op)):M(30097,{filter:t})}(u.where))instanceof nP&&nF(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new nR(iR(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let m=null;u.limit&&(m=ez(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let g=null;u.startAt&&(a=!!(n=u.startAt).before,g=new nD(n.values||[],a));let p=null;return u.endAt&&(o=!(r=u.endAt).before,p=new nD(r.values||[],o)),new n5(l,c,f,d,m,"F",g,p)}function ik(e){return{fieldPath:e.canonicalString()}}function iR(e){return et.fromServerFormat(e.fieldPath)}function iM(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function iO(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class iP{constructor(e,t,n,r,i=ef.min(),s=ef.min(),a=tY.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new iP(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new iP(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new iP(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new iP(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class iV{constructor(e){this.yt=e}}function iL(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:iF(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;r.document={name:iw(i=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:ic(i,t.version.toTimestamp()),createTime:ic(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:iq(t.version)};else{if(!t.isUnknownDocument())return M(57904,{document:t});r.unknownDocument={path:n.path.toArray(),version:iq(t.version)}}return r}function iF(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function iq(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function iU(e){let t=new ed(e.seconds,e.nanoseconds);return ef.fromTimestamp(t)}function iB(e,t){let n=(t.baseMutations||[]).map(t=>iC(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(n.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let r=t.mutations.map(t=>iC(e.yt,t)),i=ed.fromMillis(t.localWriteTimeMs);return new r$(t.batchId,i,n,r)}function ij(e){var t;let n,r=iU(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?iU(e.lastLimboFreeSnapshotVersion):ef.min();return new iP(void 0!==e.query.documents?(P(1===(n=(t=e.query).documents.length),1966,{count:n}),n7(n3(iI(t.documents[0])))):n7(iN(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,i,tY.fromBase64String(e.resumeToken))}function iz(e,t){let n,r=iq(t.snapshotVersion),i=iq(t.lastLimboFreeSnapshotVersion);n=nZ(t.target)?iA(e.yt,t.target):iD(e.yt,t.target).ft;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:nY(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function iG(e){let t=iN({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?rt(t,t.limit,"L"):t}function iK(e,t){return new rH(t.largestBatchId,iC(e.yt,t.overlayMutation))}function i$(e,t){let n=t.path.lastSegment();return[e,e$(t.path.popLast()),n]}function iQ(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:iq(r.readTime),documentKey:e$(r.documentKey.path),largestBatchId:r.largestBatchId}}class iH{getBundleMetadata(e,t){return tq(e,tm).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:iU(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return tq(e,tm).put({bundleId:t.id,createTime:iq(im(t.createTime)),version:t.version})}getNamedQuery(e,t){return tq(e,tg).get(t).next(e=>{if(e)return{name:e.name,query:iG(e.bundledQuery),readTime:iU(e.readTime)}})}saveNamedQuery(e,t){return tq(e,tg).put({name:t.name,readTime:iq(im(t.readTime)),bundledQuery:t.bundledQuery})}}class iW{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){return new iW(e,t.uid||"")}getOverlay(e,t){return tq(e,tx).get(i$(this.userId,t)).next(e=>e?iK(this.serializer,e):null)}getOverlays(e,t){let n=rf();return eC.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new rH(t,i);r.push(this.bt(e,s))}),eC.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(e$(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(tq(e,tx).X(tA,r))}),eC.waitFor(i)}getOverlaysForCollection(e,t,n){let r=rf(),i=e$(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,1/0],!0);return tq(e,tx).H(tA,s).next(e=>{for(let t of e){let e=iK(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i,s=rf(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,1/0],!0);return tq(e,tx).ee({index:tN,range:a},(e,t,n)=>{let a=iK(this.serializer,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}bt(e,t){return tq(e,tx).put(function(e,t,n){let[r,i,s]=i$(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:ix(e.yt,n.mutation)}}(this.serializer,this.userId,t))}}class iJ{St(e){return tq(e,tR)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{let t=e?.value;return t?tY.fromUint8Array(t):tY.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class iY{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(t0(e.integerValue));else if("doubleValue"in e){let n=t0(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),eG(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=tZ(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(t1(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?nE(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):nI(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):M(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let n=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(n)))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){let n=e.fields||{};this.Ft(t,53);let r=n[na].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(t0(r)),this.Ot(na,t),this.Ct(n[na],t)}qt(e,t){let n=e.values||[];for(let e of(this.Ft(t,50),n))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),en.fromName(e).path.forEach(e=>{this.Ft(t,60),this.$t(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function iX(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let r=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[n]);if(t+=r,8!==r)break}return t}(e))/8)}iY.Wt=new iY;class iZ{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Gt(n.value),n=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ht(n.value),n=t.next();this.Jt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Xt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ht(e);else if(e<2048)this.Ht(960|e>>>6),this.Ht(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Ht(480|e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e);else{let e=t.codePointAt(0);this.Ht(240|e>>>18),this.Ht(128|63&e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e)}}this.Jt()}Yt(e){let t=this.en(e),n=iX(t);this.tn(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),n=iX(t);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t,n=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),r=!!(128&n[0]);n[0]^=r?255:128;for(let e=1;e<n.length;++e)n[e]^=255*!!r;return n}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Ht(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class i0{constructor(e){this.cn=e}Bt(e){this.cn.Qt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.Yt(e)}vt(){this.cn.rn()}}class i1{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Xt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class i2{constructor(){this.cn=new iZ,this.ascending=new i0(this.cn),this.descending=new i1(this.cn)}seed(e){this.cn.seed(e)}ln(e){return 0===e?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class i5{constructor(e,t,n,r){this.hn=e,this.Pn=t,this.Tn=n,this.In=r}En(){let e=this.In.length,t=0===e||255===this.In[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.In,0),t!==e?n.set([0],this.In.length):++n[n.length-1],new i5(this.hn,this.Pn,this.Tn,n)}Rn(e,t,n){return{indexId:this.hn,uid:e,arrayValue:i6(this.Tn),directionalValue:i6(this.In),orderedDocumentKey:i6(t),documentKey:n.path.toArray()}}An(e,t,n){let r=this.Rn(e,t,n);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function i3(e,t){let n=e.hn-t.hn;return 0!==n||0!==(n=i4(e.Tn,t.Tn))||0!==(n=i4(e.In,t.In))?n:en.comparator(e.Pn,t.Pn)}function i4(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}function i6(e){return(0,v.isSafariOrWebkit)()?function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}(e):e}function i8(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)}class i7{constructor(e){for(const t of(this.Vn=new t$((e,t)=>et.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.mn=[],e.filters))t.isInequality()?this.Vn=this.Vn.add(t):this.mn.push(t)}get fn(){return this.Vn.size>1}gn(e){if(P(e.collectionGroup===this.collectionId,49279),this.fn)return!1;let t=eg(e);if(void 0!==t&&!this.pn(t))return!1;let n=ep(e),r=new Set,i=0,s=0;for(;i<n.length&&this.pn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Vn.size>0){let e=this.Vn.getIterator().getNext();if(!r.has(e.field.canonicalString())){let t=n[i];if(!this.yn(e,t)||!this.wn(this.dn[s++],t))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.dn.length||!this.wn(this.dn[s++],e))return!1}return!0}bn(){if(this.fn)return null;let e=new t$(et.comparator),t=[];for(let n of this.mn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new ew(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new ew(n.field,0))}for(let n of this.dn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new ew(n.field,+("asc"!==n.dir))));return new em(em.UNKNOWN_ID,this.collectionId,t,ev.empty())}pn(e){for(let t of this.mn)if(this.yn(t,e))return!0;return!1}yn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}wn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function i9(e){return e instanceof nO}function se(e){return e instanceof nP&&nF(e)}function st(e){return i9(e)||se(e)||function(e){if(e instanceof nP&&nL(e)){for(let t of e.getFilters())if(!i9(t)&&!se(t))return!1;return!0}return!1}(e)}function sn(e,t){return P(e instanceof nO||e instanceof nP,38388),P(t instanceof nO||t instanceof nP,25473),si(e instanceof nO?t instanceof nO?nP.create([e,t],"and"):sr(e,t):t instanceof nO?sr(t,e):function(e,t){if(P(e.filters.length>0&&t.filters.length>0,48005),nV(e)&&nV(t))return nU(e,t.getFilters());let n=nL(e)?e:t,r=nL(e)?t:e,i=n.filters.map(e=>sn(e,r));return nP.create(i,"or")}(e,t))}function sr(e,t){if(nV(t))return nU(t,e.getFilters());{let n=t.filters.map(t=>sn(e,t));return nP.create(n,"or")}}function si(e){if(P(e instanceof nO||e instanceof nP,11850),e instanceof nO)return e;let t=e.getFilters();if(1===t.length)return si(t[0]);if(nq(e))return e;let n=t.map(e=>si(e)),r=[];return n.forEach(t=>{t instanceof nO?r.push(t):t instanceof nP&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:nP.create(r,e.op)}class ss{constructor(){this.Sn=new sa}addToCollectionParentIndex(e,t){return this.Sn.add(t),eC.resolve()}getCollectionParents(e,t){return eC.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return eC.resolve()}deleteFieldIndex(e,t){return eC.resolve()}deleteAllFieldIndexes(e){return eC.resolve()}createTargetIndexes(e,t){return eC.resolve()}getDocumentsMatchingTarget(e,t){return eC.resolve(null)}getIndexType(e,t){return eC.resolve(0)}getFieldIndexes(e,t){return eC.resolve([])}getNextCollectionGroupToUpdate(e){return eC.resolve(null)}getMinOffset(e,t){return eC.resolve(eT.min())}getMinOffsetFromCollectionGroup(e,t){return eC.resolve(eT.min())}updateCollectionGroup(e,t,n){return eC.resolve()}updateIndexEntries(e,t){return eC.resolve()}}class sa{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new t$(Z.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new t$(Z.comparator)).toArray()}}let so="IndexedDbIndexManager",sl=new Uint8Array(0);class su{constructor(e,t){this.databaseId=t,this.Dn=new sa,this.Cn=new rl(e=>nY(e),(e,t)=>nX(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Dn.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Dn.add(t)});let i={collectionId:n,parent:e$(r)};return tq(e,tc).put(i)}return eC.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return tq(e,tc).H(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(eQ(r.parent))}return n})}addFieldIndex(e,t){let n=tq(e,tp),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;let i=n.add(r);if(t.indexState){let n=tq(e,tw);return i.next(e=>{n.put(iQ(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let n=tq(e,tp),r=tq(e,tw),i=tq(e,tT);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=tq(e,tp),n=tq(e,tT),r=tq(e,tw);return t.X().next(()=>n.X()).next(()=>r.X())}createTargetIndexes(e,t){return eC.forEach(this.vn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new i7(t).bn();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=tq(e,tT),r=!0,i=new Map;return eC.forEach(this.vn(t),t=>this.Fn(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=rp(),r=[];return eC.forEach(i,(i,s)=>{D(so,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${nY(t)}`);let a=function(e,t){let n=eg(t);if(void 0===n)return null;for(let t of n0(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let n=new Map;for(let r of ep(t))for(let t of n0(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),l=function(e,t){let n=[],r=!0;for(let i of ep(t)){let t=0===i.kind?n1(e,i.fieldPath,e.startAt):n2(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new nD(n,r)}(s,i),u=function(e,t){let n=[],r=!0;for(let i of ep(t)){let t=0===i.kind?n2(e,i.fieldPath,e.endAt):n1(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new nD(n,r)}(s,i),h=this.Mn(i,s,l),c=this.Mn(i,s,u),d=this.xn(i,s,o),f=this.On(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return eC.forEach(f,i=>n.Z(i,t.limit).next(t=>{t.forEach(t=>{let n=en.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return eC.resolve(null)})}vn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(P(t instanceof nO||t instanceof nP,34018),t instanceof nO)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),r=nP.create(n,t.op);return st(r=si(r))?r:(P(r instanceof nP,64498),P(nV(r),40251),P(r.filters.length>1,57927),r.filters.reduce((e,t)=>sn(e,t)))}(function e(t){if(P(t instanceof nO||t instanceof nP,20012),t instanceof nO){if(t instanceof n$){let e=t.value.arrayValue?.values?.map(e=>nO.create(t.field,"==",e))||[];return nP.create(e,"or")}return t}let n=t.filters.map(t=>e(t));return nP.create(n,t.op)}(e));return P(st(t),7391),i9(t)||se(t)?[t]:t.getFilters()})(nP.create(e.filters,"and")).map(t=>nJ(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t)),t}On(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Nn(t[h/l]):sl,c=this.Bn(e,o,n[h%l],r),d=this.Ln(e,o,i[h%l],s),f=a.map(t=>this.Bn(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}Bn(e,t,n,r){let i=new i5(e,en.empty(),t,n);return r?i:i.En()}Ln(e,t,n,r){let i=new i5(e,en.empty(),t,n);return r?i.En():i}Fn(e,t){let n=new i7(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.gn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.vn(t);return eC.forEach(r,t=>this.Fn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new t$(et.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+ +!!n}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}kn(e,t){let n=new i2;for(let r of ep(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.ln(r.kind);iY.Wt.Dt(e,i)}return n.un()}Nn(e){let t=new i2;return iY.Wt.Dt(e,t.ln(0)),t.un()}Kn(e,t){let n,r=new i2;return iY.Wt.Dt(ng(this.databaseId,t),r.ln(0===(n=ep(e)).length?0:n[n.length-1].kind)),r.un()}xn(e,t,n){if(null===n)return[];let r=[];r.push(new i2);let i=0;for(let s of ep(e)){let e=n[i++];for(let n of r)if(this.qn(t,s.fieldPath)&&ny(e))r=this.Un(r,s,e);else{let t=n.ln(s.kind);iY.Wt.Dt(e,t)}}return this.$n(r)}Mn(e,t,n){return this.xn(e,t,n.position)}$n(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].un();return t}Un(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new i2;r.seed(n.un()),iY.Wt.Dt(e,r.ln(t.kind)),i.push(r)}return i}qn(e,t){return!!e.filters.find(e=>e instanceof nO&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=tq(e,tp),r=tq(e,tw);return(t?n.H(ty,IDBKeyRange.bound(t,t)):n.H()).next(e=>{let t=[];return eC.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{let r,i;t.push((r=n?new ev(n.sequenceNumber,new eT(iU(n.readTime),new en(eQ(n.documentKey)),n.largestBatchId)):ev.empty(),i=e.fields.map(([e,t])=>new ew(et.fromServerFormat(e),t)),new em(e.indexId,e.collectionGroup,i,r)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Q(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=tq(e,tp),i=tq(e,tw);return this.Wn(e).next(e=>r.H(ty,IDBKeyRange.bound(t,t)).next(t=>eC.forEach(t,t=>i.put(iQ(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){let n=new Map;return eC.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?eC.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),eC.forEach(i,n=>this.Qn(e,t,n).next(t=>{let i=this.Gn(r,n);return t.isEqual(i)?eC.resolve():this.zn(e,r,n,t,i)}))))})}jn(e,t,n,r){return tq(e,tT).put(r.Rn(this.uid,this.Kn(n,t.key),t.key))}Hn(e,t,n,r){return tq(e,tT).delete(r.An(this.uid,this.Kn(n,t.key),t.key))}Qn(e,t,n){let r=tq(e,tT),i=new t$(i3);return r.ee({index:t_,range:IDBKeyRange.only([n.indexId,this.uid,i6(this.Kn(n,t))])},(e,r)=>{i=i.add(new i5(n.indexId,t,i8(r.arrayValue),i8(r.directionalValue)))}).next(()=>i)}Gn(e,t){let n=new t$(i3),r=this.kn(t,e);if(null==r)return n;let i=eg(t);if(null!=i){let s=e.data.field(i.fieldPath);if(ny(s))for(let i of s.arrayValue.values||[])n=n.add(new i5(t.indexId,e.key,this.Nn(i),r))}else n=n.add(new i5(t.indexId,e.key,sl,r));return n}zn(e,t,n,r,i){D(so,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=tH(s),l=tH(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=tH(a)):t?(i(o),o=tH(s)):(o=tH(s),l=tH(a))}}(r,i,i3,r=>{s.push(this.jn(e,t,n,r))},r=>{s.push(this.Hn(e,t,n,r))}),eC.waitFor(s)}Wn(e){let t=1;return tq(e,tw).ee({index:tb,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>i3(e,t)).filter((e,t,n)=>!t||0!==i3(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=i3(i,e),s=i3(i,t);if(0===n)r[0]=e.En();else if(n>0&&s<0)r.push(i),r.push(i.En());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.Jn(r[e],r[e+1]))return[];let t=r[e].An(this.uid,sl,en.empty()),n=r[e+1].An(this.uid,sl,en.empty());i.push(IDBKeyRange.bound(t,n))}return i}Jn(e,t){return i3(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(sh)}getMinOffset(e,t){return eC.mapArray(this.vn(t),t=>this.Fn(e,t).next(e=>e||M(44426))).next(sh)}}function sh(e){P(0!==e.length,28825);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>eE(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new eT(t.readTime,t.documentKey,n)}let sc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class sd{static withCacheSize(e){return new sd(e,sd.DEFAULT_COLLECTION_PERCENTILE,sd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function sf(e,t,n){let r=e.store(eX),i=e.store(e5),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.ee({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{P(1===o,47070,{batchId:n.batchId})}));let u=[];for(let e of n.mutations){var h,c;let r=(h=e.key.path,c=n.batchId,[t,e$(h),c]);s.push(i.delete(r)),u.push(e.key)}return eC.waitFor(s).next(()=>u)}function sm(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw M(14731);t=e.noDocument}return JSON.stringify(t).length}sd.DEFAULT_COLLECTION_PERCENTILE=10,sd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sd.DEFAULT=new sd(0x2800000,sd.DEFAULT_COLLECTION_PERCENTILE,sd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sd.DISABLED=new sd(-1,0,0);class sg{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Zn={}}static wt(e,t,n,r){return P(""!==e.uid,64387),new sg(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return sy(e).ee({index:e0,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=tq(e,e5),s=sy(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;P("number"==typeof a,49019);let f=new r$(a,t,n,r),m=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>ix(o.yt,e)),d=f.mutations.map(e=>ix(o.yt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),g=[],p=new t$((e,t)=>Q(e.canonicalString(),t.canonicalString()));for(let e of r){let t=(u=this.userId,h=e.key.path,[u,e$(h),a]);p=p.add(e.key.path.popLast()),g.push(s.put(m)),g.push(i.put(t,e2))}return p.forEach(t=>{g.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[a]=f.keys()}),eC.waitFor(g).next(()=>f)})}lookupMutationBatch(e,t){return sy(e).get(t).next(e=>e?(P(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),iB(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?eC.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.Zn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return sy(e).ee({index:e0,range:r},(e,t,r)=>{t.userId===this.userId&&(P(t.batchId>=n,47524,{Yn:n}),i=iB(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),n=-1;return sy(e).ee({index:e0,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return sy(e).H(e0,t).next(e=>e.map(e=>iB(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,e$(t.path)],r=IDBKeyRange.lowerBound(n),i=[];return tq(e,e5).ee({range:r},(n,r,s)=>{let[a,o,l]=n,u=eQ(o);if(a===this.userId&&t.path.isEqual(u))return sy(e).get(l).next(e=>{if(!e)throw M(61480,{er:n,batchId:l});P(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(iB(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new t$(Q),r=[];return t.forEach(t=>{let i=[this.userId,e$(t.path)],s=IDBKeyRange.lowerBound(i),a=tq(e,e5).ee({range:s},(e,r,i)=>{let[s,a,o]=e,l=eQ(a);s===this.userId&&t.path.isEqual(l)?n=n.add(o):i.done()});r.push(a)}),eC.waitFor(r).next(()=>this.tr(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=[this.userId,e$(n)],s=IDBKeyRange.lowerBound(i),a=new t$(Q);return tq(e,e5).ee({range:s},(e,t,i)=>{let[s,o,l]=e,u=eQ(o);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(a=a.add(l)):i.done()}).next(()=>this.tr(e,a))}tr(e,t){let n=[],r=[];return t.forEach(t=>{r.push(sy(e).get(t).next(e=>{if(null===e)throw M(35274,{batchId:t});P(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),n.push(iB(this.serializer,e))}))}),eC.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return sf(e.le,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.nr(t.batchId)}),eC.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}nr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return eC.resolve();let n=IDBKeyRange.lowerBound([this.userId]),r=[];return tq(e,e5).ee({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=eQ(e[1]);r.push(t)}else n.done()}).next(()=>{P(0===r.length,56720,{rr:r.map(e=>e.canonicalString())})})})}containsKey(e,t){return sp(e,this.userId,t)}ir(e){return tq(e,eY).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function sp(e,t,n){let r=[t,e$(n.path)],i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return tq(e,e5).ee({range:s,Y:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function sy(e){return tq(e,eX)}class sw{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new sw(0)}static ar(){return new sw(-1)}}class sv{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.ur(e).next(t=>{let n=new sw(t.highestTargetId);return t.highestTargetId=n.next(),this.cr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.ur(e).next(e=>ef.fromTimestamp(new ed(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.ur(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.ur(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.cr(e,r)))}addTargetData(e,t){return this.lr(e,t).next(()=>this.ur(e).next(n=>(n.targetCount+=1,this.hr(t,n),this.cr(e,n))))}updateTargetData(e,t){return this.lr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>tq(e,tn).delete(t.targetId)).next(()=>this.ur(e)).next(t=>(P(t.targetCount>0,8065),t.targetCount-=1,this.cr(e,t)))}removeTargets(e,t,n){let r=0,i=[];return tq(e,tn).ee((s,a)=>{let o=ij(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>eC.waitFor(i)).next(()=>r)}forEachTarget(e,t){return tq(e,tn).ee((e,n)=>{t(ij(n))})}ur(e){return tq(e,th).get(tu).next(e=>(P(null!==e,2888),e))}cr(e,t){return tq(e,th).put(tu,t)}lr(e,t){return tq(e,tn).put(iz(this.serializer,t))}hr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.ur(e).next(e=>e.targetCount)}getTargetData(e,t){let n=nY(t),r=IDBKeyRange.bound([n,-1/0],[n,1/0]),i=null;return tq(e,tn).ee({range:r,index:tr},(e,n,r)=>{let s=ij(n);nX(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=sb(e);return t.forEach(t=>{let s=e$(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),eC.waitFor(r)}removeMatchingKeys(e,t,n){let r=sb(e);return eC.forEach(t,t=>{let i=e$(t.path);return eC.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=sb(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=sb(e),i=rp();return r.ee({range:n,Y:!0},(e,t,n)=>{let r=new en(eQ(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=e$(t.path),r=IDBKeyRange.bound([n],[n+"\0"],!1,!0),i=0;return sb(e).ee({index:to,Y:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}At(e,t){return tq(e,tn).get(t).next(e=>e?ij(e):null)}}function sb(e){return tq(e,ts)}let sI="LruGarbageCollector";function sT([e,t],[n,r]){let i=Q(e,n);return 0===i?Q(t,r):i}class sE{constructor(e){this.Pr=e,this.buffer=new t$(sT),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>sT(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class s_{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Ar(e){D(sI,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){eO(e)?D(sI,"Ignoring IndexedDB error during garbage collection: ",e):await ex(e)}await this.Ar(3e5)})}}class sS{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return eC.resolve(ej.ce);let n=new sE(t);return this.Vr.forEachTarget(e,e=>n.Er(e.sequenceNumber)).next(()=>this.Vr.mr(e,e=>n.Er(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector","Garbage collection skipped; disabled"),eC.resolve(sc)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),sc):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let n,r,i,s,a,o,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),A()<=T.LogLevel.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${r} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),eC.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class sx{constructor(e,t){this.db=e,this.garbageCollector=new sS(this,t)}dr(e){let t=this.pr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}mr(e,t){return this.yr(e,(e,n)=>t(n))}addReference(e,t,n){return sC(e,n)}removeReference(e,t,n){return sC(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return sC(e,t)}wr(e,t){let n;return n=!1,tq(e,eY).te(r=>sp(e,r,t).next(e=>(e&&(n=!0),eC.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.yr(e,(s,a)=>{if(a<=t){let t=this.wr(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,ef.min()),sb(e).delete([0,e$(s.path)])))});r.push(t)}}).next(()=>eC.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return sC(e,t)}yr(e,t){let n=sb(e),r,i=ej.ce;return n.ee({index:to},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==ej.ce&&t(new en(eQ(r)),i),i=a,r=s):i=ej.ce}).next(()=>{i!==ej.ce&&t(new en(eQ(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function sC(e,t){var n;return sb(e).put((n=e.currentSequenceNumber,{targetId:0,path:e$(t.path),sequenceNumber:n}))}class sA{constructor(){this.changes=new rl(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,nA.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?eC.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class sD{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return tq(e,e3).put(n)}removeEntry(e,t,n){let r;return tq(e,e3).delete([(r=t.path.toArray()).slice(0,r.length-2),r[r.length-2],iF(n),r[r.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.br(e,n)))}getEntry(e,t){let n=nA.newInvalidDocument(t);return tq(e,e3).ee({index:e6,range:IDBKeyRange.only(sk(t))},(e,r)=>{n=this.Sr(t,r)}).next(()=>n)}Dr(e,t){let n={size:0,document:nA.newInvalidDocument(t)};return tq(e,e3).ee({index:e6,range:IDBKeyRange.only(sk(t))},(e,r)=>{n={document:this.Sr(t,r),size:sm(r)}}).next(()=>n)}getEntries(e,t){let n=ru;return this.Cr(e,t,(e,t)=>{let r=this.Sr(e,t);n=n.insert(e,r)}).next(()=>n)}vr(e,t){let n=ru,r=new tz(en.comparator);return this.Cr(e,t,(e,t)=>{let i=this.Sr(e,t);n=n.insert(e,i),r=r.insert(e,sm(t))}).next(()=>({documents:n,Fr:r}))}Cr(e,t,n){if(t.isEmpty())return eC.resolve();let r=new t$(sM);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(sk(r.first()),sk(r.last())),s=r.getIterator(),a=s.getNext();return tq(e,e3).ee({index:e6,range:i},(e,t,r)=>{let i=en.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>sM(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.j(sk(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),iF(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return tq(e,e3).H(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let n=ru;for(let i of e){let e=this.Sr(en.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(rs(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=ru,s=sR(t,n),a=sR(t,eT.max());return tq(e,e3).ee({index:e7,range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.Sr(en.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new sN(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return tq(e,te).get(tt).next(e=>(P(!!e,20021),e))}br(e,t){return tq(e,te).put(tt,t)}Sr(e,t){if(t){let e=function(e,t){var n;let r,i;if(t.document)r=iS(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=en.fromSegments(t.noDocument.path),n=iU(t.noDocument.readTime);r=nA.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return M(56709);{let e=en.fromSegments(t.unknownDocument.path),n=iU(t.unknownDocument.version);r=nA.newUnknownDocument(e,n)}}return t.readTime&&r.setReadTime((i=new ed((n=t.readTime)[0],n[1]),ef.fromTimestamp(i))),r}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(ef.min())))return e}return nA.newInvalidDocument(e)}}class sN extends sA{constructor(e,t){super(),this.Mr=e,this.trackRemovals=t,this.Or=new rl(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new t$((e,t)=>Q(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Or.get(i);if(t.push(this.Mr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=iL(this.Mr.serializer,s);r=r.add(i.path.popLast());let l=sm(o);n+=l-a.size,t.push(this.Mr.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=iL(this.Mr.serializer,s.convertToNoDocument(ef.min()));t.push(this.Mr.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.Mr.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.Mr.updateMetadata(e,n)),eC.waitFor(t)}getFromCache(e,t){return this.Mr.Dr(e,t).next(e=>(this.Or.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Mr.vr(e,t).next(({documents:e,Fr:t})=>(t.forEach((t,n)=>{this.Or.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function sk(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function sR(e,t){let n=t.documentKey.path.toArray();return[e,iF(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function sM(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=Q(n[e],r[e]))return i;return(i=Q(n.length,r.length))||(i=Q(n[n.length-2],r[r.length-2]))||Q(n[n.length-1],r[r.length-1])}class sO{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sP{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&rL(n.mutation,e,tW.empty(),ed.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,rp()).next(()=>t))}getLocalViewOfDocuments(e,t,n=rp()){let r=rf();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=rc();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=rf();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,rp()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=ru,s=rf(),a=rf();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof rU)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),rL(a.mutation,t,a.mutation.getFieldMask(),ed.now())):s.set(t.key,tW.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new sO(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let n=rf(),r=new tz((e,t)=>e-t),i=rp();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||tW.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||rp()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=rf();l.forEach(e=>{if(!i.has(e)){let r=rV(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return eC.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return en.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):n6(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):eC.resolve(rf()),a=-1,o=i;return s.next(t=>eC.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?eC.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,rp())).next(e=>({batchId:a,changes:rd(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new en(t)).next(e=>{let t=rc();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=rc();return this.indexManager.getCollectionParents(e,i).next(a=>eC.forEach(a,a=>{let o=new n5(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,nA.newInvalidDocument(r)))});let n=rc();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&rL(s.mutation,r,tW.empty(),ed.now()),rs(t,r)&&(n=n.insert(e,r))}),n})}}class sV{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return eC.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,{id:t.id,version:t.version,createTime:im(t.createTime)}),eC.resolve()}getNamedQuery(e,t){return eC.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,{name:t.name,query:iG(t.bundledQuery),readTime:im(t.readTime)}),eC.resolve()}}class sL{constructor(){this.overlays=new tz(en.comparator),this.Lr=new Map}getOverlay(e,t){return eC.resolve(this.overlays.get(t))}getOverlays(e,t){let n=rf();return eC.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.bt(e,t,r)}),eC.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.Lr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Lr.delete(n)),eC.resolve()}getOverlaysForCollection(e,t,n){let r=rf(),i=t.length+1,s=new en(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return eC.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new tz((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=rf(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=rf(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return eC.resolve(a)}bt(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.Lr.get(r.largestBatchId).delete(n.key);this.Lr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new rH(t,n));let i=this.Lr.get(t);void 0===i&&(i=rp(),this.Lr.set(t,i)),this.Lr.set(t,i.add(n.key))}}class sF{constructor(){this.sessionToken=tY.EMPTY_BYTE_STRING}getSessionToken(e){return eC.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,eC.resolve()}}class sq{constructor(){this.kr=new t$(sU.Kr),this.qr=new t$(sU.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let n=new sU(e,t);this.kr=this.kr.add(n),this.qr=this.qr.add(n)}$r(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new sU(e,t))}Qr(e,t){e.forEach(e=>this.removeReference(e,t))}Gr(e){let t=new en(new Z([])),n=new sU(t,e),r=new sU(t,e+1),i=[];return this.qr.forEachInRange([n,r],e=>{this.Wr(e),i.push(e.key)}),i}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new en(new Z([])),n=new sU(t,e),r=new sU(t,e+1),i=rp();return this.qr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new sU(e,0),n=this.kr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class sU{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return en.comparator(e.key,t.key)||Q(e.Hr,t.Hr)}static Ur(e,t){return Q(e.Hr,t.Hr)||en.comparator(e.key,t.key)}}class sB{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new t$(sU.Kr)}checkEmpty(e){return eC.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new r$(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Jr=this.Jr.add(new sU(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return eC.resolve(s)}lookupMutationBatch(e,t){return eC.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.Xr(t+1),r=n<0?0:n;return eC.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return eC.resolve(0===this.mutationQueue.length?-1:this.Yn-1)}getAllMutationBatches(e){return eC.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new sU(t,0),r=new sU(t,1/0),i=[];return this.Jr.forEachInRange([n,r],e=>{let t=this.Zr(e.Hr);i.push(t)}),eC.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new t$(Q);return t.forEach(e=>{let t=new sU(e,0),r=new sU(e,1/0);this.Jr.forEachInRange([t,r],e=>{n=n.add(e.Hr)})}),eC.resolve(this.Yr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;en.isDocumentKey(i)||(i=i.child(""));let s=new sU(new en(i),0),a=new t$(Q);return this.Jr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Hr)),!0)},s),eC.resolve(this.Yr(a))}Yr(e){let t=[];return e.forEach(e=>{let n=this.Zr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){P(0===this.ei(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Jr;return eC.forEach(t.mutations,r=>{let i=new sU(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Jr=n})}nr(e){}containsKey(e,t){let n=new sU(t,0),r=this.Jr.firstAfterOrEqual(n);return eC.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,eC.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class sj{constructor(e){this.ti=e,this.docs=new tz(en.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ti(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return eC.resolve(n?n.document.mutableCopy():nA.newInvalidDocument(t))}getEntries(e,t){let n=ru;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():nA.newInvalidDocument(e))}),eC.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=ru,s=t.path,a=new en(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=eE(eI(a),n)||(r.has(a.key)||rs(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return eC.resolve(i)}getAllFromCollectionGroup(e,t,n,r){M(9500)}ni(e,t){return eC.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new sz(this)}getSize(e){return eC.resolve(this.size)}}class sz extends sA{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Mr.addEntry(e,r)):this.Mr.removeEntry(n)}),eC.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class sG{constructor(e){this.persistence=e,this.ri=new rl(e=>nY(e),nX),this.lastRemoteSnapshotVersion=ef.min(),this.highestTargetId=0,this.ii=0,this.si=new sq,this.targetCount=0,this.oi=sw._r()}forEachTarget(e,t){return this.ri.forEach((e,n)=>t(n)),eC.resolve()}getLastRemoteSnapshotVersion(e){return eC.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return eC.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),eC.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ii&&(this.ii=t),eC.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new sw(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,eC.resolve()}updateTargetData(e,t){return this.lr(t),eC.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,eC.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.ri.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.ri.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),eC.waitFor(i).next(()=>r)}getTargetCount(e){return eC.resolve(this.targetCount)}getTargetData(e,t){let n=this.ri.get(t)||null;return eC.resolve(n)}addMatchingKeys(e,t,n){return this.si.$r(t,n),eC.resolve()}removeMatchingKeys(e,t,n){this.si.Qr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),eC.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),eC.resolve()}getMatchingKeysForTargetId(e,t){let n=this.si.jr(t);return eC.resolve(n)}containsKey(e,t){return eC.resolve(this.si.containsKey(t))}}class sK{constructor(e,t){this._i={},this.overlays={},this.ai=new ej(0),this.ui=!1,this.ui=!0,this.ci=new sF,this.referenceDelegate=e(this),this.li=new sG(this),this.indexManager=new ss,this.remoteDocumentCache=new sj(e=>this.referenceDelegate.hi(e)),this.serializer=new iV(t),this.Pi=new sV(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sL,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this._i[e.toKey()];return n||(n=new sB(t,this.referenceDelegate),this._i[e.toKey()]=n),n}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,n){D("MemoryPersistence","Starting transaction:",e);let r=new s$(this.ai.next());return this.referenceDelegate.Ti(),n(r).next(e=>this.referenceDelegate.Ii(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ei(e,t){return eC.or(Object.values(this._i).map(n=>()=>n.containsKey(e,t)))}}class s$ extends eS{constructor(e){super(),this.currentSequenceNumber=e}}class sQ{constructor(e){this.persistence=e,this.Ri=new sq,this.Ai=null}static Vi(e){return new sQ(e)}get di(){if(this.Ai)return this.Ai;throw M(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.di.delete(n.toString()),eC.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.di.add(n.toString()),eC.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),eC.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(e=>this.di.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return eC.forEach(this.di,n=>{let r=en.fromPath(n);return this.mi(e,r).next(e=>{e||t.removeEntry(r,ef.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return eC.or([()=>eC.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class sH{constructor(e,t){this.persistence=e,this.fi=new rl(e=>e$(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new sS(this,t)}static Vi(e,t){return new sH(e,t)}Ti(){}Ii(e){return eC.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}mr(e,t){return eC.forEach(this.fi,(n,r)=>this.wr(e,n,r).next(e=>e?eC.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ni(e,r=>this.wr(e,r,t).next(e=>{e||(n++,i.removeEntry(r,ef.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),eC.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),eC.resolve()}removeReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),eC.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),eC.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(nl(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=t8(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return t1(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var r;let i;return r=t.mapValue,i=0,tB(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw M(13486,{value:t})}}(e.data.value)),t}wr(e,t,n){return eC.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.fi.get(t);return eC.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class sW{constructor(e){this.serializer=e}k(e,t,n,r){let i=new eD("createOrUpgrade",t);n<1&&r>=1&&(e.createObjectStore(eW),e.createObjectStore(eY,{keyPath:"userId"}),e.createObjectStore(eX,{keyPath:eZ,autoIncrement:!0}).createIndex(e0,e1,{unique:!0}),e.createObjectStore(e5),sJ(e),e.createObjectStore(eH));let s=eC.resolve();return n<3&&r>=3&&(0!==n&&(e.deleteObjectStore(ts),e.deleteObjectStore(tn),e.deleteObjectStore(th),sJ(e)),s=s.next(()=>{let e,t;return e=i.store(th),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ef.min().toTimestamp(),targetCount:0},e.put(tu,t)})),n<4&&r>=4&&(0!==n&&(s=s.next(()=>i.store(eX).H().next(t=>{e.deleteObjectStore(eX),e.createObjectStore(eX,{keyPath:eZ,autoIncrement:!0}).createIndex(e0,e1,{unique:!0});let n=i.store(eX),r=t.map(e=>n.put(e));return eC.waitFor(r)}))),s=s.next(()=>{e.createObjectStore(tf,{keyPath:"clientId"})})),n<5&&r>=5&&(s=s.next(()=>this.gi(i))),n<6&&r>=6&&(s=s.next(()=>(e.createObjectStore(te),this.pi(i)))),n<7&&r>=7&&(s=s.next(()=>this.yi(i))),n<8&&r>=8&&(s=s.next(()=>this.wi(e,i))),n<9&&r>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&r>=10&&(s=s.next(()=>this.bi(i))),n<11&&r>=11&&(s=s.next(()=>{e.createObjectStore(tm,{keyPath:"bundleId"}),e.createObjectStore(tg,{keyPath:"name"})})),n<12&&r>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(tx,{keyPath:tC})).createIndex(tA,tD,{unique:!1}),t.createIndex(tN,tk,{unique:!1})})),n<13&&r>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(e3,{keyPath:e4})).createIndex(e6,e8),t.createIndex(e7,e9)}).next(()=>this.Si(e,i)).next(()=>e.deleteObjectStore(eH))),n<14&&r>=14&&(s=s.next(()=>this.Di(e,i))),n<15&&r>=15&&(s=s.next(()=>{e.createObjectStore(tp,{keyPath:"indexId",autoIncrement:!0}).createIndex(ty,"collectionGroup",{unique:!1}),e.createObjectStore(tw,{keyPath:tv}).createIndex(tb,tI,{unique:!1}),e.createObjectStore(tT,{keyPath:tE}).createIndex(t_,tS,{unique:!1})})),n<16&&r>=16&&(s=s.next(()=>{t.objectStore(tw).clear()}).next(()=>{t.objectStore(tT).clear()})),n<17&&r>=17&&(s=s.next(()=>{e.createObjectStore(tR,{keyPath:"name"})})),n<18&&r>=18&&(0,v.isSafariOrWebkit)()&&(s=s.next(()=>{t.objectStore(tw).clear()}).next(()=>{t.objectStore(tT).clear()})),s}pi(e){let t=0;return e.store(eH).ee((e,n)=>{t+=sm(n)}).next(()=>{let n={byteSize:t};return e.store(te).put(tt,n)})}gi(e){let t=e.store(eY),n=e.store(eX);return t.H().next(t=>eC.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.H(e0,r).next(n=>eC.forEach(n,n=>{P(n.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:n.batchId});let r=iB(this.serializer,n);return sf(e,t.userId,r).next(()=>{})}))}))}yi(e){let t=e.store(ts),n=e.store(eH);return e.store(th).get(tu).next(e=>{let r=[];return n.ee((n,i)=>{let s=new Z(n),a=[0,e$(s)];r.push(t.get(a).next(n=>n?eC.resolve():t.put({targetId:0,path:e$(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>eC.waitFor(r))})}wi(e,t){e.createObjectStore(tc,{keyPath:td});let n=t.store(tc),r=new sa,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:e$(r)})}};return t.store(eH).ee({Y:!0},(e,t)=>i(new Z(e).popLast())).next(()=>t.store(e5).ee({Y:!0},([e,t,n],r)=>i(eQ(t).popLast())))}bi(e){let t=e.store(tn);return t.ee((e,n)=>{let r=ij(n),i=iz(this.serializer,r);return t.put(i)})}Si(e,t){let n=t.store(eH),r=[];return n.ee((e,n)=>{let i=t.store(e3),s=(n.document?new en(Z.fromString(n.document.name).popFirst(5)):n.noDocument?en.fromSegments(n.noDocument.path):n.unknownDocument?en.fromSegments(n.unknownDocument.path):M(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>eC.waitFor(r))}Di(e,t){let n=t.store(eX),r=new sD(this.serializer),i=new sK(sQ.Vi,this.serializer.yt);return n.H().next(e=>{let n=new Map;return e.forEach(e=>{let t=n.get(e.userId)??rp();iB(this.serializer,e).keys().forEach(e=>t=t.add(e)),n.set(e.userId,t)}),eC.forEach(n,(e,n)=>{let s=new S(n),a=iW.wt(this.serializer,s),o=i.getIndexManager(s);return new sP(r,sg.wt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new tF(t,ej.ce),e).next()})})}}function sJ(e){e.createObjectStore(ts,{keyPath:ta}).createIndex(to,tl,{unique:!0}),e.createObjectStore(tn,{keyPath:"targetId"}).createIndex(tr,ti,{unique:!0}),e.createObjectStore(th)}let sY="IndexedDbPersistence",sX="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class sZ{constructor(e,t,n,r,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Ci=i,this.window=s,this.document=a,this.Fi=l,this.Mi=u,this.xi=h,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=-1/0,this.ki=e=>Promise.resolve(),!sZ.v())throw new L(V.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new sx(this,r),this.Ki=t+"main",this.serializer=new iV(o),this.qi=new eN(this.Ki,this.xi,new sW(this.serializer)),this.ci=new iJ,this.li=new sv(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new sD(this.serializer),this.Pi=new iH,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===u&&N(sY,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new L(V.FAILED_PRECONDITION,sX);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.li.getHighestSequenceNumber(e))}).then(e=>{this.ai=new ej(e,this.Fi)}).then(()=>{this.ui=!0}).catch(e=>(this.qi&&this.qi.close(),Promise.reject(e)))}zi(e){return this.ki=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.qi.q(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ci.enqueueAndForget(async()=>{this.started&&await this.$i()}))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>tq(e,tf).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ji(e).next(e=>{e||(this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Ji(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(eO(e))return D(sY,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return D(sY,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ci.enqueueRetryable(()=>this.ki(e)),this.isPrimary=e})}ji(e){return tq(e,eW).get(eJ).next(e=>eC.resolve(this.Xi(e)))}Yi(e){return tq(e,tf).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,18e5)){this.Li=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=tq(e,tf);return t.H().next(e=>{let n=this.ns(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return eC.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.rs(t.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.$i().then(()=>this.es()).then(()=>this.Gi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.Mi?eC.resolve(!0):tq(e,eW).get(eJ).next(t=>{if(null!==t&&this.ts(t.leaseTimestampMs,5e3)&&!this.ss(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new L(V.FAILED_PRECONDITION,sX);return!1}}return!(!this.networkEnabled||!this.inForeground)||tq(e,tf).H().next(e=>void 0===this.ns(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&D(sY,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[eW,tf],e=>{let t=new tF(e,ej.ce);return this.Ji(t).next(()=>this.Yi(t))}),this.qi.close(),this.ls()}ns(e,t){return e.filter(e=>this.ts(e.updateTimeMs,t)&&!this.ss(e.clientId))}hs(){return this.runTransaction("getActiveClients","readonly",e=>tq(e,tf).H().next(e=>this.ns(e,18e5).map(e=>e.clientId)))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(e,t){return sg.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new su(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return iW.wt(this.serializer,e)}getBundleCache(){return this.Pi}runTransaction(e,t,n){var r;let i;D(sY,"Starting transaction:",e);let s=18===(r=this.xi)||17===r?tL:16===r||15===r?tV:14===r||13===r?tP:12===r?tO:11===r?tM:void M(60245);return this.qi.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,r=>(i=new tF(r,this.ai?this.ai.next():ej.ce),"readwrite-primary"===t?this.ji(i).next(e=>!!e||this.Hi(i)).next(t=>{if(!t)throw N(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)),new L(V.FAILED_PRECONDITION,e_);return n(i)}).next(e=>this.Zi(i).next(()=>e)):this.Ps(i).next(()=>n(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Ps(e){return tq(e,eW).get(eJ).next(e=>{if(null!==e&&this.ts(e.leaseTimestampMs,5e3)&&!this.ss(e.ownerId)&&!this.Xi(e)&&!(this.Mi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new L(V.FAILED_PRECONDITION,sX)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return tq(e,eW).put(eJ,t)}static v(){return eN.v()}Ji(e){let t=tq(e,eW);return t.get(eJ).next(e=>this.Xi(e)?(D(sY,"Releasing primary lease."),t.delete(eJ)):eC.resolve())}ts(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(N(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ni=()=>{this.Ci.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.$i()))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground="visible"===this.document.visibilityState)}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){"function"==typeof this.window?.addEventListener&&(this.Oi=()=>{this._s();let e=/(?:Version|Mobile)\/1[456]/;(0,v.isSafari)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(e){try{let t=null!==this.Ui?.getItem(this.rs(e));return D(sY,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return N(sY,"Failed to get zombied client id.",e),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(e){N("Failed to set zombie client id.",e)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch(e){}}rs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function s0(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class s1{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Ts=n,this.Is=r}static Es(e,t){let n=rp(),r=rp();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new s1(e,t.fromCache,n,r)}}class s2{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class s5{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(0,v.isSafari)()?8:ek((0,v.getUA)())>0?6:4}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.gs(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ps(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new s2;return this.ys(e,t,n).next(r=>{if(i.result=r,this.As)return this.ws(e,t,n,r.size)})}).next(()=>i.result)}ws(e,t,n,r){return n.documentReadCount<this.Vs?(A()<=T.LogLevel.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",ri(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),eC.resolve()):(A()<=T.LogLevel.DEBUG&&D("QueryEngine","Query:",ri(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ds*r?(A()<=T.LogLevel.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",ri(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,n7(t))):eC.resolve())}gs(e,t){if(n4(t))return eC.resolve(null);let n=n7(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=n7(t=rt(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=rp(...r);return this.fs.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.bs(t,r);return this.Ss(t,s,i,n.readTime)?this.gs(e,rt(t,null,"F")):this.Ds(e,s,t,n)}))})))}ps(e,t,n,r){return n4(t)||r.isEqual(ef.min())?eC.resolve(null):this.fs.getDocuments(e,n).next(i=>{let s=this.bs(t,i);return this.Ss(t,s,n,r)?eC.resolve(null):(A()<=T.LogLevel.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ri(t)),this.Ds(e,s,t,eb(r,-1)).next(e=>e))})}bs(e,t){let n=new t$(ro(e));return t.forEach((t,r)=>{rs(e,r)&&(n=n.add(r))}),n}Ss(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}ys(e,t,n){return A()<=T.LogLevel.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",ri(t)),this.fs.getDocumentsMatchingQuery(e,t,eT.min(),n)}Ds(e,t,n,r){return this.fs.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let s3="LocalStore";class s4{constructor(e,t,n,r){this.persistence=e,this.Cs=t,this.serializer=r,this.vs=new tz(Q),this.Fs=new rl(e=>nY(e),nX),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(n)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sP(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}async function s6(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Os(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=rp();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({Ns:e,removedBatchIds:i,addedBatchIds:s}))})})}function s8(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function s7(e,t,n){let r=rp(),i=rp();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=ru;return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(ef.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):D(s3,"Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{Bs:r,Ls:i}})}function s9(e,t){return e.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return e.li.getTargetData(n,t).next(i=>i?(r=i,eC.resolve(r)):e.li.allocateTargetId(n).next(i=>(r=new iP(t,i,"TargetPurposeListen",n.currentSequenceNumber),e.li.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=e.vs.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.vs=e.vs.insert(n.targetId,n),e.Fs.set(t,n.targetId)),n})}async function ae(e,t,n){let r=e.vs.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!eO(e))throw e;D(s3,`Failed to update sequence numbers for target ${t}: ${e}`)}e.vs=e.vs.remove(t),e.Fs.delete(r.target)}function at(e,t,n){let r=ef.min(),i=rp();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=n7(t),void 0!==(o=e.Fs.get(a))?eC.resolve(e.vs.get(o)):e.li.getTargetData(s,a)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.li.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Cs.getDocumentsMatchingQuery(s,t,n?r:ef.min(),n?i:rp())).next(n=>(ai(e,ra(t),n),{documents:n,ks:i}))})}function an(e,t){let n=e.li,r=e.vs.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",e=>n.At(e,t).next(e=>e?e.target:null))}function ar(e,t){let n=e.Ms.get(t)||ef.min();return e.persistence.runTransaction("Get new document changes","readonly",r=>e.xs.getAllFromCollectionGroup(r,t,eb(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(ai(e,t,n),n))}function ai(e,t,n){let r=e.Ms.get(t)||ef.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Ms.set(t,r)}async function as(e,t,n,r){let i=rp(),s=ru;for(let e of n){let n=t.Ks(e.metadata.name);e.document&&(i=i.add(n));let r=t.qs(e);r.setReadTime(t.Us(e.metadata.readTime)),s=s.insert(n,r)}let a=e.xs.newChangeBuffer({trackRemovals:!0}),o=await s9(e,n7(n3(Z.fromString(`__bundle__/docs/${r}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>s7(t,a,s).next(e=>(a.apply(t),e)).next(n=>e.li.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.li.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,n.Bs,n.Ls)).next(()=>n.Bs)))}async function aa(e,t,n=rp()){let r=await s9(e,n7(iG(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=im(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return e.Pi.saveNamedQuery(i,t);let a=r.withResumeToken(tY.EMPTY_BYTE_STRING,s);return e.vs=e.vs.insert(a.targetId,a),e.li.updateTargetData(i,a).next(()=>e.li.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>e.li.addMatchingKeys(i,n,r.targetId)).next(()=>e.Pi.saveNamedQuery(i,t))})}let ao="firestore_clients";function al(e,t){return`${ao}_${e}_${t}`}let au="firestore_mutations";function ah(e,t,n){let r=`${au}_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}let ac="firestore_targets";function ad(e,t){return`${ac}_${e}_${t}`}let af="SharedClientState";class am{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static $s(e,t,n){let r=JSON.parse(n),i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new L(r.error.code,r.error.message)),s?new am(e,t,r.state,i):(N(af,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ag{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static $s(e,t){let n=JSON.parse(t),r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new L(n.error.code,n.error.message)),i?new ag(e,n.state,r):(N(af,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ap{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ry;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=eK(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new ap(e,i):(N(af,`Failed to parse client data for instance '${e}': ${t}`),null)}}class ay{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new ay(t.clientId,t.onlineState):(N(af,`Failed to parse online state: ${e}`),null)}}class aw{constructor(){this.activeTargetIds=ry}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class av{constructor(e,t,n,r,i){var s,a,o;this.window=e,this.Ci=t,this.persistenceKey=n,this.zs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.js=this.Hs.bind(this),this.Js=new tz(Q),this.started=!1,this.Zs=[];const l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=al(this.persistenceKey,this.zs),this.Ys=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.Js=this.Js.insert(this.zs,new aw),this.eo=RegExp(`^${ao}_${l}_([^_]*)$`),this.no=RegExp(`^${au}_${l}_(\\d+)(?:_(.*))?$`),this.ro=RegExp(`^${ac}_${l}_(\\d+)$`),this.io=(a=this.persistenceKey,`firestore_online_state_${a}`),this.so=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.js)}static v(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.hs())){if(e===this.zs)continue;let t=this.getItem(al(this.persistenceKey,e));if(t){let n=ap.$s(e,t);n&&(this.Js=this.Js.insert(n.clientId,n))}}this.oo();let e=this.storage.getItem(this.io);if(e){let t=this._o(e);t&&this.ao(t)}for(let e of this.Zs)this.Hs(e);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ys,JSON.stringify(e))}getAllActiveQueryTargets(){return this.uo(this.Js)}isActiveQueryTarget(e){let t=!1;return this.Js.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.co(e,"pending")}updateMutationState(e,t,n){this.co(e,t,n),this.lo(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(ad(this.persistenceKey,e));if(t){let r=ag.$s(e,t);r&&(n=r.state)}}return t&&this.ho.Qs(e),this.oo(),n}removeLocalQueryTarget(e){this.ho.Gs(e),this.oo()}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(ad(this.persistenceKey,e))}updateQueryState(e,t,n){this.Po(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.lo(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.To(e)}notifyBundleLoaded(e){this.Io(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return D(af,"READ",e,t),t}setItem(e,t){D(af,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){D(af,"REMOVE",e),this.storage.removeItem(e)}Hs(e){if(e.storageArea===this.storage){if(D(af,"EVENT",e.key,e.newValue),e.key===this.Xs)return void N("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ci.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.eo.test(e.key)){if(null==e.newValue){let t=this.Eo(e.key);return this.Ro(t,null)}{let t=this.Ao(e.key,e.newValue);if(t)return this.Ro(t.clientId,t)}}else if(this.no.test(e.key)){if(null!==e.newValue){let t=this.Vo(e.key,e.newValue);if(t)return this.mo(t)}}else if(this.ro.test(e.key)){if(null!==e.newValue){let t=this.fo(e.key,e.newValue);if(t)return this.po(t)}}else if(e.key===this.io){if(null!==e.newValue){let t=this._o(e.newValue);if(t)return this.ao(t)}}else if(e.key===this.Ys){let t=function(e){let t=ej.ce;if(null!=e)try{let n=JSON.parse(e);P("number"==typeof n,30636,{yo:e}),t=n}catch(e){N(af,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==ej.ce&&this.sequenceNumberHandler(t)}else if(e.key===this.so){let t=this.wo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.bo(e)))}}}else this.Zs.push(e)})}}get ho(){return this.Js.get(this.zs)}oo(){this.setItem(this.Xs,this.ho.Ws())}co(e,t,n){let r=new am(this.currentUser,e,t,n),i=ah(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Ws())}lo(e){let t=ah(this.persistenceKey,this.currentUser,e);this.removeItem(t)}To(e){let t={clientId:this.zs,onlineState:e};this.storage.setItem(this.io,JSON.stringify(t))}Po(e,t,n){let r=ad(this.persistenceKey,e),i=new ag(e,t,n);this.setItem(r,i.Ws())}Io(e){let t=JSON.stringify(Array.from(e));this.setItem(this.so,t)}Eo(e){let t=this.eo.exec(e);return t?t[1]:null}Ao(e,t){let n=this.Eo(e);return ap.$s(n,t)}Vo(e,t){let n=this.no.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return am.$s(new S(i),r,t)}fo(e,t){let n=Number(this.ro.exec(e)[1]);return ag.$s(n,t)}_o(e){return ay.$s(e)}wo(e){return JSON.parse(e)}async mo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.So(e.batchId,e.state,e.error);D(af,`Ignoring mutation for non-active user ${e.user.uid}`)}po(e){return this.syncEngine.Do(e.targetId,e.state,e.error)}Ro(e,t){let n=t?this.Js.insert(e,t):this.Js.remove(e),r=this.uo(this.Js),i=this.uo(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Co(s,a).then(()=>{this.Js=n})}ao(e){this.Js.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}uo(e){let t=ry;return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class ab{constructor(){this.vo=new aw,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,n){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new aw,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class aI{Mo(e){}shutdown(){}}let aT="ConnectivityMonitor";class aE{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){for(let e of(D(aT,"Network connectivity changed: AVAILABLE"),this.Lo))e(0)}Bo(){for(let e of(D(aT,"Network connectivity changed: UNAVAILABLE"),this.Lo))e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let a_=null;function aS(){return null===a_?a_=0x10000000+Math.round(0x80000000*Math.random()):a_++,"0x"+a_.toString(16)}let ax="RestConnection",aC={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class aA{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${n}/databases/${r}`,this.$o=this.databaseId.database===ne?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Wo(e,t,n,r,i){let s=aS(),a=this.Qo(e,t.toUriEncodedString());D(ax,`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(o,r,i);let{host:l}=new URL(a),u=(0,v.isCloudWorkstation)(l);return this.zo(e,a,o,n,u).then(t=>(D(ax,`Received RPC '${e}' ${s}: `,t),t),t=>{throw k(ax,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}jo(e,t,n,r,i,s){return this.Wo(e,t,n,r,i)}Go(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+x,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}Qo(e,t){let n=aC[e],r=`${this.qo}/v1/${t}:${n}`;return this.databaseInfo.apiKey&&(r=`${r}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),r}terminate(){}}class aD{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}let aN="WebChannelConnection",ak=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};class aR extends aA{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){aR.c_||(ak(u(),l.STAT_EVENT,e=>{e.stat===o.PROXY?D(aN,"STAT_EVENT: detected buffering proxy"):e.stat===o.NOPROXY&&D(aN,"STAT_EVENT: detected no buffering proxy")}),aR.c_=!0)}zo(e,t,n,i,o){let l=aS();return new Promise((o,u)=>{let h=new r;h.setWithCredentials(!0),h.listenOnce(s.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case a.NO_ERROR:let t=h.getResponseJson();D(aN,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(t)),o(t);break;case a.TIMEOUT:D(aN,`RPC '${e}' ${l} timed out`),u(new L(V.DEADLINE_EXCEEDED,"Request time out"));break;case a.HTTP_ERROR:let n=h.getStatus();if(D(aN,`RPC '${e}' ${l} failed with status:`,n,"response text:",h.getResponseText()),n>0){let e=h.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,n=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(V).indexOf(e)>=0?e:V.UNKNOWN);u(new L(n,t.message))}else u(new L(V.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new L(V.UNAVAILABLE,"Connection failed."));break;default:M(9055,{l_:e,streamId:l,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{D(aN,`RPC '${e}' ${l} completed.`)}});let c=JSON.stringify(i);D(aN,`RPC '${e}' ${l} sending request:`,i),h.send(t,"POST",c,n,15)})}T_(e,t,n){let r=aS(),s=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Go(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;let u=s.join("");D(aN,`Creating RPC '${e}' stream ${r}: ${u}`,o);let h=a.createWebChannel(u,o);this.I_(h);let d=!1,f=!1,m=new aD({Ho:t=>{f?D(aN,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(d||(D(aN,`Opening RPC '${e}' stream ${r} transport.`),h.open(),d=!0),D(aN,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},Jo:()=>h.close()});return ak(h,i.EventType.OPEN,()=>{f||(D(aN,`RPC '${e}' stream ${r} transport opened.`),m.i_())}),ak(h,i.EventType.CLOSE,()=>{f||(f=!0,D(aN,`RPC '${e}' stream ${r} transport closed`),m.o_(),this.E_(h))}),ak(h,i.EventType.ERROR,t=>{f||(f=!0,k(aN,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),m.o_(new L(V.UNAVAILABLE,"The operation could not be completed")))}),ak(h,i.EventType.MESSAGE,t=>{if(!f){let n=t.data[0];P(!!n,16349);let i=n?.error||n[0]?.error;if(i){D(aN,`RPC '${e}' stream ${r} received error:`,i);let t=i.status,n=function(e){let t=c[e];if(void 0!==t)return rX(t)}(t),s=i.message;void 0===n&&(n=V.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),f=!0,m.o_(new L(n,s)),h.close()}else D(aN,`RPC '${e}' stream ${r} received:`,n),m.__(n)}}),aR.u_(),setTimeout(()=>{m.s_()},0),m}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,n){super.Go(e,t,n),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return h()}}function aM(){return"undefined"!=typeof window?window:null}function aO(){return"undefined"!=typeof document?document:null}function aP(e){return new iu(e,!0)}aR.c_=!1;class aV{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=n,this.A_=r,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&D("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}let aL="PersistentStream";class aF{constructor(e,t,n,r,i,s,a,o){this.Ci=e,this.b_=n,this.S_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new aV(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===V.RESOURCE_EXHAUSTED?(N(t.toString()),N("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===V.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{let e=new L(V.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let n=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.Yo(()=>{n(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.H_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return D(aL,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(D(aL,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class aq extends aF{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:M(39313,{state:r}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(P(void 0===i||"string"==typeof i,58123),tY.fromBase64String(i||"")):(P(void 0===i||i instanceof w.Buffer||i instanceof Uint8Array,16193),tY.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new ie(s,a,o,l&&new L(void 0===l.code?V.UNKNOWN:rX(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=iv(e,r.document.name),s=im(r.document.updateTime),a=r.document.createTime?im(r.document.createTime):ef.min(),o=new nC({mapValue:{fields:r.document.fields}}),l=nA.newFoundDocument(i,s,a,o);n=new r7(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=iv(e,r.document),s=r.readTime?im(r.readTime):ef.min(),a=nA.newNoDocument(i,s);n=new r7([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=iv(e,r.document);n=new r7([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return M(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new rJ(r,i);n=new r9(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ef.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?ef.min():t.readTime?im(t.readTime):ef.min()}(e);return this.listener.J_(t,n)}Z_(e){let t,n={};n.database=iT(this.serializer),n.addTarget=function(e,t){let n,r=t.target;if((n=nZ(r)?{documents:iA(e,r)}:{query:iD(e,r).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=id(e,t.resumeToken);let r=ih(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(ef.min())>0){n.readTime=ic(e,t.snapshotVersion.toTimestamp());let r=ih(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let r=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});r&&(n.labels=r),this.K_(n)}X_(e){let t={};t.database=iT(this.serializer),t.removeTarget=e,this.K_(t)}}class aU extends aF{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return P(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,P(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,n;P(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(P(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?im(e.updateTime):im(n)).isEqual(ef.min())&&(t=im(n)),new rR(t,e.transformResults||[])})):[]),i=im(e.commitTime);return this.listener.na(i,r)}ra(){let e={};e.database=iT(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>ix(this.serializer,e))};this.K_(t)}}class aB{}class aj extends aB{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new L(V.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Wo(e,ip(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new L(V.UNKNOWN,e.toString())})}jo(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.jo(e,ip(t,n),r,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new L(V.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class az{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(N(t),this.aa=!1):D("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let aG="RemoteStore";class aK{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo(e=>{n.enqueueAndForget(async()=>{a0(this)&&(D(aG,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await aQ(e),e.Va.set("Unknown"),e.Ea.delete(4),await a$(e)}(this))})}),this.Va=new az(n,r)}}async function a$(e){if(a0(e))for(let t of e.Ra)await t(!0)}async function aQ(e){for(let t of e.Ra)await t(!1)}function aH(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),aZ(e)?aX(e):oa(e).O_()&&aJ(e,t))}function aW(e,t){let n=oa(e);e.Ia.delete(t),n.O_()&&aY(e,t),0===e.Ia.size&&(n.O_()?n.L_():a0(e)&&e.Va.set("Unknown"))}function aJ(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ef.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}oa(e).Z_(t)}function aY(e,t){e.da.$e(t),oa(e).X_(t)}function aX(e){e.da=new ir({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),oa(e).start(),e.Va.ua()}function aZ(e){return a0(e)&&!oa(e).x_()&&e.Ia.size>0}function a0(e){return 0===e.Ea.size}async function a1(e){e.Va.set("Online")}async function a2(e){e.Ia.forEach((t,n)=>{aJ(e,t)})}async function a5(e,t){e.da=void 0,aZ(e)?(e.Va.ha(t),aX(e)):e.Va.set("Unknown")}async function a3(e,t,n){if(e.Va.set("Online"),t instanceof ie&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.da.removeTarget(r))}(e,t)}catch(n){D(aG,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await a4(e,n)}else if(t instanceof r7?e.da.Xe(t):t instanceof r9?e.da.st(t):e.da.tt(t),!n.isEqual(ef.min()))try{let t,r=await s8(e.localStore);n.compareTo(r)>=0&&await ((t=e.da.Tt(n)).targetChanges.forEach((t,r)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(t.resumeToken,n))}}),t.targetMismatches.forEach((t,n)=>{let r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(tY.EMPTY_BYTE_STRING,r.snapshotVersion)),aY(e,t);let i=new iP(r.target,t,n,r.sequenceNumber);aJ(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){D(aG,"Failed to raise snapshot:",t),await a4(e,t)}}async function a4(e,t,n){if(!eO(t))throw t;e.Ea.add(1),await aQ(e),e.Va.set("Offline"),n||(n=()=>s8(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{D(aG,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await a$(e)})}function a6(e,t){return t().catch(n=>a4(e,n,t))}async function a8(e){var t;let n=oo(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;a0(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.Ta.length&&n.L_();break}r=t.batchId,function(e,t){e.Ta.push(t);let n=oo(e);n.O_()&&n.Y_&&n.ea(t.mutations)}(e,t)}catch(t){await a4(e,t)}a7(e)&&a9(e)}function a7(e){return a0(e)&&!oo(e).x_()&&e.Ta.length>0}function a9(e){oo(e).start()}async function oe(e){oo(e).ra()}async function ot(e){let t=oo(e);for(let n of e.Ta)t.ea(n.mutations)}async function on(e,t,n){let r=e.Ta.shift(),i=rQ.from(r,t,n);await a6(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await a8(e)}async function or(e,t){t&&oo(e).Y_&&await async function(e,t){var n;if(rY(n=t.code)&&n!==V.ABORTED){let n=e.Ta.shift();oo(e).B_(),await a6(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await a8(e)}}(e,t),a7(e)&&a9(e)}async function oi(e,t){e.asyncQueue.verifyOperationInProgress(),D(aG,"RemoteStore received new credentials");let n=a0(e);e.Ea.add(3),await aQ(e),n&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await a$(e)}async function os(e,t){t?(e.Ea.delete(2),await a$(e)):t||(e.Ea.add(2),await aQ(e),e.Va.set("Unknown"))}function oa(e){var t,n,r;return e.ma||(t=e.datastore,n=e.asyncQueue,r={Zo:a1.bind(null,e),Yo:a2.bind(null,e),t_:a5.bind(null,e),J_:a3.bind(null,e)},t.sa(),e.ma=new aq(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.Ra.push(async t=>{t?(e.ma.B_(),aZ(e)?aX(e):e.Va.set("Unknown")):(await e.ma.stop(),e.da=void 0)})),e.ma}function oo(e){var t,n,r;return e.fa||(t=e.datastore,n=e.asyncQueue,r={Zo:()=>Promise.resolve(),Yo:oe.bind(null,e),t_:or.bind(null,e),ta:ot.bind(null,e),na:on.bind(null,e)},t.sa(),e.fa=new aU(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.Ra.push(async t=>{t?(e.fa.B_(),await a8(e)):(await e.fa.stop(),e.Ta.length>0&&(D(aG,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class ol{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new F,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new ol(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new L(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ou(e,t){if(N("AsyncQueue",`${t}: ${e}`),eO(e))return new L(V.UNAVAILABLE,`${t}: ${e}`);throw e}class oh{static emptySet(e){return new oh(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||en.comparator(t.key,n.key):(e,t)=>en.comparator(e.key,t.key),this.keyedMap=rc(),this.sortedSet=new tz(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof oh)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new oh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class oc{constructor(){this.ga=new tz(en.comparator)}track(e){let t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):M(63341,{Vt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class od{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new od(e,t,oh.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&rn(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class of{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class om{constructor(){this.queries=og(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new L(V.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=og(),t.forEach((t,n)=>{for(let t of n.ba)t.onError(e)})}}function og(){return new rl(e=>rr(e),rn)}async function op(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.Sa()&&t.Da()&&(n=2):(i=new of,n=+!t.Da());try{switch(n){case 0:i.wa=await e.onListen(r,!0);break;case 1:i.wa=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=ou(n,`Initialization of query '${ri(t.query)}' failed`);return void t.onError(e)}e.queries.set(r,i),i.ba.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&ob(e)}async function oy(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.ba.indexOf(t);e>=0&&(i.ba.splice(e,1),0===i.ba.length?r=+!t.Da():!i.Sa()&&t.Da()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function ow(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.ba)e.Fa(r)&&(n=!0);i.wa=r}}n&&ob(e)}function ov(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.ba)e.onError(n);e.queries.delete(t)}function ob(e){e.Ca.forEach(e=>{e.next()})}(m=f||(f={})).Ma="default",m.Cache="cache";class oI{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new od(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.Ka||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=od.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==f.Cache}}class oT{constructor(e,t){this.qa=e,this.byteLength=t}Ua(){return"metadata"in this.qa}}class oE{constructor(e){this.serializer=e}Ks(e){return iv(this.serializer,e)}qs(e){return e.metadata.exists?iS(this.serializer,e.document,!1):nA.newNoDocument(this.Ks(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return im(e)}}class o_{constructor(e,t){this.$a=e,this.serializer=t,this.Wa=[],this.Qa=[],this.collectionGroups=new Set,this.progress=oS(e)}get queries(){return this.Wa}get documents(){return this.Qa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Wa.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Qa.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let n=Z.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.qa.document&&(this.Qa[this.Qa.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,n=new oE(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.Ks(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||rp()).add(e);t.set(n,r)}}return t}async ja(e){let t=await as(e,new oE(this.serializer),this.Qa,this.$a.id),n=this.za(this.documents);for(let t of this.Wa)await aa(e,t,n.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ha:this.collectionGroups,Ja:t}}}function oS(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class ox{constructor(e){this.key=e}}class oC{constructor(e){this.key=e}}class oA{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=rp(),this.mutatedKeys=rp(),this.eu=ro(e),this.tu=new oh(this.eu)}get nu(){return this.Za}ru(e,t){let n=t?t.iu:new oc,r=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),h=rs(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(n.track({type:3,doc:h}),f=!0):this.su(u,h)||(n.track({type:2,doc:h}),f=!0,(o&&this.eu(h,o)>0||l&&0>this.eu(h,l))&&(a=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Ss:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var n,r;let i;return n=e.type,r=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M(20277,{Vt:e})}})(n)-i(r)||this.eu(e.doc,t.doc)}),this.ou(n),r=r??!1;let a=t&&!r?this._u():[],o=0===this.Ya.size&&this.current&&!r?1:0,l=o!==this.Xa;return(this.Xa=o,0!==s.length||l)?{snapshot:new od(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new oc,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Za=this.Za.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Za=this.Za.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=rp(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))});let t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new oC(e))}),this.Ya.forEach(n=>{e.has(n)||t.push(new ox(n))}),t}cu(e){this.Za=e.ks,this.Ya=rp();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return od.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Xa,this.hasCachedResults)}}let oD="SyncEngine";class oN{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ok{constructor(e){this.key=e,this.hu=!1}}class oR{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new rl(e=>rr(e),rn),this.Iu=new Map,this.Eu=new Set,this.Ru=new tz(en.comparator),this.Au=new Map,this.Vu=new sq,this.du={},this.mu=new Map,this.fu=sw.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function oM(e,t,n=!0){let r,i=o9(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=await oP(i,t,n,!0),r}async function oO(e,t){let n=o9(e);await oP(n,t,!0,!1)}async function oP(e,t,n,r){let i,s=await s9(e.localStore,n7(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,n);return r&&(i=await oV(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&aH(e.remoteStore,s),i}async function oV(e,t,n,r,i){e.pu=(t,n,r)=>(async function(e,t,n,r){let i=t.view.ru(n);i.Ss&&(i=await at(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return oW(e,t.targetId,o.au),o.snapshot})(e,t,n,r);let s=await at(e.localStore,t,!0),a=new oA(t,s.ks),o=a.ru(s.documents),l=r8.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);oW(e,n,u.au);let h=new oN(t,n,a);return e.Tu.set(t,h),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),u.snapshot}async function oL(e,t,n){let r=e.Tu.get(t),i=e.Iu.get(r.targetId);i.length>1?(e.Iu.set(r.targetId,i.filter(e=>!rn(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await ae(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&aW(e.remoteStore,r.targetId),oQ(e,r.targetId)}).catch(ex)):(oQ(e,r.targetId),await ae(e.localStore,r.targetId,!0))}async function oF(e,t){let n=e.Tu.get(t),r=e.Iu.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),aW(e.remoteStore,n.targetId))}async function oq(e,t,n){let r=le(e);try{var i,s;let e,a,o,l,u,h=await (i=r.localStore,o=ed.now(),l=t.reduce((e,t)=>e.add(t.key),rp()),i.persistence.runTransaction("Locally write mutations","readwrite",n=>{let r=ru,s=rp();return i.xs.getEntries(n,l).next(e=>{(r=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(n,r)).next(r=>{e=r;let s=[];for(let n of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=rT(r.transform,e||null);null!=i&&(null===n&&(n=nC.empty()),n.set(r.field,i))}return n||null}(n,e.get(n.key).overlayedDocument);null!=t&&s.push(new rU(n.key,t,function e(t){let n=[];return tB(t.fields,(t,r)=>{let i=new et([t]);if(nb(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new tW(n)}(t.value.mapValue),rM.exists(!0)))}return i.mutationQueue.addMutationBatch(n,o,s,t)}).next(t=>{a=t;let r=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(n,t.batchId,r)})}).then(()=>({batchId:a.batchId,changes:rd(e)})));r.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=r.du[r.currentUser.toKey()])||(u=new tz(Q)),u=u.insert(s,n),r.du[r.currentUser.toKey()]=u,await oY(r,h.changes),await a8(r.remoteStore)}catch(t){let e=ou(t,"Failed to persist write");n.reject(e)}}async function oU(e,t){var n;try{let r,i,s=await (n=e.localStore,r=t.snapshotVersion,i=n.vs,n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=n.xs.newChangeBuffer({trackRemovals:!0});i=n.vs;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(n.li.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.li.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(tY.EMPTY_BYTE_STRING,ef.min()).withLastLimboFreeSnapshotVersion(ef.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,r)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(n.li.updateTargetData(e,h))});let o=ru,l=rp();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(s7(e,s,t.documentUpdates).next(e=>{o=e.Bs,l=e.Ls})),!r.isEqual(ef.min())){let t=n.li.getLastRemoteSnapshotVersion(e).next(t=>n.li.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return eC.waitFor(a).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.vs=i,e)));t.targetChanges.forEach((t,n)=>{let r=e.Au.get(n);r&&(P(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.hu=!0:t.modifiedDocuments.size>0?P(r.hu,14607):t.removedDocuments.size>0&&(P(r.hu,42227),r.hu=!1))}),await oY(e,s,t)}catch(e){await ex(e)}}function oB(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.Tu.forEach((e,n)=>{let r=n.view.va(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.ba)e.va(t)&&(n=!0)}),n&&ob(r),i.length&&e.Pu.J_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function oj(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Au.get(t),i=r&&r.key;if(i){let n=new tz(en.comparator);n=n.insert(i,nA.newNoDocument(i,ef.min()));let r=rp().add(i),s=new r6(ef.min(),new Map,new tz(Q),n,r);await oU(e,s),e.Ru=e.Ru.remove(i),e.Au.delete(t),oJ(e)}else await ae(e.localStore,t,!1).then(()=>oQ(e,t,n)).catch(ex)}async function oz(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r,i,s,a=t.batch.keys(),o=n.xs.newChangeBuffer({trackRemovals:!0});return(i=(r=t.batch).keys(),s=eC.resolve(),i.forEach(n=>{s=s.next(()=>o.getEntry(e,n)).next(e=>{let i=t.docVersions.get(n);P(null!==i,48541),0>e.version.compareTo(i)&&(r.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>n.mutationQueue.removeMutationBatch(e,r))).next(()=>o.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=rp();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,a))}));o$(e,r,null),oK(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await oY(e,i)}catch(e){await ex(e)}}async function oG(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(P(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));o$(e,t,n),oK(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await oY(e,i)}catch(e){await ex(e)}}function oK(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function o$(e,t,n){let r=e.du[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.du[e.currentUser.toKey()]=r}}function oQ(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach(t=>{e.Vu.containsKey(t)||oH(e,t)})}function oH(e,t){e.Eu.delete(t.path.canonicalString());let n=e.Ru.get(t);null!==n&&(aW(e.remoteStore,n),e.Ru=e.Ru.remove(t),e.Au.delete(n),oJ(e))}function oW(e,t,n){for(let r of n)r instanceof ox?(e.Vu.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.Ru.get(n)||e.Eu.has(r)||(D(oD,"New document in limbo: "+n),e.Eu.add(r),oJ(e))}(e,r)):r instanceof oC?(D(oD,"Document no longer in limbo: "+r.key),e.Vu.removeReference(r.key,t),e.Vu.containsKey(r.key)||oH(e,r.key)):M(19791,{wu:r})}function oJ(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let n=new en(Z.fromString(t)),r=e.fu.next();e.Au.set(r,new ok(n)),e.Ru=e.Ru.insert(n,r),aH(e.remoteStore,new iP(n7(n3(n.path)),r,"TargetPurposeLimboResolution",ej.ce))}}async function oY(e,t,n){let r=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,n).then(t=>{if((t||n)&&e.isPrimaryClient){let r=t?!t.fromCache:n?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,r?"current":"not-current")}if(t){r.push(t);let e=s1.Es(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.J_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>eC.forEach(t,t=>eC.forEach(t.Ts,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>eC.forEach(t.Is,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!eO(e))throw e;D(s3,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.vs.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.vs=e.vs.insert(t,i)}}}(e.localStore,i))}async function oX(e,t){if(!e.currentUser.isEqual(t)){D(oD,"User change. New user:",t.toKey());let n=await s6(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new L(V.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await oY(e,n.Ns)}}function oZ(e,t){let n=e.Au.get(t);if(n&&n.hu)return rp().add(n.key);{let n=rp(),r=e.Iu.get(t);if(!r)return n;for(let t of r){let r=e.Tu.get(t);n=n.unionWith(r.view.nu)}return n}}async function o0(e,t){let n=await at(e.localStore,t.query,!0),r=t.view.cu(n);return e.isPrimaryClient&&oW(e,t.targetId,r.au),r}async function o1(e,t){return ar(e.localStore,t).then(t=>oY(e,t))}async function o2(e,t,n,r){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.Xn(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):eC.resolve(null))));null!==o?("pending"===n?await a8(e.remoteStore):"acknowledged"===n||"rejected"===n?(o$(e,t,r||null),oK(e,t),s=e.localStore,s.mutationQueue.nr(t)):M(6720,"Unknown batchState",{bu:n}),await oY(e,o)):D(oD,"Cannot apply mutation batch with id: "+t)}async function o5(e,t){if(o9(e),le(e),!0===t&&!0!==e.gu){let t=e.sharedClientState.getAllActiveQueryTargets(),n=await o3(e,t.toArray());for(let t of(e.gu=!0,await os(e.remoteStore,!0),n))aH(e.remoteStore,t)}else if(!1===t&&!1!==e.gu){let t=[],n=Promise.resolve();e.Iu.forEach((r,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):n=n.then(()=>(oQ(e,i),ae(e.localStore,i,!0))),aW(e.remoteStore,i)}),await n,await o3(e,t),e.Au.forEach((t,n)=>{aW(e.remoteStore,n)}),e.Vu.zr(),e.Au=new Map,e.Ru=new tz(en.comparator),e.gu=!1,await os(e.remoteStore,!1)}}async function o3(e,t,n){let r=[],i=[];for(let n of t){let t,s=e.Iu.get(n);if(s&&0!==s.length)for(let n of(t=await s9(e.localStore,n7(s[0])),s)){let t=e.Tu.get(n),r=await o0(e,t);r.snapshot&&i.push(r.snapshot)}else{let r=await an(e.localStore,n);t=await s9(e.localStore,r),await oV(e,o4(r),n,!1,t.resumeToken)}r.push(t)}return e.Pu.J_(i),r}function o4(e){var t,n,r,i,s;return t=e.path,n=e.collectionGroup,r=e.orderBy,i=e.filters,s=e.limit,new n5(t,n,r,i,s,"F",e.startAt,e.endAt)}function o6(e){return e.localStore.persistence.hs()}async function o8(e,t,n,r){if(e.gu)return void D(oD,"Ignoring unexpected query state notification.");let i=e.Iu.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{let r=await ar(e.localStore,ra(i[0])),s=r6.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,tY.EMPTY_BYTE_STRING);await oY(e,r,s);break}case"rejected":await ae(e.localStore,t,!0),oQ(e,t,r);break;default:M(64155,n)}}async function o7(e,t,n){let r=o9(e);if(r.gu){for(let e of t){if(r.Iu.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){D(oD,"Adding an already active target "+e);continue}let t=await an(r.localStore,e),n=await s9(r.localStore,t);await oV(r,o4(t),n.targetId,!1,n.resumeToken),aH(r.remoteStore,n)}for(let e of n)r.Iu.has(e)&&await ae(r.localStore,e,!1).then(()=>{aW(r.remoteStore,e),oQ(r,e)}).catch(ex)}}function o9(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=oU.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=oZ.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=oj.bind(null,e),e.Pu.J_=ow.bind(null,e.eventManager),e.Pu.yu=ov.bind(null,e.eventManager),e}function le(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=oz.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=oG.bind(null,e),e}class lt{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=aP(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,n;return t=this.persistence,n=new s5,new s4(t,n,e.initialUser,this.serializer)}Cu(e){return new sK(sQ.Vi,this.serializer)}Du(e){return new ab}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}lt.provider={build:()=>new lt};class ln extends lt{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return P(this.persistence.referenceDelegate instanceof sH,46915),new s_(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?sd.withCacheSize(this.cacheSizeBytes):sd.DEFAULT;return new sK(e=>sH.Vi(e,t),this.serializer)}}class lr extends lt{constructor(e,t,n){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await le(this.xu.syncEngine),await a8(this.xu.remoteStore),await this.persistence.zi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,n;return t=this.persistence,n=new s5,new s4(t,n,e.initialUser,this.serializer)}Fu(e,t){return new s_(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let n=new eB(t,this.persistence);return new eU(e.asyncQueue,n)}Cu(e){let t=s0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?sd.withCacheSize(this.cacheSizeBytes):sd.DEFAULT;return new sZ(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,aM(),aO(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new ab}}class li extends lr{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.xu.syncEngine;this.sharedClientState instanceof av&&(this.sharedClientState.syncEngine={So:o2.bind(null,t),Do:o8.bind(null,t),Co:o7.bind(null,t),hs:o6.bind(null,t),bo:o1.bind(null,t)},await this.sharedClientState.start()),await this.persistence.zi(async e=>{await o5(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){let t=aM();if(!av.v(t))throw new L(V.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=s0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new av(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class ls{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>oB(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=oX.bind(null,this.syncEngine),await os(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new om}createDatastore(e){var t;let n=aP(e.databaseInfo.databaseId),r=new aR(e.databaseInfo);return t=e.authCredentials,new aj(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new aK(t,n,e.asyncQueue,e=>oB(this.syncEngine,e,0),aE.v()?new aE:new aI)}createSyncEngine(e,t){var n,r,i,s,a,o;let l;return n=this.localStore,r=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new oR(n,r,i,s,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){D(aG,"RemoteStore shutting down."),e.Ea.add(5),await aQ(e),e.Aa.shutdown(),e.Va.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}function la(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}ls.provider={build:()=>new ls};class lo{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):N("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class ll{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new F,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.Ua()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.qa)}`))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.ku()}async ku(){let e=await this.Ku();if(null===e)return null;let t=this.Lu.decode(e),n=Number(t);return isNaN(n)&&this.qu(`length string (${t}) is not valid number`),new oT(JSON.parse(await this.Uu(n)),e.length+n)}$u(){return this.buffer.findIndex(e=>123===e)}async Ku(){for(;0>this.$u()&&!await this.Wu(););if(0===this.buffer.length)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Uu(e){for(;this.buffer.length<e;)await this.Wu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Bu.cancel(),Error(`Invalid bundle format: ${e}`)}async Wu(){let e=await this.Bu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class lu{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let n=this.Su();if(!n||!n.Ua())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(n?.qa)}`);this.metadata=n;do null!==(n=this.Su())&&this.elements.push(n);while(null!==n)}getMetadata(){return this.metadata}Qu(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.Ku();return new oT(JSON.parse(this.Uu(e)),e)}Uu(e){if(this.cursor+e>this.bundleData.length)throw new L(V.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}Ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class lh{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new L(V.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let n={documents:t.map(t=>iw(e.serializer,t))},r=await e.jo("BatchGetDocuments",e.serializer.databaseId,Z.emptyPath(),n,t.length),i=new Map;r.forEach(t=>{var n;let r,s,a,o,l,u,h=(n=e.serializer,"found"in t?(P(!!t.found,43571),t.found.name,t.found.updateTime,r=iv(n,t.found.name),s=im(t.found.updateTime),a=t.found.createTime?im(t.found.createTime):ef.min(),o=new nC({mapValue:{fields:t.found.fields}}),nA.newFoundDocument(r,s,a,o)):"missing"in t?(P(!!t.missing,3894),P(!!t.readTime,22933),l=iv(n,t.missing),u=im(t.readTime),nA.newNoDocument(l,u)):M(7234,{result:t}));i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());P(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new rG(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=en.fromPath(t);this.mutations.push(new rK(n,this.precondition(n)))}),await async function(e,t){let n={writes:t.map(t=>ix(e.serializer,t))};await e.Wo("Commit",e.serializer.databaseId,Z.emptyPath(),n)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw M(50498,{Gu:e.constructor.name});t=ef.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new L(V.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ef.min())?rM.exists(!1):rM.updateTime(t):rM.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ef.min()))throw new L(V.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return rM.updateTime(t)}return rM.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class lc{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.zu=n.maxAttempts,this.M_=new aV(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Hu()}Hu(){this.M_.p_(async()=>{let e=new lh(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Zu(e)}))}).catch(e=>{this.Zu(e)})})}Ju(e){try{let t=this.updateFunction(e);return!ez(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Zu(e){this.zu>0&&this.Xu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Hu(),Promise.resolve()))):this.deferred.reject(e)}Xu(e){if("FirebaseError"===e?.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!rY(t)}return!1}}let ld="FirestoreClient";class lf{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this._databaseInfo=r,this.user=S.UNAUTHENTICATED,this.clientId=$.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{D(ld,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(D(ld,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new F;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=ou(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function lm(e,t){e.asyncQueue.verifyOperationInProgress(),D(ld,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await s6(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function lg(e,t){e.asyncQueue.verifyOperationInProgress();let n=await lp(e);D(ld,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>oi(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>oi(t.remoteStore,n)),e._onlineComponents=t}async function lp(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){D(ld,"Using user provided OfflineComponentProvider");try{await lm(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===V.FAILED_PRECONDITION||t.code===V.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;k("Error using user provided cache. Falling back to memory cache: "+t),await lm(e,new lt)}}else D(ld,"Using default OfflineComponentProvider"),await lm(e,new ln(void 0));return e._offlineComponents}async function ly(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(D(ld,"Using user provided OnlineComponentProvider"),await lg(e,e._uninitializedComponentsProvider._online)):(D(ld,"Using default OnlineComponentProvider"),await lg(e,new ls))),e._onlineComponents}function lw(e){return lp(e).then(e=>e.localStore)}function lv(e){return ly(e).then(e=>e.syncEngine)}function lb(e){return ly(e).then(e=>e.datastore)}async function lI(e){let t=await ly(e),n=t.eventManager;return n.onListen=oM.bind(null,t.syncEngine),n.onUnlisten=oL.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=oO.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=oF.bind(null,t.syncEngine),n}function lT(e,t,n={}){let r=new F;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await lI(e),s=e.asyncQueue,a=new lo({next:e=>{a.Nu(),s.enqueueAndForget(()=>oy(i,o));let l=e.docs.has(t);!l&&e.fromCache?r.reject(new L(V.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&n&&"server"===n.source?r.reject(new L(V.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(e)},error:e=>r.reject(e)}),op(i,o=new oI(n3(t.path),a,{includeMetadataChanges:!0,Ka:!0}))}),r.promise}function lE(e,t,n={}){let r=new F;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await lI(e),s=e.asyncQueue,o=new oI(t,a=new lo({next:e=>{a.Nu(),s.enqueueAndForget(()=>oy(i,o)),e.fromCache&&"server"===n.source?r.reject(new L(V.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(e)},error:e=>r.reject(e)}),{includeMetadataChanges:!0,Ka:!0}),op(i,o)}),r.promise}function l_(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let lS=new Map;class lx{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new L(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new L(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new L(V.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=l_(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new L(V.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new L(V.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new L(V.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class lC{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new lx({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new L(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new L(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lx(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new U;switch(e.type){case"firstParty":return new z(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new L(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=lS.get(this))&&(D("ComponentProvider","Removing Datastore"),lS.delete(this),e.terminate()),Promise.resolve()}}class lA{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new lA(this.firestore,e,this._query)}}class lD{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lN(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new lD(this.firestore,e,this._key)}toJSON(){return{type:lD._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(ec(t,lD._jsonSchema))return new lD(e,n||null,new en(Z.fromString(t.referencePath)))}}lD._jsonSchemaVersion="firestore/documentReference/1.0",lD._jsonSchema={type:eh("string",lD._jsonSchemaVersion),referencePath:eh("string")};class lN extends lA{constructor(e,t,n){super(e,t,n3(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new lD(this.firestore,null,new en(e))}withConverter(e){return new lN(this.firestore,e,this._path)}}function lk(e,t,...n){if(e=(0,v.getModularInstance)(e),er("collection","path",t),e instanceof lC){let r=Z.fromString(t,...n);return es(r),new lN(e,null,r)}{if(!(e instanceof lD||e instanceof lN))throw new L(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(Z.fromString(t,...n));return es(r),new lN(e.firestore,null,r)}}function lR(e,t,...n){if(e=(0,v.getModularInstance)(e),1==arguments.length&&(t=$.newId()),er("doc","path",t),e instanceof lC){let r=Z.fromString(t,...n);return ei(r),new lD(e,null,new en(r))}{if(!(e instanceof lD||e instanceof lN))throw new L(V.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(Z.fromString(t,...n));return ei(r),new lD(e.firestore,e instanceof lN?e.converter:null,new en(r))}}function lM(e,t){return e=(0,v.getModularInstance)(e),t=(0,v.getModularInstance)(t),e instanceof lA&&t instanceof lA&&e.firestore===t.firestore&&rn(e._query,t._query)&&e.converter===t.converter}let lO="AsyncQueue";class lP{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new aV(this,"async_queue_retry"),this._c=()=>{let e=aO();e&&D(lO,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=aO();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=aO();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new F;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(0!==this.Yu.length){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!eO(e))throw e;D(lO,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,N("INTERNAL UNHANDLED ERROR: ",lV(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let r=ol.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&M(47125,{Pc:lV(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function lV(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class lL{constructor(){this._progressObserver={},this._taskCompletionResolver=new F,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class lF extends lC{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new lP,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new lP(e),this._firestoreClient=void 0,await e}}}function lq(e){if(e._terminated)throw new L(V.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,r,i,s;let a,o=e._freezeSettings(),l=(t=e._databaseId,n=e._app?.options.appId||"",r=e._persistenceKey,i=e._app?.options.apiKey,new t9(t,n,r,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,l_(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator,i));e._componentsProvider||o.localCache?._offlineComponentProvider&&o.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),e._firestoreClient=new lf(e._authCredentials,e._appCheckCredentials,e._queue,l,e._componentsProvider&&(s=e._componentsProvider,a=s?._online.build(),{_offline:s?._offline.build(a),_online:a}))}(e),e._firestoreClient}function lU(e,t){let n=lq(e=el(e,lF)),r=new lL;return function(e,t,n,r){var i;let s=(i=aP(t),new ll(function(e,t){if(e instanceof Uint8Array)return la(e,void 0);if(e instanceof ArrayBuffer)return la(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof n?r0().encode(n):n),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,n){try{var r,i;let s,a=await t.getMetadata();if(await (r=e.localStore,s=im(a.createTime),r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.Pi.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),n._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);n._updateProgress(oS(a));let o=new o_(a,t.serializer),l=await t.Su();for(;l;){let e=await o.Ga(l);e&&n._updateProgress(e),l=await t.Su()}let u=await o.ja(e.localStore);return await oY(e,u.Ja,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Pi.saveBundleMetadata(e,a))),n._completeWith(u.progress),Promise.resolve(u.Ha)}catch(e){return k(oD,`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(t=await lv(e),s,r).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(n,e._databaseId,t,r),r}class lB{constructor(e){this._byteString=e}static fromBase64String(e){try{return new lB(tY.fromBase64String(e))}catch(e){throw new L(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new lB(tY.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:lB._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ec(e,lB._jsonSchema))return lB.fromBase64String(e.bytes)}}lB._jsonSchemaVersion="firestore/bytes/1.0",lB._jsonSchema={type:eh("string",lB._jsonSchemaVersion),bytes:eh("string")};class lj{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new L(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new et(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class lz{constructor(e){this._methodName=e}}class lG{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new L(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new L(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:lG._jsonSchemaVersion}}static fromJSON(e){if(ec(e,lG._jsonSchema))return new lG(e.latitude,e.longitude)}}lG._jsonSchemaVersion="firestore/geoPoint/1.0",lG._jsonSchema={type:eh("string",lG._jsonSchemaVersion),latitude:eh("number"),longitude:eh("number")};class lK{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:lK._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ec(e,lK._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new lK(e.vectorValues);throw new L(V.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}lK._jsonSchemaVersion="firestore/vectorValue/1.0",lK._jsonSchema={type:eh("string",lK._jsonSchemaVersion),vectorValues:eh("object")};let l$=/^__.*__$/;class lQ{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new rU(e,this.data,this.fieldMask,t,this.fieldTransforms):new rq(e,this.data,t,this.fieldTransforms)}}class lH{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new rU(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function lW(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M(40011,{dataSource:e})}}class lJ{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new lJ({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),n=this.contextWith({path:t,arrayElement:!1});return n.validatePathSegment(e),n}childContextForFieldPath(e){let t=this.path?.child(e),n=this.contextWith({path:t,arrayElement:!1});return n.validatePath(),n}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return un(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(lW(this.dataSource)&&l$.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class lY{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||aP(e)}createContext(e,t,n,r=!1){return new lJ({dataSource:e,methodName:t,targetDoc:n,path:et.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function lX(e){let t=e._freezeSettings(),n=aP(e._databaseId);return new lY(e._databaseId,!!t.ignoreUndefinedProperties,n)}function lZ(e,t,n,r,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,n,i);l7("Data must be an object, but it was:",l,r);let u=l6(r,l);if(s.merge)a=new tW(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=l9(t,r,n);if(!l.contains(i))throw new L(V.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);ur(e,i)||e.push(i)}a=new tW(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new lQ(new nC(u),a,o)}class l0 extends lz{_toFieldTransform(e){if(2!==e.dataSource)throw 1===e.dataSource?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof l0}}class l1 extends lz{constructor(e,t){super(e),this.Vc=t}_toFieldTransform(e){let t=new rA(e.serializer,rb(e.serializer,this.Vc));return new rk(e.path,t)}isEqual(e){return e instanceof l1&&this.Vc===e.Vc}}function l2(e,t,n,r){let i=e.createContext(1,t,n);l7("Data must be an object, but it was:",i,r);let s=[],a=nC.empty();return tB(r,(e,r)=>{let o=ut(t,e,n);r=(0,v.getModularInstance)(r);let l=i.childContextForFieldPath(o);if(r instanceof l0)s.push(o);else{let e=l4(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new lH(a,new tW(s),i.fieldTransforms)}function l5(e,t,n,r,i,s){let a=e.createContext(1,t,n),o=[l9(t,r,n)],l=[i];if(s.length%2!=0)throw new L(V.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(l9(t,s[e])),l.push(s[e+1]);let u=[],h=nC.empty();for(let e=o.length-1;e>=0;--e)if(!ur(u,o[e])){let t=o[e],n=l[e];n=(0,v.getModularInstance)(n);let r=a.childContextForFieldPath(t);if(n instanceof l0)u.push(t);else{let e=l4(n,r);null!=e&&(u.push(t),h.set(t,e))}}return new lH(h,new tW(u),a.fieldTransforms)}function l3(e,t,n,r=!1){return l4(n,e.createContext(r?4:3,t))}function l4(e,t){if(l8(e=(0,v.getModularInstance)(e)))return l7("Unsupported field value:",t,e),l6(e,t);if(e instanceof lz)return function(e,t){if(!lW(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=l4(i,t.childContextForArray(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}return function(e,t){if(null===(e=(0,v.getModularInstance)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return rb(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=ed.fromDate(e);return{timestampValue:ic(t.serializer,n)}}if(e instanceof ed){let n=new ed(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ic(t.serializer,n)}}if(e instanceof lG)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof lB)return{bytesValue:id(t.serializer,e._byteString)};if(e instanceof lD){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ig(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof lK){var n;return{mapValue:{fields:{[nn]:{stringValue:ns},[na]:{arrayValue:{values:((n=e)instanceof lK?n.toArray():n).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return rw(t.serializer,e)})}}}}}}if(iO(e))return e._toProto(t.serializer);throw t.createError(`Unsupported field value: ${eo(e)}`)}(e,t)}function l6(e,t){let n={};return tj(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):tB(e,(e,r)=>{let i=l4(r,t.childContextForField(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function l8(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ed||e instanceof lG||e instanceof lB||e instanceof lD||e instanceof lz||e instanceof lK||iO(e))}function l7(e,t,n){if(!l8(n)||!ea(n)){let r=eo(n);throw"an object"===r?t.createError(e+" a custom object"):t.createError(e+" "+r)}}function l9(e,t,n){if((t=(0,v.getModularInstance)(t))instanceof lj)return t._internalPath;if("string"==typeof t)return ut(e,t);throw un("Field path arguments must be of type string or ",e,!1,void 0,n)}let ue=RegExp("[~\\*/\\[\\]]");function ut(e,t,n){if(t.search(ue)>=0)throw un(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new lj(...t.split("."))._internalPath}catch(r){throw un(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function un(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new L(V.INVALID_ARGUMENT,o+e+l)}function ur(e,t){return e.some(e=>e.isEqual(t))}class ui{convertValue(e,t="none"){switch(nl(e)){case 0:return null;case 1:return e.booleanValue;case 2:return t0(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(t1(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw M(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return tB(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){return new lK(e.fields?.[na].arrayValue?.values?.map(e=>t0(e.doubleValue)))}convertGeoPoint(e){return new lG(t0(e.latitude),t0(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=t8(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(t7(e));default:return null}}convertTimestamp(e){let t=tZ(e);return new ed(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=Z.fromString(e);P(iM(n),9688,{name:e});let r=new nt(n.get(1),n.get(3)),i=new en(n.popFirst(5));return r.isEqual(t)||N(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class us extends ui{constructor(e){super(),this.firestore=e}convertBytes(e){return new lB(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new lD(this.firestore,null,t)}}function ua(e){return new l1("increment",e)}let uo="@firebase/firestore",ul="4.10.0";function uu(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class uh{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class uc{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new nC({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class ud{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new lD(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new uf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(l9("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class uf extends ud{data(){return super.data()}}function um(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new L(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ug{}class up extends ug{}function uy(e,t,...n){let r=[];for(let i of(t instanceof ug&&r.push(t),function(e){let t=e.filter(e=>e instanceof ub).length,n=e.filter(e=>e instanceof uw).length;if(t>1||t>0&&n>0)throw new L(V.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e}class uw extends up{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new uw(e,t,n)}_apply(e){let t=this._parse(e);return uL(e._query,t),new lA(e.firestore,e.converter,re(e._query,t))}_parse(e){let t=lX(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new L(V.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){uV(a,s);let t=[];for(let n of a)t.push(uP(r,e,n));o={arrayValue:{values:t}}}else o=uP(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||uV(a,s),o=l3(n,t,a,"in"===s||"not-in"===s);return nO.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function uv(e,t,n){let r=l9("where",e);return uw._create(r,t,n)}class ub extends ug{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ub(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:nP.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())uL(n,e),n=re(n,e)}(e._query,t),new lA(e.firestore,e.converter,re(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function uI(...e){return e.forEach(e=>uF("or",e)),ub._create("or",e)}function uT(...e){return e.forEach(e=>uF("and",e)),ub._create("and",e)}class uE extends up{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new uE(e,t)}_apply(e){var t;let n,r=function(e,t,n){if(null!==e.startAt)throw new L(V.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new L(V.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new nR(t,n)}(e._query,this._field,this._direction);return new lA(e.firestore,e.converter,(t=e._query,n=t.explicitOrderBy.concat([r]),new n5(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function u_(e,t="asc"){let n=l9("orderBy",e);return uE._create(n,t)}class uS extends up{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new uS(e,t,n)}_apply(e){return new lA(e.firestore,e.converter,rt(e._query,this._limit,this._limitType))}}function ux(e){return eu("limit",e),uS._create("limit",e,"F")}function uC(e){return eu("limitToLast",e),uS._create("limitToLast",e,"L")}class uA extends up{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new uA(e,t,n)}_apply(e){var t;let n=uO(e,this.type,this._docOrFields,this._inclusive);return new lA(e.firestore,e.converter,(t=e._query,new n5(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt)))}}function uD(...e){return uA._create("startAt",e,!0)}function uN(...e){return uA._create("startAfter",e,!1)}class uk extends up{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new uk(e,t,n)}_apply(e){var t;let n=uO(e,this.type,this._docOrFields,this._inclusive);return new lA(e.firestore,e.converter,(t=e._query,new n5(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n)))}}function uR(...e){return uk._create("endBefore",e,!1)}function uM(...e){return uk._create("endAt",e,!0)}function uO(e,t,n,r){if(n[0]=(0,v.getModularInstance)(n[0]),n[0]instanceof ud)return function(e,t,n,r,i){if(!r)throw new L(V.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of n8(e))if(n.field.isKeyField())s.push(ng(t,r.key));else{let e=r.data.field(n.field);if(t6(e))throw new L(V.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new L(V.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new nD(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=lX(e.firestore);return function(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new L(V.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new L(V.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!n6(e)&&-1!==l.indexOf("/"))throw new L(V.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(Z.fromString(l));if(!en.isDocumentKey(n))throw new L(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new en(n);o.push(ng(t,i))}else{let e=l3(n,r,l);o.push(e)}}return new nD(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function uP(e,t,n){if("string"==typeof(n=(0,v.getModularInstance)(n))){if(""===n)throw new L(V.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!n6(t)&&-1!==n.indexOf("/"))throw new L(V.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(Z.fromString(n));if(!en.isDocumentKey(r))throw new L(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ng(e,new en(r))}if(n instanceof lD)return ng(e,n._key);throw new L(V.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${eo(n)}.`)}function uV(e,t){if(!Array.isArray(e)||0===e.length)throw new L(V.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function uL(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new L(V.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new L(V.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function uF(e,t){if(!(t instanceof uw||t instanceof ub))throw new L(V.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function uq(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class uU extends ui{constructor(e){super(),this.firestore=e}convertBytes(e){return new lB(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new lD(this.firestore,null,t)}}function uB(e){return new uh("sum",l9("sum",e))}function uj(e){return new uh("avg",l9("average",e))}function uz(){return new uh("count")}function uG(e,t){return e instanceof uh&&t instanceof uh&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function uK(e,t){return lM(e.query,t.query)&&(0,v.deepEqual)(e.data(),t.data())}function u$(e){return uQ(e,{count:uz()})}function uQ(e,t){var n;let r,i=el(e.firestore,lF),s=lq(i),a=function(e,t){let n=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r,e));return n}(t,(e,t)=>new rW(t,e.aggregateType,e._internalFieldPath));return(n=e._query,r=new F,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await lb(s);r.resolve(async function(e,t,n){let{request:r,gt:i,parent:s}=function(e,t,n,r){let{ft:i,parent:s}=iD(e,t),a={},o=[],l=0;return n.forEach(e=>{let t="aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:ik(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:ik(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},gt:a,parent:s}}(e.serializer,(t.Re||(t.Re=n9(t,t.explicitOrderBy)),t.Re),n);e.connection.Ko||delete r.parent;let a=(await e.jo("RunAggregationQuery",e.serializer.databaseId,s,r,1)).filter(e=>!!e.result);P(1===a.length,64727);let o=a[0].result?.aggregateFields;return Object.keys(o).reduce((e,t)=>(e[i[t]]=o[t],e),{})}(e,n,a))}catch(e){r.reject(e)}}),r.promise).then(t=>new uc(e,new us(i),t))}class uH{constructor(e){this.kind="memory",this._onlineComponentProvider=ls.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new ln(void 0)}}toJSON(){return{kind:this.kind}}}class uW{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=u3(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class uJ{constructor(){this.kind="memoryEager",this._offlineComponentProvider=lt.provider}toJSON(){return{kind:this.kind}}}class uY{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new ln(e)}}toJSON(){return{kind:this.kind}}}function uX(){return new uJ}function uZ(e){return new uY(e?.cacheSizeBytes)}function u0(e){return new uH(e)}function u1(e){return new uW(e)}class u2{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ls.provider,this._offlineComponentProvider={build:t=>new lr(t,e?.cacheSizeBytes,this.forceOwnership)}}}class u5{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ls.provider,this._offlineComponentProvider={build:t=>new li(t,e?.cacheSizeBytes)}}}function u3(e){return new u2(e?.forceOwnership)}function u4(){return new u5}let u6="NOT SUPPORTED";class u8{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class u7 extends ud{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new he(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(l9("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new L(V.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=u7._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function u9(e,t,n){if(ec(t,u7._jsonSchema)){var r;if(t.bundle===u6)throw new L(V.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=aP(e._databaseId),s=(r=t.bundle,new lu(r,i)),a=s.t(),o=new o_(s.getMetadata(),i);for(let e of a)o.o(e);let l=o.documents;if(1!==l.length)throw new L(V.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${l.length} documents.`);let u=iS(i,l[0].document),h=new en(Z.fromString(t.bundleName));return new u7(e,new uU(e),h,u,new u8(!1,!1),n||null)}}u7._jsonSchemaVersion="firestore/documentSnapshot/1.0",u7._jsonSchema={type:eh("string",u7._jsonSchemaVersion),bundleSource:eh("string","DocumentSnapshot"),bundleName:eh("string"),bundle:eh("string")};class he extends u7{data(e={}){return super.data(e)}}class ht{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new u8(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new he(this._firestore,this._userDataWriter,n.key,n,new u8(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new L(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new he(e._firestore,e._userDataWriter,n.doc.key,n.doc,new u8(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new he(e._firestore,e._userDataWriter,t.doc.key,t.doc,new u8(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M(61501,{type:e})}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new L(V.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=ht._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=$.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function hn(e,t,n){if(ec(t,ht._jsonSchema)){var r;if(t.bundle===u6)throw new L(V.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=aP(e._databaseId),s=(r=t.bundle,new lu(r,i)),a=s.t(),o=new o_(s.getMetadata(),i);for(let e of a)o.o(e);if(1!==o.queries.length)throw new L(V.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let l=iG(o.queries[0].bundledQuery),u=o.documents,h=new oh;u.map(e=>{let t=iS(i,e.document);h=h.add(t)});let c=od.fromInitialDocuments(l,h,rp(),!1,!1),d=new lA(e,n||null,l);return new ht(e,new uU(e),d,c)}}function hr(e,t){return e instanceof u7&&t instanceof u7?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof ht&&t instanceof ht&&e._firestore===t._firestore&&lM(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}ht._jsonSchemaVersion="firestore/querySnapshot/1.0",ht._jsonSchema={type:eh("string",ht._jsonSchemaVersion),bundleSource:eh("string","QuerySnapshot"),bundleName:eh("string"),bundle:eh("string")};let hi={maxAttempts:5};class hs{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=lX(e)}set(e,t,n){this._verifyNotCommitted();let r=ha(e,this._firestore),i=uq(r.converter,t,n),s=lZ(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,rM.none())),this}update(e,t,n,...r){let i;this._verifyNotCommitted();let s=ha(e,this._firestore);return i="string"==typeof(t=(0,v.getModularInstance)(t))||t instanceof lj?l5(this._dataReader,"WriteBatch.update",s._key,t,n,r):l2(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,rM.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=ha(e,this._firestore);return this._mutations=this._mutations.concat(new rG(t._key,rM.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new L(V.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ha(e,t){if((e=(0,v.getModularInstance)(e)).firestore!==t)throw new L(V.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class ho{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=lX(e)}get(e){let t=ha(e,this._firestore),n=new uU(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return M(24041);let r=e[0];if(r.isFoundDocument())return new ud(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new ud(this._firestore,n,t._key,null,t.converter);throw M(18433,{doc:r})})}set(e,t,n){let r=ha(e,this._firestore),i=uq(r.converter,t,n),s=lZ(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){let i,s=ha(e,this._firestore);return i="string"==typeof(t=(0,v.getModularInstance)(t))||t instanceof lj?l5(this._dataReader,"Transaction.update",s._key,t,n,r):l2(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=ha(e,this._firestore);return this._transaction.delete(t._key),this}}class hl extends ho{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=ha(e,this._firestore),n=new us(this._firestore);return super.get(e).then(e=>new u7(this._firestore,n,t._key,e._document,new u8(!1,!1),t.converter))}}function hu(e,t,n){var r,i;let s;e=el(e,lF);let a={...hi,...n};if(a.maxAttempts<1)throw new L(V.INVALID_ARGUMENT,"Max attempts must be at least 1");return r=lq(e),i=n=>t(new hl(e,n)),s=new F,r.asyncQueue.enqueueAndForget(async()=>{let e=await lb(r);new lc(r.asyncQueue,e,a,i,s).ju()}),s.promise}function hh(e){e=el(e,lD);let t=el(e.firestore,lF);return lT(lq(t),e._key).then(n=>h_(t,e,n))}function hc(e){var t;let n;e=el(e,lD);let r=el(e.firestore,lF),i=lq(r),s=new us(r);return(t=e._key,n=new F,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await e.persistence.runTransaction("read document","readonly",n=>e.localDocuments.getDocument(n,t));r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new L(V.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let e=ou(r,`Failed to get document '${t} from cache`);n.reject(e)}})(await lw(i),t,n)),n.promise).then(t=>new u7(r,s,e._key,t,new u8(null!==t&&t.hasLocalMutations,!0),e.converter))}function hd(e){e=el(e,lD);let t=el(e.firestore,lF);return lT(lq(t),e._key,{source:"server"}).then(n=>h_(t,e,n))}function hf(e){e=el(e,lA);let t=el(e.firestore,lF),n=lq(t),r=new us(t);return um(e._query),lE(n,e._query).then(n=>new ht(t,r,e,n))}function hm(e){var t;let n;e=el(e,lA);let r=el(e.firestore,lF),i=lq(r),s=new us(r);return(t=e._query,n=new F,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await at(e,t,!0),i=new oA(t,r.ks),s=i.ru(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(r){let e=ou(r,`Failed to execute query '${t} against cache`);n.reject(e)}})(await lw(i),t,n)),n.promise).then(t=>new ht(r,s,e,t))}function hg(e){e=el(e,lA);let t=el(e.firestore,lF),n=lq(t),r=new us(t);return lE(n,e._query,{source:"server"}).then(n=>new ht(t,r,e,n))}function hp(e,t,n){e=el(e,lD);let r=el(e.firestore,lF),i=uq(e.converter,t,n),s=lX(r);return hE(r,[lZ(s,"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,rM.none())])}function hy(e,t,n,...r){e=el(e,lD);let i=el(e.firestore,lF),s=lX(i);return hE(i,[("string"==typeof(t=(0,v.getModularInstance)(t))||t instanceof lj?l5(s,"updateDoc",e._key,t,n,r):l2(s,"updateDoc",e._key,t)).toMutation(e._key,rM.exists(!0))])}function hw(e){return hE(el(e.firestore,lF),[new rG(e._key,rM.none())])}function hv(e,t){let n=el(e.firestore,lF),r=lR(e),i=uq(e.converter,t);return hE(n,[lZ(lX(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,rM.exists(!1))]).then(()=>r)}function hb(e,...t){var n;let r,i,s,a,o;e=(0,v.getModularInstance)(e);let l={includeMetadataChanges:!1,source:"default"},u=0;"object"!=typeof t[0]||uu(t[u])||(l=t[u++]);let h={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(uu(t[u])){let e=t[u];t[u]=e.next?.bind(e),t[u+1]=e.error?.bind(e),t[u+2]=e.complete?.bind(e)}if(e instanceof lD)i=el(e.firestore,lF),s=n3(e._key.path),r={next:n=>{t[u]&&t[u](h_(i,e,n))},error:t[u+1],complete:t[u+2]};else{let n=el(e,lA);i=el(n.firestore,lF),s=n._query;let a=new us(i);r={next:e=>{t[u]&&t[u](new ht(i,a,n,e))},error:t[u+1],complete:t[u+2]},um(e._query)}return n=lq(i),o=new oI(s,a=new lo(r),h),n.asyncQueue.enqueueAndForget(async()=>op(await lI(n),o)),()=>{a.Nu(),n.asyncQueue.enqueueAndForget(async()=>oy(await lI(n),o))}}function hI(e,t,...n){var r,i,s,a,o,l;let u=(0,v.getModularInstance)(e),h=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let n of["bundle","bundleName","bundleSource"]){if(!(n in e)){t.error=`snapshotJson missing required field: ${n}`;break}let r=e[n];if("string"!=typeof r){t.error=`snapshotJson field '${n}' must be a string.`;break}if(0===r.length){t.error=`snapshotJson field '${n}' cannot be an empty string.`;break}"bundle"===n?t.bundle=r:"bundleName"===n?t.bundleName=r:"bundleSource"===n&&(t.bundleSource=r)}return t}(t);if(h.error)throw new L(V.INVALID_ARGUMENT,h.error);let c,d=0;if("object"!=typeof n[0]||uu(n[d])||(c=n[d++]),"QuerySnapshot"===h.bundleSource){let e,t,a=null;if("object"==typeof n[d]&&uu(n[d])){let e=n[d++];a={next:e.next,error:e.error,complete:e.complete}}else a={next:n[d++],error:n[d++],complete:n[d++]};return r=c,i=a,s=n[d],t=!1,lU(u,h.bundle).then(()=>{var e,t,n;return e=u,t=h.bundleName,(n=lq(e=el(e,lF)),n.asyncQueue.enqueue(async()=>{var e;return e=await lw(n),e.persistence.runTransaction("Get named query","readonly",n=>e.Pi.getNamedQuery(n,t))})).then(t=>t?new lA(e,null,t.query):null)}).then(n=>{n&&!t&&(s&&n.withConverter(s),e=hb(n,r||{},i))}).catch(e=>(i.error&&i.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===h.bundleSource){let e,t,r=null;if("object"==typeof n[d]&&uu(n[d])){let e=n[d++];r={next:e.next,error:e.error,complete:e.complete}}else r={next:n[d++],error:n[d++],complete:n[d++]};return a=c,o=r,l=n[d],t=!1,lU(u,h.bundle).then(()=>{t||(e=hb(new lD(u,l||null,en.fromPath(h.bundleName)),a||{},o))}).catch(e=>(o.error&&o.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new L(V.INVALID_ARGUMENT,`unsupported bundle source: ${h.bundleSource}`)}function hT(e,t){let n,r=lq(e=el(e,lF));return n=new lo(uu(t)?t:{next:t}),r.asyncQueue.enqueueAndForget(async()=>{var e;return e=await lI(r),void(e.Ca.add(n),n.next())}),()=>{n.Nu(),r.asyncQueue.enqueueAndForget(async()=>{var e;return e=await lI(r),void e.Ca.delete(n)})}}function hE(e,t){var n;let r;return n=lq(e),r=new F,n.asyncQueue.enqueueAndForget(async()=>oq(await lv(n),t,r)),r.promise}function h_(e,t,n){let r=n.docs.get(t._key),i=new us(e);return new u7(e,i,t._key,r,new u8(n.hasPendingWrites,n.fromCache),t.converter)}function hS(e){return lq(e=el(e,lF)),new hs(e,t=>hE(e,t))}function hx(e,t){let n=lq(e=el(e,lF));if(!n._uninitializedComponentsProvider||"memory"===n._uninitializedComponentsProvider._offline.kind)return k("Cannot enable indexes when persistence is disabled"),Promise.resolve();let r=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new L(V.INVALID_ARGUMENT,"Failed to parse JSON: "+e?.message)}}(e):e,n=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=hC(e,"collectionGroup"),r=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=ut("setIndexConfiguration",hC(t,"fieldPath"));"CONTAINS"===t.arrayConfig?r.push(new ew(e,2)):"ASCENDING"===t.order?r.push(new ew(e,0)):"DESCENDING"===t.order&&r.push(new ew(e,1))}n.push(new em(em.UNKNOWN_ID,t,r,ev.empty()))}return n}(t);return n.asyncQueue.enqueue(async()=>(async function(e,t){let n=e.indexManager,r=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(i=>(function(e,t,n,r,i){t=[...t],(e=[...e]).sort(n),t.sort(n);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=n(e[l],t[o]);s<0?i(e[l++]):s>0?r(t[o++]):(o++,l++)}for(;o<a;)r(t[o++]);for(;l<s;)i(e[l++])})(i,t,ey,t=>{r.push(n.addFieldIndex(e,t))},t=>{r.push(n.deleteFieldIndex(e,t))})).next(()=>eC.waitFor(r)))})(await lw(n),r))}function hC(e,t){if("string"!=typeof e[t])throw new L(V.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class hA{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function hD(e){e=el(e,lF);let t=hO.get(e);if(t)return t;let n=lq(e);if("persistent"!==n._uninitializedComponentsProvider?._offline.kind)return null;let r=new hA(e);return hO.set(e,r),r}function hN(e){hM(e,!0)}function hk(e){hM(e,!1)}function hR(e){var t;(t=lq(e._firestore)).asyncQueue.enqueue(async()=>{var e;let n;return n=(e=await lw(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>n.deleteAllFieldIndexes(e))}).then(e=>D("deleting all persistent cache indexes succeeded")).catch(e=>k("deleting all persistent cache indexes failed",e))}function hM(e,t){var n;(n=lq(e._firestore),n.asyncQueue.enqueue(async()=>{var e;return e=await lw(n),void(e.Cs.As=t)})).then(e=>D(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>k(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let hO=new WeakMap;class hP{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return hV.instance.onExistenceFilterMismatch(e)}}class hV{constructor(){this.i=new Map}static get instance(){return hL||function(e){if(rZ)throw Error("a TestingHooksSpi instance is already set");rZ=e}(hL=new hV),hL}u(e){this.i.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),n=this.i;return n.set(t,e),()=>n.delete(t)}}let hL=null;!function(e=!0){x=g.SDK_VERSION,(0,g._registerComponent)(new p.Component("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new lF(new B(t.getProvider("auth-internal")),new K(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new L(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nt(e.options.projectId,t)}(i,n),i);return r={useFetchStreams:e,...r},s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),(0,g.registerVersion)(uo,ul,void 0),(0,g.registerVersion)(uo,ul,"esm2020")}(),e.s(["AggregateField",()=>uh,"AggregateQuerySnapshot",()=>uc,"DocumentSnapshot",()=>u7,"PersistentCacheIndexManager",()=>hA,"QueryCompositeFilterConstraint",()=>ub,"QueryConstraint",()=>up,"QueryDocumentSnapshot",()=>he,"QueryEndAtConstraint",()=>uk,"QueryFieldFilterConstraint",()=>uw,"QueryLimitConstraint",()=>uS,"QueryOrderByConstraint",()=>uE,"QuerySnapshot",()=>ht,"QueryStartAtConstraint",()=>uA,"SnapshotMetadata",()=>u8,"Transaction",()=>hl,"WriteBatch",()=>hs,"_TestingHooks",()=>hP,"addDoc",()=>hv,"aggregateFieldEqual",()=>uG,"aggregateQuerySnapshotEqual",()=>uK,"and",()=>uT,"average",()=>uj,"count",()=>uz,"deleteAllPersistentCacheIndexes",()=>hR,"deleteDoc",()=>hw,"disablePersistentCacheIndexAutoCreation",()=>hk,"documentSnapshotFromJSON",()=>u9,"enablePersistentCacheIndexAutoCreation",()=>hN,"endAt",()=>uM,"endBefore",()=>uR,"executeWrite",()=>hE,"getAggregateFromServer",()=>uQ,"getCountFromServer",()=>u$,"getDoc",()=>hh,"getDocFromCache",()=>hc,"getDocFromServer",()=>hd,"getDocs",()=>hf,"getDocsFromCache",()=>hm,"getDocsFromServer",()=>hg,"getPersistentCacheIndexManager",()=>hD,"limit",()=>ux,"limitToLast",()=>uC,"memoryEagerGarbageCollector",()=>uX,"memoryLocalCache",()=>u0,"memoryLruGarbageCollector",()=>uZ,"onSnapshot",()=>hb,"onSnapshotResume",()=>hI,"onSnapshotsInSync",()=>hT,"or",()=>uI,"orderBy",()=>u_,"persistentLocalCache",()=>u1,"persistentMultipleTabManager",()=>u4,"persistentSingleTabManager",()=>u3,"query",()=>uy,"querySnapshotFromJSON",()=>hn,"runTransaction",()=>hu,"setDoc",()=>hp,"setIndexConfiguration",()=>hx,"snapshotEqual",()=>hr,"startAfter",()=>uN,"startAt",()=>uD,"sum",()=>uB,"updateDoc",()=>hy,"where",()=>uv,"writeBatch",()=>hS],755827),e.s([],240925),e.i(755827),e.s(["FirestoreError",()=>L,"Timestamp",()=>ed,"addDoc",()=>hv,"collection",()=>lk,"deleteDoc",()=>hw,"doc",()=>lR,"getDoc",()=>hh,"getDocs",()=>hf,"increment",()=>ua,"limit",()=>ux,"onSnapshot",()=>hb,"orderBy",()=>u_,"query",()=>uy,"setDoc",()=>hp,"updateDoc",()=>hy,"where",()=>uv,"writeBatch",()=>hS],977031)}]);