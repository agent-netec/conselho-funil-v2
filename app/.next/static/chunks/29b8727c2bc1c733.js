(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,198997,e=>{"use strict";var t=e.i(430459),s=e.i(833145),a=e.i(58333),i=e.i(533763),r=e.i(615090),l=e.i(282956),n=e.i(749442),c=e.i(54203),o=e.i(860205),d=e.i(602851),x=e.i(184149),m=e.i(939287),h=e.i(628626),p=e.i(91435),u=e.i(360619),j=e.i(783365),g=e.i(763739),b=e.i(82238),f=e.i(143957),N=e.i(587975),v=e.i(651752),y=e.i(946089);let w=(0,y.default)("bookmark-plus",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"12",x2:"12",y1:"7",y2:"13",key:"1cppfj"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]]);var k=e.i(634697),C=e.i(329075),z=e.i(439469);e.i(240925);var S=e.i(977031),A=e.i(597482),$=e.i(551165),E=e.i(255006);e.i(151495);var T=e.i(800598),P=e.i(913821),O=e.i(186855),F=e.i(818168),B=e.i(151999);let R={EXECUTAR:{icon:p.CheckCircle2,color:"text-emerald-400",bg:"bg-emerald-500/10",border:"border-emerald-500/30",label:"Aprovado para ExecuÃ§Ã£o"},AJUSTAR:{icon:T.RefreshCw,color:"text-amber-400",bg:"bg-amber-500/10",border:"border-amber-500/30",label:"Ajustes Solicitados"},MATAR:{icon:u.XCircle,color:"text-red-400",bg:"bg-red-500/10",border:"border-red-500/30",label:"Descartado"}};function D({decision:e,isLast:a}){let[i,n]=(0,s.useState)(!1),o=R[e.type]??R.EXECUTAR,d=o.icon,x=(e.createdAt?.toDate?.()||new Date).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return(0,t.jsxs)("div",{className:"relative flex gap-4",children:[!a&&(0,t.jsx)("div",{className:"absolute left-5 top-12 bottom-0 w-px bg-zinc-800"}),(0,t.jsx)("div",{className:(0,E.cn)("relative z-10 flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl",o.bg,o.border,"border"),children:(0,t.jsx)(d,{className:(0,E.cn)("h-5 w-5",o.color)})}),(0,t.jsx)("div",{className:"flex-1 pb-8",children:(0,t.jsxs)("div",{className:(0,E.cn)("rounded-xl border p-4 transition-all cursor-pointer","border-white/[0.06] bg-white/[0.02]","hover:border-white/[0.1] hover:bg-white/[0.04]"),onClick:()=>n(!i),children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:(0,E.cn)("font-semibold",o.color),children:o.label}),e.metadata?.proposalVersion&&(0,t.jsxs)("span",{className:"text-xs text-zinc-500 px-2 py-0.5 bg-zinc-800 rounded",children:["v",e.metadata.proposalVersion]})]}),(0,t.jsx)("p",{className:"text-sm text-zinc-400 mt-1",children:e.parecer?.summary||"Sem descriÃ§Ã£o"})]}),(0,t.jsx)(c.Button,{variant:"ghost",size:"sm",className:"text-zinc-500",children:i?(0,t.jsx)(F.ChevronUp,{className:"h-4 w-4"}):(0,t.jsx)(O.ChevronDown,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 mt-3 text-xs text-zinc-500",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(P.User,{className:"h-3.5 w-3.5"}),e.metadata?.userName||"UsuÃ¡rio"]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(g.Clock,{className:"h-3.5 w-3.5"}),x]}),e.metadata?.proposalName&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(B.FileText,{className:"h-3.5 w-3.5"}),e.metadata.proposalName]})]}),(0,t.jsx)(l.AnimatePresence,{children:i&&(0,t.jsxs)(r.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 pt-4 border-t border-white/[0.06]",children:[e.parecer?.nextSteps&&e.parecer.nextSteps.length>0&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-zinc-300 mb-2",children:"PrÃ³ximos Passos"}),(0,t.jsx)("ul",{className:"space-y-1",children:e.parecer.nextSteps.map((e,s)=>(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm text-zinc-400",children:[(0,t.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-zinc-600"}),e]},s))})]}),"AJUSTAR"===e.type&&e.adjustments&&e.adjustments.length>0&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-amber-400 mb-2",children:"Ajustes Solicitados"}),(0,t.jsx)("ul",{className:"space-y-1",children:e.adjustments.map((e,s)=>(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm text-zinc-400",children:[(0,t.jsx)(T.RefreshCw,{className:"h-3 w-3 text-amber-400"}),e]},s))})]}),e.parecer?.consolidated?.totalScore&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)(f.Sparkles,{className:"h-4 w-4 text-emerald-400"}),(0,t.jsx)("span",{className:"text-zinc-400",children:"Score do Conselho:"}),(0,t.jsx)("span",{className:"font-semibold text-white",children:"number"==typeof e.parecer.consolidated.totalScore?e.parecer.consolidated.totalScore.toFixed(1):e.parecer.consolidated.totalScore})]})]})})]})})]})}function I({funnelId:e,className:a}){let[i,r]=(0,s.useState)([]),[l,n]=(0,s.useState)(!0);(0,s.useEffect)(()=>{c()},[e]);let c=async()=>{try{n(!0);let t=await fetch(`/api/decisions?funnelId=${e}`),s=await t.json();r(s.decisions||[])}catch(e){console.error("Error loading decisions:",e)}finally{n(!1)}};return l?(0,t.jsx)("div",{className:(0,E.cn)("space-y-4",a),children:[1,2].map(e=>(0,t.jsxs)("div",{className:"flex gap-4 animate-pulse",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-xl bg-zinc-800"}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)("div",{className:"h-24 rounded-xl bg-zinc-800"})})]},e))}):0===i.length?(0,t.jsxs)("div",{className:(0,E.cn)("text-center py-8",a),children:[(0,t.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-xl bg-zinc-800/50 mb-3",children:(0,t.jsx)(g.Clock,{className:"h-6 w-6 text-zinc-600"})}),(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"Nenhuma decisÃ£o registrada"}),(0,t.jsx)("p",{className:"text-xs text-zinc-600 mt-1",children:"Avalie uma proposta para registrar a primeira decisÃ£o"})]}):(0,t.jsx)("div",{className:a,children:(0,t.jsx)("div",{className:"space-y-0",children:i.map((e,s)=>(0,t.jsx)(D,{decision:e,isLast:s===i.length-1},e.id))})})}var L=e.i(197248),M=e.i(790548);function U({proposal:e,isOriginal:s,isLatest:a,onSelect:i}){let l=e.scorecard,n=l?.overall||0;return(0,t.jsxs)(r.motion.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:(0,E.cn)("flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all","hover:bg-white/[0.04]",a?"bg-emerald-500/10 border border-emerald-500/30":"bg-white/[0.02]"),onClick:i,children:[(0,t.jsxs)("div",{className:(0,E.cn)("flex h-8 w-8 items-center justify-center rounded-lg text-xs font-bold",a?"bg-emerald-500 text-white":"bg-zinc-700 text-zinc-300"),children:["v",e.version||1]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-white truncate",children:e.name}),a&&(0,t.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 bg-emerald-500/20 text-emerald-400 rounded",children:"ATUAL"}),s&&!a&&(0,t.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 bg-zinc-700 text-zinc-400 rounded",children:"ORIGINAL"})]}),e.appliedAdjustments&&e.appliedAdjustments.length>0&&(0,t.jsxs)("p",{className:"text-xs text-zinc-500 mt-0.5 truncate",children:["Ajustes: ",e.appliedAdjustments.slice(0,2).join(", "),e.appliedAdjustments.length>2&&"..."]})]}),(0,t.jsx)("div",{className:(0,E.cn)("text-sm font-semibold",n>=7.5?"text-emerald-400":n>=6?"text-amber-400":"text-red-400"),children:n.toFixed(1)})]})}function q({group:e,onSelectProposal:a}){let[i,n]=(0,s.useState)(e.versions.length>0),o=e.versions.length>0,d=o?e.versions[0]:e.original,x=[e.original,...e.versions],m=d.scorecard,h=m?.overall||0;return(0,t.jsxs)("div",{className:"card-premium overflow-hidden",children:[(0,t.jsx)("div",{className:(0,E.cn)("p-4 cursor-pointer transition-colors",o&&"hover:bg-white/[0.02]"),onClick:()=>o?n(!i):a(e.original.id),children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:(0,E.cn)("flex h-14 w-14 flex-shrink-0 items-center justify-center rounded-xl",h>=7.5?"bg-emerald-500/10":h>=6?"bg-amber-500/10":"bg-red-500/10"),children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:(0,E.cn)("text-xl font-bold",h>=7.5?"text-emerald-400":h>=6?"text-amber-400":"text-red-400"),children:h.toFixed(1)}),(0,t.jsx)("div",{className:"text-[10px] text-zinc-500",children:"SCORE"})]})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h4",{className:"font-semibold text-white truncate",children:d.name}),o&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-xs text-zinc-500",children:[(0,t.jsx)(L.GitBranch,{className:"h-3 w-3"}),x.length," versÃµes"]})]}),(0,t.jsx)("p",{className:"text-sm text-zinc-400 mt-1 line-clamp-2",children:d.summary}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:["selected"===d.status&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-xs text-emerald-400 bg-emerald-500/10 px-2 py-0.5 rounded",children:[(0,t.jsx)(p.CheckCircle2,{className:"h-3 w-3"}),"Selecionada"]}),o&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-xs text-blue-400 bg-blue-500/10 px-2 py-0.5 rounded",children:[(0,t.jsx)(T.RefreshCw,{className:"h-3 w-3"}),"Iterada"]})]})]}),o?(0,t.jsx)(c.Button,{variant:"ghost",size:"sm",className:"text-zinc-500",onClick:e=>{e.stopPropagation(),n(!i)},children:i?(0,t.jsx)(O.ChevronDown,{className:"h-4 w-4"}):(0,t.jsx)(M.ChevronRight,{className:"h-4 w-4"})}):(0,t.jsx)(c.Button,{size:"sm",className:"btn-accent",onClick:()=>a(e.original.id),children:"Ver Detalhes"})]})}),(0,t.jsx)(l.AnimatePresence,{children:i&&o&&(0,t.jsx)(r.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-white/[0.06]",children:(0,t.jsxs)("div",{className:"p-4 bg-white/[0.01]",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)(g.Clock,{className:"h-4 w-4 text-zinc-500"}),(0,t.jsx)("span",{className:"text-sm font-medium text-zinc-400",children:"HistÃ³rico de VersÃµes"})]}),(0,t.jsx)("div",{className:"space-y-2 pl-2 border-l-2 border-zinc-800",children:x.map((e,s)=>(0,t.jsx)(U,{proposal:e,isOriginal:s===x.length-1,isLatest:0===s,onSelect:()=>a(e.id)},e.id))})]})})})]})}function G({proposals:e,onSelectProposal:s,className:a}){let i,r=(i=new Map,e.forEach(e=>{e.parentProposalId||i.set(e.id,{original:e,versions:[]})}),e.forEach(e=>{e.parentProposalId&&i.has(e.parentProposalId)?i.get(e.parentProposalId).versions.push(e):e.parentProposalId&&i.set(e.id,{original:e,versions:[]})}),i.forEach(e=>{e.versions.sort((e,t)=>(t.version||0)-(e.version||0))}),Array.from(i.values()));return 0===e.length?null:(0,t.jsx)("div",{className:(0,E.cn)("space-y-4",a),children:r.map(e=>(0,t.jsx)(q,{group:e,onSelectProposal:s},e.original.id))})}var H=e.i(185629),V=e.i(151763);let J=(0,y.default)("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);var Z=e.i(362164);function _({isOpen:e,onClose:a,funnelId:i,funnelName:r,currentShareUrl:l}){let[n,o]=(0,s.useState)(!1),[d,x]=(0,s.useState)(l||null),[m,h]=(0,s.useState)(!1),[p,u]=(0,s.useState)(0),b=async()=>{o(!0);try{let e=await fetch("/api/funnels/share",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({funnelId:i,expiresIn:p})}),t=await e.json();t.success?(x(t.shareUrl),H.notify.success("Link criado!","Compartilhe o link com quem quiser")):H.notify.error("Erro",t.error)}catch(e){H.notify.error("Erro","NÃ£o foi possÃ­vel criar o link")}finally{o(!1)}},f=async()=>{o(!0);try{let e=await fetch(`/api/funnels/share?funnelId=${i}`,{method:"DELETE"});(await e.json()).success&&(x(null),H.notify.info("Link removido","O compartilhamento foi desativado"))}catch(e){H.notify.error("Erro","NÃ£o foi possÃ­vel remover o link")}finally{o(!1)}},N=async()=>{if(d)try{await navigator.clipboard.writeText(d),h(!0),setTimeout(()=>h(!1),2e3),H.notify.success("Copiado!")}catch{H.notify.error("Erro ao copiar")}};return(0,t.jsx)(Z.Dialog,{open:e,onOpenChange:e=>!e&&a(),children:(0,t.jsxs)(Z.DialogContent,{className:"bg-zinc-900 border-zinc-800 max-w-md",children:[(0,t.jsx)(Z.DialogHeader,{children:(0,t.jsxs)(Z.DialogTitle,{className:"flex items-center gap-2 text-white",children:[(0,t.jsx)(z.Share2,{className:"h-5 w-5 text-emerald-400"}),"Compartilhar Funil"]})}),(0,t.jsxs)("div",{className:"space-y-4 pt-2",children:[(0,t.jsxs)("p",{className:"text-sm text-zinc-400",children:["Crie um link pÃºblico para compartilhar ",(0,t.jsxs)("strong",{className:"text-white",children:['"',r,'"']})," com qualquer pessoa."]}),d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm text-zinc-400",children:"Link pÃºblico"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("div",{className:"flex-1 flex items-center gap-2 bg-zinc-800 rounded-lg px-3 py-2 border border-zinc-700",children:[(0,t.jsx)(J,{className:"h-4 w-4 text-zinc-500 flex-shrink-0"}),(0,t.jsx)("span",{className:"text-sm text-white truncate",children:d})]}),(0,t.jsx)(c.Button,{onClick:N,variant:"outline",size:"sm",className:"flex-shrink-0",children:m?(0,t.jsx)(k.Check,{className:"h-4 w-4 text-emerald-400"}):(0,t.jsx)(V.Copy,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(c.Button,{onClick:N,className:"flex-1 btn-accent",children:m?"Copiado!":"Copiar Link"}),(0,t.jsx)(c.Button,{onClick:f,variant:"outline",className:"text-red-400 hover:text-red-300",disabled:n,children:(0,t.jsx)(j.Trash2,{className:"h-4 w-4"})})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm text-zinc-400 flex items-center gap-2",children:[(0,t.jsx)(g.Clock,{className:"h-4 w-4"}),"ExpiraÃ§Ã£o do link"]}),(0,t.jsx)("div",{className:"flex gap-2",children:[{label:"Nunca",value:0},{label:"7 dias",value:7},{label:"30 dias",value:30}].map(e=>(0,t.jsx)("button",{onClick:()=>u(e.value),className:(0,E.cn)("flex-1 py-2 px-3 rounded-lg text-sm transition-all",p===e.value?"bg-emerald-500/20 text-emerald-400 border border-emerald-500/30":"bg-zinc-800 text-zinc-400 border border-zinc-700 hover:border-zinc-600"),children:e.label},e.value))})]}),(0,t.jsx)(c.Button,{onClick:b,disabled:n,className:"w-full btn-accent",children:n?"Criando...":"Criar Link de Compartilhamento"})]}),(0,t.jsx)("p",{className:"text-xs text-zinc-500 text-center",children:"Qualquer pessoa com o link poderÃ¡ ver as propostas do funil."})]})]})})}let X=(0,y.default)("file-braces",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]),Q=(0,y.default)("file-code",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}]]),Y=(0,y.default)("clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]),K=[{format:"markdown",label:"Markdown",icon:B.FileText,description:"Para documentaÃ§Ã£o e README"},{format:"html",label:"HTML",icon:Q,description:"Para Google Docs ou email"},{format:"json",label:"JSON",icon:X,description:"Para integraÃ§Ã£o com APIs"},{format:"notion",label:"Notion",icon:Y,description:"Copiar como blocos Notion"}];function W({isOpen:e,onClose:a,funnel:i,proposals:r}){let[l,n]=(0,s.useState)("markdown"),[o,d]=(0,s.useState)(!1),[x,m]=(0,s.useState)(!1),h=async()=>{m(!0);try{let e,t,s,a,n,c;switch(l){case"markdown":a=`# ${i.name}

> ${i.context?.objective?`Objetivo: ${i.context.objective}`:"Funil criado com Conselho de Funil"}

## ðŸ“‹ Contexto

| Campo | Valor |
|-------|-------|
| **Empresa** | ${i.context.company} |
| **Mercado** | ${i.context.market} |
| **Objetivo** | ${i.context.objective} |
| **Audi\xeancia** | ${i.context.audience.who} |
| **Dor** | ${i.context.audience.pain} |
| **Awareness** | ${i.context.audience.awareness} |
| **Oferta** | ${i.context.offer.what} |
| **Ticket** | ${i.context.offer.ticket} |
| **Canal Principal** | ${i.context.channel?.main||"N/A"} |

`,r.length>0&&(a+=`## ðŸŽ¯ Propostas do Conselho

`,r.forEach((e,t)=>{a+=`### Proposta ${t+1}: ${e.name}

**Score:** ${e.scorecard?.overall?.toFixed(1)||"N/A"}/10

${e.summary}

`,e.architecture?.stages&&e.architecture.stages.length>0&&(a+=`#### Etapas do Funil

`,e.architecture.stages.forEach((e,t)=>{a+=`${t+1}. **${e.name}**
`,e.objective&&(a+=`   - Objetivo: ${e.objective}
`),a+="\n"})),e.strategy?.rationale&&(a+=`#### Racioc\xednio

${e.strategy.rationale}

`),a+="---\n\n"})),e=a+=`
*Gerado por [Conselho de Funil](https://conselho-de-funil.vercel.app) em ${new Date().toLocaleDateString("pt-BR")}*
`,t="text/markdown",s="md";break;case"html":n=`<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>${i.name}</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 40px 20px; color: #1a1a1a; }
    h1 { color: #059669; border-bottom: 3px solid #059669; padding-bottom: 10px; }
    h2 { color: #374151; margin-top: 30px; }
    h3 { color: #059669; }
    table { border-collapse: collapse; width: 100%; margin: 15px 0; }
    th, td { border: 1px solid #e5e7eb; padding: 10px; text-align: left; }
    th { background: #f3f4f6; }
    .score { display: inline-block; padding: 4px 12px; border-radius: 20px; font-weight: bold; }
    .score-high { background: #d1fae5; color: #065f46; }
    .score-mid { background: #fef3c7; color: #92400e; }
    .score-low { background: #fee2e2; color: #991b1b; }
    .stage { background: #f9fafb; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #059669; }
    blockquote { border-left: 4px solid #d1d5db; margin: 20px 0; padding: 10px 20px; background: #f9fafb; }
    .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #e5e7eb; color: #6b7280; font-size: 14px; }
  </style>
</head>
<body>
  <h1>ðŸŽ¯ ${i.name}</h1>
  <blockquote>${i.context?.objective?`Objetivo: ${i.context.objective}`:"Funil criado com Conselho de Funil"}</blockquote>
  
  <h2>ðŸ“‹ Contexto</h2>
  <table>
    <tr><th>Campo</th><th>Valor</th></tr>
    <tr><td>Empresa</td><td>${i.context.company}</td></tr>
    <tr><td>Mercado</td><td>${i.context.market}</td></tr>
    <tr><td>Objetivo</td><td>${i.context.objective}</td></tr>
    <tr><td>Audi\xeancia</td><td>${i.context.audience.who}</td></tr>
    <tr><td>Dor</td><td>${i.context.audience.pain}</td></tr>
    <tr><td>Awareness</td><td>${i.context.audience.awareness}</td></tr>
    <tr><td>Oferta</td><td>${i.context.offer.what}</td></tr>
    <tr><td>Ticket</td><td>${i.context.offer.ticket}</td></tr>
    <tr><td>Canal Principal</td><td>${i.context.channel?.main||"N/A"}</td></tr>
  </table>`,r.length>0&&(n+=`<h2>ðŸŽ¯ Propostas do Conselho</h2>`,r.forEach((e,t)=>{let s=e.scorecard?.overall||0,a=s>=7.5?"score-high":s>=6?"score-mid":"score-low";n+=`
      <h3>Proposta ${t+1}: ${e.name}</h3>
      <p><span class="score ${a}">${s.toFixed(1)}/10</span></p>
      <p>${e.summary}</p>`,e.architecture?.stages&&e.architecture.stages.length>0&&(n+="<h4>Etapas do Funil</h4>",e.architecture.stages.forEach((e,t)=>{n+=`
          <div class="stage">
            <strong>${t+1}. ${e.name}</strong>
            ${e.objective?`<br><small>Objetivo: ${e.objective}</small>`:""}
            ${e.metrics?.target?`<br><small>Meta: ${e.metrics.target}</small>`:""}
          </div>`})),e.strategy?.rationale&&(n+=`<h4>Racioc\xednio</h4><p>${e.strategy.rationale}</p>`),n+="<hr>"})),e=n+=`
  <div class="footer">
    <p>Gerado por <strong>Conselho de Funil</strong> em ${new Date().toLocaleDateString("pt-BR")}</p>
  </div>
</body>
</html>`,t="text/html",s="html";break;case"json":e=JSON.stringify({funnel:{id:i.id,name:i.name,status:i.status,context:i.context,createdAt:i.createdAt,updatedAt:i.updatedAt},proposals:r.map(e=>({id:e.id,name:e.name,version:e.version,summary:e.summary,status:e.status,scorecard:e.scorecard,architecture:e.architecture,strategy:e.strategy})),exportedAt:new Date().toISOString(),source:"Conselho de Funil"},null,2),t="application/json",s="json";break;case"notion":c=`# ${i.name}

> Objetivo: ${i.context?.objective||""}

## ðŸ“‹ Contexto
- **Empresa:** ${i.context.company}
- **Objetivo:** ${i.context.objective}
- **Audi\xeancia:** ${i.context.audience.who}
- **Dor:** ${i.context.audience.pain}
- **Oferta:** ${i.context.offer.what}
- **Ticket:** ${i.context.offer.ticket}

`,r.forEach((e,t)=>{let s=e.scorecard?.overall||0;c+=`## ðŸŽ¯ Proposta ${t+1}: ${e.name}
**Score:** ${s.toFixed(1)}/10

${e.summary}

`,e.architecture?.stages&&e.architecture.stages.length>0&&(c+=`### Etapas
`,e.architecture.stages.forEach((e,t)=>{c+=`${t+1}. **${e.name}** - ${e.objective||""}
`}),c+="\n")}),e=c,await navigator.clipboard.writeText(e),d(!0),setTimeout(()=>d(!1),2e3),H.notify.success("Copiado!","Cole no Notion com Ctrl+V"),m(!1);return;default:return}let o=new Blob([e],{type:t}),x=URL.createObjectURL(o),h=document.createElement("a");h.href=x,h.download=`${i.name.toLowerCase().replace(/\s+/g,"-")}.${s}`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(x),H.notify.success("Exportado!",`Arquivo ${s.toUpperCase()} baixado`)}catch(e){H.notify.error("Erro","Falha ao exportar")}finally{m(!1)}};return(0,t.jsx)(Z.Dialog,{open:e,onOpenChange:e=>!e&&a(),children:(0,t.jsxs)(Z.DialogContent,{className:"bg-zinc-900 border-zinc-800 max-w-md",children:[(0,t.jsx)(Z.DialogHeader,{children:(0,t.jsxs)(Z.DialogTitle,{className:"flex items-center gap-2 text-white",children:[(0,t.jsx)(C.Download,{className:"h-5 w-5 text-emerald-400"}),"Exportar Funil"]})}),(0,t.jsxs)("div",{className:"space-y-4 pt-2",children:[(0,t.jsxs)("p",{className:"text-sm text-zinc-400",children:["Escolha o formato para exportar ",(0,t.jsxs)("strong",{className:"text-white",children:['"',i.name,'"']})]}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2",children:K.map(e=>(0,t.jsxs)("button",{onClick:()=>n(e.format),className:(0,E.cn)("flex flex-col items-center gap-2 p-4 rounded-lg border transition-all text-left",l===e.format?"bg-emerald-500/10 border-emerald-500/30 text-white":"bg-zinc-800/50 border-zinc-700 text-zinc-400 hover:border-zinc-600"),children:[(0,t.jsx)(e.icon,{className:(0,E.cn)("h-6 w-6",l===e.format?"text-emerald-400":"text-zinc-500")}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"font-medium text-sm",children:e.label}),(0,t.jsx)("p",{className:"text-xs text-zinc-500",children:e.description})]})]},e.format))}),(0,t.jsx)(c.Button,{onClick:h,disabled:x,className:"w-full btn-accent",children:x?"Exportando...":"notion"===l?o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(k.Check,{className:"mr-2 h-4 w-4"}),"Copiado!"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(V.Copy,{className:"mr-2 h-4 w-4"}),"Copiar para Notion"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C.Download,{className:"mr-2 h-4 w-4"}),"Baixar ",l.toUpperCase()]})})]})]})})}var ee=e.i(43048),et=e.i(431342),es=e.i(779017),ea=e.i(182492),ei=e.i(543609),er=e.i(516660),el=e.i(888660),en=e.i(854184);let ec=(0,y.default)("monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),eo=({title:e,result:s,icon:a,delay:i})=>{let l={pass:{color:"text-green-400",bg:"bg-green-500/10",icon:p.CheckCircle2},fail:{color:"text-red-400",bg:"bg-red-500/10",icon:u.XCircle},warning:{color:"text-yellow-400",bg:"bg-yellow-500/10",icon:b.AlertCircle}}[s.status];return(0,t.jsxs)(r.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i},className:"card-premium p-5 border-l-4 border-l-zinc-800 hover:border-l-purple-500 transition-all",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-zinc-800 rounded-lg",children:(0,t.jsx)(a,{className:"w-5 h-5 text-zinc-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-bold text-white",children:e}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)(es.Progress,{value:10*s.score,className:"h-1 w-20 bg-zinc-800"}),(0,t.jsxs)("span",{className:(0,E.cn)("text-[10px] font-bold",l.color),children:[s.score,"/10"]})]})]})]}),(0,t.jsx)(l.icon,{className:(0,E.cn)("w-5 h-5",l.color)})]}),(0,t.jsx)("ul",{className:"space-y-2",children:s.findings.map((e,s)=>(0,t.jsxs)("li",{className:"flex gap-2 text-xs text-zinc-400 leading-relaxed",children:[(0,t.jsx)("div",{className:(0,E.cn)("w-1.5 h-1.5 rounded-full mt-1.5 shrink-0",l.color.replace("text","bg"))}),e]},s))})]})},ed=({report:e})=>{var s;return(0,t.jsxs)("div",{className:"space-y-8 max-w-6xl mx-auto pb-20",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)(ee.Card,{className:"lg:col-span-2 bg-zinc-900/50 border-zinc-800 backdrop-blur-sm overflow-hidden",children:[(0,t.jsx)("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:(0,t.jsx)(o.Target,{className:"w-32 h-32"})}),(0,t.jsxs)(ee.CardHeader,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(et.Badge,{variant:"outline",className:"text-purple-400 border-purple-500/30 bg-purple-500/5",children:"DiagnÃ³stico Forense Ativo"}),(0,t.jsxs)("span",{className:"text-[10px] text-zinc-500 uppercase tracking-widest",children:["ID: ",e.id]})]}),(0,t.jsx)(ee.CardTitle,{className:"text-3xl font-black text-white",children:"Resumo Executivo"})]}),(0,t.jsxs)(ee.CardContent,{children:[(0,t.jsxs)("p",{className:"text-zinc-400 leading-relaxed text-lg italic",children:['"',e.summary,'"']}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-8",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("span",{className:"text-[10px] text-zinc-500 uppercase font-bold",children:"Health Score"}),(0,t.jsxs)("div",{className:(0,E.cn)("text-2xl font-black",(s=e.score)<4?"text-red-500":s<7?"text-yellow-500":"text-green-500"),children:[10*e.score,"%"]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("span",{className:"text-[10px] text-zinc-500 uppercase font-bold",children:"Load Time"}),(0,t.jsxs)("div",{className:"text-2xl font-black text-white",children:[e.metadata.loadTimeMs,"ms"]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("span",{className:"text-[10px] text-zinc-500 uppercase font-bold",children:"Tech Stack"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:e.metadata.techStack.map(e=>(0,t.jsx)(et.Badge,{variant:"secondary",className:"text-[9px] bg-zinc-800",children:e},e))})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("span",{className:"text-[10px] text-zinc-500 uppercase font-bold",children:"Status"}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-emerald-400 text-sm font-bold",children:[(0,t.jsx)(p.CheckCircle2,{className:"w-4 h-4"})," COMPLETO"]})]})]})]})]}),(0,t.jsxs)(ee.Card,{className:"bg-zinc-900/50 border-zinc-800 backdrop-blur-sm flex flex-col items-center justify-center p-6 text-center group",children:[(0,t.jsxs)("div",{className:"relative w-full aspect-video rounded-xl border border-zinc-800 overflow-hidden bg-zinc-950",children:[e.metadata.screenshotUrl?(0,t.jsx)("img",{src:e.metadata.screenshotUrl,alt:"Screenshot do Funil",className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"}):(0,t.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-700",children:[(0,t.jsx)(ec,{className:"w-12 h-12 mb-2"}),(0,t.jsx)("span",{className:"text-xs",children:"Preview IndisponÃ­vel"})]}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-zinc-950 to-transparent opacity-60"}),(0,t.jsxs)("div",{className:"absolute bottom-3 left-3 flex items-center gap-2",children:[(0,t.jsx)(en.Globe,{className:"w-3 h-3 text-zinc-400"}),(0,t.jsx)("span",{className:"text-[10px] text-zinc-300 truncate max-w-[150px]",children:e.url})]})]}),(0,t.jsxs)(Button,{variant:"ghost",size:"sm",className:"mt-4 text-zinc-500 hover:text-white text-[10px] uppercase font-bold tracking-widest",children:["Ver Captura Full-Size ",(0,t.jsx)(el.ArrowRight,{className:"w-3 h-3 ml-2"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:[(0,t.jsx)(eo,{title:"Hook",result:e.heuristics.hook,icon:v.Zap,delay:.1}),(0,t.jsx)(eo,{title:"Story",result:e.heuristics.story,icon:ea.Layers,delay:.2}),(0,t.jsx)(eo,{title:"Offer",result:e.heuristics.offer,icon:o.Target,delay:.3}),(0,t.jsx)(eo,{title:"Friction",result:e.heuristics.friction,icon:er.MousePointer2,delay:.4}),(0,t.jsx)(eo,{title:"Trust",result:e.heuristics.trust,icon:ei.ShieldCheck,delay:.5})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[(0,t.jsx)(b.AlertCircle,{className:"w-5 h-5 text-purple-400"}),"Plano de AÃ§Ã£o Corretiva"]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.recommendations.sort((e,t)=>{let s={high:3,medium:2,low:1};return s[t.priority]-s[e.priority]}).map((e,s)=>(0,t.jsxs)(r.motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.6+.1*s},className:"p-5 bg-zinc-900/30 border border-zinc-800 rounded-2xl flex gap-4 hover:bg-zinc-900/50 transition-colors group",children:[(0,t.jsx)("div",{className:(0,E.cn)("w-10 h-10 rounded-xl flex items-center justify-center shrink-0","high"===e.priority?"bg-red-500/10 text-red-400":"medium"===e.priority?"bg-yellow-500/10 text-yellow-400":"bg-blue-500/10 text-blue-400"),children:(0,t.jsx)(v.Zap,{className:"w-5 h-5"})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(et.Badge,{variant:"outline",className:(0,E.cn)("text-[9px] uppercase font-black","high"===e.priority?"border-red-500/30 text-red-400":"medium"===e.priority?"border-yellow-500/30 text-yellow-400":"border-blue-500/30 text-blue-400"),children:[e.priority," Priority"]}),(0,t.jsx)(et.Badge,{variant:"secondary",className:"text-[9px] uppercase bg-zinc-800",children:e.type})]}),(0,t.jsx)("h5",{className:"font-bold text-white group-hover:text-purple-400 transition-colors",children:e.action}),(0,t.jsx)("p",{className:"text-xs text-zinc-500 leading-relaxed",children:e.impact})]})]},s))})]})]})},ex={draft:{label:"Rascunho",color:"text-zinc-400",bg:"bg-zinc-500/10",description:"Aguardando geraÃ§Ã£o pelo Conselho",glow:"from-zinc-500/5 to-transparent"},generating:{label:"Gerando Propostas",color:"text-blue-400",bg:"bg-blue-500/10",description:"O Conselho estÃ¡ analisando e criando propostas...",glow:"from-blue-500/5 to-transparent"},review:{label:"Propostas Prontas",color:"text-amber-400",bg:"bg-amber-500/10",description:"Avalie as propostas e decida: EXECUTAR, AJUSTAR ou MATAR",glow:"from-amber-500/5 to-transparent"},approved:{label:"Aprovado",color:"text-emerald-400",bg:"bg-emerald-500/10",description:"Pronto para execuÃ§Ã£o estratÃ©gica",glow:"from-emerald-500/5 to-transparent"},adjusting:{label:"Ajustando",color:"text-violet-400",bg:"bg-violet-500/10",description:"Aplicando ajustes solicitados pelo Conselho",glow:"from-violet-500/5 to-transparent"},executing:{label:"Executando",color:"text-blue-400",bg:"bg-blue-500/10",description:"Funil em operaÃ§Ã£o e monitoramento ativado",glow:"from-blue-500/5 to-transparent"},completed:{label:"ConcluÃ­do",color:"text-emerald-400",bg:"bg-emerald-500/10",description:"Ciclo estratÃ©gico finalizado com sucesso",glow:"from-emerald-500/5 to-transparent"},killed:{label:"Cancelado",color:"text-red-400",bg:"bg-red-500/10",description:"Funil descontinuado apÃ³s anÃ¡lise de viabilidade",glow:"from-red-500/5 to-transparent"}},em={fria:"AudiÃªncia Fria",morna:"AudiÃªncia Morna",quente:"AudiÃªncia Quente",unaware:"Inconsciente",problem:"Consciente do Problema",solution:"Consciente da SoluÃ§Ã£o",product:"Consciente do Produto"},eh=()=>(0,t.jsxs)(r.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"card-premium p-12 text-center relative overflow-hidden",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-zinc-950/50 backdrop-blur-sm z-0"}),(0,t.jsxs)("div",{className:"relative z-10",children:[(0,t.jsxs)("div",{className:"relative mx-auto mb-8 w-24 h-24",children:[(0,t.jsx)(r.motion.div,{animate:{rotate:360},transition:{duration:3,repeat:1/0,ease:"linear"},className:"absolute inset-0 rounded-full border-2 border-purple-500/20 border-t-purple-500"}),(0,t.jsx)("div",{className:"absolute inset-3 rounded-full bg-gradient-to-br from-purple-500/20 to-transparent flex items-center justify-center",children:(0,t.jsx)(v.Zap,{className:"h-8 w-8 text-purple-400 animate-pulse"})})]}),(0,t.jsx)("h3",{className:"text-xl font-black text-white mb-3 uppercase tracking-widest",children:"Iniciando AutÃ³psia Forense..."}),(0,t.jsx)("p",{className:"text-zinc-400 mb-6 max-w-md mx-auto text-sm italic",children:'"O Agente Monara estÃ¡ escaneando a estrutura do funil enquanto o Conselho de Estrategistas prepara o diagnÃ³stico."'}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4 text-xs font-mono text-zinc-500",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"h-1 w-1 rounded-full bg-purple-500 animate-ping"}),(0,t.jsx)("span",{children:"[SCRAPING_ENGINE]: ACTIVE"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"h-1 w-1 rounded-full bg-purple-500 animate-ping delay-75"}),(0,t.jsx)("span",{children:"[HEURISTIC_ANALYSIS]: GEMINI_1.5_PRO_READY"})]})]})]})]});function ep(){let e=(0,a.useParams)(),y=(0,a.useRouter)(),{remove:T,update:P}=(0,$.useFunnels)(),[O,F]=(0,s.useState)(null),[B,R]=(0,s.useState)([]),[D,L]=(0,s.useState)(null),[M,U]=(0,s.useState)(!0),[q,V]=(0,s.useState)(!1),[J,Z]=(0,s.useState)(!1),[X,Q]=(0,s.useState)(!1),[Y,K]=(0,s.useState)(!1),[ee,et]=(0,s.useState)(null),[es,ea]=(0,s.useState)(!1),[ei,er]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(!e.id)return;let t=(0,S.onSnapshot)((0,S.doc)(A.db,"funnels",e.id),t=>{if(t.exists()){let s={id:t.id,...t.data()};F(s),O?.status==="generating"&&"review"===s.status&&H.notify.success("ðŸŽ¯ Propostas Prontas!",`O Conselho terminou de analisar "${s.name}"`),"draft"!==s.status&&"generating"!==s.status&&el(e.id)}else F(null);U(!1)});return()=>t()},[e.id]);let el=async e=>{try{let t=(0,S.query)((0,S.collection)(A.db,"funnels",e,"proposals"),(0,S.orderBy)("version","asc")),s=(await (0,S.getDocs)(t)).docs.map(e=>({id:e.id,...e.data()}));R(s)}catch(e){console.error("Error loading proposals:",e)}},en=async()=>{if(!O||!O.context.url)return void H.notify.error("Erro","URL do funil nÃ£o encontrada no contexto.");Z(!0);try{let e=await fetch("/api/intelligence/autopsy/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({brandId:O.brandId||"default",url:O.context.url,depth:"deep",context:{targetAudience:O.context.audience?.who,mainOffer:O.context.offer?.what}})});if(!e.ok)throw Error("Falha na autÃ³psia");let t=await e.json();L(t),H.notify.success("AutÃ³psia Completa!","O diagnÃ³stico forense estÃ¡ pronto.")}catch(e){console.error("Autopsy error:",e),H.notify.error("Erro na AutÃ³psia","NÃ£o foi possÃ­vel completar o diagnÃ³stico.")}finally{Z(!1)}},ec=async()=>{if(O){V(!0);try{let e=await fetch("/api/funnels/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({funnelId:O.id,context:O.context})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to generate proposals")}}catch(e){console.error("Error generating proposals:",e),alert("Erro ao gerar propostas. Tente novamente."),V(!1)}}},eo=async()=>{O&&confirm("Tem certeza que deseja excluir este funil?")&&(await T(O.id),y.push("/funnels"))},ep=async()=>{if(O){U(!0);try{let e=Date.now(),t=Math.random().toString(36).substring(2,7),s=`${O.id}_${e}_${t}`,a=(0,S.doc)(A.db,"campaigns",s),i=B.find(e=>"selected"===e.status)||B[0],r={id:s,funnelId:O.id,brandId:O.brandId||"",userId:O.userId||"",name:O.name,status:"active",funnel:{type:O.context.objective||"Funnel",architecture:i?.strategy?.rationale||"",targetAudience:O.context.audience?.who||"",mainGoal:O.context.objective||"",stages:i?.architecture?.stages?.map(e=>e.name)||[],summary:i?.summary||""},createdAt:S.Timestamp.now(),updatedAt:S.Timestamp.now()};await (0,S.setDoc)(a,r),H.notify.success("Linha de Ouro Ativada!","Seu manifesto estratÃ©gico foi criado."),y.push(`/campaigns/${s}`)}catch(e){console.error("Error activating Golden Thread:",e),H.notify.error("Erro","Falha ao ativar a Linha de Ouro.")}finally{U(!1)}}},eu=async()=>{if(!O||0===B.length)return;let e=B.find(e=>"selected"===e.status)||B[0];Q(!0);try{if(!(await fetch("/api/library",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({funnelId:O.id,proposalId:e.id,name:`Template: ${O.name}`,description:e.summary,tags:[O.context.objective,O.context.channel?.main].filter(Boolean)})})).ok)throw Error("Failed to save template");K(!0)}catch(e){console.error("Error saving to library:",e),alert("Erro ao salvar na biblioteca. Tente novamente.")}finally{Q(!1)}};if(M)return(0,t.jsxs)("div",{className:"flex min-h-screen flex-col",children:[(0,t.jsx)(n.Header,{title:"Carregando...",showBack:!0}),(0,t.jsx)("div",{className:"flex-1 p-8",children:(0,t.jsxs)("div",{className:"animate-pulse space-y-6 max-w-5xl mx-auto",children:[(0,t.jsx)("div",{className:"h-20 rounded-xl bg-zinc-800/50"}),(0,t.jsx)("div",{className:"grid gap-5 md:grid-cols-2",children:[1,2,3,4].map(e=>(0,t.jsx)("div",{className:"h-40 rounded-xl bg-zinc-800/50"},e))})]})})]});if(!O)return(0,t.jsxs)("div",{className:"flex min-h-screen flex-col",children:[(0,t.jsx)(n.Header,{title:"Funil nÃ£o encontrado",showBack:!0}),(0,t.jsx)("div",{className:"flex-1 p-8 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-2xl bg-zinc-800/50 mb-4",children:(0,t.jsx)(o.Target,{className:"h-8 w-8 text-zinc-600"})}),(0,t.jsx)("h3",{className:"text-lg font-medium text-white",children:"Funil nÃ£o encontrado"}),(0,t.jsx)("p",{className:"mt-2 text-zinc-500",children:"O funil pode ter sido excluÃ­do ou nÃ£o existe."}),(0,t.jsx)(i.default,{href:"/funnels",children:(0,t.jsx)(c.Button,{className:"mt-6 btn-accent",children:"Voltar para Funis"})})]})})]});let ej=ex[O.status]||ex.draft,eg="generating"===O.status||q;return(0,t.jsxs)("div",{className:"flex min-h-screen flex-col",children:[(0,t.jsx)(n.Header,{title:O.name,showBack:!0,actions:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[O.context.url&&(0,t.jsxs)(c.Button,{onClick:en,disabled:J,className:"bg-purple-600 hover:bg-purple-700 text-white font-bold",children:[J?(0,t.jsx)(N.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(v.Zap,{className:"mr-2 h-4 w-4"}),"Executar AutÃ³psia"]}),"approved"===O.status&&(0,t.jsxs)(c.Button,{onClick:ep,className:"bg-amber-500 hover:bg-amber-600 text-black font-bold",children:[(0,t.jsx)(v.Zap,{className:"mr-2 h-4 w-4"}),"Ativar Linha de Ouro"]}),"approved"===O.status&&B.length>0&&(0,t.jsx)(c.Button,{variant:"outline",className:(0,E.cn)("btn-ghost",Y&&"text-emerald-400 border-emerald-500/50"),onClick:eu,disabled:X||Y,children:Y?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(k.Check,{className:"mr-2 h-4 w-4"}),"Salvo"]}):X?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(N.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Salvando..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w,{className:"mr-2 h-4 w-4"}),"Salvar na Biblioteca"]})}),(0,t.jsxs)(c.Button,{variant:"ghost",className:"btn-ghost",onClick:()=>er(!0),children:[(0,t.jsx)(C.Download,{className:"mr-2 h-4 w-4"}),"Exportar"]}),(0,t.jsxs)(c.Button,{variant:"ghost",className:"btn-ghost",onClick:()=>ea(!0),children:[(0,t.jsx)(z.Share2,{className:"mr-2 h-4 w-4"}),"Compartilhar"]}),(0,t.jsxs)(c.Button,{variant:"ghost",className:"btn-ghost",onClick:eo,children:[(0,t.jsx)(j.Trash2,{className:"mr-2 h-4 w-4"}),"Excluir"]}),(0,t.jsx)(i.default,{href:`/chat?funnelId=${O.id}`,children:(0,t.jsxs)(c.Button,{className:"btn-accent",children:[(0,t.jsx)(h.MessageSquare,{className:"mr-2 h-4 w-4"}),"Consultar Conselho"]})})]})}),(0,t.jsx)("div",{className:"flex-1 p-4 sm:p-8",children:(0,t.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,t.jsxs)(r.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:(0,E.cn)("card-premium p-5 sm:p-6 mb-6 sm:mb-8 border-l-4 relative overflow-hidden",ej.color.replace("text","border")),children:[(0,t.jsx)("div",{className:(0,E.cn)("absolute inset-0 bg-gradient-to-r opacity-20 pointer-events-none",ej.glow)}),(0,t.jsxs)("div",{className:"relative flex flex-col md:flex-row md:items-center justify-between gap-6",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3 sm:gap-4",children:[(0,t.jsxs)("div",{className:(0,E.cn)("flex h-10 w-10 sm:h-12 sm:w-12 items-center justify-center rounded-xl sm:rounded-2xl shrink-0",ej.bg),children:["approved"===O.status&&(0,t.jsx)(p.CheckCircle2,{className:(0,E.cn)("h-5 w-5 sm:h-6 sm:w-6",ej.color)}),"review"===O.status&&(0,t.jsx)(b.AlertCircle,{className:(0,E.cn)("h-5 w-5 sm:h-6 sm:w-6",ej.color)}),"killed"===O.status&&(0,t.jsx)(u.XCircle,{className:(0,E.cn)("h-5 w-5 sm:h-6 sm:w-6",ej.color)}),"generating"===O.status&&(0,t.jsx)(N.Loader2,{className:(0,E.cn)("h-5 w-5 sm:h-6 sm:w-6 animate-spin",ej.color)}),["draft","adjusting","executing","completed"].includes(O.status)&&(0,t.jsx)(g.Clock,{className:(0,E.cn)("h-5 w-5 sm:h-6 sm:w-6",ej.color)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:(0,E.cn)("inline-flex items-center gap-2 px-2.5 py-0.5 rounded-full text-[9px] sm:text-[10px] font-bold uppercase tracking-wider mb-1.5 sm:mb-2",ej.color,ej.bg,"border border-white/[0.05]"),children:ej.label}),(0,t.jsx)("h3",{className:"text-lg sm:text-xl font-bold text-white mb-1",children:"Status EstratÃ©gico"}),(0,t.jsx)("p",{className:"text-zinc-400 text-xs sm:text-sm max-w-xl leading-relaxed",children:ej.description})]})]}),"draft"===O.status&&!q&&(0,t.jsxs)(c.Button,{className:"btn-accent w-full md:w-auto shadow-lg shadow-emerald-500/20",onClick:ec,children:[(0,t.jsx)(f.Sparkles,{className:"mr-2 h-4 w-4"}),"Gerar Propostas"]})]})]}),(0,t.jsx)(l.AnimatePresence,{children:eg&&(0,t.jsx)(eh,{})}),(0,t.jsxs)(l.AnimatePresence,{children:[J&&(0,t.jsx)(eh,{}),D&&!J&&(0,t.jsxs)(r.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-12",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("h3",{className:"text-2xl font-black text-white flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-purple-500/20 rounded-lg",children:(0,t.jsx)(v.Zap,{className:"h-6 w-6 text-purple-400"})}),"RelatÃ³rio de AutÃ³psia Forense"]}),(0,t.jsx)(c.Button,{variant:"outline",size:"sm",className:"border-zinc-800 text-zinc-500 hover:text-white",onClick:()=>L(null),children:"Fechar RelatÃ³rio"})]}),(0,t.jsx)(ed,{report:D.report})]})]}),B.length>0&&!eg&&(0,t.jsxs)(r.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-5",children:(0,t.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,t.jsx)(v.Zap,{className:"h-5 w-5 text-emerald-400"}),"Propostas do Conselho",(0,t.jsxs)("span",{className:"text-sm font-normal text-zinc-500",children:["(",B.length," ",1===B.length?"proposta":"propostas",")"]})]})}),(0,t.jsx)(G,{proposals:B,onSelectProposal:e=>{y.push(`/funnels/${O?.id}/proposals/${e}`)}})]}),!eg&&(0,t.jsxs)("div",{className:"grid gap-4 sm:gap-5 grid-cols-1 sm:grid-cols-2",children:[(0,t.jsxs)(r.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"card-premium p-5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-emerald-500/10",children:(0,t.jsx)(o.Target,{className:"h-5 w-5 text-emerald-400"})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Contexto"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm text-zinc-500",children:"Objetivo"}),(0,t.jsx)("p",{className:"text-white font-medium capitalize",children:O.context.objective})]}),O.context.company&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm text-zinc-500",children:"Empresa"}),(0,t.jsx)("p",{className:"text-zinc-300",children:O.context.company})]}),O.context.market&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm text-zinc-500",children:"Mercado"}),(0,t.jsx)("p",{className:"text-zinc-300",children:O.context.market})]})]})]}),(0,t.jsxs)(r.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"card-premium p-5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-blue-500/10",children:(0,t.jsx)(d.Users,{className:"h-5 w-5 text-blue-400"})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-white",children:"PÃºblico"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm text-zinc-500",children:"Quem Ã©"}),(0,t.jsx)("p",{className:"text-zinc-300",children:O.context.audience?.who})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm text-zinc-500",children:"Dor principal"}),(0,t.jsx)("p",{className:"text-zinc-300",children:O.context.audience?.pain})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm text-zinc-500",children:"NÃ­vel de consciÃªncia"}),(0,t.jsx)("p",{className:"text-white font-medium",children:em[O.context.audience?.awareness||""]||O.context.audience?.awareness})]})]})]}),(0,t.jsxs)(r.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"card-premium p-5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-amber-500/10",children:(0,t.jsx)(x.Package,{className:"h-5 w-5 text-amber-400"})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Oferta"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm text-zinc-500",children:"Produto"}),(0,t.jsx)("p",{className:"text-white font-medium",children:O.context.offer?.what})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm text-zinc-500",children:"Ticket"}),(0,t.jsx)("p",{className:"text-emerald-400 font-semibold text-lg",children:O.context.offer?.ticket})]}),O.context.offer?.type&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm text-zinc-500",children:"Tipo"}),(0,t.jsx)("p",{className:"text-zinc-300 capitalize",children:O.context.offer.type})]})]})]})]}),(0,t.jsxs)(r.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.25},className:"card-premium p-5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-violet-500/10",children:(0,t.jsx)(m.Radio,{className:"h-5 w-5 text-violet-400"})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Canais"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm text-zinc-500",children:"Principal"}),(0,t.jsx)("p",{className:"text-white font-medium capitalize",children:O.context.channel?.main})]}),O.context.channel?.secondary&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm text-zinc-500",children:"SecundÃ¡rio"}),(0,t.jsx)("p",{className:"text-zinc-300 capitalize",children:O.context.channel.secondary})]})]})]})]}),"draft"===O.status&&!q&&(0,t.jsxs)(r.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.35},className:"mt-8 card-premium p-8 text-center",children:[(0,t.jsxs)("div",{className:"relative mx-auto mb-6",children:[(0,t.jsx)("div",{className:"absolute inset-0 rounded-2xl bg-emerald-500/20 blur-2xl"}),(0,t.jsx)("div",{className:"relative flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-to-br from-emerald-500 to-emerald-600 mx-auto",children:(0,t.jsx)(f.Sparkles,{className:"h-8 w-8 text-white"})})]}),(0,t.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"Pronto para criar propostas?"}),(0,t.jsx)("p",{className:"text-zinc-400 mb-6 max-w-md mx-auto",children:"O Conselho vai analisar seu contexto e gerar propostas de funil com arquitetura, copy e mÃ©tricas."}),(0,t.jsxs)(c.Button,{className:"btn-accent",onClick:ec,children:[(0,t.jsx)(f.Sparkles,{className:"mr-2 h-4 w-4"}),"Gerar Propostas com o Conselho"]})]}),!eg&&"draft"!==O.status&&(0,t.jsxs)(r.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"mt-8",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold text-white mb-5 flex items-center gap-2",children:[(0,t.jsx)(g.Clock,{className:"h-5 w-5 text-zinc-400"}),"HistÃ³rico de DecisÃµes"]}),(0,t.jsx)(I,{funnelId:O.id})]})]})}),(0,t.jsx)(_,{isOpen:es,onClose:()=>ea(!1),funnelId:O.id,funnelName:O.name}),(0,t.jsx)(W,{isOpen:ei,onClose:()=>er(!1),funnel:O,proposals:B})]})}e.s(["default",()=>ep],198997)}]);