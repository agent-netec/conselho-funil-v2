(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,987444,e=>{"use strict";var a=e.i(430459),s=e.i(255006);function r({className:e,type:r,...t}){return(0,a.jsx)("input",{type:r,"data-slot":"input",className:(0,s.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...t})}e.s(["Input",()=>r])},43048,e=>{"use strict";var a=e.i(430459),s=e.i(255006);function r({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...r})}function t({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...r})}function i({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-semibold",e),...r})}function d({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,s.cn)("text-muted-foreground text-sm",e),...r})}function n({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-6",e),...r})}e.s(["Card",()=>r,"CardContent",()=>n,"CardDescription",()=>d,"CardHeader",()=>t,"CardTitle",()=>i])},431342,e=>{"use strict";var a=e.i(430459),s=e.i(163904),r=e.i(894756),t=e.i(255006);let i=(0,r.cva)("inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function d({className:e,variant:r,asChild:d=!1,...n}){let l=d?s.Slot:"span";return(0,a.jsx)(l,{"data-slot":"badge",className:(0,t.cn)(i({variant:r}),e),...n})}e.s(["Badge",()=>d])},602851,e=>{"use strict";let a=(0,e.i(946089).default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);e.s(["Users",()=>a],602851)},783365,e=>{"use strict";let a=(0,e.i(946089).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>a],783365)},359722,e=>{"use strict";let a=(0,e.i(946089).default)("brain-circuit",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M9 13a4.5 4.5 0 0 0 3-4",key:"10igwf"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M16 8V5a2 2 0 0 1 2-2",key:"u6izg6"}],["circle",{cx:"16",cy:"13",r:".5",key:"ry7gng"}],["circle",{cx:"18",cy:"3",r:".5",key:"1aiba7"}],["circle",{cx:"20",cy:"21",r:".5",key:"yhc1fs"}],["circle",{cx:"20",cy:"8",r:".5",key:"1e43v0"}]]);e.s(["BrainCircuit",()=>a],359722)},695959,e=>{"use strict";var a=e.i(430459),s=e.i(833145),r=e.i(255006);let t=s.forwardRef(({className:e,...s},t)=>(0,a.jsx)("label",{ref:t,className:(0,r.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...s}));t.displayName="Label",e.s(["Label",()=>t])},136019,e=>{"use strict";let a=(0,e.i(946089).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>a],136019)},805239,e=>{"use strict";let a=(0,e.i(946089).default)("panels-top-left",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);e.s(["Layout",()=>a],805239)},325056,e=>{"use strict";let a=(0,e.i(946089).default)("video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);e.s(["Video",()=>a],325056)},627968,e=>{"use strict";let a=(0,e.i(946089).default)("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);e.s(["Tag",()=>a],627968)},695437,e=>{"use strict";var a=e.i(430459),s=e.i(833145),r=e.i(43048),t=e.i(431342),i=e.i(779017),d=e.i(359722),n=e.i(602851),l=e.i(860205),c=e.i(658603),o=e.i(566068);function u({scan:e,onSelect:s,isSelected:u}){let{persona:m,propensity:x,metadata:p}=e;return(0,a.jsxs)(r.Card,{className:`cursor-pointer transition-all hover:shadow-md ${u?"border-purple-500 ring-1 ring-purple-500":""}`,onClick:()=>s?.(e),children:[(0,a.jsx)(r.CardHeader,{className:"pb-2",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(r.CardTitle,{className:"text-lg flex items-center gap-2",children:[(0,a.jsx)(n.Users,{className:"w-5 h-5 text-blue-500"}),e.name]}),(0,a.jsxs)(r.CardDescription,{children:["Gerado em ",(0,c.format)(p.createdAt.toDate(),"dd 'de' MMMM",{locale:o.ptBR})]})]}),(0,a.jsx)(t.Badge,{variant:"hot"===x.segment?"default":"warm"===x.segment?"secondary":"outline",className:"capitalize",children:x.segment})]})}),(0,a.jsxs)(r.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("span",{className:"text-xs text-muted-foreground uppercase font-bold",children:"Propensão"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i.Progress,{value:100*x.score,className:"h-2"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[(100*x.score).toFixed(0),"%"]})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("span",{className:"text-xs text-muted-foreground uppercase font-bold",children:"Sofisticação"}),(0,a.jsx)("div",{className:"flex gap-1",children:[1,2,3,4,5].map(e=>(0,a.jsx)("div",{className:`h-2 w-full rounded-full ${e<=m.sophisticationLevel?"bg-purple-500":"bg-muted"}`},e))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium",children:[(0,a.jsx)(l.Target,{className:"w-4 h-4 text-red-500"}),"Dores Principais"]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-1",children:[m.painPoints.slice(0,3).map((e,s)=>(0,a.jsx)(t.Badge,{variant:"secondary",className:"text-[10px] font-normal",children:e},s)),m.painPoints.length>3&&(0,a.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:["+",m.painPoints.length-3]})]})]}),(0,a.jsx)("div",{className:"p-3 bg-muted/30 rounded-lg border border-dashed",children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(d.BrainCircuit,{className:"w-4 h-4 text-purple-500 mt-1 shrink-0"}),(0,a.jsxs)("p",{className:"text-xs italic text-muted-foreground leading-relaxed",children:['"',x.reasoning.substring(0,120),'..."']})]})})]})]})}function m(){return(0,a.jsxs)(r.Card,{className:"animate-pulse",children:[(0,a.jsxs)(r.CardHeader,{className:"pb-2",children:[(0,a.jsx)("div",{className:"h-6 w-3/4 bg-muted rounded mb-2"}),(0,a.jsx)("div",{className:"h-4 w-1/2 bg-muted rounded"})]}),(0,a.jsxs)(r.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)("div",{className:"h-8 bg-muted rounded"}),(0,a.jsx)("div",{className:"h-8 bg-muted rounded"})]}),(0,a.jsx)("div",{className:"h-12 bg-muted rounded"}),(0,a.jsx)("div",{className:"h-16 bg-muted rounded"})]})]})}var x=e.i(54203),p=e.i(987444),h=e.i(695959),g=e.i(651752),f=e.i(136019),v=e.i(783365),j=e.i(805239),y=e.i(325056),b=e.i(627968);function N({scan:e,existingRule:t,onSave:i}){let[d,n]=s.useState(t?.contentVariations.headline||""),[l,c]=s.useState(t?.contentVariations.vslId||""),[o,u]=s.useState(t?.contentVariations.offerId||"");return(0,a.jsxs)(r.Card,{className:"border-2 border-purple-100 bg-purple-50/10",children:[(0,a.jsxs)(r.CardHeader,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(g.Zap,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"}),(0,a.jsx)(r.CardTitle,{children:"Regra de Personalização Dinâmica"})]}),(0,a.jsxs)(r.CardDescription,{children:["Defina o conteúdo que será exibido para a persona ",(0,a.jsx)("strong",{children:e.name}),"."]})]}),(0,a.jsxs)(r.CardContent,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(h.Label,{className:"flex items-center gap-2",children:[(0,a.jsx)(j.Layout,{className:"w-4 h-4"}),"Headline Personalizada"]}),(0,a.jsx)(p.Input,{placeholder:"Ex: Como mães empreendedoras podem escalar sem perder tempo...",value:d,onChange:e=>n(e.target.value),className:"border-purple-200 focus-visible:ring-purple-500"}),(0,a.jsxs)("p",{className:"text-[10px] text-muted-foreground",children:['Dica da IA: Use a dor "',e.persona.painPoints[0],'" para maior conversão.']})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(h.Label,{className:"flex items-center gap-2",children:[(0,a.jsx)(y.Video,{className:"w-4 h-4"}),"ID do VSL (Opcional)"]}),(0,a.jsx)(p.Input,{placeholder:"vsl_123...",value:l,onChange:e=>c(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(h.Label,{className:"flex items-center gap-2",children:[(0,a.jsx)(b.Tag,{className:"w-4 h-4"}),"ID da Oferta"]}),(0,a.jsx)(p.Input,{placeholder:"offer_abc...",value:o,onChange:e=>u(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[(0,a.jsxs)(x.Button,{variant:"outline",size:"sm",className:"gap-2",children:[(0,a.jsx)(v.Trash2,{className:"w-4 h-4"}),"Descartar"]}),(0,a.jsxs)(x.Button,{size:"sm",className:"gap-2 bg-purple-600 hover:bg-purple-700",onClick:()=>{i({targetPersonaId:e.id,contentVariations:{headline:d,vslId:l,offerId:o},isActive:!0})},children:[(0,a.jsx)(f.Save,{className:"w-4 h-4"}),"Salvar Regra"]})]})]})]})}e.i(240925);var k=e.i(977031),w=e.i(597482);async function C(e){let a=(0,k.collection)(w.db,`brands/${e}/audience_scans`),s=(0,k.query)(a,(0,k.orderBy)("metadata.createdAt","desc"),(0,k.limit)(10));return(await (0,k.getDocs)(s)).docs.map(e=>({id:e.id,...e.data()}))}async function M(e){let a=(0,k.collection)(w.db,`brands/${e}/personalization_rules`);return(await (0,k.getDocs)(a)).docs.map(e=>({id:e.id,...e.data()}))}async function S(e,a){let s=(0,k.collection)(w.db,`brands/${e}/personalization_rules`);return await (0,k.addDoc)(s,{...a,updatedAt:k.Timestamp.now()})}var D=e.i(800598),P=e.i(143957);let z=(0,e.i(946089).default)("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);var I=e.i(590439);function T(){let[e,t]=s.useState([]),[i,n]=s.useState([]),[l,c]=s.useState(!0),[o,p]=s.useState(null),[h,g]=s.useState(!1),f="brand_default",v=s.useCallback(async()=>{c(!0);try{let[e,a]=await Promise.all([C(f),M(f)]);t(e),n(a)}catch(e){console.error("Erro ao carregar dados de personalização:",e),I.toast.error("Falha ao carregar dados.")}finally{c(!1)}},[f]);s.useEffect(()=>{v()},[v]);let j=async()=>{g(!0),I.toast.info("Iniciando Deep-Scan de audiência com IA...");try{let e=await fetch("/api/intelligence/audience/scan",{method:"POST",body:JSON.stringify({brandId:f})});if(!e.ok)throw Error("Falha na API");let a=await e.json();t(e=>[a,...e]),p(a),I.toast.success("Novo scan de audiência concluído!")}catch(e){I.toast.error("Erro ao executar scan.")}finally{g(!1)}},y=async e=>{try{await S(f,e),I.toast.success("Regra de personalização salva com sucesso!"),v()}catch(e){I.toast.error("Erro ao salvar regra.")}};return(0,a.jsxs)("div",{className:"container mx-auto p-6 space-y-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[(0,a.jsx)(P.Sparkles,{className:"w-8 h-8 text-purple-500"}),"Personalização Dinâmica"]}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Gerencie como sua audiência interage com seu conteúdo baseado em inteligência psicográfica."})]}),(0,a.jsxs)(x.Button,{onClick:j,disabled:h,className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 gap-2",children:[h?(0,a.jsx)(D.RefreshCw,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(z,{className:"w-4 h-4"}),"Executar Deep-Scan (IA)"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[(0,a.jsx)(d.BrainCircuit,{className:"w-5 h-5 text-blue-500"}),"Scans de Audiência"]}),(0,a.jsx)("div",{className:"space-y-4 max-h-[70vh] overflow-y-auto pr-2",children:l?[1,2,3].map(e=>(0,a.jsx)(m,{},e)):e.length>0?e.map(e=>(0,a.jsx)(u,{scan:e,isSelected:o?.id===e.id,onSelect:p},e.id)):(0,a.jsx)("div",{className:"text-center py-12 border-2 border-dashed rounded-xl",children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Nenhum scan realizado ainda."})})})]}),(0,a.jsx)("div",{className:"lg:col-span-2 space-y-6",children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)(r.Card,{children:[(0,a.jsx)(r.CardHeader,{children:(0,a.jsx)(r.CardTitle,{className:"text-sm uppercase text-muted-foreground",children:"Persona Detalhada"})}),(0,a.jsxs)(r.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-bold",children:"Dores:"}),(0,a.jsx)("ul",{className:"list-disc list-inside text-sm text-muted-foreground mt-1",children:o.persona.painPoints.map((e,s)=>(0,a.jsx)("li",{children:e},s))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-bold",children:"Desejos:"}),(0,a.jsx)("ul",{className:"list-disc list-inside text-sm text-muted-foreground mt-1",children:o.persona.desires.map((e,s)=>(0,a.jsx)("li",{children:e},s))})]})]})]}),(0,a.jsxs)(r.Card,{children:[(0,a.jsx)(r.CardHeader,{children:(0,a.jsx)(r.CardTitle,{className:"text-sm uppercase text-muted-foreground",children:"Raciocínio da IA"})}),(0,a.jsx)(r.CardContent,{children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:o.propensity.reasoning})})]})]}),(0,a.jsx)(N,{scan:o,existingRule:i.find(e=>e.targetPersonaId===o.id),onSave:y})]}):(0,a.jsxs)("div",{className:"h-full flex flex-col items-center justify-center py-20 border-2 border-dashed rounded-xl bg-muted/10",children:[(0,a.jsx)(P.Sparkles,{className:"w-12 h-12 text-muted-foreground/20 mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Selecione um Scan"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Escolha um scan ao lado para configurar as regras de conteúdo dinâmico."})]})})]})]})}e.s(["default",()=>T],695437)}]);