{"version":3,"sources":["../../../../../../../../OneDrive/Desktop/CURSOR/CONSELHO%20DE%20FUNIL/app/src/lib/ai/rag-helpers-fixed.ts"],"sourcesContent":["import { RetrievalConfig, RetrievedBrandChunk } from './rag';\r\n\r\nexport async function searchSimilarChunks(\r\n  brandId: string,\r\n  queryEmbedding: number[],\r\n  limitCount: number = 5,\r\n  filters?: RetrievalConfig['filters']\r\n): Promise<RetrievedBrandChunk[]> {\r\n  try {\r\n    const pineconeFilters: any = { \r\n      brandId: { '$eq': brandId }\r\n    };\r\n    \r\n    if (filters?.funnelStage) pineconeFilters.funnelStage = { '$eq': filters.funnelStage };\r\n    if (filters?.channel) pineconeFilters.channel = { '$eq': filters.channel };\r\n\r\n    const namespace = `brand-${brandId}`;\r\n    const { queryPinecone } = await import('./pinecone');\r\n    const pineconeResponse = await queryPinecone({\r\n      vector: queryEmbedding,\r\n      topK: limitCount * 2,\r\n      namespace,\r\n      filter: pineconeFilters\r\n    });\r\n\r\n    if (pineconeResponse.matches?.length) {\r\n      return pineconeResponse.matches.map(match => {\r\n        const meta = match.metadata as any;\r\n        return {\r\n          id: match.id,\r\n          assetId: meta.assetId || '',\r\n          assetName: meta.originalName || meta.assetName || 'Arquivo da Marca',\r\n          content: meta.content || '',\r\n          similarity: match.score || 0,\r\n          rank: 0\r\n        };\r\n      });\r\n    }\r\n    return [];\r\n  } catch (err) {\r\n    console.error('[RAG Helpers] Erro:', err);\r\n    return [];\r\n  }\r\n}\r\n"],"names":[],"mappings":"wCAEO,eAAe,EACpB,CAAe,CACf,CAAwB,CACxB,EAAqB,CAAC,CACtB,CAAoC,EAEpC,GAAI,CACF,IAAM,EAAuB,CAC3B,QAAS,CAAE,IAAO,CAAQ,CAC5B,EAEI,GAAS,cAAa,EAAgB,WAAW,CAAG,CAAE,IAAO,EAAQ,WAAW,CAAC,EACjF,GAAS,UAAS,EAAgB,OAAO,CAAG,CAAE,IAAO,EAAQ,OAAO,CAAC,EAEzE,IAAM,EAAY,CAAC,MAAM,EAAE,EAAA,CAAS,CAC9B,eAAE,CAAa,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,OACpB,EAAmB,MAAM,EAAc,CAC3C,OAAQ,EACR,KAAmB,EAAb,YACN,EACA,OAAQ,CACV,GAEA,GAAI,EAAiB,OAAO,EAAE,OAC5B,CADoC,MAC7B,EAAiB,OAAO,CAAC,GAAG,CAAC,IAClC,IAAM,EAAO,EAAM,QAAQ,CAC3B,MAAO,CACL,GAAI,EAAM,EAAE,CACZ,QAAS,EAAK,OAAO,EAAI,GACzB,UAAW,EAAK,YAAY,EAAI,EAAK,SAAS,EAAI,mBAClD,QAAS,EAAK,OAAO,EAAI,GACzB,WAAY,EAAM,KAAK,EAAI,EAC3B,KAAM,CACR,CACF,GAEF,MAAO,EAAE,AACX,CAAE,MAAO,EAAK,CAEZ,OADA,QAAQ,KAAK,CAAC,sBAAuB,GAC9B,EAAE,AACX,CACF"}