module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},688947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},912714,(e,t,r)=>{t.exports=e.x("node:fs/promises",()=>require("node:fs/promises"))},500874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},750227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},666680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},81111,(e,t,r)=>{t.exports=e.x("node:stream",()=>require("node:stream"))},478500,(e,t,r)=>{t.exports=e.x("node:async_hooks",()=>require("node:async_hooks"))},910153,e=>{"use strict";var t=e.i(666680);let r={randomUUID:t.randomUUID},a=new Uint8Array(256),n=a.length,s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));e.s(["v4",0,function(e,o,i){if(r.randomUUID&&!o&&!e)return r.randomUUID();var l=e,u=i;let d=(l=l||{}).random??l.rng?.()??(n>a.length-16&&((0,t.randomFillSync)(a),n=0),a.slice(n,n+=16));if(d.length<16)throw Error("Random bytes length must be >= 16");if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,o){if((u=u||0)<0||u+16>o.length)throw RangeError(`UUID byte range ${u}:${u+15} is out of buffer bounds`);for(let e=0;e<16;++e)o[u+e]=d[e];return o}return function(e,t=0){return(s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]).toLowerCase()}(d)}],910153)},191530,e=>{"use strict";var t=e.i(906661),r=e.i(276806),a=e.i(981990),n=e.i(707163),s=e.i(893013),o=e.i(416393),i=e.i(418829),l=e.i(907831),u=e.i(787414),d=e.i(251948),c=e.i(254140),p=e.i(847739),m=e.i(877290),x=e.i(195428),h=e.i(114365),f=e.i(193695);e.i(495983);var g=e.i(56931),R=e.i(758910),v=e.i(675229);class E{static async analyzeContent(e,t,r,a){let n=this.buildAnalysisPrompt(t,r.context),s=await (0,v.generateWithGemini)(n,{model:"gemini-1.5-pro",temperature:.2,responseMimeType:"application/json"});try{let e=JSON.parse(s);return{score:e.score,summary:e.summary,heuristics:e.heuristics,recommendations:e.recommendations,metadata:{...a,screenshotUrl:a.screenshotUrl}}}catch(e){throw console.error("[AUTOPSY_ENGINE_PARSE_ERROR]:",e,s),Error("Falha ao processar a análise heurística do Gemini.")}}static buildAnalysisPrompt(e,t){return`
Voc\xea \xe9 o Analista Forense do Conselho de Funil. Sua miss\xe3o \xe9 realizar uma aut\xf3psia detalhada em uma p\xe1gina de vendas/funil.
Baseie sua an\xe1lise nos playbooks de convers\xe3o e psicologia de vendas.

CONTE\xdaDO DA P\xc1GINA:
---
${e}
---

CONTEXTO ADICIONAL:
P\xfablico-alvo: ${t?.targetAudience||"Não informado"}
Oferta Principal: ${t?.mainOffer||"Não informada"}

DIRETRIZES DE AN\xc1LISE (Heur\xedsticas Wilder):
1. Hook (Gancho): A headline captura a aten\xe7\xe3o em < 5s? \xc9 espec\xedfica e resolve uma dor?
2. Story (Conex\xe3o): O copy quebra as obje\xe7\xf5es principais? Existe uma narrativa clara?
3. Offer (Oferta): Existe um empilhamento de valor (stack) claro? A oferta \xe9 irresist\xedvel?
4. Friction (Fric\xe7\xe3o): Existem elementos que dificultam a convers\xe3o (textos longos sem quebra, falta de clareza no pr\xf3ximo passo)?
5. Trust (Confian\xe7a): Existem depoimentos, selos ou provas sociais?

VOC\xca DEVE RESPONDER APENAS COM UM JSON NO SEGUINTE FORMATO:
{
  "score": number (0-10),
  "summary": "string (resumo executivo)",
  "heuristics": {
    "hook": { "score": number, "status": "pass"|"fail"|"warning", "findings": ["string"] },
    "story": { "score": number, "status": "pass"|"fail"|"warning", "findings": ["string"] },
    "offer": { "score": number, "status": "pass"|"fail"|"warning", "findings": ["string"] },
    "friction": { "score": number, "status": "pass"|"fail"|"warning", "findings": ["string"] },
    "trust": { "score": number, "status": "pass"|"fail"|"warning", "findings": ["string"] }
  },
  "recommendations": [
    { "priority": "high"|"medium"|"low", "type": "copy"|"design"|"offer"|"technical", "action": "string", "impact": "string" }
  ]
}
`}}var y=e.i(280465),w=e.i(910153);async function A(e){try{let t=await e.json(),{brandId:r,url:a,depth:n="quick",context:s}=t;if(!r||!a)return R.NextResponse.json({error:"Parâmetros obrigatórios ausentes (brandId, url)."},{status:400});let o=Date.now();console.log(`[AUTOPSY] Iniciando scraping para: ${a}`);let i=await (0,y.extractContentFromUrl)(a);if(i.error)return R.NextResponse.json({error:`Falha no scraping: ${i.error}`},{status:422});let l=Date.now()-o,u=[];i.rawHtml&&(i.rawHtml.includes("elementor")&&u.push("Elementor"),i.rawHtml.includes("clickfunnels")&&u.push("ClickFunnels"),i.rawHtml.includes("wp-content")&&u.push("WordPress"),i.rawHtml.includes("hotmart")&&u.push("Hotmart")),console.log(`[AUTOPSY] Executando an\xe1lise heur\xedstica via Gemini 1.5 Pro`);let d=await E.analyzeContent(a,i.content,t,{loadTimeMs:l,techStack:u,screenshotUrl:i.primaryImageUrl}),c={id:`aut_${(0,w.v4)()}`,status:"completed",url:a,timestamp:Date.now(),report:d};return R.NextResponse.json(c)}catch(e){return console.error("[AUTOPSY_API_ERROR]:",e),R.NextResponse.json({error:e.message||"Erro interno ao processar o diagnóstico."},{status:500})}}e.s(["POST",()=>A,"dynamic",0,"force-dynamic"],218992);var C=e.i(218992);let O=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/intelligence/autopsy/run/route",pathname:"/api/intelligence/autopsy/run",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/OneDrive/Desktop/CURSOR/CONSELHO DE FUNIL/app/src/app/api/intelligence/autopsy/run/route.ts",nextConfigOutput:"",userland:C}),{workAsyncStorage:b,workUnitAsyncStorage:N,serverHooks:P}=O;function U(){return(0,a.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:N})}async function S(e,t,a){O.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/intelligence/autopsy/run/route";R=R.replace(/\/index$/,"")||"/";let v=await O.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:E,params:y,nextConfig:w,parsedUrl:A,isDraftMode:C,prerenderManifest:b,routerServerContext:N,isOnDemandRevalidate:P,revalidateOnlyGenerated:U,resolvedPathname:S,clientReferenceManifest:T,serverActionsManifest:I}=v,k=(0,i.normalizeAppPath)(R),D=!!(b.dynamicRoutes[k]||b.routes[S]),q=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,A,!1):t.end("This page could not be found"),null);if(D&&!C){let e=!!b.routes[S],t=b.dynamicRoutes[k];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await q();throw new f.NoFallbackError}}let _=null;!D||O.isDev||C||(_="/index"===(_=S)?"/":_);let H=!0===O.isDev||!D,j=D&&!H;I&&T&&(0,o.setManifestsSingleton)({page:R,clientReferenceManifest:T,serverActionsManifest:I});let F=e.method||"GET",$=(0,s.getTracer)(),M=$.getActiveScopeSpan(),G={params:y,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>O.onRequestError(e,t,a,n,N)},sharedContext:{buildId:E}},L=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),B=u.NextRequestAdapter.fromNodeNextRequest(L,(0,u.signalFromNodeResponse)(t));try{let o=async e=>O.handle(B,G).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${F} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${R}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var s,l;let u=async({previousCacheEntry:r})=>{try{if(!i&&P&&U&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(n);e.fetchMetrics=G.renderOpts.fetchMetrics;let l=G.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=G.renderOpts.collectedTags;if(!D)return await (0,p.sendResponse)(L,K,s,G.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(s.headers);u&&(t[h.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==G.renderOpts.collectedRevalidate&&!(G.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&G.renderOpts.collectedRevalidate,a=void 0===G.renderOpts.collectedExpire||G.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:G.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:P})},!1,N),t}},d=await O.handleResponse({req:e,nextConfig:w,cacheKey:_,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:U,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:i});if(!D)return null;if((null==d||null==(s=d.value)?void 0:s.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",P?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&D||f.delete(h.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,x.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(L,K,new Response(d.value.body,{headers:f,status:d.value.status||200})),null};M?await l(M):await $.withPropagatedContext(e.headers,()=>$.trace(d.BaseServerSpan.handleRequest,{spanName:`${F} ${R}`,kind:s.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:P})},!1,N),D)throw t;return await (0,p.sendResponse)(L,K,new Response(null,{status:500})),null}}e.s(["handler",()=>S,"patchFetch",()=>U,"routeModule",()=>O,"serverHooks",()=>P,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>N],191530)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__d7ddd870._.js.map