module.exports=[825933,(e,t,r)=>{"use strict";var n,i,s;Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=r.DEFAULT_MAX_SEND_MESSAGE_LENGTH=r.Propagate=r.LogVerbosity=r.Status=void 0,function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(n||(r.Status=n={})),function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.NONE=3]="NONE"}(i||(r.LogVerbosity=i={})),function(e){e[e.DEADLINE=1]="DEADLINE",e[e.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",e[e.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",e[e.CANCELLATION=8]="CANCELLATION",e[e.DEFAULTS=65535]="DEFAULTS"}(s||(r.Propagate=s={})),r.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,r.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},709917,(e,t,r)=>{"use strict";var n,i,s,a;Object.defineProperty(r,"__esModule",{value:!0}),r.isTracerEnabled=r.trace=r.log=r.setLoggerVerbosity=r.setLogger=r.getLogger=void 0;let o=e.r(825933),l=e.r(605365),u=e.r(25981).version,c={error:(e,...t)=>{console.error("E "+e,...t)},info:(e,...t)=>{console.error("I "+e,...t)},debug:(e,...t)=>{console.error("D "+e,...t)}},h=o.LogVerbosity.ERROR;switch((null!=(i=null!=(n=process.env.GRPC_NODE_VERBOSITY)?n:process.env.GRPC_VERBOSITY)?i:"").toUpperCase()){case"DEBUG":h=o.LogVerbosity.DEBUG;break;case"INFO":h=o.LogVerbosity.INFO;break;case"ERROR":h=o.LogVerbosity.ERROR;break;case"NONE":h=o.LogVerbosity.NONE}r.getLogger=()=>c,r.setLogger=e=>{c=e},r.setLoggerVerbosity=e=>{h=e},r.log=(e,...t)=>{let r;if(e>=h){switch(e){case o.LogVerbosity.DEBUG:r=c.debug;break;case o.LogVerbosity.INFO:r=c.info;break;case o.LogVerbosity.ERROR:r=c.error}r||(r=c.error),r&&r.bind(c)(...t)}};let d=null!=(a=null!=(s=process.env.GRPC_NODE_TRACE)?s:process.env.GRPC_TRACE)?a:"",f=new Set,p=new Set;for(let e of d.split(","))e.startsWith("-")?p.add(e.substring(1)):f.add(e);let m=f.has("all");function g(e,t,n){y(t)&&(0,r.log)(e,new Date().toISOString()+" | v"+u+" "+l.pid+" | "+t+" | "+n)}function y(e){return!p.has(e)&&(m||f.has(e))}r.trace=g,r.isTracerEnabled=y},107106,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getErrorCode=r.getErrorMessage=void 0,r.getErrorMessage=function(e){return e instanceof Error?e.message:String(e)},r.getErrorCode=function(e){return"object"==typeof e&&null!==e&&"code"in e&&"number"==typeof e.code?e.code:null}},736063,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Metadata=void 0;let n=e.r(709917),i=e.r(825933),s=e.r(107106),a=/^[0-9a-z_.-]+$/,o=/^[ -~]*$/;function l(e){return a.test(e)}function u(e){return o.test(e)}function c(e){return e.endsWith("-bin")}function h(e){return!e.startsWith("grpc-")}function d(e){return e.toLowerCase()}function f(e,t){if(!l(e))throw Error('Metadata key "'+e+'" contains illegal characters');if(null!=t)if(c(e)){if(!Buffer.isBuffer(t))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(t))throw Error("keys that don't end with '-bin' must have String values");if(!u(t))throw Error('Metadata string value "'+t+'" contains illegal characters')}}class p{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){f(e=d(e),t),this.internalRepr.set(e,[t])}add(e,t){f(e=d(e),t);let r=this.internalRepr.get(e);void 0===r?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=d(e),this.internalRepr.delete(e)}get(e){return e=d(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let n=r[0];e[t]=Buffer.isBuffer(n)?Buffer.from(n):n}return e}clone(){let e=new p(this.options),t=e.internalRepr;for(let[e,r]of this.internalRepr){let n=r.map(e=>Buffer.isBuffer(e)?Buffer.from(e):e);t.set(e,n)}return e}merge(e){for(let[t,r]of e.internalRepr){let e=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,e)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(m);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new p;for(let r of Object.keys(e)){if(":"===r.charAt(0))continue;let a=e[r];try{c(r)?Array.isArray(a)?a.forEach(e=>{t.add(r,Buffer.from(e,"base64"))}):void 0!==a&&(h(r)?a.split(",").forEach(e=>{t.add(r,Buffer.from(e.trim(),"base64"))}):t.add(r,Buffer.from(a,"base64"))):Array.isArray(a)?a.forEach(e=>{t.add(r,e)}):void 0!==a&&t.add(r,a)}catch(t){let e=`Failed to add metadata entry ${r}: ${a}. ${(0,s.getErrorMessage)(t)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,n.log)(i.LogVerbosity.ERROR,e)}}return t}}r.Metadata=p;let m=e=>Buffer.isBuffer(e)?e.toString("base64"):e},925910,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CallCredentials=void 0;let n=e.r(736063);function i(e){return"getRequestHeaders"in e&&"function"==typeof e.getRequestHeaders}class s{static createFromMetadataGenerator(e){return new o(e)}static createFromGoogleCredential(e){return s.createFromMetadataGenerator((t,r)=>{let s;(s=i(e)?e.getRequestHeaders(t.service_url):new Promise((r,n)=>{e.getRequestMetadata(t.service_url,(e,t)=>{e?n(e):t?r(t):n(Error("Headers not set by metadata plugin"))})})).then(e=>{let t=new n.Metadata;for(let r of Object.keys(e))t.add(r,e[r]);r(null,t)},e=>{r(e)})})}static createEmpty(){return new l}}r.CallCredentials=s;class a extends s{constructor(e){super(),this.creds=e}async generateMetadata(e){let t=new n.Metadata;for(let r of(await Promise.all(this.creds.map(t=>t.generateMetadata(e)))))t.merge(r);return t}compose(e){return new a(this.creds.concat([e]))}_equals(e){return this===e||e instanceof a&&this.creds.every((t,r)=>t._equals(e.creds[r]))}}class o extends s{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(e,n)=>{void 0!==n?t(n):r(e)})})}compose(e){return new a([this,e])}_equals(e){return this===e||e instanceof o&&this.metadataGenerator===e.metadataGenerator}}class l extends s{generateMetadata(e){return Promise.resolve(new n.Metadata)}compose(e){return e}_equals(e){return e instanceof l}}},28162,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getDefaultRootsData=r.CIPHER_SUITES=void 0;let n=e.r(522734);r.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let i=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,s=null;r.getDefaultRootsData=function(){return i?(null===s&&(s=n.readFileSync(i)),s):null}},328079,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChannelCredentials=void 0;let n=e.r(755004),i=e.r(925910),s=e.r(28162);function a(e,t){if(e&&!(e instanceof Buffer))throw TypeError(`${t}, if provided, must be a Buffer.`)}class o{constructor(e){this.callCredentials=e||i.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var o;if(a(e,"Root certificate"),a(t,"Private key"),a(r,"Certificate chain"),t&&!r)throw Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw Error("Certificate chain must be given with accompanying private key");return new u((0,n.createSecureContext)({ca:null!=(o=null!=e?e:(0,s.getDefaultRootsData)())?o:void 0,key:null!=t?t:void 0,cert:null!=r?r:void 0,ciphers:s.CIPHER_SUITES}),null!=i?i:{})}static createFromSecureContext(e,t){return new u(e,null!=t?t:{})}static createInsecure(){return new l}}r.ChannelCredentials=o;class l extends o{constructor(e){super(e)}compose(e){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof l}}class u extends o{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},(null==t?void 0:t.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){return new c(this,this.callCredentials.compose(e))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e||e instanceof u&&this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity}}class c extends o{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new c(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e||e instanceof c&&this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials)}}},412065,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.validateLoadBalancingConfig=r.getFirstUsableConfig=r.isLoadBalancerNameRegistered=r.createLoadBalancer=r.registerDefaultLoadBalancerType=r.registerLoadBalancerType=r.createChildChannelControlHelper=void 0,r.createChildChannelControlHelper=function(e,t){var r,n,i,s,a,o,l,u,c,h;return{createSubchannel:null!=(n=null==(r=t.createSubchannel)?void 0:r.bind(t))?n:e.createSubchannel.bind(e),updateState:null!=(s=null==(i=t.updateState)?void 0:i.bind(t))?s:e.updateState.bind(e),requestReresolution:null!=(o=null==(a=t.requestReresolution)?void 0:a.bind(t))?o:e.requestReresolution.bind(e),addChannelzChild:null!=(u=null==(l=t.addChannelzChild)?void 0:l.bind(t))?u:e.addChannelzChild.bind(e),removeChannelzChild:null!=(h=null==(c=t.removeChannelzChild)?void 0:c.bind(t))?h:e.removeChannelzChild.bind(e)}};let n={},i=null;r.registerLoadBalancerType=function(e,t,r){n[e]={LoadBalancer:t,LoadBalancingConfig:r}},r.registerDefaultLoadBalancerType=function(e){i=e},r.createLoadBalancer=function(e,t){let r=e.getLoadBalancerName();return r in n?new n[r].LoadBalancer(t):null},r.isLoadBalancerNameRegistered=function(e){return e in n},r.getFirstUsableConfig=function(e,t=!1){for(let t of e)if(t.getLoadBalancerName()in n)return t;return t&&i?new n[i].LoadBalancingConfig:null},r.validateLoadBalancingConfig=function(e){if(null===e||"object"!=typeof e)throw Error("Load balancing config must be an object");let t=Object.keys(e);if(1!==t.length)throw Error("Provided load balancing config has multiple conflicting entries");let r=t[0];if(r in n)return n[r].LoadBalancingConfig.createFromJson(e[r]);throw Error(`Unrecognized load balancing config name ${r}`)}},812394,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.extractAndSelectServiceConfig=r.validateServiceConfig=r.validateRetryThrottling=void 0;let n=e.r(446786),i=e.r(825933),s=e.r(412065),a=/^\d+(\.\d{1,9})?s$/,o="node";function l(e){if("service"in e&&""!==e.service){if("string"!=typeof e.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof e.service}`);if(!("method"in e)||""===e.method)return{service:e.service};if("string"!=typeof e.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof e.service}`);return{service:e.service,method:e.method}}if("method"in e&&void 0!==e.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function u(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in e)||"string"!=typeof e.initialBackoff||!a.test(e.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in e)||"string"!=typeof e.maxBackoff||!a.test(e.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in e)||"number"!=typeof e.backoffMultiplier||e.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in e&&Array.isArray(e.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===e.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let t of e.retryableStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:e.maxAttempts,initialBackoff:e.initialBackoff,maxBackoff:e.maxBackoff,backoffMultiplier:e.backoffMultiplier,retryableStatusCodes:e.retryableStatusCodes}}function c(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in e&&("string"!=typeof e.hedgingDelay||!a.test(e.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in e&&Array.isArray(e.nonFatalStatusCodes))for(let t of e.nonFatalStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let t={maxAttempts:e.maxAttempts};return e.hedgingDelay&&(t.hedgingDelay=e.hedgingDelay),e.nonFatalStatusCodes&&(t.nonFatalStatusCodes=e.nonFatalStatusCodes),t}function h(e){var t;let r={name:[]};if(!("name"in e)||!Array.isArray(e.name))throw Error("Invalid method config: invalid name array");for(let t of e.name)r.name.push(l(t));if("waitForReady"in e){if("boolean"!=typeof e.waitForReady)throw Error("Invalid method config: invalid waitForReady");r.waitForReady=e.waitForReady}if("timeout"in e)if("object"==typeof e.timeout){if(!("seconds"in e.timeout)||"number"!=typeof e.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in e.timeout)||"number"!=typeof e.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");r.timeout=e.timeout}else if("string"==typeof e.timeout&&a.test(e.timeout)){let n=e.timeout.substring(0,e.timeout.length-1).split(".");r.timeout={seconds:0|n[0],nanos:(null!=(t=n[1])?t:0)|0}}else throw Error("Invalid method config: invalid timeout");if("maxRequestBytes"in e){if("number"!=typeof e.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxRequestBytes=e.maxRequestBytes}if("maxResponseBytes"in e){if("number"!=typeof e.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxResponseBytes=e.maxResponseBytes}if("retryPolicy"in e)if("hedgingPolicy"in e)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");else r.retryPolicy=u(e.retryPolicy);else"hedgingPolicy"in e&&(r.hedgingPolicy=c(e.hedgingPolicy));return r}function d(e){if(!("maxTokens"in e)||"number"!=typeof e.maxTokens||e.maxTokens<=0||e.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in e)||"number"!=typeof e.tokenRatio||e.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+e.maxTokens.toFixed(3),tokenRatio:+e.tokenRatio.toFixed(3)}}function f(e){let t={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in e)if("string"==typeof e.loadBalancingPolicy)t.loadBalancingPolicy=e.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in e)if(Array.isArray(e.loadBalancingConfig))for(let r of e.loadBalancingConfig)t.loadBalancingConfig.push((0,s.validateLoadBalancingConfig)(r));else throw Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in e&&Array.isArray(e.methodConfig))for(let r of e.methodConfig)t.methodConfig.push(h(r));"retryThrottling"in e&&(t.retryThrottling=d(e.retryThrottling));let r=[];for(let e of t.methodConfig)for(let t of e.name){for(let e of r)if(t.service===e.service&&t.method===e.method)throw Error(`Invalid service config: duplicate name ${t.service}/${t.method}`);r.push(t)}return t}function p(e){if(!("serviceConfig"in e))throw Error("Invalid service config choice: missing service config");let t={serviceConfig:f(e.serviceConfig)};if("clientLanguage"in e)if(Array.isArray(e.clientLanguage))for(let r of(t.clientLanguage=[],e.clientLanguage))if("string"==typeof r)t.clientLanguage.push(r);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in e)if(Array.isArray(e.clientHostname))for(let r of(t.clientHostname=[],e.clientHostname))if("string"==typeof r)t.clientHostname.push(r);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname");if("percentage"in e)if("number"==typeof e.percentage&&0<=e.percentage&&e.percentage<=100)t.percentage=e.percentage;else throw Error("Invalid service config choice: invalid percentage");let r=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let t in e)if(!r.includes(t))throw Error(`Invalid service config choice: unexpected field ${t}`);return t}function m(e,t){if(!Array.isArray(e))throw Error("Invalid service config list");for(let r of e){let e=p(r);if("number"!=typeof e.percentage||!(t>e.percentage)){if(Array.isArray(e.clientHostname)){let t=!1;for(let r of e.clientHostname)r===n.hostname()&&(t=!0);if(!t)continue}if(Array.isArray(e.clientLanguage)){let t=!1;for(let r of e.clientLanguage)r===o&&(t=!0);if(!t)continue}return e.serviceConfig}}throw Error("No matching service config found")}r.validateRetryThrottling=d,r.validateServiceConfig=f,r.extractAndSelectServiceConfig=function(e,t){for(let r of e)if(r.length>0&&r[0].startsWith("grpc_config="))return m(JSON.parse(r.join("").substring(12)),t);return null}},306971,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.ConnectivityState=void 0,function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.READY=2]="READY",e[e.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",e[e.SHUTDOWN=4]="SHUTDOWN"}(n||(r.ConnectivityState=n={}))},570823,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.uriToString=r.splitHostPort=r.parseUri=void 0;let n=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;r.parseUri=function(e){let t=n.exec(e);return null===t?null:{scheme:t[1],authority:t[2],path:t[3]}};let i=/^\d+$/;r.splitHostPort=function(e){if(e.startsWith("[")){let t=e.indexOf("]");if(-1===t)return null;let r=e.substring(1,t);if(-1===r.indexOf(":"))return null;if(!(e.length>t+1))return{host:r};if(":"!==e[t+1])return null;{let n=e.substring(t+2);return i.test(n)?{host:r,port:+n}:null}}{let t=e.split(":");return 2!==t.length?{host:e}:i.test(t[1])?{host:t[0],port:+t[1]}:null}},r.uriToString=function(e){let t="";return void 0!==e.scheme&&(t+=e.scheme+":"),void 0!==e.authority&&(t+="//"+e.authority+"/"),t+=e.path}},624950,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.mapUriDefaultScheme=r.getDefaultAuthority=r.createResolver=r.registerDefaultScheme=r.registerResolver=void 0;let n=e.r(570823),i={},s=null;r.registerResolver=function(e,t){i[e]=t},r.registerDefaultScheme=function(e){s=e},r.createResolver=function(e,t,r){if(void 0!==e.scheme&&e.scheme in i)return new i[e.scheme](e,t,r);throw Error(`No resolver could be created for target ${(0,n.uriToString)(e)}`)},r.getDefaultAuthority=function(e){if(void 0!==e.scheme&&e.scheme in i)return i[e.scheme].getDefaultAuthority(e);throw Error(`Invalid target ${(0,n.uriToString)(e)}`)},r.mapUriDefaultScheme=function(e){if(void 0===e.scheme||!(e.scheme in i))if(null!==s)return{scheme:s,authority:void 0,path:(0,n.uriToString)(e)};else return null;return e}},919732,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.QueuePicker=r.UnavailablePicker=r.PickResultType=void 0;let i=e.r(736063),s=e.r(825933);!function(e){e[e.COMPLETE=0]="COMPLETE",e[e.QUEUE=1]="QUEUE",e[e.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",e[e.DROP=3]="DROP"}(n||(r.PickResultType=n={}));class a{constructor(e){this.status=Object.assign({code:s.Status.UNAVAILABLE,details:"No connection established",metadata:new i.Metadata},e)}pick(e){return{pickResultType:n.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}r.UnavailablePicker=a;class o{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:n.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}r.QueuePicker=o},984883,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BackoffTimeout=void 0;let n=1e3,i=1.6,s=12e4,a=.2;function o(e,t){return Math.random()*(t-e)+e}class l{constructor(e,t){this.callback=e,this.initialDelay=n,this.multiplier=i,this.maxDelay=s,this.jitter=a,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||null==(r=(t=this.timerId).unref)||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+o(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,null==(t=(e=this.timerId).ref)||t.call(e)}unref(){var e,t;this.hasRef=!1,null==(t=(e=this.timerId).unref)||t.call(e)}getEndTime(){return this.endTime}}r.BackoffTimeout=l},559760,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChildLoadBalancerHandler=void 0;let n=e.r(412065),i=e.r(306971),s="child_load_balancer_helper";class a{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(e){this.parent=e,this.child=null}createSubchannel(e,t){return this.parent.channelControlHelper.createSubchannel(e,t)}updateState(e,t){var r;if(this.calledByPendingChild()){if(e===i.ConnectivityState.CONNECTING)return;null==(r=this.parent.currentChild)||r.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(e,t)}requestReresolution(){var e;let t=null!=(e=this.parent.pendingChild)?e:this.parent.currentChild;this.child===t&&this.parent.channelControlHelper.requestReresolution()}setChild(e){this.child=e}addChannelzChild(e){this.parent.channelControlHelper.addChannelzChild(e)}removeChannelzChild(e){this.parent.channelControlHelper.removeChannelzChild(e)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let e=new this.ChildPolicyHelper(this),r=(0,n.createLoadBalancer)(t,e);e.setChild(r),null===this.currentChild?(this.currentChild=r,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=r,i=this.pendingChild)}else i=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return s}}r.ChildLoadBalancerHandler=a},124255,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ResolvingLoadBalancer=void 0;let n=e.r(412065),i=e.r(812394),s=e.r(306971),a=e.r(624950),o=e.r(919732),l=e.r(984883),u=e.r(825933),c=e.r(736063),h=e.r(709917),d=e.r(825933),f=e.r(570823),p=e.r(559760),m="resolving_load_balancer";function g(e){h.trace(d.LogVerbosity.DEBUG,m,e)}let y=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function v(e,t,r,n){for(let i of r.name)switch(n){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===e&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===e&&i.method===t)return!0}return!1}function b(e,t,r,n){for(let i of r)if(v(e,t,i,n))return i;return null}function S(e){return function(t,r){var n,i;let s=t.split("/").filter(e=>e.length>0),a=null!=(n=s[0])?n:"",o=null!=(i=s[1])?i:"";if(e&&e.methodConfig)for(let t of y){let r=b(a,o,e.methodConfig,t);if(r)return{methodConfig:r,pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}}class w{constructor(e,t,r,h,d){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=h,this.onFailedResolution=d,this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,i.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(s.ConnectivityState.IDLE,new o.QueuePicker(this)),this.childLoadBalancer=new p.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(g("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(e,t)=>{this.latestChildState=e,this.latestChildPicker=t,this.updateState(e,t)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,a.createResolver)(e,{onSuccessfulResolution:(e,t,r,i,s)=>{var a;this.backoffTimeout.stop(),this.backoffTimeout.reset();let o=null;null===t?null===r?(this.previousServiceConfig=null,o=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(r):o=this.previousServiceConfig:(o=t,this.previousServiceConfig=t);let l=null!=(a=null==o?void 0:o.loadBalancingConfig)?a:[],h=(0,n.getFirstUsableConfig)(l,!0);if(null===h)return void this.handleResolutionFailure({code:u.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new c.Metadata});this.childLoadBalancer.updateAddressList(e,h,s);let d=null!=o?o:this.defaultServiceConfig;this.onSuccessfulResolution(d,null!=i?i:S(d))},onError:e=>{this.handleResolutionFailure(e)}},r);const f={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new l.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},f),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===s.ConnectivityState.IDLE&&this.updateState(s.ConnectivityState.CONNECTING,new o.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){g((0,f.uriToString)(this.target)+" "+s.ConnectivityState[this.currentState]+" -> "+s.ConnectivityState[e]),e===s.ConnectivityState.IDLE&&(t=new o.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===s.ConnectivityState.IDLE&&(this.updateState(s.ConnectivityState.TRANSIENT_FAILURE,new o.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===s.ConnectivityState.IDLE||this.currentState===s.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}r.ResolvingLoadBalancer=w},229956,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.channelOptionsEqual=r.recognizedOptions=void 0,r.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},r.channelOptionsEqual=function(e,t){let r=Object.keys(e).sort(),n=Object.keys(t).sort();if(r.length!==n.length)return!1;for(let i=0;i<r.length;i+=1)if(r[i]!==n[i]||e[r[i]]!==t[n[i]])return!1;return!0}},18806,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.stringToSubchannelAddress=r.subchannelAddressToString=r.subchannelAddressEqual=r.isTcpSubchannelAddress=void 0;let n=e.r(504446);function i(e){return"port"in e}r.isTcpSubchannelAddress=i,r.subchannelAddressEqual=function(e,t){return!e&&!t||!!e&&!!t&&(i(e)?i(t)&&e.host===t.host&&e.port===t.port:!i(t)&&e.path===t.path)},r.subchannelAddressToString=function(e){return i(e)?e.host+":"+e.port:e.path};let s=443;r.stringToSubchannelAddress=function(e,t){return(0,n.isIP)(e)?{host:e,port:null!=t?t:s}:{path:e}}},23135,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addAdminServicesToServer=r.registerAdminService=void 0;let n=[];r.registerAdminService=function(e,t){n.push({getServiceDefinition:e,getHandlers:t})},r.addAdminServicesToServer=function(e){for(let{getServiceDefinition:t,getHandlers:r}of n)e.addService(t(),r())}},486514,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ClientDuplexStreamImpl=r.ClientWritableStreamImpl=r.ClientReadableStreamImpl=r.ClientUnaryCallImpl=r.callErrorFromStatus=void 0;let n=e.r(427699),i=e.r(688947),s=e.r(825933);r.callErrorFromStatus=function(e,t){let r=`${e.code} ${s.Status[e.code]}: ${e.details}`,n=Error(r),i=`${n.stack}
for call at
${t}`;return Object.assign(Error(r),e,{stack:i})};class a extends n.EventEmitter{constructor(){super()}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}}r.ClientUnaryCallImpl=a;class o extends i.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_read(e){var t;null==(t=this.call)||t.startRead()}}r.ClientReadableStreamImpl=o;class l extends i.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null==(n=this.call)||n.sendMessageWithContext(i,e)}_final(e){var t;null==(t=this.call)||t.halfClose(),e()}}r.ClientWritableStreamImpl=l;class u extends i.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_read(e){var t;null==(t=this.call)||t.startRead()}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null==(n=this.call)||n.sendMessageWithContext(i,e)}_final(e){var t;null==(t=this.call)||t.halfClose(),e()}}r.ClientDuplexStreamImpl=u},962888,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InterceptingListenerImpl=r.isInterceptingListener=void 0,r.isInterceptingListener=function(e){return void 0!==e.onReceiveMetadata&&1===e.onReceiveMetadata.length};class n{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,e=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(e),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,e=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=e,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(e),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,e=>{this.processingMetadata||this.processingMessage?this.pendingStatus=e:this.nextListener.onReceiveStatus(e)})}}r.InterceptingListenerImpl=n},129561,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getInterceptingCall=r.InterceptingCall=r.RequesterBuilder=r.ListenerBuilder=r.InterceptorConfigurationError=void 0;let n=e.r(736063),i=e.r(962888),s=e.r(825933),a=e.r(107106);class o extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,o)}}r.InterceptorConfigurationError=o;class l{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}r.ListenerBuilder=l;class u{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}r.RequesterBuilder=u;let c=(e,t)=>{t(e)},h=(e,t)=>{t(e)},d=(e,t)=>{t(e)},f={start:(e,t,r)=>{r(e,t)},sendMessage:(e,t)=>{t(e)},halfClose:e=>{e()},cancel:e=>{e()}};class p{constructor(e,t){var r,n,i,s;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:null!=(r=t.start)?r:f.start,sendMessage:null!=(n=t.sendMessage)?n:f.sendMessage,halfClose:null!=(i=t.halfClose)?i:f.halfClose,cancel:null!=(s=t.cancel)?s:f.cancel}:this.requester=f}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,n,s,a,o,l;let u={onReceiveMetadata:null!=(n=null==(r=null==t?void 0:t.onReceiveMetadata)?void 0:r.bind(t))?n:e=>{},onReceiveMessage:null!=(a=null==(s=null==t?void 0:t.onReceiveMessage)?void 0:s.bind(t))?a:e=>{},onReceiveStatus:null!=(l=null==(o=null==t?void 0:t.onReceiveStatus)?void 0:o.bind(t))?l:e=>{}};this.processingMetadata=!0,this.requester.start(e,u,(e,t)=>{var r,n,s;let a;if(this.processingMetadata=!1,(0,i.isInterceptingListener)(t))a=t;else{let e={onReceiveMetadata:null!=(r=t.onReceiveMetadata)?r:c,onReceiveMessage:null!=(n=t.onReceiveMessage)?n:h,onReceiveStatus:null!=(s=t.onReceiveStatus)?s:d};a=new i.InterceptingListenerImpl(e,u)}this.nextCall.start(e,a),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function m(e,t,r){var n,i;let s=null!=(n=r.deadline)?n:1/0,a=r.host,o=null!=(i=r.parent)?i:null,l=r.propagate_flags,u=r.credentials,c=e.createCall(t,s,a,o,l);return u&&c.setCredentials(u),c}r.InterceptingCall=p;class g{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(e){this.call.cancelWithStatus(s.Status.INTERNAL,`Request message serialization failure: ${(0,a.getErrorMessage)(e)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:e=>{var r;null==(r=null==t?void 0:t.onReceiveMetadata)||r.call(t,e)},onReceiveMessage:e=>{var i;let o;try{o=this.methodDefinition.responseDeserialize(e)}catch(e){r={code:s.Status.INTERNAL,details:`Response message parsing error: ${(0,a.getErrorMessage)(e)}`,metadata:new n.Metadata},this.call.cancelWithStatus(r.code,r.details);return}null==(i=null==t?void 0:t.onReceiveMessage)||i.call(t,o)},onReceiveStatus:e=>{var n,i;r?null==(n=null==t?void 0:t.onReceiveStatus)||n.call(t,r):null==(i=null==t?void 0:t.onReceiveStatus)||i.call(t,e)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class y extends g{constructor(e,t){super(e,t)}start(e,t){var r,n;let i=!1,s={onReceiveMetadata:null!=(n=null==(r=null==t?void 0:t.onReceiveMetadata)?void 0:r.bind(t))?n:e=>{},onReceiveMessage:e=>{var r;i=!0,null==(r=null==t?void 0:t.onReceiveMessage)||r.call(t,e)},onReceiveStatus:e=>{var r,n;i||null==(r=null==t?void 0:t.onReceiveMessage)||r.call(t,null),null==(n=null==t?void 0:t.onReceiveStatus)||n.call(t,e)}};super.start(e,s),this.call.startRead()}}class v extends g{}function b(e,t,r){let n=m(e,r.path,t);return r.responseStream?new v(n,r):new y(n,r)}r.getInterceptingCall=function(e,t,r,n){if(e.clientInterceptors.length>0&&e.clientInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(e.callInterceptors.length>0&&e.callInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];i=e.callInterceptors.length>0||e.callInterceptorProviders.length>0?[].concat(e.callInterceptors,e.callInterceptorProviders.map(e=>e(t))).filter(e=>e):[].concat(e.clientInterceptors,e.clientInterceptorProviders.map(e=>e(t))).filter(e=>e);let s=Object.assign({},r,{method_definition:t});return i.reduceRight((e,t)=>r=>t(r,e),e=>b(n,e,t))(s)}},742683,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Client=void 0;let n=e.r(486514),i=e.r(200494),s=e.r(306971),a=e.r(825933),o=e.r(736063),l=e.r(129561),u=Symbol(),c=Symbol(),h=Symbol(),d=Symbol();function f(e){return"function"==typeof e}function p(e){return e.stack.split("\n").slice(1).join("\n")}class m{constructor(e,t,r={}){var n,s;if(r=Object.assign({},r),this[c]=null!=(n=r.interceptors)?n:[],delete r.interceptors,this[h]=null!=(s=r.interceptor_providers)?s:[],delete r.interceptor_providers,this[c].length>0&&this[h].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[d]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[u]=r.channelOverride;else if(r.channelFactoryOverride){const n=r.channelFactoryOverride;delete r.channelFactoryOverride,this[u]=n(e,t,r)}else this[u]=new i.ChannelImplementation(e,t,r)}close(){this[u].close()}getChannel(){return this[u]}waitForReady(e,t){let r=n=>{let i;if(n)return void t(Error("Failed to connect before the deadline"));try{i=this[u].getConnectivityState(!0)}catch(e){t(Error("The channel has been closed"));return}if(i===s.ConnectivityState.READY)t();else try{this[u].watchConnectivityState(i,e,r)}catch(e){t(Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(f(e))return{metadata:new o.Metadata,options:{},callback:e};if(f(t))if(e instanceof o.Metadata)return{metadata:e,options:{},callback:t};else return{metadata:new o.Metadata,options:e,callback:t};if(!(e instanceof o.Metadata&&t instanceof Object&&f(r)))throw Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,f){var m,g;let y=this.checkOptionalUnaryResponseArguments(s,o,f),v={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},b={argument:i,metadata:y.metadata,call:new n.ClientUnaryCallImpl,channel:this[u],methodDefinition:v,callOptions:y.options,callback:y.callback};this[d]&&(b=this[d](b));let S=b.call,w={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(m=b.callOptions.interceptors)?m:[],callInterceptorProviders:null!=(g=b.callOptions.interceptor_providers)?g:[]},C=(0,l.getInterceptingCall)(w,b.methodDefinition,b.callOptions,b.channel);S.call=C;let T=null,E=!1,_=Error();return C.start(b.metadata,{onReceiveMetadata:e=>{S.emit("metadata",e)},onReceiveMessage(e){null!==T&&C.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),T=e},onReceiveStatus(e){if(!E){if(E=!0,e.code===a.Status.OK)if(null===T){let t=p(_);b.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else b.callback(null,T);else{let t=p(_);b.callback((0,n.callErrorFromStatus)(e,t))}_=null,S.emit("status",e)}}}),C.sendMessage(i),C.halfClose(),S}makeClientStreamRequest(e,t,r,i,s,o){var f,m;let g=this.checkOptionalUnaryResponseArguments(i,s,o),y={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},v={metadata:g.metadata,call:new n.ClientWritableStreamImpl(t),channel:this[u],methodDefinition:y,callOptions:g.options,callback:g.callback};this[d]&&(v=this[d](v));let b=v.call,S={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(f=v.callOptions.interceptors)?f:[],callInterceptorProviders:null!=(m=v.callOptions.interceptor_providers)?m:[]},w=(0,l.getInterceptingCall)(S,v.methodDefinition,v.callOptions,v.channel);b.call=w;let C=null,T=!1,E=Error();return w.start(v.metadata,{onReceiveMetadata:e=>{b.emit("metadata",e)},onReceiveMessage(e){null!==C&&w.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),C=e},onReceiveStatus(e){if(!T){if(T=!0,e.code===a.Status.OK)if(null===C){let t=p(E);v.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else v.callback(null,C);else{let t=p(E);v.callback((0,n.callErrorFromStatus)(e,t))}E=null,b.emit("status",e)}}}),b}checkMetadataAndOptions(e,t){let r,n;return e instanceof o.Metadata?(r=e,n=t||{}):(n=e||{},r=new o.Metadata),{metadata:r,options:n}}makeServerStreamRequest(e,t,r,i,s,o){var f,m;let g=this.checkMetadataAndOptions(s,o),y={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},v={argument:i,metadata:g.metadata,call:new n.ClientReadableStreamImpl(r),channel:this[u],methodDefinition:y,callOptions:g.options};this[d]&&(v=this[d](v));let b=v.call,S={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(f=v.callOptions.interceptors)?f:[],callInterceptorProviders:null!=(m=v.callOptions.interceptor_providers)?m:[]},w=(0,l.getInterceptingCall)(S,v.methodDefinition,v.callOptions,v.channel);b.call=w;let C=!1,T=Error();return w.start(v.metadata,{onReceiveMetadata(e){b.emit("metadata",e)},onReceiveMessage(e){b.push(e)},onReceiveStatus(e){if(!C){if(C=!0,b.push(null),e.code!==a.Status.OK){let t=p(T);b.emit("error",(0,n.callErrorFromStatus)(e,t))}T=null,b.emit("status",e)}}}),w.sendMessage(i),w.halfClose(),b}makeBidiStreamRequest(e,t,r,i,s){var o,f;let m=this.checkMetadataAndOptions(i,s),g={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},y={metadata:m.metadata,call:new n.ClientDuplexStreamImpl(t,r),channel:this[u],methodDefinition:g,callOptions:m.options};this[d]&&(y=this[d](y));let v=y.call,b={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(o=y.callOptions.interceptors)?o:[],callInterceptorProviders:null!=(f=y.callOptions.interceptor_providers)?f:[]},S=(0,l.getInterceptingCall)(b,y.methodDefinition,y.callOptions,y.channel);v.call=S;let w=!1,C=Error();return S.start(y.metadata,{onReceiveMetadata(e){v.emit("metadata",e)},onReceiveMessage(e){v.push(e)},onReceiveStatus(e){if(!w){if(w=!0,v.push(null),e.code!==a.Status.OK){let t=p(C);v.emit("error",(0,n.callErrorFromStatus)(e,t))}C=null,v.emit("status",e)}}}),v}}r.Client=m},325930,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.loadPackageDefinition=r.makeClientConstructor=void 0;let n=e.r(742683),i={unary:n.Client.prototype.makeUnaryRequest,server_stream:n.Client.prototype.makeServerStreamRequest,client_stream:n.Client.prototype.makeClientStreamRequest,bidi:n.Client.prototype.makeBidiStreamRequest};function s(e){return["__proto__","prototype","constructor"].includes(e)}function a(e,t,r){r||(r={});class a extends n.Client{}return Object.keys(e).forEach(t=>{let r;if(s(t))return;let n=e[t];if("string"==typeof t&&"$"===t.charAt(0))throw Error("Method names cannot start with $");r=n.requestStream?n.responseStream?"bidi":"client_stream":n.responseStream?"server_stream":"unary";let l=n.requestSerialize,u=n.responseDeserialize,c=o(i[r],n.path,l,u);a.prototype[t]=c,Object.assign(a.prototype[t],n),n.originalName&&!s(n.originalName)&&(a.prototype[n.originalName]=a.prototype[t])}),a.service=e,a.serviceName=t,a}function o(e,t,r,n){return function(...i){return e.call(this,t,r,n,...i)}}function l(e){return"format"in e}r.makeClientConstructor=a,r.loadPackageDefinition=function(e){let t={};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let n=e[r],i=r.split(".");if(i.some(e=>s(e)))continue;let o=i[i.length-1],u=t;for(let e of i.slice(0,-1))u[e]||(u[e]={}),u=u[e];l(n)?u[o]=n:u[o]=a(n,o,{})}return t}},110462,(e,t,r)=>{var n=1/0,i="[object Symbol]",s=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,a=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,o="\\ud800-\\udfff",l="\\u0300-\\u036f\\ufe20-\\ufe23",u="\\u20d0-\\u20f0",c="\\u2700-\\u27bf",h="a-z\\xdf-\\xf6\\xf8-\\xff",d="A-Z\\xc0-\\xd6\\xd8-\\xde",f="\\ufe0e\\ufe0f",p="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",m="[']",g="["+o+"]",y="["+p+"]",v="["+l+u+"]",b="\\d+",S="["+c+"]",w="["+h+"]",C="[^"+o+p+b+c+h+d+"]",T="\\ud83c[\\udffb-\\udfff]",E="[^"+o+"]",_="(?:\\ud83c[\\udde6-\\uddff]){2}",I="[\\ud800-\\udbff][\\udc00-\\udfff]",k="["+d+"]",x="\\u200d",R="(?:"+w+"|"+C+")",D="(?:"+k+"|"+C+")",A="(?:"+m+"(?:d|ll|m|re|s|t|ve))?",O="(?:"+m+"(?:D|LL|M|RE|S|T|VE))?",N="(?:"+v+"|"+T+")?",P="["+f+"]?",M="(?:"+x+"(?:"+[E,_,I].join("|")+")"+P+N+")*",L=P+N+M,B="(?:"+[S,_,I].join("|")+")"+L,F="(?:"+[E+v+"?",v,_,I,g].join("|")+")",j=RegExp(m,"g"),V=RegExp(v,"g"),q=RegExp(T+"(?="+T+")|"+F+L,"g"),z=RegExp([k+"?"+w+"+"+A+"(?="+[y,k,"$"].join("|")+")",D+"+"+O+"(?="+[y,k+R,"$"].join("|")+")",k+"?"+R+"+"+A,k+"+"+O,b,B].join("|"),"g"),U=RegExp("["+x+o+l+u+f+"]"),$=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,K={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"ss"},W=e.g&&e.g.Object===Object&&e.g,G="object"==typeof self&&self&&self.Object===Object&&self,H=W||G||Function("return this")();function Q(e,t,r,n){var i=-1,s=e?e.length:0;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function J(e){return e.split("")}function Y(e){return e.match(s)||[]}var X=function(e){return function(t){return null==e?void 0:e[t]}}(K);function Z(e){return U.test(e)}function ee(e){return $.test(e)}function et(e){return Z(e)?er(e):J(e)}function er(e){return e.match(q)||[]}function en(e){return e.match(z)||[]}var ei=Object.prototype.toString,es=H.Symbol,ea=es?es.prototype:void 0,eo=ea?ea.toString:void 0;function el(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s}function eu(e){if("string"==typeof e)return e;if(ef(e))return eo?eo.call(e):"";var t=e+"";return"0"==t&&1/e==-n?"-0":t}function ec(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:el(e,t,r)}function eh(e){return function(t){var r=Z(t=ep(t))?et(t):void 0,n=r?r[0]:t.charAt(0),i=r?ec(r,1).join(""):t.slice(1);return n[e]()+i}}function ed(e){return!!e&&"object"==typeof e}function ef(e){return"symbol"==typeof e||ed(e)&&ei.call(e)==i}function ep(e){return null==e?"":eu(e)}var em=function(e){return function(t){return Q(eb(ey(t).replace(j,"")),e,"")}}(function(e,t,r){return t=t.toLowerCase(),e+(r?eg(t):t)});function eg(e){return ev(ep(e).toLowerCase())}function ey(e){return(e=ep(e))&&e.replace(a,X).replace(V,"")}var ev=eh("toUpperCase");function eb(e,t,r){return(e=ep(e),void 0===(t=r?void 0:t))?ee(e)?en(e):Y(e):e.match(t)||[]}t.exports=em},364156,(e,t,r)=>{"use strict";t.exports=function e(e,t){for(var r=Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise(function(i,a){r[n]=function(e){if(s)if(s=!1,e)a(e);else{for(var t=Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){s&&(s=!1,a(e))}})}},439310,(e,t,r)=>{"use strict";var n=r;n.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var i=Array(64),s=Array(123),a=0;a<64;)s[i[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;n.encode=function(e,t,r){for(var n,s=null,a=[],o=0,l=0;t<r;){var u=e[t++];switch(l){case 0:a[o++]=i[u>>2],n=(3&u)<<4,l=1;break;case 1:a[o++]=i[n|u>>4],n=(15&u)<<2,l=2;break;case 2:a[o++]=i[n|u>>6],a[o++]=i[63&u],l=0}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0)}return(l&&(a[o++]=i[n],a[o++]=61,1===l&&(a[o++]=61)),s)?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};var o="invalid encoding";n.decode=function(e,t,r){for(var n,i=r,a=0,l=0;l<e.length;){var u=e.charCodeAt(l++);if(61===u&&a>1)break;if(void 0===(u=s[u]))throw Error(o);switch(a){case 0:n=u,a=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,a=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,a=3;break;case 3:t[r++]=(3&n)<<6|u,a=0}}if(1===a)throw Error(o);return r-i},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},839536,(e,t,r)=>{"use strict";function n(){this._listeners={}}t.exports=n,n.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},n.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},n.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},814696,(e,t,r)=>{"use strict";function n(e){return"undefined"!=typeof Float32Array?!function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function s(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function o(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:s,e.writeFloatBE=n?s:i,e.readFloatLE=n?a:o,e.readFloatBE=n?o:a}():!function(){function t(e,t,r,n){var i=+(t<0);if(i&&(t=-t),0===t)e(1/t>0?0:0x80000000,r,n);else if(isNaN(t))e(0x7fc00000,r,n);else if(t>34028234663852886e22)e((i<<31|0x7f800000)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var s=Math.floor(Math.log(t)/Math.LN2),a=8388607&Math.round(t*Math.pow(2,-s)*8388608);e((i<<31|s+127<<23|a)>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=(n>>31)*2+1,s=n>>>23&255,a=8388607&n;return 255===s?a?NaN:1/0*i:0===s?1401298464324817e-60*i*a:i*Math.pow(2,s-150)*(a+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,s),e.readFloatLE=r.bind(null,a),e.readFloatBE=r.bind(null,o)}(),"undefined"!=typeof Float64Array?!function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function s(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function o(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:s,e.writeDoubleBE=n?s:i,e.readDoubleLE=n?a:o,e.readDoubleBE=n?o:a}():!function(){function t(e,t,r,n,i,s){var a,o=+(n<0);if(o&&(n=-n),0===n)e(0,i,s+t),e(1/n>0?0:0x80000000,i,s+r);else if(isNaN(n))e(0,i,s+t),e(0x7ff80000,i,s+r);else if(n>17976931348623157e292)e(0,i,s+t),e((o<<31|0x7ff00000)>>>0,i,s+r);else if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,i,s+t),e((o<<31|a/0x100000000)>>>0,i,s+r);else{var l=Math.floor(Math.log(n)/Math.LN2);1024===l&&(l=1023),e(0x10000000000000*(a=n*Math.pow(2,-l))>>>0,i,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,i,s+r)}}function r(e,t,r,n,i){var s=e(n,i+t),a=e(n,i+r),o=(a>>31)*2+1,l=a>>>20&2047,u=0x100000000*(1048575&a)+s;return 2047===l?u?NaN:1/0*o:0===l?5e-324*o*u:o*Math.pow(2,l-1075)*(u+0x10000000000000)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,s,4,0),e.readDoubleLE=r.bind(null,a,0,4),e.readDoubleBE=r.bind(null,o,4,0)}(),e}function i(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function s(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function o(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}t.exports=n(n)},291584,(__turbopack_context__,module,exports)=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},57684,(e,t,r)=>{"use strict";var n=r;n.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:(64512&r)==55296&&(64512&e.charCodeAt(n+1))==56320?(++n,t+=4):t+=3;return t},n.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,s=[],a=0;t<r;)(n=e[t++])<128?s[a++]=n:n>191&&n<224?s[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[a++]=55296+(n>>10),s[a++]=56320+(1023&n)):s[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))},n.write=function(e,t,r){for(var n,i,s=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:((64512&n)==55296&&(64512&(i=e.charCodeAt(a+1)))==56320?(n=65536+((1023&n)<<10)+(1023&i),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128);return r-s}},281315,(e,t,r)=>{"use strict";t.exports=function e(e,t,r){var n=r||8192,i=n>>>1,s=null,a=n;return function(r){if(r<1||r>i)return e(r);a+r>n&&(s=e(n),a=0);var o=t.call(s,a,a+=r);return 7&a&&(a=(7|a)+1),o}}},575515,(e,t,r)=>{"use strict";t.exports=i;var n=e.r(356727);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/0x100000000>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>0xffffffff&&(r=0,++n>0xffffffff&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e))if(!n.Long)return i.fromNumber(parseInt(e,10));else e=n.Long.fromString(e);return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+0x100000000*r)}return this.lo+0x100000000*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var o=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?s:new i((o.call(e,0)|o.call(e,1)<<8|o.call(e,2)<<16|o.call(e,3)<<24)>>>0,(o.call(e,4)|o.call(e,5)<<8|o.call(e,6)<<16|o.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},356727,(e,t,r)=>{"use strict";var n=r;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function s(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&i(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=e.r(364156),n.base64=e.r(439310),n.EventEmitter=e.r(839536),n.float=e.r(814696),n.inquire=e.r(291584),n.utf8=e.r(57684),n.pool=e.r(281315),n.LongBits=e.r(575515),n.isNode=!!(e.g&&e.g.process&&e.g.process.versions&&e.g.process.versions.node),n.global=n.isNode&&e.g||"undefined"!=typeof self&&self||e.e,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!!(null!=r&&e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;if(!e){n._Buffer_from=n._Buffer_allocUnsafe=null;return}n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}}},78370,(e,t,r)=>{"use strict";t.exports={}},197388,(e,t,r)=>{"use strict";function n(e,t){"string"==typeof e&&(t=e,e=void 0);var r=[];function i(e){if("string"!=typeof e){var t=s();if(n.verbose&&console.log("codegen: "+t),t="return "+t,e){for(var a=Object.keys(e),o=Array(a.length+1),l=Array(a.length),u=0;u<a.length;)o[u]=a[u],l[u]=e[a[u++]];return o[u]=t,Function.apply(null,o).apply(null,l)}return Function(t)()}for(var c=Array(arguments.length-1),h=0;h<c.length;)c[h]=arguments[++h];if(h=0,e=e.replace(/%([%dfijs])/g,function(e,t){var r=c[h++];switch(t){case"d":case"f":return String(Number(r));case"i":return String(Math.floor(r));case"j":return JSON.stringify(r);case"s":return String(r)}return"%"}),h!==c.length)throw Error("parameter count mismatch");return r.push(e),i}function s(n){return"function "+(n||t||"")+"("+(e&&e.join(",")||"")+"){\n  "+r.join("\n  ")+"\n}"}return i.toString=s,i}t.exports=n,n.verbose=!1},195136,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(364156),i=e.r(291584)("fs");function s(e,t,r){return("function"==typeof t?(r=t,t={}):t||(t={}),r)?!t.xhr&&i&&i.readFile?i.readFile(e,function(n,i){return n&&"undefined"!=typeof XMLHttpRequest?s.xhr(e,t,r):n?r(n):r(null,t.binary?i:i.toString("utf8"))}):s.xhr(e,t,r):n(s,this,e,t)}s.xhr=function(e,t,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){if(0!==n.status&&200!==n.status)return r(Error("status "+n.status));if(t.binary){var e=n.response;if(!e){e=[];for(var i=0;i<n.responseText.length;++i)e.push(255&n.responseText.charCodeAt(i))}return r(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return r(null,n.responseText)}},t.binary&&("overrideMimeType"in n&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.responseType="arraybuffer"),n.open("GET",e),n.send()}},50476,(e,t,r)=>{"use strict";var n=r,i=n.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},s=n.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),r=i(e),n="";r&&(n=t.shift()+"/");for(var s=0;s<t.length;)".."===t[s]?s>0&&".."!==t[s-1]?t.splice(--s,2):r?t.splice(s,1):++s:"."===t[s]?t.splice(s,1):++s;return n+t.join("/")};n.resolve=function(e,t,r){return(r||(t=s(t)),i(t))?t:(r||(e=s(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?s(e+"/"+t):t)}},411615,(e,t,r)=>{"use strict";t.exports=h;var n,i,s,a=e.r(712688);((h.prototype=Object.create(a.prototype)).constructor=h).className="Namespace";var o=e.r(432240),l=e.r(516553),u=e.r(904216);function c(e,t){if(e&&e.length){for(var r={},n=0;n<e.length;++n)r[e[n].name]=e[n].toJSON(t);return r}}function h(e,t){a.call(this,e,t),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function d(e){e._nestedArray=null,e._lookupCache={};for(var t=e;t=t.parent;)t._lookupCache={};return e}h.fromJSON=function(e,t){return new h(e,t.options).addJSON(t.nested)},h.arrayToJSON=c,h.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if("string"!=typeof e[r]&&e[r][0]<=t&&e[r][1]>t)return!0}return!1},h.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1},Object.defineProperty(h.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=l.toArray(this.nested))}}),h.prototype.toJSON=function(e){return l.toObject(["options",this.options,"nested",c(this.nestedArray,e)])},h.prototype.addJSON=function(e){var t=this;if(e)for(var r,a=Object.keys(e),l=0;l<a.length;++l)r=e[a[l]],t.add((void 0!==r.fields?n.fromJSON:void 0!==r.values?s.fromJSON:void 0!==r.methods?i.fromJSON:void 0!==r.id?o.fromJSON:h.fromJSON)(a[l],r));return this},h.prototype.get=function(e){return this.nested&&this.nested[e]||null},h.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},h.prototype.add=function(e){if(!(e instanceof o&&void 0!==e.extend||e instanceof n||e instanceof u||e instanceof s||e instanceof i||e instanceof h))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t)if(t instanceof h&&e instanceof h&&!(t instanceof n||t instanceof i)){for(var r=t.nestedArray,a=0;a<r.length;++a)e.add(r[a]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}else this.nested={};this.nested[e.name]=e,this instanceof n||this instanceof i||this instanceof s||this instanceof o||e._edition||(e._edition=e._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var l=this;l=l.parent;)l._needsRecursiveFeatureResolution=!0,l._needsRecursiveResolve=!0;return e.onAdd(this),d(this)},h.prototype.remove=function(e){if(!(e instanceof a))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),d(this)},h.prototype.define=function(e,t){if(l.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var r=this;e.length>0;){var n=e.shift();if(r.nested&&r.nested[n]){if(!((r=r.nested[n])instanceof h))throw Error("path conflicts with non-namespace objects")}else r.add(r=new h(n))}return t&&r.addJSON(t),r},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var e=this.nestedArray,t=0;for(this.resolve();t<e.length;)e[t]instanceof h?e[t++].resolveAll():e[t++].resolve();return this._needsRecursiveResolve=!1,this},h.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,e=this._edition||e,a.prototype._resolveFeaturesRecursive.call(this,e),this.nestedArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},h.prototype.lookup=function(e,t,r){if("boolean"==typeof t?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),l.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;var n=e.join(".");if(""===e[0])return this.root.lookup(e.slice(1),t);var i=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+n];if(i&&(!t||t.indexOf(i.constructor)>-1)||(i=this._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;if(r)return null;for(var s=this;s.parent;){if((i=s.parent._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;s=s.parent}return null},h.prototype._lookupImpl=function(e,t){if(Object.prototype.hasOwnProperty.call(this._lookupCache,t))return this._lookupCache[t];var r=this.get(e[0]),n=null;if(r)1===e.length?n=r:r instanceof h&&(e=e.slice(1),n=r._lookupImpl(e,e.join(".")));else for(var i=0;i<this.nestedArray.length;++i)this._nestedArray[i]instanceof h&&(r=this._nestedArray[i]._lookupImpl(e,t))&&(n=r);return this._lookupCache[t]=n,n},h.prototype.lookupType=function(e){var t=this.lookup(e,[n]);if(!t)throw Error("no such type: "+e);return t},h.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},h.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[n,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},h.prototype.lookupService=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},h._configure=function(e,t,r){n=e,i=t,s=r}},481498,(e,t,r)=>{"use strict";t.exports=a;var n=e.r(432240);((a.prototype=Object.create(n.prototype)).constructor=a).className="MapField";var i=e.r(711826),s=e.r(516553);function a(e,t,r,i,a,o){if(n.call(this,e,t,i,void 0,void 0,a,o),!s.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},a.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return n.prototype.resolve.call(this)},a.d=function(e,t,r){return"function"==typeof r?r=s.decorateType(r).name:r&&"object"==typeof r&&(r=s.decorateEnum(r).name),function(n,i){s.decorateType(n.constructor).add(new a(i,e,t,r))}}},124051,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(712688);((s.prototype=Object.create(n.prototype)).constructor=s).className="Method";var i=e.r(516553);function s(e,t,r,s,a,o,l,u,c){if(i.isObject(a)?(l=a,a=o=void 0):i.isObject(o)&&(l=o,o=void 0),!(void 0===t||i.isString(t)))throw TypeError("type must be a string");if(!i.isString(r))throw TypeError("requestType must be a string");if(!i.isString(s))throw TypeError("responseType must be a string");n.call(this,e,l),this.type=t||"rpc",this.requestType=r,this.requestStream=!!a||void 0,this.responseType=s,this.responseStream=!!o||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=c}s.fromJSON=function(e,t){return new s(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},s.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},s.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),n.prototype.resolve.call(this))}},327739,(e,t,r)=>{"use strict";t.exports=i;var n=e.r(356727);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!r}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,s,a){if(!s)throw TypeError("request must be specified");var o=this;if(!a)return n.asPromise(e,o,t,r,i,s);if(!o.rpcImpl)return void setTimeout(function(){a(Error("already ended"))},0);try{return o.rpcImpl(t,r[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(e,r){if(e)return o.emit("error",e,t),a(e);if(null===r)return void o.end(!0);if(!(r instanceof i))try{r=i[o.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return o.emit("error",e,t),a(e)}return o.emit("data",r,t),a(null,r)})}catch(e){o.emit("error",e,t),setTimeout(function(){a(e)},0);return}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},830036,(e,t,r)=>{"use strict";r.Service=e.r(327739)},712184,(e,t,r)=>{"use strict";t.exports=o;var n=e.r(411615);((o.prototype=Object.create(n.prototype)).constructor=o).className="Service";var i=e.r(124051),s=e.r(516553),a=e.r(830036);function o(e,t){n.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}o.fromJSON=function(e,t){var r=new o(e,t.options);if(t.methods)for(var n=Object.keys(t.methods),s=0;s<n.length;++s)r.add(i.fromJSON(n[s],t.methods[n[s]]));return t.nested&&r.addJSON(t.nested),t.edition&&(r._edition=t.edition),r.comment=t.comment,r._defaultEdition="proto3",r},o.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"methods",n.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},Object.defineProperty(o.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),o.prototype.get=function(e){return this.methods[e]||n.prototype.get.call(this,e)},o.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolve.call(this);for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return this},o.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.methodsArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},o.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,l(this)):n.prototype.add.call(this,e)},o.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return n.prototype.remove.call(this,e)},o.prototype.create=function(e,t,r){for(var n,i=new a.Service(e,t,r),o=0;o<this.methodsArray.length;++o){var l=s.lcFirst((n=this._methodsArray[o]).resolve().name).replace(/[^$\w_]/g,"");i[l]=s.codegen(["r","c"],s.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:n,q:n.resolvedRequestType.ctor,s:n.resolvedResponseType.ctor})}return i}},505560,(e,t,r)=>{"use strict";t.exports=i;var n=e.r(356727);function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)this[t[r]]=e[t[r]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,n.toJSONOptions)}},962638,(e,t,r)=>{"use strict";t.exports=l;var n,i=e.r(356727),s=i.LongBits,a=i.utf8;function o(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},c=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new n(e):u(e)})(e)}:u};function h(){var e=new s(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw o(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}l.create=c(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=function(){var e=0xffffffff;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return e}}(),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return d(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return 0|d(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw o(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var n=i.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)},l.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw o(this);while(128&this.buf[this.pos++])return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){n=e,l.create=c(),n._configure();var t=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},676978,(e,t,r)=>{"use strict";t.exports=h;var n,i=e.r(356727),s=i.LongBits,a=i.base64,o=i.utf8;function l(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function u(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new n})()}:function(){return new h}};function f(e,t,r){t[r]=255&e}function p(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function m(e,t){this.len=e,this.next=void 0,this.val=t}function g(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function y(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}h.create=d(),h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,r){return this.tail=this.tail.next=new l(e,t,r),this.len+=t,this},m.prototype=Object.create(l.prototype),m.prototype.fn=p,h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new m((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(g,10,s.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=s.from(e);return this._push(g,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(g,t.length(),t)},h.prototype.bool=function(e){return this._push(f,1,+!!e)},h.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=s.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(f,1,0);if(i.isString(e)){var r=h.alloc(t=a.length(e));a.decode(e,r,0),e=r}return this.uint32(t)._push(v,t,e)},h.prototype.string=function(e){var t=o.length(e);return t?this.uint32(t)._push(o.write,t,e):this._push(f,1,0)},h.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new l(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},h._configure=function(e){n=e,h.create=d(),n._configure()}},235616,(e,t,r)=>{"use strict";t.exports=o;var n=e.r(215891),i=e.r(711826),s=e.r(516553);function a(e){return"missing required '"+e.name+"'"}function o(e){for(var t=s.codegen(["r","l","e"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),r=0;r<e.fieldsArray.length;++r){var o=e._fieldsArray[r].resolve(),l=o.resolvedType instanceof n?"int32":o.type,u="m"+s.safeProp(o.name);t("case %i: {",o.id),o.map?(t("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[o.keyType]?t("k=%j",i.defaults[o.keyType]):t("k=null"),void 0!==i.defaults[l]?t("value=%j",i.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",o.keyType)("case 2:"),void 0===i.basic[l]?t("value=types[%i].decode(r,r.uint32())",r):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==i.long[o.keyType]?t('%s[typeof k==="object"?util.longToHash(k):k]=value',u):t("%s[k]=value",u)):o.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==i.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,l)("}else"),void 0===i.basic[l]?t(o.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",u,r):t("%s.push(r.%s())",u,l)):void 0===i.basic[l]?t(o.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",u,r):t("%s=r.%s()",u,l),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),r=0;r<e._fieldsArray.length;++r){var c=e._fieldsArray[r];c.required&&t("if(!m.hasOwnProperty(%j))",c.name)("throw util.ProtocolError(%j,{instance:m})",a(c))}return t("return m")}},74211,(e,t,r)=>{"use strict";t.exports=l;var n=e.r(215891),i=e.r(516553);function s(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,r,i){if(t.resolvedType)if(t.resolvedType instanceof n){e("switch(%s){",i)("default:")("return%j",s(t,"enum value"));for(var a=Object.keys(t.resolvedType.values),o=0;o<a.length;++o)e("case %i:",t.resolvedType.values[a[o]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",r,i)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",s(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",s(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",s(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",s(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",s(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",s(t,"buffer"))}return e}function o(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",s(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",s(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",s(t,"boolean key"))}return e}function l(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r=e.oneofsArray,n={};r.length&&t("var p={}");for(var l=0;l<e.fieldsArray.length;++l){var u=e._fieldsArray[l].resolve(),c="m"+i.safeProp(u.name);if(u.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",c,u.name),u.map)t("if(!util.isObject(%s))",c)("return%j",s(u,"object"))("var k=Object.keys(%s)",c)("for(var i=0;i<k.length;++i){"),o(t,u,"k[i]"),a(t,u,l,c+"[k[i]]")("}");else if(u.repeated)t("if(!Array.isArray(%s))",c)("return%j",s(u,"array"))("for(var i=0;i<%s.length;++i){",c),a(t,u,l,c+"[i]")("}");else{if(u.partOf){var h=i.safeProp(u.partOf.name);1===n[u.partOf.name]&&t("if(p%s===1)",h)("return%j",u.partOf.name+": multiple values"),n[u.partOf.name]=1,t("p%s=1",h)}a(t,u,l,c)}u.optional&&t("}")}return t("return null")}},666516,(e,t,r)=>{"use strict";var n=r,i=e.r(215891),s=e.r(516553);function a(e,t,r,n){var s=!1;if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(d%s){",n);for(var a=t.resolvedType.values,o=Object.keys(a),l=0;l<o.length;++l)a[o[l]]!==t.typeDefault||s||(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',n,n,n),t.repeated||e("break"),s=!0),e("case%j:",o[l])("case %i:",a[o[l]])("m%s=%j",n,a[o[l]])("break");e("}")}else e('if(typeof d%s!=="object")',n)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",n,r,n);else{var u=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",n,n);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",n,n);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",n,n);break;case"uint64":u=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",n,n,u)('else if(typeof d%s==="string")',n)("m%s=parseInt(d%s,10)",n,n)('else if(typeof d%s==="number")',n)("m%s=d%s",n,n)('else if(typeof d%s==="object")',n)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",n,n,n,u?"true":"");break;case"bytes":e('if(typeof d%s==="string")',n)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",n,n,n)("else if(d%s.length >= 0)",n)("m%s=d%s",n,n);break;case"string":e("m%s=String(d%s)",n,n);break;case"bool":e("m%s=Boolean(d%s)",n,n)}}return e}function o(e,t,r,n){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",n,r,n,n,r,n,n):e("d%s=types[%i].toObject(m%s,o)",n,r,n);else{var s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",n,n,n,n);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',n)("d%s=o.longs===String?String(m%s):m%s",n,n,n)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",n,n,n,n,s?"true":"",n);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",n,n,n,n,n);break;default:e("d%s=m%s",n,n)}}return e}n.fromObject=function(e){var t=e.fieldsArray,r=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var n=0;n<t.length;++n){var o=t[n].resolve(),l=s.safeProp(o.name);o.map?(r("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",o.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),a(r,o,n,l+"[ks[i]]")("}")("}")):o.repeated?(r("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",o.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),a(r,o,n,l+"[i]")("}")("}")):(o.resolvedType instanceof i||r("if(d%s!=null){",l),a(r,o,n,l),o.resolvedType instanceof i||r("}"))}return r("return m")},n.toObject=function(e){var t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var r=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),n=[],a=[],l=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?n:t[u].map?a:l).push(t[u]);if(n.length){for(r("if(o.arrays||o.defaults){"),u=0;u<n.length;++u)r("d%s=[]",s.safeProp(n[u].name));r("}")}if(a.length){for(r("if(o.objects||o.defaults){"),u=0;u<a.length;++u)r("d%s={}",s.safeProp(a[u].name));r("}")}if(l.length){for(r("if(o.defaults){"),u=0;u<l.length;++u){var c=l[u],h=s.safeProp(c.name);if(c.resolvedType instanceof i)r("d%s=o.enums===String?%j:%j",h,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",h)("}else")("d%s=o.longs===String?%j:%i",h,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){var d="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",h,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",h,d)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",h,h)("}")}else r("d%s=%j",h,c.typeDefault)}r("}")}var f=!1;for(u=0;u<t.length;++u){var c=t[u],p=e._fieldsArray.indexOf(c),h=s.safeProp(c.name);c.map?(f||(f=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",h,h)("d%s={}",h)("for(var j=0;j<ks2.length;++j){"),o(r,c,p,h+"[ks2[j]]")("}")):c.repeated?(r("if(m%s&&m%s.length){",h,h)("d%s=[]",h)("for(var j=0;j<m%s.length;++j){",h),o(r,c,p,h+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",h,c.name),o(r,c,p,h),c.partOf&&r("if(o.oneofs)")("d%s=%j",s.safeProp(c.partOf.name),c.name)),r("}")}return r("return d")}},478288,(e,t,r)=>{"use strict";var n=r,i=e.r(505560);n[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),r=this.lookup(t);if(r){var n="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return -1===n.indexOf("/")&&(n="/"+n),this.create({type_url:n,value:r.encode(r.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var r="type.googleapis.com/",n="",s="";if(t&&t.json&&e.type_url&&e.value){s=e.type_url.substring(e.type_url.lastIndexOf("/")+1),n=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var a=this.lookup(s);a&&(e=a.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var o=e.$type.toObject(e,t),l="."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName;return""===n&&(n=r),s=n+l,o["@type"]=s,o}return this.toObject(e,t)}}},143306,(e,t,r)=>{"use strict";t.exports=v;var n=e.r(411615);((v.prototype=Object.create(n.prototype)).constructor=v).className="Type";var i=e.r(215891),s=e.r(904216),a=e.r(432240),o=e.r(481498),l=e.r(712184),u=e.r(505560),c=e.r(962638),h=e.r(676978),d=e.r(516553),f=e.r(564617),p=e.r(235616),m=e.r(74211),g=e.r(666516),y=e.r(478288);function v(e,t){n.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function b(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var r=this.fields[e[t]],n=r.id;if(this._fieldsById[n])throw Error("duplicate id "+n+" in "+this);this._fieldsById[n]=r}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=d.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=d.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,d.merge(e.prototype,t)),e.$type=e.prototype.$type=this,d.merge(e,u,!0),this._ctor=e;for(var r=0;r<this.fieldsArray.length;++r)this._fieldsArray[r].resolve();var n={};for(r=0;r<this.oneofsArray.length;++r)n[this._oneofsArray[r].resolve().name]={get:d.oneOfGetter(this._oneofsArray[r].oneof),set:d.oneOfSetter(this._oneofsArray[r].oneof)};r&&Object.defineProperties(e.prototype,n)}}}),v.generateConstructor=function(e){for(var t,r=d.codegen(["p"],e.name),n=0;n<e.fieldsArray.length;++n)(t=e._fieldsArray[n]).map?r("this%s={}",d.safeProp(t.name)):t.repeated&&r("this%s=[]",d.safeProp(t.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){var r=new v(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var u=Object.keys(t.fields),c=0;c<u.length;++c)r.add((void 0!==t.fields[u[c]].keyType?o.fromJSON:a.fromJSON)(u[c],t.fields[u[c]]));if(t.oneofs)for(u=Object.keys(t.oneofs),c=0;c<u.length;++c)r.add(s.fromJSON(u[c],t.oneofs[u[c]]));if(t.nested)for(u=Object.keys(t.nested),c=0;c<u.length;++c){var h=t.nested[u[c]];r.add((void 0!==h.id?a.fromJSON:void 0!==h.fields?v.fromJSON:void 0!==h.values?i.fromJSON:void 0!==h.methods?l.fromJSON:n.fromJSON)(u[c],h))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},v.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return d.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"oneofs",n.arrayToJSON(this.oneofsArray,e),"fields",n.arrayToJSON(this.fieldsArray.filter(function(e){return!e.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},v.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolveAll.call(this);var e=this.oneofsArray;for(r=0;r<e.length;)e[r++].resolve();for(var t=this.fieldsArray,r=0;r<t.length;)t[r++].resolve();return this},v.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.oneofsArray.forEach(t=>{t._resolveFeatures(e)}),this.fieldsArray.forEach(t=>{t._resolveFeatures(e)})),this},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),b(this)}return e instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),b(this)):n.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof a&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),b(this)}if(e instanceof s){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),b(this)}return n.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return n.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return n.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=f(this)({Writer:h,types:t,util:d}),this.decode=p(this)({Reader:c,types:t,util:d}),this.verify=m(this)({types:t,util:d}),this.fromObject=g.fromObject(this)({types:t,util:d}),this.toObject=g.toObject(this)({types:t,util:d});var n=y[e];if(n){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=n.fromObject.bind(i),i.toObject=this.toObject,this.toObject=n.toObject.bind(i)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof c||(e=c.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){d.decorateType(t,e)}}},443963,(e,t,r)=>{"use strict";t.exports=h;var n,i,s,a=e.r(411615);((h.prototype=Object.create(a.prototype)).constructor=h).className="Root";var o=e.r(432240),l=e.r(215891),u=e.r(904216),c=e.r(516553);function h(e){a.call(this,"",e),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function d(){}h.fromJSON=function(e,t){return t||(t=new h),e.options&&t.setOptions(e.options),t.addJSON(e.nested).resolveAll()},h.prototype.resolvePath=c.path.resolve,h.prototype.fetch=c.fetch,h.prototype.load=function e(t,r,n){"function"==typeof r&&(n=r,r=void 0);var a=this;if(!n)return c.asPromise(e,a,t,r);var o=n===d;function l(e,t){if(n){if(o)throw e;t&&t.resolveAll();var r=n;n=null,r(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var r=e.substring(t);if(r in s)return r}return null}function h(e,t){try{if(c.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),c.isString(t)){i.filename=e;var n,s=i(t,a,r),h=0;if(s.imports)for(;h<s.imports.length;++h)(n=u(s.imports[h])||a.resolvePath(e,s.imports[h]))&&f(n);if(s.weakImports)for(h=0;h<s.weakImports.length;++h)(n=u(s.weakImports[h])||a.resolvePath(e,s.weakImports[h]))&&f(n,!0)}else a.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}o||p||l(null,a)}function f(e,t){if(e=u(e)||e,!(a.files.indexOf(e)>-1)){if(a.files.push(e),e in s)return void(o?h(e,s[e]):(++p,setTimeout(function(){--p,h(e,s[e])})));if(o){var r;try{r=c.fs.readFileSync(e).toString("utf8")}catch(e){t||l(e);return}h(e,r)}else++p,a.fetch(e,function(r,i){if(--p,n){if(r)return void(t?p||l(null,a):l(r));h(e,i)}})}}var p=0;c.isString(t)&&(t=[t]);for(var m,g=0;g<t.length;++g)(m=a.resolvePath("",t[g]))&&f(m);return o?a.resolveAll():p||l(null,a),a},h.prototype.loadSync=function(e,t){if(!c.isNode)throw Error("not supported");return this.load(e,t,d)},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return a.prototype.resolveAll.call(this)};var f=/^[A-Z]/;function p(e,t){var r=t.parent.lookup(t.extend);if(r){var n=new o(t.fullName,t.id,t.type,t.rule,void 0,t.options);return!!r.get(n.name)||(n.declaringField=t,t.extensionField=n,r.add(n),!0)}return!1}h.prototype._handleAdd=function(e){if(e instanceof o)void 0===e.extend||e.extensionField||p(this,e)||this.deferred.push(e);else if(e instanceof l)f.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof n)for(var t=0;t<this.deferred.length;)p(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);f.test(e.name)&&(e.parent[e.name]=e)}(e instanceof n||e instanceof l||e instanceof o)&&(this._fullyQualifiedObjects[e.fullName]=e)},h.prototype._handleRemove=function(e){if(e instanceof o){if(void 0!==e.extend)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof l)f.test(e.name)&&delete e.parent[e.name];else if(e instanceof a){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);f.test(e.name)&&delete e.parent[e.name]}delete this._fullyQualifiedObjects[e.fullName]},h._configure=function(e,t,r){n=e,i=t,s=r}},516553,(e,t,r)=>{"use strict";var n,i,s=t.exports=e.r(356727),a=e.r(78370);s.codegen=e.r(197388),s.fetch=e.r(195136),s.path=e.r(50476),s.fs=s.inquire("fs"),s.toArray=function(e){if(e){for(var t=Object.keys(e),r=Array(t.length),n=0;n<t.length;)r[n]=e[t[n++]];return r}return[]},s.toObject=function(e){for(var t={},r=0;r<e.length;){var n=e[r++],i=e[r++];void 0!==i&&(t[n]=i)}return t};var o=/\\/g,l=/"/g;s.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},s.safeProp=function(e){return!/^[$\w_]+$/.test(e)||s.isReserved(e)?'["'+e.replace(o,"\\\\").replace(l,'\\"')+'"]':"."+e},s.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;s.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,function(e,t){return t.toUpperCase()})},s.compareFieldsById=function(e,t){return e.id-t.id},s.decorateType=function(t,r){if(t.$type)return r&&t.$type.name!==r&&(s.decorateRoot.remove(t.$type),t.$type.name=r,s.decorateRoot.add(t.$type)),t.$type;n||(n=e.r(143306));var i=new n(r||t.name);return s.decorateRoot.add(i),i.ctor=t,Object.defineProperty(t,"$type",{value:i,enumerable:!1}),Object.defineProperty(t.prototype,"$type",{value:i,enumerable:!1}),i};var c=0;s.decorateEnum=function(t){if(t.$type)return t.$type;i||(i=e.r(215891));var r=new i("Enum"+c++,t);return s.decorateRoot.add(r),Object.defineProperty(t,"$type",{value:r,enumerable:!1}),r},s.setProperty=function(e,t,r,n){function i(e,t,r){var s=t.shift();if("__proto__"===s||"prototype"===s)return e;if(t.length>0)e[s]=i(e[s]||{},t,r);else{var a=e[s];if(a&&n)return e;a&&(r=[].concat(a).concat(r)),e[s]=r}return e}if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return i(e,t=t.split("."),r)},Object.defineProperty(s,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(e.r(443963)))}})},711826,(e,t,r)=>{"use strict";var n=r,i=e.r(516553),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(e,t){var r=0,n={};for(t|=0;r<e.length;)n[s[r+t]]=e[r++];return n}n.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),n.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),n.long=a([0,0,0,1,1],7),n.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),n.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},432240,(e,t,r)=>{"use strict";t.exports=u;var n,i=e.r(712688);((u.prototype=Object.create(i.prototype)).constructor=u).className="Field";var s=e.r(215891),a=e.r(711826),o=e.r(516553),l=/^required|optional|repeated$/;function u(e,t,r,n,s,u,c){if(o.isObject(n)?(c=s,u=n,n=s=void 0):o.isObject(s)&&(c=u,u=s,s=void 0),i.call(this,e,u),!o.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!o.isString(r))throw TypeError("type must be a string");if(void 0!==n&&!l.test(n=n.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!o.isString(s))throw TypeError("extend must be a string");"proto3_optional"===n&&(n="optional"),this.rule=n&&"optional"!==n?n:void 0,this.type=r,this.id=t,this.extend=s||void 0,this.repeated="repeated"===n,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!o.Long&&void 0!==a.long[r],this.bytes="bytes"===r,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=c}u.fromJSON=function(e,t){var r=new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment);return t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},Object.defineProperty(u.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(u.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(u.prototype,"delimited",{get:function(){return this.resolvedType instanceof n&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(u.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(u.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),u.prototype.setOption=function(e,t,r){return i.prototype.setOption.call(this,e,t,r)},u.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return o.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=a.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof n?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof s&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof s||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=o.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;o.base64.test(this.typeDefault)?o.base64.decode(this.typeDefault,e=o.newBuffer(o.base64.length(this.typeDefault)),0):o.utf8.write(this.typeDefault,e=o.newBuffer(o.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=o.emptyObject:this.repeated?this.defaultValue=o.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof n&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},u.prototype._inferLegacyProtoFeatures=function(e){if("proto2"!==e&&"proto3"!==e)return{};var t={};if("required"===this.rule&&(t.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===a.defaults[this.type]){var r=this.parent.get(this.type.split(".").pop());r&&r instanceof n&&r.group&&(t.message_encoding="DELIMITED")}return!0===this.getOption("packed")?t.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(t.repeated_field_encoding="EXPANDED"),t},u.prototype._resolveFeatures=function(e){return i.prototype._resolveFeatures.call(this,this._edition||e)},u.d=function(e,t,r,n){return"function"==typeof t?t=o.decorateType(t).name:t&&"object"==typeof t&&(t=o.decorateEnum(t).name),function(i,s){o.decorateType(i.constructor).add(new u(s,e,t,r,{default:n}))}},u._configure=function(e){n=e}},904216,(e,t,r)=>{"use strict";t.exports=a;var n=e.r(712688);((a.prototype=Object.create(n.prototype)).constructor=a).className="OneOf";var i=e.r(432240),s=e.r(516553);function a(e,t,r,i){if(Array.isArray(t)||(r=t,t=void 0),n.call(this,e,r),!(void 0===t||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function o(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,o(this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){n.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}o(this)},a.prototype.onRemove=function(e){for(var t,r=0;r<this.fieldsArray.length;++r)(t=this.fieldsArray[r]).parent&&t.parent.remove(t);n.prototype.onRemove.call(this,e)},Object.defineProperty(a.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var e=this.fieldsArray[0];return null!=e.options&&!0===e.options.proto3_optional}}),a.d=function(){for(var e=Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,r){s.decorateType(t.constructor).add(new a(r,e)),Object.defineProperty(t,r,{get:s.oneOfGetter(e),set:s.oneOfSetter(e)})}}},712688,(e,t,r)=>{"use strict";t.exports=u,u.className="ReflectionObject";let n=e.r(904216);var i,s=e.r(516553),a={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},o={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},l={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function u(e,t){if(!s.isString(e))throw TypeError("name must be a string");if(t&&!s.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(u.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),u.prototype.toJSON=function(){throw Error()},u.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof i&&t._handleAdd(this)},u.prototype.onRemove=function(e){var t=e.root;t instanceof i&&t._handleRemove(this),this.parent=null,this.resolved=!1},u.prototype.resolve=function(){return this.resolved||this.root instanceof i&&(this.resolved=!0),this},u.prototype._resolveFeaturesRecursive=function(e){return this._resolveFeatures(this._edition||e)},u.prototype._resolveFeatures=function(e){if(!this._featuresResolved){var t={};if(!e)throw Error("Unknown edition for "+this.fullName);var r=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(e));if(this._edition){if("proto2"===e)t=Object.assign({},o);else if("proto3"===e)t=Object.assign({},l);else if("2023"===e)t=Object.assign({},a);else throw Error("Unknown edition: "+e);this._features=Object.assign(t,r||{}),this._featuresResolved=!0;return}if(this.partOf instanceof n){var i=Object.assign({},this.partOf._features);this._features=Object.assign(i,r||{})}else if(this.declaringField);else if(this.parent){var s=Object.assign({},this.parent._features);this._features=Object.assign(s,r||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},u.prototype._inferLegacyProtoFeatures=function(){return{}},u.prototype.getOption=function(e){if(this.options)return this.options[e]},u.prototype.setOption=function(e,t,r){return this.options||(this.options={}),/^features\./.test(e)?s.setProperty(this.options,e,t,r):r&&void 0!==this.options[e]||(this.getOption(e)!==t&&(this.resolved=!1),this.options[e]=t),this},u.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var n=this.parsedOptions;if(r){var i=n.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)});if(i){var a=i[e];s.setProperty(a,r,t)}else(i={})[e]=s.setProperty({},r,t),n.push(i)}else{var o={};o[e]=t,n.push(o)}return this},u.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),n=0;n<r.length;++n)this.setOption(r[n],e[r[n]],t);return this},u.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},u.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},u._configure=function(e){i=e}},215891,(e,t,r)=>{"use strict";t.exports=a;var n=e.r(712688);((a.prototype=Object.create(n.prototype)).constructor=a).className="Enum";var i=e.r(411615),s=e.r(516553);function a(e,t,r,i,s,a){if(n.call(this,e,r),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=s||{},this.valuesOptions=a,this._valuesFeatures={},this.reserved=void 0,t)for(var o=Object.keys(t),l=0;l<o.length;++l)"number"==typeof t[o[l]]&&(this.valuesById[this.values[o[l]]=t[o[l]]]=o[l])}a.prototype._resolveFeatures=function(e){return e=this._edition||e,n.prototype._resolveFeatures.call(this,e),Object.keys(this.values).forEach(e=>{var t=Object.assign({},this._features);this._valuesFeatures[e]=Object.assign(t,this.valuesOptions&&this.valuesOptions[e]&&this.valuesOptions[e].features)}),this},a.fromJSON=function(e,t){var r=new a(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},a.prototype.add=function(e,t,r,n){if(!s.isString(e))throw TypeError("name must be a string");if(!s.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return n&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[e]=n||null),this.comments[e]=r||null,this},a.prototype.remove=function(e){if(!s.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},564617,(e,t,r)=>{"use strict";t.exports=o;var n=e.r(215891),i=e.r(711826),s=e.r(516553);function a(e,t,r,n){return t.delimited?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",r,n,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",r,n,(t.id<<3|2)>>>0)}function o(e){for(var t,r,o=s.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),l=e.fieldsArray.slice().sort(s.compareFieldsById),t=0;t<l.length;++t){var u=l[t].resolve(),c=e._fieldsArray.indexOf(u),h=u.resolvedType instanceof n?"int32":u.type,d=i.basic[h];r="m"+s.safeProp(u.name),u.map?(o("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),void 0===d?o("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",c,r):o(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|d,h,r),o("}")("}")):u.repeated?(o("if(%s!=null&&%s.length){",r,r),u.packed&&void 0!==i.packed[h]?o("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",h,r)("w.ldelim()"):(o("for(var i=0;i<%s.length;++i)",r),void 0===d?a(o,u,c,r+"[i]"):o("w.uint32(%i).%s(%s[i])",(u.id<<3|d)>>>0,h,r)),o("}")):(u.optional&&o("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,u.name),void 0===d?a(o,u,c,r):o("w.uint32(%i).%s(%s)",(u.id<<3|d)>>>0,h,r))}return o("return w")}},509276,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(676978);(s.prototype=Object.create(n.prototype)).constructor=s;var i=e.r(356727);function s(){n.call(this)}function a(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},s._configure()},411598,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(962638);(s.prototype=Object.create(n.prototype)).constructor=s;var i=e.r(356727);function s(e){n.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},947160,(e,t,r)=>{"use strict";var n=r;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=e.r(676978),n.BufferWriter=e.r(509276),n.Reader=e.r(962638),n.BufferReader=e.r(411598),n.util=e.r(356727),n.rpc=e.r(830036),n.roots=e.r(78370),n.configure=i,i()},809137,(e,t,r)=>{"use strict";var n=t.exports=e.r(947160);function i(e,t,r){return"function"==typeof t?(r=t,t=new n.Root):t||(t=new n.Root),t.load(e,r)}function s(e,t){return t||(t=new n.Root),t.loadSync(e)}n.build="light",n.load=i,n.loadSync=s,n.encoder=e.r(564617),n.decoder=e.r(235616),n.verifier=e.r(74211),n.converter=e.r(666516),n.ReflectionObject=e.r(712688),n.Namespace=e.r(411615),n.Root=e.r(443963),n.Enum=e.r(215891),n.Type=e.r(143306),n.Field=e.r(432240),n.OneOf=e.r(904216),n.MapField=e.r(481498),n.Service=e.r(712184),n.Method=e.r(124051),n.Message=e.r(505560),n.wrappers=e.r(478288),n.types=e.r(711826),n.util=e.r(516553),n.ReflectionObject._configure(n.Root),n.Namespace._configure(n.Type,n.Service,n.Enum),n.Root._configure(n.Type),n.Field._configure(n.Type)},144551,(e,t,r)=>{"use strict";t.exports=f;var n=/[\s{}=;:[\],'"()<>]/g,i=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,s=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,a=/^ *[*/]+ */,o=/^\s*\*?\/*/,l=/\n/g,u=/\s/,c=/\\(.?)/g,h={0:"\0",r:"\r",n:"\n",t:"	"};function d(e){return e.replace(c,function(e,t){switch(t){case"\\":case"":return t;default:return h[t]||""}})}function f(e,t){e=e.toString();var r=0,c=e.length,h=1,f=0,p={},m=[],g=null;function y(e){return Error("illegal "+e+" (line "+h+")")}function v(){var t="'"===g?s:i;t.lastIndex=r-1;var n=t.exec(e);if(!n)throw y("string");return r=t.lastIndex,E(g),g=null,d(n[1])}function b(t){return e.charAt(t)}function S(r,n,i){var s,u={type:e.charAt(r++),lineEmpty:!1,leading:i},c=r-(t?2:3);do if(--c<0||"\n"===(s=e.charAt(c))){u.lineEmpty=!0;break}while(" "===s||"	"===s)for(var d=e.substring(r,n).split(l),m=0;m<d.length;++m)d[m]=d[m].replace(t?o:a,"").trim();u.text=d.join("\n").trim(),p[h]=u,f=h}function w(t){var r=C(t),n=e.substring(t,r);return/^\s*\/\//.test(n)}function C(e){for(var t=e;t<c&&"\n"!==b(t);)t++;return t}function T(){if(m.length>0)return m.shift();if(g)return v();var i,s,a,o,l,d=0===r;do{if(r===c)return null;for(i=!1;u.test(a=b(r));)if("\n"===a&&(d=!0,++h),++r===c)return null;if("/"===b(r)){if(++r===c)throw y("comment");if("/"===b(r))if(t){if(o=r,l=!1,w(r-1)){l=!0;do if((r=C(r))===c||(r++,!d))break;while(w(r))}else r=Math.min(c,C(r)+1);l&&(S(o,r,d),d=!0),h++,i=!0}else{for(l="/"===b(o=r+1);"\n"!==b(++r);)if(r===c)return null;++r,l&&(S(o,r-1,d),d=!0),++h,i=!0}else{if("*"!==(a=b(r)))return"/";o=r+1,l=t||"*"===b(o);do{if("\n"===a&&++h,++r===c)throw y("comment");s=a,a=b(r)}while("*"!==s||"/"!==a)++r,l&&(S(o,r-2,d),d=!0),i=!0}}}while(i)var f=r;if(n.lastIndex=0,!n.test(b(f++)))for(;f<c&&!n.test(b(f));)++f;var p=e.substring(r,r=f);return('"'===p||"'"===p)&&(g=p),p}function E(e){m.push(e)}function _(){if(!m.length){var e=T();if(null===e)return null;E(e)}return m[0]}function I(e,t){var r=_();if(r===e)return T(),!0;if(!t)throw y("token '"+r+"', '"+e+"' expected");return!1}function k(e){var r,n=null;return void 0===e?(r=p[h-1],delete p[h-1],r&&(t||"*"===r.type||r.lineEmpty)&&(n=r.leading?r.text:null)):(f<e&&_(),r=p[e],delete p[e],r&&!r.lineEmpty&&(t||"/"===r.type)&&(n=r.leading?null:r.text)),n}return Object.defineProperty({next:T,peek:_,push:E,skip:I,cmnt:k},"line",{get:function(){return h}})}f.unescape=d},654157,(e,t,r)=>{"use strict";t.exports=E,E.filename=null,E.defaults={keepCase:!1};var n=e.r(144551),i=e.r(443963),s=e.r(143306),a=e.r(432240),o=e.r(481498),l=e.r(904216),u=e.r(215891),c=e.r(712184),h=e.r(124051),d=e.r(712688),f=e.r(711826),p=e.r(516553),m=/^[1-9][0-9]*$/,g=/^-?[1-9][0-9]*$/,y=/^0[x][0-9a-fA-F]+$/,v=/^-?0[x][0-9a-fA-F]+$/,b=/^0[0-7]+$/,S=/^-?0[0-7]+$/,w=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,C=/^[a-zA-Z_][a-zA-Z_0-9]*$/,T=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function E(e,t,r){t instanceof i||(r=t,t=new i),r||(r=E.defaults);var _,I,k,x,R=r.preferTrailingComment||!1,D=n(e,r.alternateCommentMode||!1),A=D.next,O=D.push,N=D.peek,P=D.skip,M=D.cmnt,L=!0,B="proto2",F=t,j=[],V={},q=r.keepCase?function(e){return e}:p.camelCase;function z(){j.forEach(e=>{e._edition=B,Object.keys(V).forEach(t=>{void 0===e.getOption(t)&&e.setOption(t,V[t],!0)})})}function U(e,t,r){var n=E.filename;return r||(E.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(n?n+", ":"")+"line "+D.line+")")}function $(){var e,t=[];do{if('"'!==(e=A())&&"'"!==e)throw U(e);t.push(A()),P(e),e=N()}while('"'===e||"'"===e)return t.join("")}function K(e){var t=A();switch(t){case"'":case'"':return O(t),$();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return G(t,!0)}catch(r){if(e&&T.test(t))return t;throw U(t,"value")}}function W(e,t){do if(t&&('"'===(r=N())||"'"===r)){var r,n,i=$();if(e.push(i),B>=2023)throw U(i,"id")}else try{e.push([n=H(A()),P("to",!0)?H(A()):n])}catch(n){if(t&&T.test(r)&&B>=2023)e.push(r);else throw n}while(P(",",!0))var s={options:void 0};s.setOption=function(e,t){void 0===this.options&&(this.options={}),this.options[e]=t},ee(s,function(e){if("option"===e)el(s,e),P(";");else throw U(e)},function(){ed(s)})}function G(e,t){var r=1;switch("-"===e.charAt(0)&&(r=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return 1/0*r;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(m.test(e))return r*parseInt(e,10);if(y.test(e))return r*parseInt(e,16);if(b.test(e))return r*parseInt(e,8);if(w.test(e))return r*parseFloat(e);throw U(e,"number",t)}function H(e,t){switch(e){case"max":case"MAX":case"Max":return 0x1fffffff;case"0":return 0}if(!t&&"-"===e.charAt(0))throw U(e,"id");if(g.test(e))return parseInt(e,10);if(v.test(e))return parseInt(e,16);if(S.test(e))return parseInt(e,8);throw U(e,"id")}function Q(){if(void 0!==I)throw U("package");if(I=A(),!T.test(I))throw U(I,"name");F=F.define(I),P(";")}function J(){var e,t=N();switch(t){case"weak":e=x||(x=[]),A();break;case"public":A();default:e=k||(k=[])}t=$(),P(";"),e.push(t)}function Y(){if(P("="),(B=$())<2023)throw U(B,"syntax");P(";")}function X(){if(P("="),!["2023"].includes(B=$()))throw U(B,"edition");P(";")}function Z(e,t){switch(t){case"option":return el(e,t),P(";"),!0;case"message":return et(e,t),!0;case"enum":return ea(e,t),!0;case"service":return ef(e,t),!0;case"extend":return em(e,t),!0}return!1}function ee(e,t,r){var n,i=D.line;if(e&&("string"!=typeof e.comment&&(e.comment=M()),e.filename=E.filename),P("{",!0)){for(;"}"!==(n=A());)t(n);P(";",!0)}else r&&r(),P(";"),e&&("string"!=typeof e.comment||R)&&(e.comment=M(i)||e.comment)}function et(e,t){if(!C.test(t=A()))throw U(t,"type name");var r=new s(t);ee(r,function(e){if(!Z(r,e))switch(e){case"map":ei(r,e);break;case"required":if("proto2"!==B)throw U(e);case"repeated":er(r,e);break;case"optional":if("proto3"===B)er(r,"proto3_optional");else if("proto2"!==B)throw U(e);else er(r,"optional");break;case"oneof":es(r,e);break;case"extensions":W(r.extensions||(r.extensions=[]));break;case"reserved":W(r.reserved||(r.reserved=[]),!0);break;default:if("proto2"===B||!T.test(e))throw U(e);O(e),er(r,"optional")}}),e.add(r),e===F&&j.push(r)}function er(e,t,r){var n=A();if("group"===n)return void en(e,t);for(;n.endsWith(".")||N().startsWith(".");)n+=A();if(!T.test(n))throw U(n,"type");var i=A();if(!C.test(i))throw U(i,"name");i=q(i),P("=");var s=new a(i,H(A()),n,t,r);if(ee(s,function(e){if("option"===e)el(s,e),P(";");else throw U(e)},function(){ed(s)}),"proto3_optional"===t){var o=new l("_"+i);s.setOption("proto3_optional",!0),o.add(s),e.add(o)}else e.add(s);e===F&&j.push(s)}function en(e,t){if(B>=2023)throw U("group");var r=A();if(!C.test(r))throw U(r,"name");var n=p.lcFirst(r);r===n&&(r=p.ucFirst(r)),P("=");var i=H(A()),o=new s(r);o.group=!0;var l=new a(n,i,r,t);l.filename=E.filename,ee(o,function(e){switch(e){case"option":el(o,e),P(";");break;case"required":case"repeated":er(o,e);break;case"optional":"proto3"===B?er(o,"proto3_optional"):er(o,"optional");break;case"message":et(o,e);break;case"enum":ea(o,e);break;case"reserved":W(o.reserved||(o.reserved=[]),!0);break;default:throw U(e)}}),e.add(o).add(l)}function ei(e){P("<");var t=A();if(void 0===f.mapKey[t])throw U(t,"type");P(",");var r=A();if(!T.test(r))throw U(r,"type");P(">");var n=A();if(!C.test(n))throw U(n,"name");P("=");var i=new o(q(n),H(A()),t,r);ee(i,function(e){if("option"===e)el(i,e),P(";");else throw U(e)},function(){ed(i)}),e.add(i)}function es(e,t){if(!C.test(t=A()))throw U(t,"name");var r=new l(q(t));ee(r,function(e){"option"===e?(el(r,e),P(";")):(O(e),er(r,"optional"))}),e.add(r)}function ea(e,t){if(!C.test(t=A()))throw U(t,"name");var r=new u(t);ee(r,function(e){switch(e){case"option":el(r,e),P(";");break;case"reserved":W(r.reserved||(r.reserved=[]),!0),void 0===r.reserved&&(r.reserved=[]);break;default:eo(r,e)}}),e.add(r),e===F&&j.push(r)}function eo(e,t){if(!C.test(t))throw U(t,"name");P("=");var r=H(A(),!0),n={options:void 0};n.getOption=function(e){return this.options[e]},n.setOption=function(e,t){d.prototype.setOption.call(n,e,t)},n.setParsedOption=function(){},ee(n,function(e){if("option"===e)el(n,e),P(";");else throw U(e)},function(){ed(n)}),e.add(t,r,n.comment,n.parsedOptions||n.options)}function el(e,t){var r,n,i=!0;for("option"===t&&(t=A());"="!==t;){if("("===t){var s=A();P(")"),t="("+s+")"}if(i){if(i=!1,t.includes(".")&&!t.includes("(")){var a=t.split(".");r=a[0]+".",t=a[1];continue}r=t}else n=n?n+=t:t;t=A()}var o=eu(e,n?r.concat(n):r);n=n&&"."===n[0]?n.slice(1):n,eh(e,r=r&&"."===r[r.length-1]?r.slice(0,-1):r,o,n)}function eu(e,t){if(P("{",!0)){for(var r={};!P("}",!0);){if(!C.test(_=A()))throw U(_,"name");if(null===_)throw U(_,"end of input");var n,i,s=_;if(P(":",!0),"{"===N())n=eu(e,t+"."+_);else if("["===N()){if(n=[],P("[",!0)){do i=K(!0),n.push(i);while(P(",",!0))P("]"),void 0!==i&&ec(e,t+"."+_,i)}}else n=K(!0),ec(e,t+"."+_,n);var a=r[s];a&&(n=[].concat(a).concat(n)),r[s]=n,P(",",!0),P(";",!0)}return r}var o=K(!0);return ec(e,t,o),o}function ec(e,t,r){if(F===e&&/^features\./.test(t)){V[t]=r;return}e.setOption&&e.setOption(t,r)}function eh(e,t,r,n){e.setParsedOption&&e.setParsedOption(t,r,n)}function ed(e){if(P("[",!0)){do el(e,"option");while(P(",",!0))P("]")}return e}function ef(e,t){if(!C.test(t=A()))throw U(t,"service name");var r=new c(t);ee(r,function(e){if(!Z(r,e))if("rpc"===e)ep(r,e);else throw U(e)}),e.add(r),e===F&&j.push(r)}function ep(e,t){var r=M(),n=t;if(!C.test(t=A()))throw U(t,"name");var i,s,a,o,l=t;if(P("("),P("stream",!0)&&(s=!0),!T.test(t=A())||(i=t,P(")"),P("returns"),P("("),P("stream",!0)&&(o=!0),!T.test(t=A())))throw U(t);a=t,P(")");var u=new h(l,n,i,a,s,o);u.comment=r,ee(u,function(e){if("option"===e)el(u,e),P(";");else throw U(e)}),e.add(u)}function em(e,t){if(!T.test(t=A()))throw U(t,"reference");var r=t;ee(null,function(t){switch(t){case"required":case"repeated":er(e,t,r);break;case"optional":"proto3"===B?er(e,"proto3_optional",r):er(e,"optional",r);break;default:if("proto2"===B||!T.test(t))throw U(t);O(t),er(e,"optional",r)}})}for(;null!==(_=A());)switch(_){case"package":if(!L)throw U(_);Q();break;case"import":if(!L)throw U(_);J();break;case"syntax":if(!L)throw U(_);Y();break;case"edition":if(!L)throw U(_);X();break;case"option":el(F,_),P(";",!0);break;default:if(Z(F,_)){L=!1;continue}throw U(_)}return z(),E.filename=null,{package:I,imports:k,weakImports:x,root:t}}},267463,(e,t,r)=>{"use strict";t.exports=s;var n,i=/\/|\./;function s(e,t){i.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),s[e]=t}s("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),s("duration",{Duration:n={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),s("timestamp",{Timestamp:n}),s("empty",{Empty:{fields:{}}}),s("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),s("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),s("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),s.get=function(e){return s[e]||null}},713216,(e,t,r)=>{"use strict";var n=t.exports=e.r(809137);n.build="full",n.tokenize=e.r(144551),n.parse=e.r(654157),n.common=e.r(267463),n.Root._configure(n.Type,n.parse,n.common)},68645,(e,t,r)=>{"use strict";t.exports=e.r(713216)},257828,(e,t,r)=>{"use strict";var n=e.r(68645);t.exports=r=n.descriptor=n.Root.fromJSON(e.r(8630)).lookup(".google.protobuf");var i=n.Namespace,s=n.Root,a=n.Enum,o=n.Type,l=n.Field,u=n.MapField,c=n.OneOf,h=n.Service,d=n.Method;function f(e,t,n){var u=r.FileDescriptorProto.create({name:e.filename||(e.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});D(n,u),e instanceof s||(u.package=e.fullName.substring(1));for(var c,d=0;d<e.nestedArray.length;++d)(c=e._nestedArray[d])instanceof o?u.messageType.push(c.toDescriptor(n)):c instanceof a?u.enumType.push(c.toDescriptor()):c instanceof l?u.extension.push(c.toDescriptor(n)):c instanceof h?u.service.push(c.toDescriptor()):c instanceof i&&f(c,t,n);u.options=I(e.options,r.FileOptions),u.messageType.length+u.enumType.length+u.extension.length+u.service.length&&t.push(u)}s.fromDescriptor=function(e){"number"==typeof e.length&&(e=r.FileDescriptorSet.decode(e));var t=new s;if(e.file)for(var n,i,u,c=0;c<e.file.length;++c){i=t,(n=e.file[c]).package&&n.package.length&&(i=t.define(n.package));var d=R(n);if(n.name&&n.name.length&&t.files.push(i.filename=n.name),n.messageType)for(u=0;u<n.messageType.length;++u)i.add(o.fromDescriptor(n.messageType[u],d));if(n.enumType)for(u=0;u<n.enumType.length;++u)i.add(a.fromDescriptor(n.enumType[u],d));if(n.extension)for(u=0;u<n.extension.length;++u)i.add(l.fromDescriptor(n.extension[u],d));if(n.service)for(u=0;u<n.service.length;++u)i.add(h.fromDescriptor(n.service[u],d));var f=E(n.options,r.FileOptions);if(f){var p=Object.keys(f);for(u=0;u<p.length;++u)i.setOption(p[u],f[p[u]])}}return t.resolveAll()},s.prototype.toDescriptor=function(e){var t=r.FileDescriptorSet.create();return f(this,t.file,e),t};var p=0;o.fromDescriptor=function(e,t,n){"number"==typeof e.length&&(e=r.DescriptorProto.decode(e));var i,s=new o(e.name.length?e.name:"Type"+p++,E(e.options,r.MessageOptions));if(n||(s._edition=t),e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)s.add(c.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var u=l.fromDescriptor(e.field[i],t,!0);s.add(u),e.field[i].hasOwnProperty("oneofIndex")&&s.oneofsArray[e.field[i].oneofIndex].add(u)}if(e.extension)for(i=0;i<e.extension.length;++i)s.add(l.fromDescriptor(e.extension[i],t,!0));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)s.add(o.fromDescriptor(e.nestedType[i],t,!0)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&s.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)s.add(a.fromDescriptor(e.enumType[i],t,!0));if(e.extensionRange&&e.extensionRange.length)for(i=0,s.extensions=[];i<e.extensionRange.length;++i)s.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(s.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)s.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)s.reserved.push(e.reservedName[i])}return s},o.prototype.toDescriptor=function(e){var t,n,i=r.DescriptorProto.create({name:this.name});for(n=0;n<this.fieldsArray.length;++n)if(i.field.push(t=this._fieldsArray[n].toDescriptor(e)),this._fieldsArray[n]instanceof u){var s=C(this._fieldsArray[n].keyType,this._fieldsArray[n].resolvedKeyType,!1),c=C(this._fieldsArray[n].type,this._fieldsArray[n].resolvedType,!1),h=11===c||14===c?this._fieldsArray[n].resolvedType&&k(this.parent,this._fieldsArray[n].resolvedType)||this._fieldsArray[n].type:void 0;i.nestedType.push(r.DescriptorProto.create({name:t.typeName,field:[r.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),r.FieldDescriptorProto.create({name:"value",number:2,label:1,type:c,typeName:h})],options:r.MessageOptions.create({mapEntry:!0})}))}for(n=0;n<this.oneofsArray.length;++n)i.oneofDecl.push(this._oneofsArray[n].toDescriptor());for(n=0;n<this.nestedArray.length;++n)this._nestedArray[n]instanceof l?i.field.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof o?i.nestedType.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof a&&i.enumType.push(this._nestedArray[n].toDescriptor());if(this.extensions)for(n=0;n<this.extensions.length;++n)i.extensionRange.push(r.DescriptorProto.ExtensionRange.create({start:this.extensions[n][0],end:this.extensions[n][1]}));if(this.reserved)for(n=0;n<this.reserved.length;++n)"string"==typeof this.reserved[n]?i.reservedName.push(this.reserved[n]):i.reservedRange.push(r.DescriptorProto.ReservedRange.create({start:this.reserved[n][0],end:this.reserved[n][1]}));return i.options=I(this.options,r.MessageOptions),i};var m=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(e,t,n){if("number"==typeof e.length&&(e=r.DescriptorProto.decode(e)),"number"!=typeof e.number)throw Error("missing field id");switch(i=e.typeName&&e.typeName.length?e.typeName:S(e.type),e.label){case 1:s=void 0;break;case 2:s="required";break;case 3:s="repeated";break;default:throw Error("illegal label: "+e.label)}var i,s,a=e.extendee;void 0!==e.extendee&&(a=a.length?a:void 0);var o=new l(e.name.length?e.name:"field"+e.number,e.number,i,s,a);if(n||(o._edition=t),o.options=E(e.options,r.FieldOptions),e.proto3_optional&&(o.options.proto3_optional=!0),e.defaultValue&&e.defaultValue.length){var u=e.defaultValue;switch(u){case"true":case"TRUE":u=!0;break;case"false":case"FALSE":u=!1;break;default:m.exec(u)&&(u=parseInt(u))}o.setOption("default",u)}return w(e.type)&&("proto3"===t?e.options&&!e.options.packed&&o.setOption("packed",!1):(!t||"proto2"===t)&&e.options&&e.options.packed&&o.setOption("packed",!0)),o},l.prototype.toDescriptor=function(e){var t=r.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=n.util.ucFirst(this.name),t.label=3;else{switch(t.type=C(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:t.typeName=this.resolvedType?k(this.parent,this.resolvedType):this.type}"repeated"===this.rule?t.label=3:this.required&&"proto2"===e?t.label=2:t.label=1}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=I(this.options,r.FieldOptions),null!=this.options.default&&(t.defaultValue=String(this.options.default)),this.options.proto3_optional&&(t.proto3_optional=!0)),"proto3"===e?this.packed||((t.options||(t.options=r.FieldOptions.create())).packed=!1):(!e||"proto2"===e)&&this.packed&&((t.options||(t.options=r.FieldOptions.create())).packed=!0),t};var g=0;a.fromDescriptor=function(e,t,n){"number"==typeof e.length&&(e=r.EnumDescriptorProto.decode(e));var i={};if(e.value)for(var s=0;s<e.value.length;++s){var o=e.value[s].name,l=e.value[s].number||0;i[o&&o.length?o:"NAME"+l]=l}var u=new a(e.name&&e.name.length?e.name:"Enum"+g++,i,E(e.options,r.EnumOptions));return n||(u._edition=t),u},a.prototype.toDescriptor=function(){for(var e=[],t=0,n=Object.keys(this.values);t<n.length;++t)e.push(r.EnumValueDescriptorProto.create({name:n[t],number:this.values[n[t]]}));return r.EnumDescriptorProto.create({name:this.name,value:e,options:I(this.options,r.EnumOptions)})};var y=0;c.fromDescriptor=function(e){return"number"==typeof e.length&&(e=r.OneofDescriptorProto.decode(e)),new c(e.name&&e.name.length?e.name:"oneof"+y++)},c.prototype.toDescriptor=function(){return r.OneofDescriptorProto.create({name:this.name})};var v=0;h.fromDescriptor=function(e,t,n){"number"==typeof e.length&&(e=r.ServiceDescriptorProto.decode(e));var i=new h(e.name&&e.name.length?e.name:"Service"+v++,E(e.options,r.ServiceOptions));if(n||(i._edition=t),e.method)for(var s=0;s<e.method.length;++s)i.add(d.fromDescriptor(e.method[s]));return i},h.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return r.ServiceDescriptorProto.create({name:this.name,method:e,options:I(this.options,r.ServiceOptions)})};var b=0;function S(e){switch(e){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+e)}function w(e){switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function C(e,t,r){switch(e){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(t instanceof a)return 14;if(t instanceof o)return r?10:11;throw Error("illegal type: "+e)}function T(e,t){for(var r,n,i={},s=0;s<t.fieldsArray.length;++s)if("uninterpretedOption"!==(n=(r=t._fieldsArray[s]).name)&&Object.prototype.hasOwnProperty.call(e,n)){var l=x(n);r.resolvedType instanceof o?i[l]=T(e[n],r.resolvedType):r.resolvedType instanceof a?i[l]=r.resolvedType.valuesById[e[n]]:i[l]=e[n]}return i}function E(e,t){if(e)return T(t.toObject(e),t)}function _(e,t){for(var r={},i=Object.keys(e),s=0;s<i.length;++s){var a=i[s],l=n.util.camelCase(a);if(Object.prototype.hasOwnProperty.call(t.fields,l)){var u=t.fields[l];u.resolvedType instanceof o?r[l]=_(e[a],u.resolvedType):r[l]=e[a],u.repeated&&!Array.isArray(r[l])&&(r[l]=[r[l]])}}return r}function I(e,t){if(e)return t.fromObject(_(e,t))}function k(e,t){var r=e.fullName.split("."),n=t.fullName.split("."),a=0,o=0,l=n.length-1;if(!(e instanceof s)&&t instanceof i)for(;a<r.length&&o<l&&r[a]===n[o];){var u=t.lookup(r[a++],!0);if(null!==u&&u!==t)break;++o}else for(;a<r.length&&o<l&&r[a]===n[o];++a,++o);return n.slice(o).join(".")}function x(e){return e.substring(0,1)+e.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}function R(e){if("editions"===e.syntax)if(e.edition===r.Edition.EDITION_2023)return"2023";else throw Error("Unsupported edition "+e.edition);return"proto3"===e.syntax?"proto3":"proto2"}function D(e,t){if(e)if("proto2"===e||"proto3"===e)t.syntax=e;else if(t.syntax="editions","2023"===e)t.edition=r.Edition.EDITION_2023;else throw Error("Unsupported edition "+e)}d.fromDescriptor=function(e){return"number"==typeof e.length&&(e=r.MethodDescriptorProto.decode(e)),new d(e.name&&e.name.length?e.name:"Method"+b++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,E(e.options,r.MethodOptions))},d.prototype.toDescriptor=function(){return r.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:I(this.options,r.MethodOptions)})}},662303,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addCommonProtos=r.loadProtosWithOptionsSync=r.loadProtosWithOptions=void 0;let n=e.r(522734),i=e.r(814747),s=e.r(68645);function a(e,t){let r=e.resolvePath;e.resolvePath=(e,s)=>{if(i.isAbsolute(s))return s;for(let e of t){let t=i.join(e,s);try{return n.accessSync(t,n.constants.R_OK),t}catch(e){continue}}return process.emitWarning(`${s} not found in any of the include paths ${t}`),r(e,s)}}r.loadProtosWithOptions=async function(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));a(r,t.includeDirs)}let n=await r.load(e,t);return n.resolveAll(),n},r.loadProtosWithOptionsSync=function(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))throw Error("The includeDirs option must be an array");a(r,t.includeDirs)}let n=r.loadSync(e,t);return n.resolveAll(),n},r.addCommonProtos=function(){let t=e.r(282813),r=e.r(8630),n=e.r(724453),i=e.r(352708);s.common("api",t.nested.google.nested.protobuf.nested),s.common("descriptor",r.nested.google.nested.protobuf.nested),s.common("source_context",n.nested.google.nested.protobuf.nested),s.common("type",i.nested.google.nested.protobuf.nested)}},858231,(e,t,r)=>{!function(n,i){function s(e){return e.default||e}if("function"==typeof define&&define.amd){let t;void 0!==(t=function(){var e={};return i(e),s(e)}())&&e.v(t)}else i(r),t.exports=s(r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:e.e,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function r(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function n(e){return!0===(e&&e.__isLong__)}function i(e){var t=Math.clz32(e&-e);return e?31-t:t}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=n;var s={},a={};function o(e,t){var r,n,i;if(t)return(e>>>=0,(i=0<=e&&e<256)&&(n=a[e]))?n:(r=u(e,0,!0),i&&(a[e]=r),r);return(e|=0,(i=-128<=e&&e<128)&&(n=s[e]))?n:(r=u(e,e<0?-1:0,!1),i&&(s[e]=r),r)}function l(e,t){if(isNaN(e))return t?v:y;if(t){if(e<0)return v;if(e>=p)return T}else{if(e<=-m)return E;if(e+1>=m)return C}return e<0?l(-e,t).neg():u(e%f|0,e/f|0,t)}function u(e,t,n){return new r(e,t,n)}r.fromInt=o,r.fromNumber=l,r.fromBits=u;var c=Math.pow;function h(e,t,r){if(0===e.length)throw Error("empty string");if("number"==typeof t?(r=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?v:y;if((r=r||10)<2||36<r)throw RangeError("radix");if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return h(e.substring(1),t,r).neg();for(var n,i=l(c(r,8)),s=y,a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),u=parseInt(e.substring(a,a+o),r);if(o<8){var d=l(c(r,o));s=s.mul(d).add(l(u))}else s=(s=s.mul(i)).add(l(u))}return s.unsigned=t,s}function d(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?h(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=h,r.fromValue=d;var f=0x100000000,p=0xffffffffffffffff,m=0x8000000000000000,g=o(0x1000000),y=o(0);r.ZERO=y;var v=o(0,!0);r.UZERO=v;var b=o(1);r.ONE=b;var S=o(1,!0);r.UONE=S;var w=o(-1);r.NEG_ONE=w;var C=u(-1,0x7fffffff,!1);r.MAX_VALUE=C;var T=u(-1,-1,!0);r.MAX_UNSIGNED_VALUE=T;var E=u(0,-0x80000000,!1);r.MIN_VALUE=E;var _=r.prototype;_.toInt=function(){return this.unsigned?this.low>>>0:this.low},_.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},_.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(!this.eq(E))return"-"+this.neg().toString(e);else{var t=l(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}for(var i=l(c(e,6),this.unsigned),s=this,a="";;){var o=s.div(i),u=(s.sub(o.mul(i)).toInt()>>>0).toString(e);if((s=o).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},_.getHighBits=function(){return this.high},_.getHighBitsUnsigned=function(){return this.high>>>0},_.getLowBits=function(){return this.low},_.getLowBitsUnsigned=function(){return this.low>>>0},_.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},_.isSafeInteger=function(){var e=this.high>>21;return!e||!this.unsigned&&-1===e&&(0!==this.low||-2097152!==this.high)},_.isZero=function(){return 0===this.high&&0===this.low},_.eqz=_.isZero,_.isNegative=function(){return!this.unsigned&&this.high<0},_.isPositive=function(){return this.unsigned||this.high>=0},_.isOdd=function(){return(1&this.low)==1},_.isEven=function(){return(1&this.low)==0},_.equals=function(e){return n(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},_.eq=_.equals,_.notEquals=function(e){return!this.eq(e)},_.neq=_.notEquals,_.ne=_.notEquals,_.lessThan=function(e){return 0>this.comp(e)},_.lt=_.lessThan,_.lessThanOrEqual=function(e){return 0>=this.comp(e)},_.lte=_.lessThanOrEqual,_.le=_.lessThanOrEqual,_.greaterThan=function(e){return this.comp(e)>0},_.gt=_.greaterThan,_.greaterThanOrEqual=function(e){return this.comp(e)>=0},_.gte=_.greaterThanOrEqual,_.ge=_.greaterThanOrEqual,_.compare=function(e){if(n(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},_.comp=_.compare,_.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(b)},_.neg=_.negate,_.add=function(e){n(e)||(e=d(e));var t,r,i=this.high>>>16,s=65535&this.high,a=this.low>>>16,o=65535&this.low,l=e.high>>>16,c=65535&e.high,h=e.low>>>16,f=65535&e.low,p=0,m=0;return t=0+((r=0+(o+f))>>>16),r&=65535,t+=a+h,m+=t>>>16,t&=65535,m+=s+c,p+=m>>>16,m&=65535,p+=i+l,u(t<<16|r,(p&=65535)<<16|m,this.unsigned)},_.subtract=function(e){return n(e)||(e=d(e)),this.add(e.neg())},_.sub=_.subtract,_.multiply=function(e){if(this.isZero())return this;if(n(e)||(e=d(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?v:y;if(this.eq(E))return e.isOdd()?E:y;if(e.eq(E))return this.isOdd()?E:y;if(this.isNegative())if(e.isNegative())return this.neg().mul(e.neg());else return this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return l(this.toNumber()*e.toNumber(),this.unsigned);var r,i,s=this.high>>>16,a=65535&this.high,o=this.low>>>16,c=65535&this.low,h=e.high>>>16,f=65535&e.high,p=e.low>>>16,m=65535&e.low,b=0,S=0;return r=0+((i=0+c*m)>>>16),i&=65535,r+=o*m,S+=r>>>16,r&=65535,r+=c*p,S+=r>>>16,r&=65535,S+=a*m,b+=S>>>16,S&=65535,S+=o*p,b+=S>>>16,S&=65535,S+=c*f,b+=S>>>16,S&=65535,b+=s*m+a*p+o*f+c*h,u(r<<16|i,(b&=65535)<<16|S,this.unsigned)},_.mul=_.multiply,_.divide=function(e){if(n(e)||(e=d(e)),e.isZero())throw Error("division by zero");if(t){var r,i,s;return this.unsigned||-0x80000000!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return S;s=v}else{if(this.eq(E))if(e.eq(b)||e.eq(w))return E;else return e.eq(E)?b:(r=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?b:w:(i=this.sub(e.mul(r)),s=r.add(i.div(e)));if(e.eq(E))return this.unsigned?v:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=y}for(i=this;i.gte(e);){for(var a=Math.ceil(Math.log(r=Math.max(1,Math.floor(i.toNumber()/e.toNumber())))/Math.LN2),o=a<=48?1:c(2,a-48),h=l(r),f=h.mul(e);f.isNegative()||f.gt(i);)r-=o,f=(h=l(r,this.unsigned)).mul(e);h.isZero()&&(h=b),s=s.add(h),i=i.sub(f)}return s},_.div=_.divide,_.modulo=function(e){return(n(e)||(e=d(e)),t)?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},_.mod=_.modulo,_.rem=_.modulo,_.not=function(){return u(~this.low,~this.high,this.unsigned)},_.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},_.clz=_.countLeadingZeros,_.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},_.ctz=_.countTrailingZeros,_.and=function(e){return n(e)||(e=d(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},_.or=function(e){return n(e)||(e=d(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},_.xor=function(e){return n(e)||(e=d(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},_.shiftLeft=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},_.shl=_.shiftLeft,_.shiftRight=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},_.shr=_.shiftRight,_.shiftRightUnsigned=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):32===e?u(this.high,0,this.unsigned):u(this.high>>>e-32,0,this.unsigned)},_.shru=_.shiftRightUnsigned,_.shr_u=_.shiftRightUnsigned,_.rotateLeft=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,u(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},_.rotl=_.rotateLeft,_.rotateRight=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,u(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},_.rotr=_.rotateRight,_.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},_.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},_.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},_.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},_.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},"function"==typeof BigInt&&(r.fromBigInt=function(e,t){return u(Number(BigInt.asIntN(32,e)),Number(BigInt.asIntN(32,e>>BigInt(32))),t)},r.fromValue=function(e,t){return"bigint"==typeof e?r.fromBigInt(e,t):d(e,t)},_.toBigInt=function(){var e=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|e}),e.default=r})},405695,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.loadFileDescriptorSetFromObject=r.loadFileDescriptorSetFromBuffer=r.fromJSON=r.loadSync=r.load=r.IdempotencyLevel=r.isAnyExtension=r.Long=void 0;let i=e.r(110462),s=e.r(68645),a=e.r(257828),o=e.r(662303);r.Long=e.r(858231),r.isAnyExtension=function(e){return"@type"in e&&"string"==typeof e["@type"]},function(e){e.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",e.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",e.IDEMPOTENT="IDEMPOTENT"}(n=r.IdempotencyLevel||(r.IdempotencyLevel={}));let l={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function u(e,t){return""===e?t:e+"."+t}function c(e){return e instanceof s.Service||e instanceof s.Type||e instanceof s.Enum}function h(e){return e instanceof s.Namespace||e instanceof s.Root}function d(e,t){let r=u(t,e.name);return c(e)?[[r,e]]:h(e)&&void 0!==e.nested?Object.keys(e.nested).map(t=>d(e.nested[t],r)).reduce((e,t)=>e.concat(t),[]):[]}function f(e,t){return function(r){return e.toObject(e.decode(r),t)}}function p(e){return function(t){if(Array.isArray(t))throw Error(`Failed to serialize message: expected object with ${e.name} structure, got array instead`);let r=e.fromObject(t);return e.encode(r).finish()}}function m(e){return(e||[]).reduce((e,t)=>{for(let[r,n]of Object.entries(t))"uninterpreted_option"===r?e.uninterpreted_option.push(t.uninterpreted_option):e[r]=n;return e},{deprecated:!1,idempotency_level:n.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function g(e,t,r,n){let s=e.resolvedRequestType,a=e.resolvedResponseType;return{path:"/"+t+"/"+e.name,requestStream:!!e.requestStream,responseStream:!!e.responseStream,requestSerialize:p(s),requestDeserialize:f(s,r),responseSerialize:p(a),responseDeserialize:f(a,r),originalName:i(e.name),requestType:v(s,n),responseType:v(a,n),options:m(e.parsedOptions)}}function y(e,t,r,n){let i={};for(let s of e.methodsArray)i[s.name]=g(s,t,r,n);return i}function v(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:r.$type.toObject(r,l),fileDescriptorProtos:t}}function b(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:r.$type.toObject(r,l),fileDescriptorProtos:t}}function S(e,t,r,n){if(e instanceof s.Service)return y(e,t,r,n);if(e instanceof s.Type)return v(e,n);if(e instanceof s.Enum)return b(e,n);throw Error("Type mismatch in reflection object handling")}function w(e,t){let r={};e.resolveAll();let n=e.toDescriptor("proto3").file.map(e=>Buffer.from(a.FileDescriptorProto.encode(e).finish()));for(let[i,s]of d(e,""))r[i]=S(s,i,t,n);return r}function C(e,t){t=t||{};let r=s.Root.fromDescriptor(e);return r.resolveAll(),w(r,t)}r.load=function(e,t){return(0,o.loadProtosWithOptions)(e,t).then(e=>w(e,t))},r.loadSync=function(e,t){return w((0,o.loadProtosWithOptionsSync)(e,t),t)},r.fromJSON=function(e,t){t=t||{};let r=s.Root.fromJSON(e);return r.resolveAll(),w(r,t)},r.loadFileDescriptorSetFromBuffer=function(e,t){return C(a.FileDescriptorSet.decode(e),t)},r.loadFileDescriptorSetFromObject=function(e,t){return C(a.FileDescriptorSet.fromObject(e),t)},(0,o.addCommonProtos)()},880064,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.getChannelzServiceDefinition=r.getChannelzHandlers=r.unregisterChannelzRef=r.registerChannelzSocket=r.registerChannelzServer=r.registerChannelzSubchannel=r.registerChannelzChannel=r.ChannelzCallTracker=r.ChannelzChildrenTracker=r.ChannelzTrace=void 0;let n=e.r(504446),i=e.r(306971),s=e.r(825933),a=e.r(18806),o=e.r(23135),l=e.r(325930);function u(e){return{channel_id:e.id,name:e.name}}function c(e){return{subchannel_id:e.id,name:e.name}}function h(e){return{server_id:e.id}}function d(e){return{socket_id:e.id,name:e.name}}let f=32;class p{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let n=new Date;this.events.push({description:t,severity:e,timestamp:n,childChannel:(null==r?void 0:r.kind)==="channel"?r:void 0,childSubchannel:(null==r?void 0:r.kind)==="subchannel"?r:void 0}),this.events.length>=2*f&&(this.events=this.events.slice(f)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:k(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:k(e.timestamp),channel_ref:e.childChannel?u(e.childChannel):null,subchannel_ref:e.childSubchannel?c(e.childSubchannel):null}))}}}r.ChannelzTrace=p;class m{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,n;switch(e.kind){case"channel":{let r=null!=(t=this.channelChildren.get(e.id))?t:{ref:e,count:0};r.count+=1,this.channelChildren.set(e.id,r);break}case"subchannel":{let t=null!=(r=this.subchannelChildren.get(e.id))?r:{ref:e,count:0};t.count+=1,this.subchannelChildren.set(e.id,t);break}case"socket":{let t=null!=(n=this.socketChildren.get(e.id))?n:{ref:e,count:0};t.count+=1,this.socketChildren.set(e.id,t)}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t))}}}getChildLists(){let e=[];for(let{ref:t}of this.channelChildren.values())e.push(t);let t=[];for(let{ref:e}of this.subchannelChildren.values())t.push(e);let r=[];for(let{ref:e}of this.socketChildren.values())r.push(e);return{channels:e,subchannels:t,sockets:r}}}r.ChannelzChildrenTracker=m;class g{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}r.ChannelzCallTracker=g;let y=1;function v(){return y++}let b=[],S=[],w=[],C=[];function T(e){let t=Number.parseInt(e,16);return[t/256|0,t%256]}function E(e){return""===e?[]:[].concat(...e.split(":").map(e=>T(e)))}function _(e){if((0,n.isIPv4)(e))return Buffer.from(Uint8Array.from(e.split(".").map(e=>Number.parseInt(e))));if(!(0,n.isIPv6)(e))return null;{let t,r,n=e.indexOf("::");-1===n?(t=e,r=""):(t=e.substring(0,n),r=e.substring(n+2));let i=Buffer.from(E(t)),s=Buffer.from(E(r)),a=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,a,s])}}function I(e){switch(e){case i.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case i.ConnectivityState.IDLE:return{state:"IDLE"};case i.ConnectivityState.READY:return{state:"READY"};case i.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case i.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function k(e){if(!e)return null;let t=e.getTime();return{seconds:t/1e3|0,nanos:t%1e3*1e6}}function x(e){let t=e.getInfo();return{ref:u(e.ref),data:{target:t.target,state:I(t.state),calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:k(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},channel_ref:t.children.channels.map(e=>u(e)),subchannel_ref:t.children.subchannels.map(e=>c(e))}}function R(e,t){let r=Number.parseInt(e.request.channel_id),n=b[r];void 0===n?t({code:s.Status.NOT_FOUND,details:"No channel data found for id "+r}):t(null,{channel:x(n)})}function D(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_channel_id);for(;i<b.length;i++){let e=b[i];if(void 0!==e&&(n.push(x(e)),n.length>=r))break}t(null,{channel:n,end:i>=w.length})}function A(e){let t=e.getInfo();return{ref:h(e.ref),data:{calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:k(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},listen_socket:t.listenerChildren.sockets.map(e=>d(e))}}function O(e,t){let r=Number.parseInt(e.request.server_id),n=w[r];void 0===n?t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r}):t(null,{server:A(n)})}function N(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_server_id);for(;i<w.length;i++){let e=w[i];if(void 0!==e&&(n.push(A(e)),n.length>=r))break}t(null,{server:n,end:i>=w.length})}function P(e,t){let r=Number.parseInt(e.request.subchannel_id),n=S[r];if(void 0===n)return void t({code:s.Status.NOT_FOUND,details:"No subchannel data found for id "+r});let i=n.getInfo();t(null,{subchannel:{ref:c(n.ref),data:{target:i.target,state:I(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:k(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(e=>d(e))}})}function M(e){var t;return(0,a.isTcpSubchannelAddress)(e)?{address:"tcpip_address",tcpip_address:{ip_address:null!=(t=_(e.host))?t:void 0,port:e.port}}:{address:"uds_address",uds_address:{filename:e.path}}}function L(e,t){var r,n,i,a,o;let l=Number.parseInt(e.request.socket_id),u=C[l];if(void 0===u)return void t({code:s.Status.NOT_FOUND,details:"No socket data found for id "+l});let c=u.getInfo(),h=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!=(r=c.security.cipherSuiteStandardName)?r:void 0,other_name:null!=(n=c.security.cipherSuiteOtherName)?n:void 0,local_certificate:null!=(i=c.security.localCertificate)?i:void 0,remote_certificate:null!=(a=c.security.remoteCertificate)?a:void 0}}:null;t(null,{socket:{ref:d(u.ref),local:c.localAddress?M(c.localAddress):null,remote:c.remoteAddress?M(c.remoteAddress):null,remote_name:null!=(o=c.remoteName)?o:void 0,security:h,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:k(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:k(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:k(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:k(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}}})}function B(e,t){let r=Number.parseInt(e.request.server_id),n=w[r];if(void 0===n)return void t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r});let i=Number.parseInt(e.request.start_socket_id),a=Number.parseInt(e.request.max_results),o=n.getInfo().sessionChildren.sockets.sort((e,t)=>e.id-t.id),l=[],u=0;for(;u<o.length&&(!(o[u].id>=i)||(l.push(d(o[u])),!(l.length>=a)));u++);t(null,{socket_ref:l,end:u>=o.length})}function F(){return{GetChannel:R,GetTopChannels:D,GetServer:O,GetServers:N,GetSubchannel:P,GetSocket:L,GetServerSockets:B}}r.registerChannelzChannel=function(e,t,r){let n=v(),i={id:n,name:e,kind:"channel"};return r&&(b[n]={ref:i,getInfo:t}),i},r.registerChannelzSubchannel=function(e,t,r){let n=v(),i={id:n,name:e,kind:"subchannel"};return r&&(S[n]={ref:i,getInfo:t}),i},r.registerChannelzServer=function(e,t){let r=v(),n={id:r,kind:"server"};return t&&(w[r]={ref:n,getInfo:e}),n},r.registerChannelzSocket=function(e,t,r){let n=v(),i={id:n,name:e,kind:"socket"};return r&&(C[n]={ref:i,getInfo:t}),i},r.unregisterChannelzRef=function(e){switch(e.kind){case"channel":delete b[e.id];return;case"subchannel":delete S[e.id];return;case"server":delete w[e.id];return;case"socket":delete C[e.id];return}},r.getChannelzHandlers=F;let j=null;function V(){if(j)return j;let t=(0,e.r(405695).loadSync)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:["/ROOT/OneDrive/Desktop/CURSOR/CONSELHO DE FUNIL/node_modules/@grpc/grpc-js/build/src/../../proto"]});return j=(0,l.loadPackageDefinition)(t).grpc.channelz.v1.Channelz.service}r.getChannelzServiceDefinition=V,r.setup=function(){(0,o.registerAdminService)(V,F)}},58105,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Subchannel=void 0;let n=e.r(306971),i=e.r(984883),s=e.r(709917),a=e.r(825933),o=e.r(570823),l=e.r(18806),u=e.r(880064),c="subchannel",h=0x7fffffff;class d{constructor(e,t,r,s,a){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=s,this.connector=a,this.connectivityState=n.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new u.ChannelzCallTracker,this.childrenTracker=new u.ChannelzChildrenTracker,this.streamTracker=new u.ChannelzCallTracker;const c={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.handleBackoffTimer()},c),this.backoffTimeout.unref(),this.subchannelAddressString=(0,l.subchannelAddressToString)(t),this.keepaliveTime=null!=(o=r["grpc.keepalive_time_ms"])?o:-1,0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new u.ChannelzTrace,this.channelzRef=(0,u.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){s.trace(a.LogVerbosity.DEBUG,c,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){s.trace(a.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING):this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,h);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.READY)?(this.transport=e,this.channelzEnabled&&this.childrenTracker.refChild(e.getChannelzRef()),e.addDisconnectListener(e=>{this.transitionToState([n.ConnectivityState.READY],n.ConnectivityState.IDLE),e&&this.keepaliveTime>0&&(this.keepaliveTime*=2,s.log(a.LogVerbosity.ERROR,`Connection to ${(0,o.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):e.shutdown()},e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.TRANSIENT_FAILURE,`${e}`)})}transitionToState(e,t,r){var i,s;if(-1===e.indexOf(this.connectivityState))return!1;this.trace(n.ConnectivityState[this.connectivityState]+" -> "+n.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+n.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case n.ConnectivityState.READY:this.stopBackoff();break;case n.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case n.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(i=this.transport)||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case n.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(s=this.transport)||s.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let e of this.stateListeners)e(this,a,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,u.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([n.ConnectivityState.CONNECTING,n.ConnectivityState.READY],n.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(e,t,r,n){let i;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),i={onCallEnd:e=>{e.code===a.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):i={},this.transport.createCall(e,t,r,n,i)}startConnecting(){process.nextTick(()=>{this.transitionToState([n.ConnectivityState.IDLE],n.ConnectivityState.CONNECTING)||this.connectivityState!==n.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}}r.Subchannel=d},560848,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.DEFAULT_PORT=void 0;let n=e.r(624950),i=e.r(679594),s=e.r(224361),a=e.r(812394),o=e.r(825933),l=e.r(736063),u=e.r(709917),c=e.r(825933),h=e.r(570823),d=e.r(504446),f=e.r(984883),p="dns_resolver";function m(e){u.trace(c.LogVerbosity.DEBUG,p,e)}r.DEFAULT_PORT=443;let g=3e4,y=s.promisify(i.resolveTxt),v=s.promisify(i.lookup);function b(...e){let t=[];for(let r=0;r<Math.max.apply(null,e.map(e=>e.length));r++)for(let n of e)r<n.length&&t.push(n[r]);return t}class S{constructor(e,t,n){var i,s,a;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,m("Resolver constructed for target "+(0,h.uriToString)(e));const u=(0,h.splitHostPort)(e.path);null===u?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,d.isIPv4)(u.host)||(0,d.isIPv6)(u.host)?(this.ipResult=[{host:u.host,port:null!=(i=u.port)?i:r.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=u.host,this.port=null!=(s=u.port)?s:r.DEFAULT_PORT),this.percentage=100*Math.random(),1===n["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:o.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata};const c={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoff=new f.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},c),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!=(a=n["grpc.dns_min_time_between_resolutions_ms"])?a:g,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(m("Returning IP address for target "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)m("Failed to parse DNS address "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:o.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;m("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=v(e,{all:!0}),this.pendingLookupPromise.then(e=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let t=e.filter(e=>4===e.family),r=e.filter(e=>6===e.family);this.latestLookupResult=b(r,t).map(e=>({host:e.address,port:+this.port}));let n="["+this.latestLookupResult.map(e=>e.host+":"+e.port).join(",")+"]";(m("Resolved addresses for target "+(0,h.uriToString)(this.target)+": "+n),0===this.latestLookupResult.length)?this.listener.onError(this.defaultResolutionError):this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},e=>{null!==this.pendingLookupPromise&&(m("Resolution error for target "+(0,h.uriToString)(this.target)+": "+e.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=y(e),this.pendingTxtPromise.then(e=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,a.extractAndSelectServiceConfig)(e,this.percentage)}catch(e){this.latestServiceConfigError={code:o.Status.UNAVAILABLE,details:`Parsing service config failed with error ${e.message}`,metadata:new l.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},e=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null==(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?m('resolution update delayed by "min time between resolutions" rate limit'):m("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}}r.setup=function(){(0,n.registerResolver)("dns",S),(0,n.registerDefaultScheme)("dns")}},652952,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getProxiedConnection=r.mapProxyName=void 0;let n=e.r(709917),i=e.r(825933),s=e.r(624950),a=e.r(921517),o=e.r(755004),l=e.r(709917),u=e.r(18806),c=e.r(570823),h=e.r(792509),d=e.r(560848),f="proxy";function p(e){l.trace(i.LogVerbosity.DEBUG,f,e)}function m(){let e,t="",r="";if(process.env.grpc_proxy)r="grpc_proxy",t=process.env.grpc_proxy;else if(process.env.https_proxy)r="https_proxy",t=process.env.https_proxy;else{if(!process.env.http_proxy)return{};r="http_proxy",t=process.env.http_proxy}try{e=new h.URL(t)}catch(e){return(0,n.log)(i.LogVerbosity.ERROR,`cannot parse value of "${r}" env var`),{}}if("http:"!==e.protocol)return(0,n.log)(i.LogVerbosity.ERROR,`"${e.protocol}" scheme not supported in proxy URI`),{};let s=null;e.username&&(e.password?((0,n.log)(i.LogVerbosity.INFO,"userinfo found in proxy URI"),s=`${e.username}:${e.password}`):s=e.username);let a=e.hostname,o=e.port;""===o&&(o="80");let l={address:`${a}:${o}`};return s&&(l.creds=s),p("Proxy server "+l.address+" set by environment variable "+r),l}function g(){let e=process.env.no_grpc_proxy,t="no_grpc_proxy";return(e||(e=process.env.no_proxy,t="no_proxy"),e)?(p("No proxy server list set by environment variable "+t),e.split(",")):[]}r.mapProxyName=function(e,t){var r;let n={target:e,extraOptions:{}};if((null!=(r=t["grpc.enable_http_proxy"])?r:1)===0||"unix"===e.scheme)return n;let i=m();if(!i.address)return n;let s=(0,c.splitHostPort)(e.path);if(!s)return n;let a=s.host;for(let t of g())if(t===a)return p("Not using proxy for target in no_proxy list: "+(0,c.uriToString)(e)),n;let o={"grpc.http_connect_target":(0,c.uriToString)(e)};return i.creds&&(o["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:o}},r.getProxiedConnection=function(e,t,r){var l;if(!("grpc.http_connect_target"in t))return Promise.resolve({});let h=t["grpc.http_connect_target"],f=(0,c.parseUri)(h);if(null===f)return Promise.resolve({});let m=(0,c.splitHostPort)(f.path);if(null===m)return Promise.resolve({});let g=`${m.host}:${null!=(l=m.port)?l:d.DEFAULT_PORT}`,y={method:"CONNECT",path:g},v={Host:g};(0,u.isTcpSubchannelAddress)(e)?(y.host=e.host,y.port=e.port):y.socketPath=e.path,"grpc.http_connect_creds"in t&&(v["Proxy-Authorization"]="Basic "+Buffer.from(t["grpc.http_connect_creds"]).toString("base64")),y.headers=v;let b=(0,u.subchannelAddressToString)(e);return p("Using proxy "+b+" to connect to "+y.path),new Promise((e,t)=>{let l=a.request(y);l.once("connect",(a,u,h)=>{var d;if(l.removeAllListeners(),u.removeAllListeners(),200===a.statusCode)if(p("Successfully connected to "+y.path+" through proxy "+b),"secureContext"in r){let n=(0,s.getDefaultAuthority)(f),i=(0,c.splitHostPort)(n),a=null!=(d=null==i?void 0:i.host)?d:n,l=o.connect(Object.assign({host:a,servername:a,socket:u},r),()=>{p("Successfully established a TLS connection to "+y.path+" through proxy "+b),e({socket:l,realTarget:f})});l.on("error",e=>{p("Failed to establish a TLS connection to "+y.path+" through proxy "+b+" with error "+e.message),t()})}else p("Successfully established a plaintext connection to "+y.path+" through proxy "+b),e({socket:u,realTarget:f});else(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to "+y.path+" through proxy "+b+" with status "+a.statusCode),t()}),l.once("error",e=>{l.removeAllListeners(),(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to proxy "+b+" with error "+e.message),t()}),l.end()})}},932748,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.StreamDecoder=void 0,function(e){e[e.NO_DATA=0]="NO_DATA",e[e.READING_SIZE=1]="READING_SIZE",e[e.READING_MESSAGE=2]="READING_MESSAGE"}(n||(n={}));class i{constructor(e){this.maxReadMessageLength=e,this.readState=n.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t,r=0,i=[];for(;r<e.length;)switch(this.readState){case n.NO_DATA:this.readCompressFlag=e.slice(r,r+1),r+=1,this.readState=n.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case n.READING_SIZE:if(t=Math.min(e.length-r,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,r,r+t),this.readSizeRemaining-=t,r+=t,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=n.READING_MESSAGE;else{let e=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=n.NO_DATA,i.push(e)}}break;case n.READING_MESSAGE:if(t=Math.min(e.length-r,this.readMessageRemaining),this.readPartialMessage.push(e.slice(r,r+t)),this.readMessageRemaining-=t,r+=t,0===this.readMessageRemaining){let e=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),t=Buffer.concat(e,this.readMessageSize+5);this.readState=n.NO_DATA,i.push(t)}break;default:throw Error("Unexpected read state")}return i}}r.StreamDecoder=i},309840,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Http2SubchannelCall=void 0;let n=e.r(925328),i=e.r(446786),s=e.r(825933),a=e.r(736063),o=e.r(932748),l=e.r(709917),u=e.r(825933),c="subchannel_call";function h(e){for(let[t,r]of Object.entries(i.constants.errno))if(r===e)return t;return"Unknown system error "+e}class d{constructor(e,t,r,i,l){var u;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=l,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=s.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;const c=null!=(u=i.getOptions()["grpc.max_receive_message_length"])?u:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new o.StreamDecoder(c),e.on("response",(e,t)=>{let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";switch(this.trace("Received server headers:\n"+r),e[":status"]){case 400:this.mappedStatusCode=s.Status.INTERNAL;break;case 401:this.mappedStatusCode=s.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=s.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=s.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=s.Status.UNAVAILABLE;break;default:this.mappedStatusCode=s.Status.UNKNOWN}if(t&n.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(e);else{let t;try{t=a.Metadata.fromHttp2Headers(e)}catch(e){this.endCall({code:s.Status.UNKNOWN,details:e.message,metadata:new a.Metadata});return}this.listener.onReceiveMetadata(t)}}),e.on("trailers",e=>{this.handleTrailers(e)}),e.on("data",e=>{let t;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+e.length);try{t=this.decoder.write(e)}catch(e){this.cancelWithStatus(s.Status.RESOURCE_EXHAUSTED,e.message);return}for(let e of t)this.trace("parsed message of length "+e.length),this.callEventTracker.addMessageReceived(),this.tryPush(e)}}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var t;let r;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),(null==(t=this.finalStatus)?void 0:t.code)===s.Status.OK)return;let i="";switch(e.rstCode){case n.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`;break;case n.constants.NGHTTP2_REFUSED_STREAM:r=s.Status.UNAVAILABLE,i="Stream refused by server";break;case n.constants.NGHTTP2_CANCEL:r=s.Status.CANCELLED,i="Call cancelled";break;case n.constants.NGHTTP2_ENHANCE_YOUR_CALM:r=s.Status.RESOURCE_EXHAUSTED,i="Bandwidth exhausted or memory limit exceeded";break;case n.constants.NGHTTP2_INADEQUATE_SECURITY:r=s.Status.PERMISSION_DENIED,i="Protocol not secure enough";break;case n.constants.NGHTTP2_INTERNAL_ERROR:r=s.Status.INTERNAL,null===this.internalError?i=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(r=s.Status.UNAVAILABLE,i=this.internalError.message):i=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:r,details:i,metadata:new a.Metadata,rstCode:e.rstCode})})}),e.on("error",e=>{"ERR_HTTP2_STREAM_ERROR"!==e.code&&(this.trace("Node error event: message="+e.message+" code="+e.code+" errno="+h(e.errno)+" syscall="+e.syscall),this.internalError=e),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:s.Status.UNAVAILABLE,details:"Connection dropped",metadata:new a.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){l.trace(u.LogVerbosity.DEBUG,c,"["+this.callId+"] "+e)}endCall(e){(null===this.finalStatus||this.finalStatus.code===s.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===s.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){let t;this.callEventTracker.onStreamEnd(!0);let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";this.trace("Received server trailers:\n"+r);try{t=a.Metadata.fromHttp2Headers(e)}catch(e){t=new a.Metadata}let n=t.getMap(),i=this.mappedStatusCode;if(i===s.Status.UNKNOWN&&"string"==typeof n["grpc-status"]){let e=Number(n["grpc-status"]);e in s.Status&&(i=e,this.trace("received status code "+e+" from server")),t.remove("grpc-status")}let o="";if("string"==typeof n["grpc-message"]){try{o=decodeURI(n["grpc-message"])}catch(e){o=n["grpc-message"]}t.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let l={code:i,details:o,metadata:t};this.endCall(l)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;t=(null==(e=this.finalStatus)?void 0:e.code)===s.Status.OK?n.constants.NGHTTP2_NO_ERROR:n.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new a.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==s.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=t=>{process.nextTick(()=>{var r;let n=s.Status.UNAVAILABLE;(null==t?void 0:t.code)==="ERR_STREAM_WRITE_AFTER_END"&&(n=s.Status.INTERNAL),t&&this.cancelWithStatus(n,`Write error: ${t.message}`),null==(r=e.callback)||r.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(e){this.endCall({code:s.Status.UNAVAILABLE,details:`Write failed with error ${e.message}`,metadata:new a.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}r.Http2SubchannelCall=d},806162,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getNextCallNumber=void 0;let n=0;r.getNextCallNumber=function(){return n++}},278641,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Http2SubchannelConnector=void 0;let n=e.r(925328),i=e.r(755004),s=e.r(880064),a=e.r(825933),o=e.r(652952),l=e.r(709917),u=e.r(624950),c=e.r(18806),h=e.r(570823),d=e.r(504446),f=e.r(309840),p=e.r(806162),m="transport",g="transport_flowctrl",y=e.r(25981).version,{HTTP2_HEADER_AUTHORITY:v,HTTP2_HEADER_CONTENT_TYPE:b,HTTP2_HEADER_METHOD:S,HTTP2_HEADER_PATH:w,HTTP2_HEADER_TE:C,HTTP2_HEADER_USER_AGENT:T}=n.constants,E=2e4,_=Buffer.from("too_many_pings","ascii");class I{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=E,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new s.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,c.subchannelAddressToString)(t),0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,s.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${y}`,r["grpc.secondary_user_agent"]].filter(e=>e).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=1===r["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(e,t,r)=>{let i=!1;e===n.constants.NGHTTP2_ENHANCE_YOUR_CALM&&r&&r.equals(_)&&(i=!0),this.trace("connection closed by GOAWAY with code "+e+" and data "+(null==r?void 0:r.toString())),this.reportDisconnectToOwner(i)}),e.once("error",e=>{this.trace("connection closed with error "+e.message)}),l.isTracerEnabled(m)&&(e.on("remoteSettings",t=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))}),e.on("localSettings",t=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let n,i=this.session.socket,s=i.remoteAddress?(0,c.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,a=i.localAddress?(0,c.stringToSubchannelAddress)(i.localAddress,i.localPort):null;if(this.session.encrypted){let t=i,r=t.getCipher(),s=t.getCertificate(),a=t.getPeerCertificate();n={cipherSuiteStandardName:null!=(e=r.standardName)?e:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:s&&"raw"in s?s.raw:null,remoteCertificate:a&&"raw"in a?a.raw:null}}else n=null;return{remoteAddress:s,localAddress:a,security:n,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(t=this.session.state.localWindowSize)?t:null,remoteFlowControlWindow:null!=(r=this.session.state.remoteWindowSize)?r:null}}trace(e){l.trace(a.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){l.trace(a.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){l.trace(a.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){l.trace(a.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null==(t=(e=this.keepaliveTimeoutId).unref)||t.call(e));try{this.session.ping((e,t,r)=>{e&&(this.keepaliveTrace("Ping failed with error "+e.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(e){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null==(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),0===this.activeCalls.size&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),1===this.activeCalls.size&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,n,i){let s,a,o,l=e.toHttp2Headers();l[v]=t,l[T]=this.userAgent,l[b]="application/grpc",l[S]="POST",l[w]=r,l[C]="trailers";try{s=this.session.request(l)}catch(e){throw this.handleDisconnect(),e}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),a={addMessageSent:()=>{var e;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null==(e=i.addMessageSent)||e.call(i)},addMessageReceived:()=>{var e;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null==(e=i.addMessageReceived)||e.call(i)},onCallEnd:e=>{var t;null==(t=i.onCallEnd)||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;e?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null==(t=i.onStreamEnd)||t.call(i,e)}}):a={addMessageSent:()=>{var e;null==(e=i.addMessageSent)||e.call(i)},addMessageReceived:()=>{var e;null==(e=i.addMessageReceived)||e.call(i)},onCallEnd:e=>{var t;null==(t=i.onCallEnd)||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;null==(t=i.onStreamEnd)||t.call(i,e)}},o=new f.Http2SubchannelCall(s,a,n,this,(0,p.getNextCallNumber)()),this.addActiveCall(o),o}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,s.unregisterChannelzRef)(this.channelzRef)}}class k{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){l.trace(a.LogVerbosity.DEBUG,m,(0,h.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,s){return this.isShutdown?Promise.reject():new Promise((a,o)=>{var l,f,p;let m;s.realTarget?(m=(0,h.uriToString)(s.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,h.uriToString)(s.realTarget))):(m=null,this.trace("creating HTTP/2 session to "+(0,c.subchannelAddressToString)(e)));let g=(0,u.getDefaultAuthority)(null!=(l=s.realTarget)?l:this.channelTarget),y=t._getConnectionOptions()||{};y.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?y.maxSessionMemory=r["grpc-node.max_session_memory"]:y.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in y){if(v="https://",r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];y.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),y.servername=e}else{let e=null!=(p=null==(f=(0,h.splitHostPort)(g))?void 0:f.host)?p:"localhost";y.servername=e}s.socket&&(y.createConnection=(e,t)=>s.socket)}else y.createConnection=(t,r)=>s.socket?s.socket:d.connect(e);y=Object.assign(Object.assign(Object.assign({},y),e),{enableTrace:1===r["grpc-node.tls_enable_trace"]});let b=n.connect(v+g,y);this.session=b;let S="Failed to connect";b.unref(),b.once("connect",()=>{b.removeAllListeners(),a(new I(b,e,r,m)),this.session=null}),b.once("close",()=>{this.session=null,setImmediate(()=>{o(`${S} (${new Date().toISOString()})`)})}),b.once("error",e=>{S=e.message,this.trace("connection failed with error "+S)})})}connect(e,t,r){var n,s;if(this.isShutdown)return Promise.reject();let a=t._getConnectionOptions()||{};if("secureContext"in a){if(a.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];a.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),a.servername=e}else if("grpc.http_connect_target"in r){let e=(0,u.getDefaultAuthority)(null!=(n=(0,h.parseUri)(r["grpc.http_connect_target"]))?n:{path:"localhost"}),t=(0,h.splitHostPort)(e);a.servername=null!=(s=null==t?void 0:t.host)?s:e}r["grpc-node.tls_enable_trace"]&&(a.enableTrace=!0)}return(0,o.getProxiedConnection)(e,r,a).then(n=>this.createSession(e,t,r,n))}shutdown(){var e;this.isShutdown=!0,null==(e=this.session)||e.close(),this.session=null}}r.Http2SubchannelConnector=k},906569,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getSubchannelPool=r.SubchannelPool=void 0;let n=e.r(229956),i=e.r(58105),s=e.r(18806),a=e.r(570823),o=e.r(278641),l=1e4;class u{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let r=this.pool[t].filter(e=>!e.subchannel.unrefIfOneRef());r.length>0&&(e=!1),this.pool[t]=r}e&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},l),null==(t=(e=this.cleanupTimer).unref)||t.call(e))}getOrCreateSubchannel(e,t,r,l){this.ensureCleanupTask();let u=(0,a.uriToString)(e);if(u in this.pool){for(let e of this.pool[u])if((0,s.subchannelAddressEqual)(t,e.subchannelAddress)&&(0,n.channelOptionsEqual)(r,e.channelArguments)&&l._equals(e.channelCredentials))return e.subchannel}let c=new i.Subchannel(e,t,r,l,new o.Http2SubchannelConnector(e));return u in this.pool||(this.pool[u]=[]),this.pool[u].push({subchannelAddress:t,channelArguments:r,channelCredentials:l,subchannel:c}),c.ref(),c}}r.SubchannelPool=u;let c=new u;r.getSubchannelPool=function(e){return e?c:new u}},368021,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FilterStackFactory=r.FilterStack=void 0;class n{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMessage(t);return t}receiveMessage(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}}r.FilterStack=n;class i{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new i([...this.factories])}createFilter(){return new n(this.factories.map(e=>e.createFilter()))}}r.FilterStackFactory=i},921501,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.CompressionAlgorithms=void 0,function(e){e[e.identity=0]="identity",e[e.deflate=1]="deflate",e[e.gzip=2]="gzip"}(n||(r.CompressionAlgorithms=n={}))},770721,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BaseFilter=void 0;class n{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}}r.BaseFilter=n},384906,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CompressionFilterFactory=r.CompressionFilter=void 0;let n=e.r(406461),i=e.r(921501),s=e.r(825933),a=e.r(770721),o=e.r(709917),l=e=>"number"==typeof e&&"string"==typeof i.CompressionAlgorithms[e];class u{async writeMessage(e,t){let r=e;t&&(r=await this.compressMessage(r));let n=Buffer.allocUnsafe(r.length+5);return n.writeUInt8(+!!t,0),n.writeUInt32BE(r.length,1),r.copy(n,5),n}async readMessage(e){let t=1===e.readUInt8(0),r=e.slice(5);return t&&(r=await this.decompressMessage(r)),r}}class c extends u{async compressMessage(e){return e}async writeMessage(e,t){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r}decompressMessage(e){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class h extends u{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.deflate(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createInflate();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class d extends u{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.gzip(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createGunzip();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class f extends u{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function p(e,t){switch(e){case"identity":return new c;case"deflate":return new h(t);case"gzip":return new d(t);default:return new f(e)}}class m extends a.BaseFilter{constructor(e,t){var r,n;super(),this.sharedFilterConfig=t,this.sendCompression=new c,this.receiveCompression=new c,this.currentCompressionAlgorithm="identity";const a=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!=(r=e["grpc.max_receive_message_length"])?r:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==a)if(l(a)){const e=i.CompressionAlgorithms[a],r=null==(n=t.serverSupportedEncodingHeader)?void 0:n.split(",");(!r||r.includes(e))&&(this.currentCompressionAlgorithm=e,this.sendCompression=p(this.currentCompressionAlgorithm,-1))}else o.log(s.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${a}`)}async sendMetadata(e){let t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let e=t[0];"string"==typeof e&&(this.receiveCompression=p(e,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new c,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){var t;let r,n=await e;return r=!(this.sendCompression instanceof c)&&((null!=(t=n.flags)?t:0)&2)==0,{message:await this.sendCompression.writeMessage(n.message,r),flags:n.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}}r.CompressionFilter=m;class g{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new m(this.options,this.sharedFilterConfig)}}r.CompressionFilterFactory=g},698371,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.deadlineToString=r.getRelativeTimeout=r.getDeadlineTimeoutString=r.minDeadline=void 0,r.minDeadline=function(...e){let t=1/0;for(let r of e){let e=r instanceof Date?r.getTime():r;e<t&&(t=e)}return t};let n=[["m",1],["S",1e3],["M",6e4],["H",36e5]];r.getDeadlineTimeoutString=function(e){let t=new Date().getTime();e instanceof Date&&(e=e.getTime());let r=Math.max(e-t,0);for(let[e,t]of n){let n=r/t;if(n<1e8)return String(Math.ceil(n))+e}throw Error("Deadline is too far in the future")};let i=0x7fffffff;r.getRelativeTimeout=function(e){let t=(e instanceof Date?e.getTime():e)-new Date().getTime();return t<0?0:t>i?1/0:t},r.deadlineToString=function(e){if(e instanceof Date)return e.toISOString();{let t=new Date(e);return Number.isNaN(t.getTime())?""+e:t.toISOString()}}},599362,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.restrictControlPlaneStatusCode=void 0;let n=e.r(825933),i=[n.Status.OK,n.Status.INVALID_ARGUMENT,n.Status.NOT_FOUND,n.Status.ALREADY_EXISTS,n.Status.FAILED_PRECONDITION,n.Status.ABORTED,n.Status.OUT_OF_RANGE,n.Status.DATA_LOSS];r.restrictControlPlaneStatusCode=function(e,t){return i.includes(e)?{code:n.Status.INTERNAL,details:`Invalid status from control plane: ${e} ${n.Status[e]} ${t}`}:{code:e,details:t}}},202088,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LoadBalancingCall=void 0;let n=e.r(306971),i=e.r(825933),s=e.r(698371),a=e.r(736063),o=e.r(919732),l=e.r(570823),u=e.r(709917),c=e.r(599362),h=e.r(925328),d="load_balancing_call";class f{constructor(e,t,r,n,i,s,a){var o,u;this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;const c=this.methodName.split("/");let h="";c.length>=2&&(h=c[1]);const d=null!=(u=null==(o=(0,l.splitHostPort)(this.host))?void 0:o.host)?u:"localhost";this.serviceUrl=`https://${d}/${h}`}trace(e){u.trace(i.LogVerbosity.DEBUG,d,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,n;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let i=Object.assign(Object.assign({},e),{progress:t});null==(r=this.listener)||r.onReceiveStatus(i),null==(n=this.onCallEnded)||n.call(this,i.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),l=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+o.PickResultType[r.pickResultType]+" subchannel: "+l+" status: "+(null==(e=r.status)?void 0:e.code)+" "+(null==(t=r.status)?void 0:t.details)),r.pickResultType){case o.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(e=>{var t,o,u;if(this.ended)return void this.trace("Credentials metadata generation finished after call ended");let c=this.metadata.clone();if(c.merge(e),c.get("authorization").length>1&&this.outputStatus({code:i.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new a.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==n.ConnectivityState.READY){this.trace("Picked subchannel "+l+" has state "+n.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&c.set("grpc-timeout",(0,s.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(c,this.host,this.methodName,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(e)},onReceiveMessage:e=>{this.trace("Received message"),this.listener.onReceiveMessage(e)},onReceiveStatus:e=>{this.trace("Received status"),e.rstCode===h.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(e,"REFUSED"):this.outputStatus(e,"PROCESSED")}})}catch(e){this.trace("Failed to start call on picked subchannel "+l+" with error "+e.message),this.outputStatus({code:i.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+e.message,metadata:new a.Metadata},"NOT_STARTED");return}null==(o=(t=this.callConfig).onCommitted)||o.call(t),null==(u=r.onCallStarted)||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},e=>{let{code:t,details:r}=(0,c.restrictControlPlaneStatusCode)("number"==typeof e.code?e.code:i.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${e.message}`);this.outputStatus({code:t,details:r,metadata:new a.Metadata},"PROCESSED")});break;case o.PickResultType.DROP:let{code:u,details:d}=(0,c.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:u,details:d,metadata:r.status.metadata},"DROP")});break;case o.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:e,details:t}=(0,c.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:e,details:t,metadata:r.status.metadata},"PROCESSED")})}break;case o.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null==(r=this.child)||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new a.Metadata},"PROCESSED")}getPeer(){var e,t;return null!=(t=null==(e=this.child)?void 0:e.getPeer())?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}r.LoadBalancingCall=f},255598,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ResolvingCall=void 0;let n=e.r(825933),i=e.r(698371),s=e.r(736063),a=e.r(709917),o=e.r(599362),l="resolving_call";class u{constructor(e,t,r,s,a,o){this.channel=e,this.method=t,this.filterStackFactory=s,this.credentials=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&n.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(n.Status.CANCELLED,"Cancelled by parent call")}),r.flags&n.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,i.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){a.trace(n.LogVerbosity.DEBUG,l,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,i.deadlineToString)(this.deadline));let e=(0,i.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(n.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(e=>e(t)),process.nextTick(()=>{var e;null==(e=this.listener)||e.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(t=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,t.message),this.pendingHalfClose&&r.halfClose()},e=>{this.cancelWithStatus(e.code,e.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if("NONE"===e.type)return void this.channel.queueCallForConfig(this);if("ERROR"===e.type)return void(this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error));let t=e.config;if(t.status!==n.Status.OK){let{code:e,details:r}=(0,o.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:e,details:r,metadata:new s.Metadata});return}if(t.methodConfig.timeout){let e=new Date;e.setSeconds(e.getSeconds()+t.methodConfig.timeout.seconds),e.setMilliseconds(e.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,i.minDeadline)(this.deadline,e),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(e=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(e,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(e))},onReceiveMessage:e=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(e).then(e=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(e),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},e=>{this.cancelWithStatus(e.code,e.details)})},onReceiveStatus:e=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=e:this.outputStatus(e)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},e=>{this.outputStatus(e)})}reportResolverError(e){var t;(null==(t=this.metadata)?void 0:t.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null==(r=this.child)||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new s.Metadata})}getPeer(){var e,t;return null!=(t=null==(e=this.child)?void 0:e.getPeer())?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}}r.ResolvingCall=u},755824,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RetryingCall=r.MessageBufferTracker=r.RetryThrottler=void 0;let n=e.r(825933),i=e.r(736063),s=e.r(709917),a="retrying_call";class o{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}r.RetryThrottler=o;class l{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let n=null!=(r=this.allocatedPerCall.get(t))?r:0;return!(this.limitPerCall-n<e)&&!(this.totalLimit-this.totalAllocated<e)&&(this.allocatedPerCall.set(t,n+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let n=null!=(r=this.allocatedPerCall.get(t))?r:0;if(n<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${n}`);this.allocatedPerCall.set(t,n-e)}freeAll(e){var t;let r=null!=(t=this.allocatedPerCall.get(e))?t:0;if(this.totalAllocated<r)throw Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}}r.MessageBufferTracker=l;let u="grpc-previous-rpc-attempts";class c{constructor(e,t,r,n,i,s,a,o,l){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.bufferTracker=o,this.retryThrottler=l,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";const e=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(e.initialBackoff.substring(0,e.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){s.trace(n.LogVerbosity.DEBUG,a,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;null==(t=this.listener)||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){for(let{call:r}of(this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new i.Metadata}),this.underlyingCalls))r.cancelWithStatus(e,t)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return null!=(t=this.writeBuffer[e-this.writeBufferOffset])?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let e=this.getBufferEntry(t);e.allocated&&this.bufferTracker.free(e.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[e].state){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&"COMPLETED"!==this.underlyingCalls[t].state&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(n.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let e=-1,t=-1;for(let[r,n]of this.underlyingCalls.entries())"ACTIVE"===n.state&&n.nextMessageToSend>e&&(e=n.nextMessageToSend,t=r);-1===t?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(e=>e===t||e.toString().toLowerCase()===n.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=null==(e=this.callConfig)?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,n=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,n),r}maybeRetryCall(e,t){let r;if("RETRY"!==this.state)return void t(!1);let n=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return void t(!1);if(null===e)r=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else r=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var e,r;"RETRY"!==this.state?t(!1):(null==(r=null==(e=this.retryThrottler)?void 0:e.canRetryCall())||r)&&(t(!0),this.attempts+=1,this.startNewAttempt())},r)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)(null==t?void 0:t.state)==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var n,i,s;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList(null!=(n=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)?n:[],e.code)){let n;if(null==(i=this.retryThrottler)||i.addCallFailed(),null===r)n=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else n=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(t),this.reportStatus(e))},n)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?(null==(s=this.retryThrottler)||s.addCallFailed(),this.maybeRetryCall(r,r=>{r||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e))}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(0===t.length)return null;try{return parseInt(t[0])}catch(e){return -1}}handleChildStatus(e,t){var r;if("COMPLETED"===this.underlyingCalls[t].state)return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===n.Status.OK){null==(r=this.retryThrottler)||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if("COMMITTED"===this.state)return void this.reportStatus(e);let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let n=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return;let i=null!=(e=n.hedgingDelay)?e:"0s",s=Number(i.substring(0,i.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*s),null==(r=(t=this.hedgingTimer).unref)||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,n=this.initialMetadata.clone();r>0&&n.set(u,`${r}`);let i=!1;e.start(n,{onReceiveMetadata:n=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),i=!0,r>0&&n.set(u,`${r}`),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMetadata(n)},onReceiveMessage:r=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMessage(r)},onReceiveStatus:n=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!i&&r>0&&n.metadata.set(u,`${r}`),this.handleChildStatus(n,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let n=this.underlyingCalls[e],i=n.nextMessageToSend;null==(r=(t=this.getBufferEntry(i)).callback)||r.call(t),this.clearSentMessages(),n.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if("COMPLETED"!==t.state&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:t=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose()}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let n={message:t,flags:e.flags},i=this.getNextBufferIndex(),s={entryType:"MESSAGE",message:n,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(s),s.allocated)for(let[n,s]of(null==(r=e.callback)||r.call(e),this.underlyingCalls.entries()))"ACTIVE"===s.state&&s.nextMessageToSend===i&&s.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(n)}},t);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let r=this.underlyingCalls[this.committedCallIndex];s.callback=e.callback,"ACTIVE"===r.state&&r.nextMessageToSend===i&&r.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){for(let e of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==e?void 0:e.state)==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();for(let t of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==t?void 0:t.state)==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}r.RetryingCall=c},590238,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BaseSubchannelWrapper=void 0;class n{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}}r.BaseSubchannelWrapper=n},426099,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InternalChannel=void 0;let n=e.r(328079),i=e.r(124255),s=e.r(906569),a=e.r(919732),o=e.r(825933),l=e.r(368021),u=e.r(384906),c=e.r(624950),h=e.r(709917),d=e.r(652952),f=e.r(570823),p=e.r(306971),m=e.r(880064),g=e.r(202088),y=e.r(698371),v=e.r(255598),b=e.r(806162),S=e.r(599362),w=e.r(755824),C=e.r(590238),T=0x7fffffff,E=1e3,_=18e5,I=new Map,k=0x1000000,x=1048576;class R extends C.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(e,r,n,i)=>{t.throttleKeepalive(i)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class D{constructor(e,t,r){var g,y,v,b,C,D,A,O;if(this.credentials=t,this.options=r,this.connectivityState=p.ConnectivityState.IDLE,this.currentPicker=new a.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new m.ChannelzCallTracker,this.childrenTracker=new m.ChannelzChildrenTracker,"string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.originalTarget=e;const N=(0,f.parseUri)(e);if(null===N)throw Error(`Could not parse target name "${e}"`);const P=(0,c.mapUriDefaultScheme)(N);if(null===P)throw Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},T),null==(y=(g=this.callRefTimer).unref)||y.call(g),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new m.ChannelzTrace,this.channelzRef=(0,m.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,c.getDefaultAuthority)(P);const M=(0,d.mapProxyName)(P,r);this.target=M.target,this.options=Object.assign({},this.options,M.extraOptions),this.subchannelPool=(0,s.getSubchannelPool)((null!=(v=r["grpc.use_local_subchannel_pool"])?v:0)===0),this.retryBufferTracker=new w.MessageBufferTracker(null!=(b=r["grpc.retry_buffer_size"])?b:k,null!=(C=r["grpc.per_rpc_retry_buffer_size"])?C:x),this.keepaliveTime=null!=(D=r["grpc.keepalive_time_ms"])?D:-1,this.idleTimeoutMs=Math.max(null!=(A=r["grpc.client_idle_timeout_ms"])?A:_,E);const L={createSubchannel:(e,t)=>{let r=this.subchannelPool.getOrCreateSubchannel(this.target,e,Object.assign({},this.options,t),this.credentials);r.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",r.getChannelzRef());let n=new R(r,this);return this.wrappedSubchannels.add(n),n},updateState:(e,t)=>{this.currentPicker=t;let r=this.pickQueue.slice();for(let e of(this.pickQueue=[],r.length>0&&this.callRefTimerUnref(),r))e.doPick();this.updateState(e)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.refChild(e)},removeChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.unrefChild(e)}};this.resolvingLoadBalancer=new i.ResolvingLoadBalancer(this.target,L,r,(e,t)=>{e.retryThrottling?I.set(this.getTarget(),new w.RetryThrottler(e.retryThrottling.maxTokens,e.retryThrottling.tokenRatio,I.get(this.getTarget()))):I.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=t,this.currentResolutionError=null,process.nextTick(()=>{let e=this.configSelectionQueue;for(let t of(this.configSelectionQueue=[],e.length>0&&this.callRefTimerUnref(),e))t.getConfig()})},e=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+e.code+' and details "'+e.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,S.restrictControlPlaneStatusCode)(e.code,e.details)),{metadata:e.metadata}));let t=this.configSelectionQueue;for(let r of(this.configSelectionQueue=[],t.length>0&&this.callRefTimerUnref(),t))r.reportResolverError(e)}),this.filterStackFactory=new l.FilterStackFactory([new u.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));const B=Error();(0,h.trace)(o.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null==(O=B.stack)?void 0:O.substring(B.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,h.trace)(null!=t?t:o.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,f.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,n;(null==(t=(e=this.callRefTimer).hasRef)?void 0:t.call(e))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(n=(r=this.callRefTimer).ref)||n.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(t=(e=this.callRefTimer).unref)||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(t=>t===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){for(let t of((0,h.trace)(o.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,f.uriToString)(this.target)+" "+p.ConnectivityState[this.connectivityState]+" -> "+p.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+p.ConnectivityState[e]),this.connectivityState=e,this.connectivityStateWatchers.slice()))e!==t.currentState&&(t.timer&&clearTimeout(t.timer),this.removeConnectivityStateWatcher(t),t.callback());e!==p.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime)for(let t of(this.keepaliveTime=e,this.wrappedSubchannels))t.throttleKeepalive(e)}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(p.ConnectivityState.IDLE),this.currentPicker=new a.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0)return void this.startIdleTimeout(this.idleTimeoutMs);let e=new Date().valueOf()-this.lastActivityTimestamp.valueOf();e>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-e)},e),null==(r=(t=this.idleTimer).unref)||r.call(t)}maybeStartIdleTimer(){this.connectivityState===p.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===o.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+s+'] method="'+t+'"'),new g.LoadBalancingCall(this,e,t,r,n,i,s)}createRetryingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();return this.trace("createRetryingCall ["+s+'] method="'+t+'"'),new w.RetryingCall(this,e,t,r,n,i,s,this.retryBufferTracker,I.get(this.getTarget()))}createInnerCall(e,t,r,n,i){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(e,t,r,n,i):this.createRetryingCall(e,t,r,n,i)}createResolvingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();this.trace("createResolvingCall ["+s+'] method="'+e+'", deadline='+(0,y.deadlineToString)(t));let a={deadline:t,flags:null!=i?i:o.Propagate.DEFAULTS,host:null!=r?r:this.defaultAuthority,parentCall:n},l=new v.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),s);return this.onCallStart(),l.addStatusWatcher(e=>{this.onCallEnd(e)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(p.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,m.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,f.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===p.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let n=null;if(t!==1/0){let e=t instanceof Date?t:new Date(t),s=new Date;if(t===-1/0||e<=s)return void process.nextTick(r,Error("Deadline passed without connectivity state change"));n=setTimeout(()=>{this.removeConnectivityStateWatcher(i),r(Error("Deadline passed without connectivity state change"))},e.getTime()-s.getTime())}let i={currentState:e,callback:r,timer:n};this.connectivityStateWatchers.push(i)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===p.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(e,t,r,n,i)}}r.InternalChannel=D},200494,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChannelImplementation=void 0;let n=e.r(328079),i=e.r(426099);class s{constructor(e,t,r){if("string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.internalChannel=new i.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,n,i)}}r.ChannelImplementation=s},545471,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Http2ServerCallStream=r.ServerDuplexStreamImpl=r.ServerWritableStreamImpl=r.ServerReadableStreamImpl=r.ServerUnaryCallImpl=void 0;let n=e.r(427699),i=e.r(925328),s=e.r(688947),a=e.r(406461),o=e.r(825933),l=e.r(736063),u=e.r(932748),c=e.r(709917),h=e.r(107106),d="server_call";function f(e){c.trace(o.LogVerbosity.DEBUG,d,e)}let p="grpc-message",m="grpc-status",g="grpc-timeout",y=/(\d{1,8})\s*([HMSmun])/,v={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},b={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},S={[i.constants.HTTP2_HEADER_STATUS]:i.constants.HTTP_STATUS_OK,[i.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},w={waitForTrailers:!0};class C extends n.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}r.ServerUnaryCallImpl=C;class T extends s.Readable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,n)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}r.ServerReadableStreamImpl=T;class E extends s.Writable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let t=this.call.serializeMessage(e);if(!this.call.write(t))return void this.call.once("drain",r)}catch(e){this.emit("error",{details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:o.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}}r.ServerWritableStreamImpl=E;class _ extends s.Duplex{constructor(e,t,r,n,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}}r.ServerDuplexStreamImpl=_,_.prototype._read=T.prototype._read,_.prototype._write=E.prototype._write,_.prototype._final=E.prototype._final;class I extends n.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=o.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=o.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",e=>{}),this.stream.once("close",()=>{var e;f("Request to method "+(null==(e=this.handler)?void 0:e.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:o.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if("identity"===t)return r;if("deflate"!==t&&"gzip"!==t)return Promise.reject({code:o.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`});{let e;return e="deflate"===t?a.createInflate():a.createGunzip(),new Promise((t,n)=>{let i=0,s=[];e.on("data",t=>{s.push(t),i+=t.byteLength,-1!==this.maxReceiveMessageSize&&i>this.maxReceiveMessageSize&&(e.destroy(),n({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),e.on("end",()=>{t(Buffer.concat(s))}),e.write(r),e.end()})}}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},S),b),t);this.stream.respond(r,w)}receiveMetadata(e){let t=l.Metadata.fromHttp2Headers(e);c.isTracerEnabled(d)&&f("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(g);if(r.length>0){let e=r[0].toString().match(y);if(null===e){let e=Error("Invalid deadline");return e.code=o.Status.OUT_OF_RANGE,this.sendError(e),t}let n=e[1]*v[e[2]]|0,i=new Date;this.deadline=i.setMilliseconds(i.getMilliseconds()+n),this.deadlineTimer=setTimeout(k,n,this),t.remove(g)}return t.remove(i.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(i.constants.HTTP2_HEADER_TE),t.remove(i.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:n}=this,i=0,s=this,a=[],l=this.maxReceiveMessageSize;function u(e){if(i+=e.byteLength,-1!==l&&i>l){n.removeListener("data",u),n.removeListener("end",c),n.removeListener("error",c),r({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${i} vs. ${l})`});return}a.push(e)}function c(l){if(n.removeListener("data",u),n.removeListener("end",c),n.removeListener("error",c),void 0!==l)return void r({code:o.Status.INTERNAL,details:l.message});if(0===i)return void r({code:o.Status.INTERNAL,details:"received empty unary message"});s.emit("receiveMessage");let h=Buffer.concat(a,i),d=1===h.readUInt8(0)?e:"identity",f=s.getDecompressedMessage(h,d);Buffer.isBuffer(f)?t(s.deserializeMessageWithInternalError(f)):f.then(e=>t(s.deserializeMessageWithInternalError(e)),t=>r(t.code?t:{code:o.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}this.stream.on("data",u),this.stream.on("end",c),this.stream.on("error",c)})}async deserializeMessageWithInternalError(e){try{return this.deserializeMessage(e)}catch(e){throw{details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL}}}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,n=Buffer.allocUnsafe(r+5);return n.writeUInt8(0,0),n.writeUInt32BE(r,1),t.copy(n,5),n}deserializeMessage(e){return this.handler.deserialize(e)}async sendUnaryMessage(e,t,r,n){if(!this.checkCancelled()){if(void 0===r&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let e=this.serializeMessage(t);this.write(e),this.sendStatus({code:o.Status.OK,details:"OK",metadata:r})}catch(e){this.sendError({details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL})}}}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===o.Status.OK),!this.checkCancelled())if(f("Request to method "+(null==(t=this.handler)?void 0:t.path)+" ended with status code: "+o.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var t;let r=Object.assign({[m]:e.code,[p]:encodeURI(e.details)},null==(t=e.metadata)?void 0:t.toHttp2Headers());this.stream.sendTrailers(r),this.statusSent=!0}),this.stream.end());else{let t=Object.assign(Object.assign({[m]:e.code,[p]:encodeURI(e.details)},S),null==(r=e.metadata)?void 0:r.toHttp2Headers());this.stream.respond(t,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:o.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&void 0!==e.metadata?e.metadata:null};"code"in e&&"number"==typeof e.code&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&"string"==typeof e.details&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled())return -1!==this.maxSendMessageSize&&e.length>this.maxSendMessageSize?void this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`}):(this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e))}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new u.StreamDecoder(this.maxReceiveMessageSize),n=!1,i=!1,s=!1,a=async()=>{s||!n||i||(s=!0,await this.pushOrBufferMessage(e,null))};this.stream.on("data",async n=>{let s;try{s=r.write(n)}catch(e){this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:e.message});return}for(let r of(i=!0,this.stream.pause(),s)){let n;this.emit("receiveMessage");let i=1===r.readUInt8(0)?t:"identity";try{n=await this.getDecompressedMessage(r,i)}catch(e){this.sendError(e);return}if(!n)return;await this.pushOrBufferMessage(e,n)}i=!1,this.stream.resume(),await a()}),this.stream.once("end",async()=>{n=!0,await a()})}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(null===t||!1===r){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(e,t){this.isPushPending?this.bufferedMessages.push(t):await this.pushMessage(e,t)}async pushMessage(e,t){if(null===t){f("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}f("Received message of length "+t.length),this.isPushPending=!0;try{let r=await this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let t=(0,h.getErrorCode)(r);(null===t||t<o.Status.OK||t>o.Status.UNAUTHENTICATED)&&(t=o.Status.INTERNAL),e.emit("error",{details:(0,h.getErrorMessage)(r),code:t})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(e,this.bufferedMessages.shift())}getPeer(){var e;let t=null==(e=this.stream.session)?void 0:e.socket;return null!=t&&t.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function k(e){let t=Error("Deadline exceeded");t.code=o.Status.DEADLINE_EXCEEDED,e.sendError(t),e.cancelled=!0,e.emit("cancelled","deadline")}r.Http2ServerCallStream=I},410898,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ServerCredentials=void 0;let n=e.r(28162);class i{static createInsecure(){return new s}static createSsl(e,t,r=!1){if(null!==e&&!Buffer.isBuffer(e))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof r)throw TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let e=0;e<t.length;e++){let r=t[e];if(null===r||"object"!=typeof r)throw TypeError(`keyCertPair[${e}] must be an object`);if(!Buffer.isBuffer(r.private_key))throw TypeError(`keyCertPair[${e}].private_key must be a Buffer`);if(!Buffer.isBuffer(r.cert_chain))throw TypeError(`keyCertPair[${e}].cert_chain must be a Buffer`);i.push(r.cert_chain),s.push(r.private_key)}return new a({ca:e||(0,n.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:n.CIPHER_SUITES})}}r.ServerCredentials=i;class s extends i{_isSecure(){return!1}_getSettings(){return null}}class a extends i{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}},94152,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Server=void 0;let n=e.r(925328),i=e.r(825933),s=e.r(545471),a=e.r(410898),o=e.r(624950),l=e.r(709917),u=e.r(18806),c=e.r(570823),h=e.r(880064),d=0x7fffffff,f=0x7fffffff,p=2e4,{HTTP2_HEADER_PATH:m}=n.constants,g="server";function y(){}function v(e){return{code:i.Status.UNIMPLEMENTED,details:`The server does not implement the method ${e}`}}function b(e,t){let r=v(t);switch(e){case"unary":return(e,t)=>{t(r,null)};case"clientStream":return(e,t)=>{t(r,null)};case"serverStream":return e=>{e.emit("error",r)};case"bidi":return e=>{e.emit("error",r)};default:throw Error(`Invalid handlerType ${e}`)}}class S{constructor(e){var t,r,n,i;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new h.ChannelzTrace,this.callTracker=new h.ChannelzCallTracker,this.listenerChildrenTracker=new h.ChannelzChildrenTracker,this.sessionChildrenTracker=new h.ChannelzChildrenTracker,this.options=null!=e?e:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,h.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!=(t=this.options["grpc.max_connection_age_ms"])?t:d,this.maxConnectionAgeGraceMs=null!=(r=this.options["grpc.max_connection_age_grace_ms"])?r:d,this.keepaliveTimeMs=null!=(n=this.options["grpc.keepalive_time_ms"])?n:f,this.keepaliveTimeoutMs=null!=(i=this.options["grpc.keepalive_timeout_ms"])?i:p,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,n;let i,s=this.sessions.get(e),a=e.socket,o=a.remoteAddress?(0,u.stringToSubchannelAddress)(a.remoteAddress,a.remotePort):null,l=a.localAddress?(0,u.stringToSubchannelAddress)(a.localAddress,a.localPort):null;if(e.encrypted){let e=a,r=e.getCipher(),n=e.getCertificate(),s=e.getPeerCertificate();i={cipherSuiteStandardName:null!=(t=r.standardName)?t:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:n&&"raw"in n?n.raw:null,remoteCertificate:s&&"raw"in s?s.raw:null}}else i=null;return{remoteAddress:o,localAddress:l,security:i,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(r=e.state.localWindowSize)?r:null,remoteFlowControlWindow:null!=(n=e.state.remoteWindowSize)?n:null}}}trace(e){l.trace(i.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+e)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(e,t){if(null===e||"object"!=typeof e||null===t||"object"!=typeof t)throw Error("addService() requires two objects as arguments");let r=Object.keys(e);if(0===r.length)throw Error("Cannot add an empty service to a server");r.forEach(r=>{let n,i,s=e[r];n=s.requestStream?s.responseStream?"bidi":"clientStream":s.responseStream?"serverStream":"unary";let a=t[r];if(void 0===a&&"string"==typeof s.originalName&&(a=t[s.originalName]),i=void 0!==a?a.bind(t):b(n,r),!1===this.register(s.path,i,s.responseSerialize,s.requestDeserialize,n))throw Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(null===e||"object"!=typeof e)throw Error("removeService() requires object as argument");Object.keys(e).forEach(t=>{let r=e[t];this.unregister(r.path)})}bind(e,t){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof e)throw TypeError("port must be a string");if(null===t||!(t instanceof a.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof r)throw TypeError("callback must be a function");let s=(0,c.parseUri)(e);if(null===s)throw Error(`Could not parse port "${e}"`);let d=(0,o.mapUriDefaultScheme)(s);if(null===d)throw Error(`Could not get a default scheme for port "${e}"`);let f={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?f.maxSessionMemory=this.options["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(f.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let p=(e,t)=>{process.nextTick(()=>r(e,t))},m=()=>{let e;if(t._isSecure()){let r=Object.assign(f,t._getSettings());r.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(e=n.createSecureServer(r)).on("secureConnection",e=>{e.on("error",e=>{this.trace("An incoming TLS connection closed with error: "+e.message)})})}else e=n.createServer(f);return e.setTimeout(0,y),this._setupHandlers(e),e},g=(e,t,r)=>0===e.length?Promise.resolve({port:t,count:r}):Promise.all(e.map(e=>{let r;this.trace("Attempting to bind "+(0,u.subchannelAddressToString)(e)),r=(0,u.isTcpSubchannelAddress)(e)?{host:e.host,port:t}:e;let n=m();return new Promise((i,s)=>{let a=t=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(e)+" with error "+t.message),i(t)};n.once("error",a),n.listen(r,()=>{let e;if(this.shutdown){n.close(),i(Error("bindAsync failed because server is shutdown"));return}let r=n.address();e="string"==typeof r?{path:r}:{host:r.address,port:r.port};let s=(0,h.registerChannelzSocket)((0,u.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(s),this.http2ServerList.push({server:n,channelzRef:s}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(e)),i("port"in e?e.port:t),n.removeListener("error",a)})})})).then(e=>{let n=0;for(let r of e)if("number"==typeof r&&(n+=1,r!==t))throw Error("Invalid state: multiple port numbers added from single address");return{port:t,count:n+r}}),v=e=>{if(0===e.length)return Promise.resolve({port:0,count:0});let t=e[0],r=m();return new Promise((n,i)=>{let s=r=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(t)+" with error "+r.message),n(v(e.slice(1)))};r.once("error",s),r.listen(t,()=>{if(this.shutdown){r.close(),n({port:0,count:0});return}let t=r.address(),i={host:t.address,port:t.port},a=(0,h.registerChannelzSocket)((0,u.subchannelAddressToString)(i),()=>({localAddress:i,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(a),this.http2ServerList.push({server:r,channelzRef:a}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(i)),n(g(e.slice(1),t.port,1)),r.removeListener("error",s)})})},b={onSuccessfulResolution:(t,r,n)=>{let s;(b.onSuccessfulResolution=()=>{},this.shutdown&&p(Error("bindAsync failed because server is shutdown"),0),0===t.length)?p(Error(`No addresses resolved for port ${e}`),0):(s=(0,u.isTcpSubchannelAddress)(t[0])?0===t[0].port?v(t):g(t,t[0].port,0):g(t,1,0)).then(e=>{if(0===e.count){let e=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,e),p(Error(e),0)}else e.count<t.length&&l.log(i.LogVerbosity.INFO,`WARNING Only ${e.count} addresses added out of total ${t.length} resolved`),p(null,e.port)},e=>{let r=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,r),p(Error(r),0)})},onError:e=>{p(Error(e.details),0)}};(0,o.createResolver)(d,b,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(n.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,n,i){return!this.handlers.has(e)&&(this.handlers.set(e,{func:t,serialize:r,deserialize:n,type:i,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:e})=>!0!==e.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=t=>{this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef),e(t)},r=0;function n(){0==--r&&t()}for(let{server:e,channelzRef:t}of(this.started=!1,this.shutdown=!0,this.http2ServerList))e.listening&&(r++,e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t)),n()}));this.sessions.forEach((e,t)=>{t.closed||(r+=1,t.close(n))}),0===r&&t()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[n.constants.HTTP2_HEADER_CONTENT_TYPE];return"string"==typeof r&&!!r.startsWith("application/grpc")||(e.respond({[n.constants.HTTP2_HEADER_STATUS]:n.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return void 0===t?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let n=new s.Http2ServerCallStream(t,null,this.options);void 0===e.code&&(e.code=i.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed()),n.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),null==r||r.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed();return}let n=t[m],a=this._retrieveHandler(n);if(!a)return void this._respondWithError(v(n),e,r);let o=new s.Http2ServerCallStream(e,a,this.options);o.once("callEnd",e=>{e===i.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",e=>{e?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,a,t)||(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed(),o.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${a.type}`}))}_streamHandler(e,t){if(!0!==this._verifyContentType(e,t))return;let r=t[m],n=this._retrieveHandler(r);if(!n)return void this._respondWithError(v(r),e,null);let a=new s.Http2ServerCallStream(e,n,this.options);this._runHandlerForCall(a,n,t)||a.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${n.type}`})}_runHandlerForCall(e,t,r){var n;let i=e.receiveMetadata(r),s=null!=(n=i.get("grpc-encoding")[0])?n:"identity";i.remove("grpc-encoding");let{type:a}=t;if("unary"===a)w(e,t,i,s);else if("clientStream"===a)C(e,t,i,s);else if("serverStream"===a)T(e,t,i,s);else{if("bidi"!==a)return!1;E(e,t,i,s)}return!0}_setupHandlers(e){if(null===e)return;let t=e.address(),r="null";t&&(r="string"==typeof t?t:t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",e=>{var t,r,i,s,a;if(!this.started)return void e.destroy();let o=(0,h.registerChannelzSocket)(null!=(t=e.socket.remoteAddress)?t:"unknown",this.getChannelzSessionInfoGetter(e),this.channelzEnabled),l={ref:o,streamTracker:new h.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(e,l);let u=e.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+u),this.sessionChildrenTracker.refChild(o));let c=null,f=null,p=!1;if(this.maxConnectionAgeMs!==d){let t=this.maxConnectionAgeMs/10,s=Math.random()*t*2-t;c=null==(i=(r=setTimeout(()=>{var t,r;p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+u);try{e.goaway(n.constants.NGHTTP2_NO_ERROR,0x7fffffff,Buffer.from("max_age"))}catch(t){e.destroy();return}e.close(),this.maxConnectionAgeGraceMs!==d&&(f=null==(r=(t=setTimeout(()=>{e.destroy()},this.maxConnectionAgeGraceMs)).unref)?void 0:r.call(t))},this.maxConnectionAgeMs+s)).unref)?void 0:i.call(r)}let m=null==(a=(s=setInterval(()=>{var t,r;let n=null==(r=(t=setTimeout(()=>{p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+u),e.close()},this.keepaliveTimeoutMs)).unref)?void 0:r.call(t);try{e.ping((e,t,r)=>{clearTimeout(n)})}catch(t){e.destroy()}},this.keepaliveTimeMs)).unref)?void 0:a.call(s);e.on("close",()=>{this.channelzEnabled&&(p||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+u),this.sessionChildrenTracker.unrefChild(o),(0,h.unregisterChannelzRef)(o)),c&&clearTimeout(c),f&&clearTimeout(f),m&&clearTimeout(m),this.sessions.delete(e)})})}}async function w(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerUnaryCallImpl(e,r,i);t.func(a,(t,r,n,i)=>{e.sendUnaryMessage(t,r,n,i)})}catch(t){e.sendError(t)}}function C(e,t,r,n){let i=new s.ServerReadableStreamImpl(e,r,t.deserialize,n);function a(t,r,n,s){i.destroy(),e.sendUnaryMessage(t,r,n,s)}e.cancelled||(i.on("error",a),t.func(i,a))}async function T(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerWritableStreamImpl(e,r,t.serialize,i);t.func(a)}catch(t){e.sendError(t)}}function E(e,t,r,n){let i=new s.ServerDuplexStreamImpl(e,r,t.serialize,t.deserialize,n);e.cancelled||t.func(i)}r.Server=S},378078,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StatusBuilder=void 0;class n{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return null!==this.code&&(e.code=this.code),null!==this.details&&(e.details=this.details),null!==this.metadata&&(e.metadata=this.metadata),e}}r.StatusBuilder=n},805305,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isDuration=r.durationToMs=r.msToDuration=void 0,r.msToDuration=function(e){return{seconds:e/1e3|0,nanos:e%1e3*1e6|0}},r.durationToMs=function(e){return 1e3*e.seconds+e.nanos/1e6|0},r.isDuration=function(e){return"number"==typeof e.seconds&&"number"==typeof e.nanos}},557609,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.OutlierDetectionLoadBalancer=r.OutlierDetectionLoadBalancingConfig=void 0;let i=e.r(306971),s=e.r(825933),a=e.r(805305),o=e.r(997682),l=e.r(412065),u=e.r(559760),c=e.r(919732),h=e.r(18806),d=e.r(590238),f=e.r(709917),p="outlier_detection";function m(e){f.trace(s.LogVerbosity.DEBUG,p,e)}let g="outlier_detection",y=(null!=(n=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)?n:"true")==="true",v={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},b={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function S(e,t,r,n){if(t in e&&typeof e[t]!==r){let i=n?`${n}.${t}`:t;throw Error(`outlier detection config ${i} parse error: expected ${r}, got ${typeof e[t]}`)}}function w(e,t,r){let n=r?`${r}.${t}`:t;if(t in e){if(!(0,a.isDuration)(e[t]))throw Error(`outlier detection config ${n} parse error: expected Duration, got ${typeof e[t]}`);if(!(e[t].seconds>=0&&e[t].seconds<=315576e6&&e[t].nanos>=0&&e[t].nanos<=0x3b9ac9ff))throw Error(`outlier detection config ${n} parse error: values out of range for non-negative Duaration`)}}function C(e,t,r){let n=r?`${r}.${t}`:t;if(S(e,t,"number",r),t in e&&!(e[t]>=0&&e[t]<=100))throw Error(`outlier detection config ${n} parse error: value out of range for percentage (0-100)`)}class T{constructor(e,t,r,n,i,s,a){if(this.childPolicy=a,a.length>0&&"pick_first"===a[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=e?e:1e4,this.baseEjectionTimeMs=null!=t?t:3e4,this.maxEjectionTimeMs=null!=r?r:3e5,this.maxEjectionPercent=null!=n?n:10,this.successRateEjection=i?Object.assign(Object.assign({},v),i):null,this.failurePercentageEjection=s?Object.assign(Object.assign({},b),s):null}getLoadBalancerName(){return g}toJsonObject(){return{interval:(0,a.msToDuration)(this.intervalMs),base_ejection_time:(0,a.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,a.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new T(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(w(e,"interval"),w(e,"base_ejection_time"),w(e,"max_ejection_time"),C(e,"max_ejection_percent"),"success_rate_ejection"in e){if("object"!=typeof e.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");S(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),C(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),S(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),S(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if("object"!=typeof e.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");C(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),C(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),S(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),S(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new T(e.interval?(0,a.durationToMs)(e.interval):null,e.base_ejection_time?(0,a.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,a.durationToMs)(e.max_ejection_time):null,null!=(t=e.max_ejection_percent)?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(l.validateLoadBalancingConfig))}}r.OutlierDetectionLoadBalancingConfig=T;class E extends d.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((e,t,r,n)=>{if(this.childSubchannelState=r,!this.ejected)for(let e of this.stateListeners)e(this,t,r,n)})}getConnectivityState(){return this.ejected?i.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){for(let e of(this.ejected=!0,this.stateListeners))e(this,this.childSubchannelState,i.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let e of(this.ejected=!1,this.stateListeners))e(this,i.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function _(){return{success:0,failure:0}}class I{constructor(){this.activeBucket=_(),this.inactiveBucket=_()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=_()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class k{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType!==c.PickResultType.COMPLETE)return t;{let e=t.subchannel,r=e.getMapEntry();if(!r)return Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel()});{let n=t.onCallEnded;return this.countCalls&&(n=e=>{var n;e===s.Status.OK?r.counter.addSuccess():r.counter.addFailure(),null==(n=t.onCallEnded)||n.call(t,e)}),Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel(),onCallEnded:n})}}}}class x{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new u.ChildLoadBalancerHandler((0,o.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let n=e.createSubchannel(t,r),i=this.addressMap.get((0,h.subchannelAddressToString)(t)),s=new E(n,i);return(null==i?void 0:i.currentEjectionTimestamp)!==null&&s.eject(),null==i||i.subchannelWrappers.push(s),s},updateState:(t,r)=>{t===i.ConnectivityState.READY?e.updateState(t,new k(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())null!==t.currentEjectionTimestamp&&(e+=1);return 100*e/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;m("Running success rate check");let r=t.request_volume,n=0,i=[];for(let[e,t]of this.addressMap){let s=t.counter.getLastSuccesses(),a=t.counter.getLastFailures();m("Stats for "+e+": successes="+s+" failures="+a+" targetRequestVolume="+r),s+a>=r&&(n+=1,i.push(s/(s+a)))}if(m("Found "+n+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+i+"]"),n<t.minimum_hosts)return;let s=i.reduce((e,t)=>e+t)/i.length,a=0;for(let e of i){let t=e-s;a+=t*t}let o=Math.sqrt(a/i.length),l=s-o*(t.stdev_factor/1e3);for(let[n,i]of(m("stdev="+o+" ejectionThreshold="+l),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let s=i.counter.getLastSuccesses(),a=i.counter.getLastFailures();if(s+a<r)continue;let o=s/(s+a);if(m("Checking candidate "+n+" successRate="+o),o<l){let r=100*Math.random();m("Candidate "+n+" randomNumber="+r+" enforcement_percentage="+t.enforcement_percentage),r<t.enforcement_percentage&&(m("Ejecting candidate "+n),this.eject(i,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;m("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let e of this.addressMap.values())e.counter.getLastSuccesses()+e.counter.getLastFailures()>=t.request_volume&&(r+=1);if(!(r<t.minimum_hosts))for(let[r,n]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let i=n.counter.getLastSuccesses(),s=n.counter.getLastFailures();if((m("Candidate successes="+i+" failures="+s),!(i+s<t.request_volume))&&100*s/(s+i)>t.threshold){let i=100*Math.random();m("Candidate "+r+" randomNumber="+i+" enforcement_percentage="+t.enforcement_percentage),i<t.enforcement_percentage&&(m("Ejecting candidate "+r),this.eject(n,e))}}}eject(e,t){for(let t of(e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1,e.subchannelWrappers))t.eject()}uneject(e){for(let t of(e.currentEjectionTimestamp=null,e.subchannelWrappers))t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),null==(r=(t=this.ejectionTimer).unref)||r.call(t)}runChecks(){let e=new Date;if(m("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[t,r]of(this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e),this.addressMap.entries()))if(null===r.currentEjectionTimestamp)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let e=this.latestConfig.getBaseEjectionTimeMs(),n=this.latestConfig.getMaxEjectionTimeMs(),i=new Date(r.currentEjectionTimestamp.getTime());i.setMilliseconds(i.getMilliseconds()+Math.min(e*r.ejectionTimeMultiplier,Math.max(e,n))),i<new Date&&(m("Unejecting "+t),this.uneject(r))}}updateAddressList(e,t,r){if(!(t instanceof T))return;let n=new Set;for(let t of e)n.add((0,h.subchannelAddressToString)(t));for(let e of n)this.addressMap.has(e)||(m("Adding map entry for "+e),this.addressMap.set(e,{counter:new I,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let e of this.addressMap.keys())n.has(e)||(m("Removing map entry for "+e),this.addressMap.delete(e));let i=(0,l.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,i,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){m("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let e=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(e)}else m("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else for(let e of(m("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(e),e.ejectionTimeMultiplier=0;this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return g}}r.OutlierDetectionLoadBalancer=x,r.setup=function(){y&&(0,o.registerLoadBalancerType)(g,x,T)}},997682,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.OutlierDetectionLoadBalancingConfig=r.BaseSubchannelWrapper=r.registerAdminService=r.FilterStackFactory=r.BaseFilter=r.PickResultType=r.QueuePicker=r.UnavailablePicker=r.ChildLoadBalancerHandler=r.subchannelAddressToString=r.validateLoadBalancingConfig=r.getFirstUsableConfig=r.registerLoadBalancerType=r.createChildChannelControlHelper=r.BackoffTimeout=r.durationToMs=r.uriToString=r.createResolver=r.registerResolver=r.log=r.trace=void 0;var n=e.r(709917);Object.defineProperty(r,"trace",{enumerable:!0,get:function(){return n.trace}}),Object.defineProperty(r,"log",{enumerable:!0,get:function(){return n.log}});var i=e.r(624950);Object.defineProperty(r,"registerResolver",{enumerable:!0,get:function(){return i.registerResolver}}),Object.defineProperty(r,"createResolver",{enumerable:!0,get:function(){return i.createResolver}});var s=e.r(570823);Object.defineProperty(r,"uriToString",{enumerable:!0,get:function(){return s.uriToString}});var a=e.r(805305);Object.defineProperty(r,"durationToMs",{enumerable:!0,get:function(){return a.durationToMs}});var o=e.r(984883);Object.defineProperty(r,"BackoffTimeout",{enumerable:!0,get:function(){return o.BackoffTimeout}});var l=e.r(412065);Object.defineProperty(r,"createChildChannelControlHelper",{enumerable:!0,get:function(){return l.createChildChannelControlHelper}}),Object.defineProperty(r,"registerLoadBalancerType",{enumerable:!0,get:function(){return l.registerLoadBalancerType}}),Object.defineProperty(r,"getFirstUsableConfig",{enumerable:!0,get:function(){return l.getFirstUsableConfig}}),Object.defineProperty(r,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return l.validateLoadBalancingConfig}});var u=e.r(18806);Object.defineProperty(r,"subchannelAddressToString",{enumerable:!0,get:function(){return u.subchannelAddressToString}});var c=e.r(559760);Object.defineProperty(r,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return c.ChildLoadBalancerHandler}});var h=e.r(919732);Object.defineProperty(r,"UnavailablePicker",{enumerable:!0,get:function(){return h.UnavailablePicker}}),Object.defineProperty(r,"QueuePicker",{enumerable:!0,get:function(){return h.QueuePicker}}),Object.defineProperty(r,"PickResultType",{enumerable:!0,get:function(){return h.PickResultType}});var d=e.r(770721);Object.defineProperty(r,"BaseFilter",{enumerable:!0,get:function(){return d.BaseFilter}});var f=e.r(368021);Object.defineProperty(r,"FilterStackFactory",{enumerable:!0,get:function(){return f.FilterStackFactory}});var p=e.r(23135);Object.defineProperty(r,"registerAdminService",{enumerable:!0,get:function(){return p.registerAdminService}});var m=e.r(590238);Object.defineProperty(r,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return m.BaseSubchannelWrapper}});var g=e.r(557609);Object.defineProperty(r,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return g.OutlierDetectionLoadBalancingConfig}})},641946,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;let n=e.r(624950);class i{constructor(e,t,r){let n;this.listener=t,this.addresses=[],this.hasReturnedResult=!1,n=""===e.authority?"/"+e.path:e.path,this.addresses=[{path:n}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}}r.setup=function(){(0,n.registerResolver)("unix",i)}},153391,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;let n=e.r(504446),i=e.r(825933),s=e.r(736063),a=e.r(624950),o=e.r(570823),l=e.r(709917),u="ip_resolver";function c(e){l.trace(i.LogVerbosity.DEBUG,u,e)}let h="ipv4",d="ipv6",f=443;class p{constructor(e,t,r){var a;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,c("Resolver constructed for target "+(0,o.uriToString)(e));const l=[];if(e.scheme!==h&&e.scheme!==d){this.error={code:i.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new s.Metadata};return}for(const t of e.path.split(",")){const r=(0,o.splitHostPort)(t);if(null===r||e.scheme===h&&!(0,n.isIPv4)(r.host)||e.scheme===d&&!(0,n.isIPv6)(r.host)){this.error={code:i.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${t}`,metadata:new s.Metadata};return}l.push({host:r.host,port:null!=(a=r.port)?a:f})}this.addresses=l,c("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}}r.setup=function(){(0,a.registerResolver)(h,p),(0,a.registerResolver)(d,p)}},233411,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.PickFirstLoadBalancer=r.shuffled=r.PickFirstLoadBalancingConfig=void 0;let n=e.r(412065),i=e.r(306971),s=e.r(919732),a=e.r(709917),o=e.r(825933),l="pick_first";function u(e){a.trace(o.LogVerbosity.DEBUG,l,e)}let c="pick_first",h=250;class d{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return c}toJsonObject(){return{[c]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&"boolean"!=typeof e.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new d(!0===e.shuffleAddressList)}}r.PickFirstLoadBalancingConfig=d;class f{constructor(e){this.subchannel=e}pick(e){return{pickResultType:s.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function p(e){let t=e.slice();for(let e=t.length-1;e>1;e--){let r=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[r],t[r]=n}return t}r.shuffled=p;class m{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=i.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(e,t,r,n,i)=>{this.onSubchannelStateUpdate(e,t,r,i)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(i.ConnectivityState.READY,new f(this.currentPick)):0===this.children.length?this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:e}of(this.stickyTransientFailureMode=!0,this.children))e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,n){var s;if(null==(s=this.currentPick)?void 0:s.realSubchannelEquals(e)){r!==i.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[t,s]of this.children.entries())if(e.realSubchannelEquals(s.subchannel)){r===i.ConnectivityState.READY&&this.pickSubchannel(s.subchannel),r===i.ConnectivityState.TRANSIENT_FAILURE&&(s.hasReportedTransientFailure=!0,n&&(this.lastError=n),this.maybeEnterStickyTransientFailureMode(),t===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(t+1)),s.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let e=r.subchannel.getConnectivityState();if(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.CONNECTING)return void this.startConnecting(t)}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===i.ConnectivityState.IDLE&&(u("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var t;null==(t=this.children[e])||t.subchannel.startConnecting()})),this.connectionDelayTimeout=null==(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},h)).unref)?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(u("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){u(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(e=>({subchannel:this.channelControlHelper.createSubchannel(e,{}),hasReportedTransientFailure:!1}));for(let{subchannel:e}of t)e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef());for(let{subchannel:e}of(this.resetSubchannelList(),this.children=t,this.children))if(e.addConnectivityStateListener(this.subchannelStateListener),e.getConnectivityState()===i.ConnectivityState.READY)return void this.pickSubchannel(e);for(let e of this.children)e.subchannel.getConnectivityState()===i.ConnectivityState.TRANSIENT_FAILURE&&(e.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof d&&(t.getShuffleAddressList()&&(e=p(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===i.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return c}}r.PickFirstLoadBalancer=m,r.setup=function(){(0,n.registerLoadBalancerType)(c,m,d),(0,n.registerDefaultLoadBalancerType)(c)}},875401,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.RoundRobinLoadBalancer=void 0;let n=e.r(412065),i=e.r(306971),s=e.r(919732),a=e.r(18806),o=e.r(709917),l=e.r(825933),u="round_robin";function c(e){o.trace(l.LogVerbosity.DEBUG,u,e)}let h="round_robin";class d{getLoadBalancerName(){return h}toJsonObject(){return{[h]:{}}}static createFromJson(e){return new d}}class f{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:s.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class p{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=i.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(e,t,r,n,s)=>{this.calculateAndUpdateState(),(r===i.ConnectivityState.TRANSIENT_FAILURE||r===i.ConnectivityState.IDLE)&&(s&&(this.lastError=s),this.channelControlHelper.requestReresolution(),e.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(i.ConnectivityState.READY)>0){let e=this.subchannels.filter(e=>e.getConnectivityState()===i.ConnectivityState.READY),t=0;null!==this.currentReadyPicker&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(t=0),this.updateState(i.ConnectivityState.READY,new f(e,t))}else this.countSubchannelsWithState(i.ConnectivityState.CONNECTING)>0?this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this)):this.countSubchannelsWithState(i.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this))}updateState(e,t){c(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),e===i.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){for(let t of(this.resetSubchannelList(),c("Connect to address list "+e.map(e=>(0,a.subchannelAddressToString)(e))),this.subchannels=e.map(e=>this.channelControlHelper.createSubchannel(e,{})),this.subchannels)){t.ref(),t.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(t.getChannelzRef());let e=t.getConnectivityState();(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.TRANSIENT_FAILURE)&&t.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return h}}r.RoundRobinLoadBalancer=p,r.setup=function(){(0,n.registerLoadBalancerType)(h,p,d)}},360688,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.experimental=r.addAdminServicesToServer=r.getChannelzHandlers=r.getChannelzServiceDefinition=r.InterceptorConfigurationError=r.InterceptingCall=r.RequesterBuilder=r.ListenerBuilder=r.StatusBuilder=r.getClientChannel=r.ServerCredentials=r.Server=r.setLogVerbosity=r.setLogger=r.load=r.loadObject=r.CallCredentials=r.ChannelCredentials=r.waitForClientReady=r.closeClient=r.Channel=r.makeGenericClientConstructor=r.makeClientConstructor=r.loadPackageDefinition=r.Client=r.compressionAlgorithms=r.propagate=r.connectivityState=r.status=r.logVerbosity=r.Metadata=r.credentials=void 0;let n=e.r(925910);Object.defineProperty(r,"CallCredentials",{enumerable:!0,get:function(){return n.CallCredentials}});let i=e.r(200494);Object.defineProperty(r,"Channel",{enumerable:!0,get:function(){return i.ChannelImplementation}});let s=e.r(921501);Object.defineProperty(r,"compressionAlgorithms",{enumerable:!0,get:function(){return s.CompressionAlgorithms}});let a=e.r(306971);Object.defineProperty(r,"connectivityState",{enumerable:!0,get:function(){return a.ConnectivityState}});let o=e.r(328079);Object.defineProperty(r,"ChannelCredentials",{enumerable:!0,get:function(){return o.ChannelCredentials}});let l=e.r(742683);Object.defineProperty(r,"Client",{enumerable:!0,get:function(){return l.Client}});let u=e.r(825933);Object.defineProperty(r,"logVerbosity",{enumerable:!0,get:function(){return u.LogVerbosity}}),Object.defineProperty(r,"status",{enumerable:!0,get:function(){return u.Status}}),Object.defineProperty(r,"propagate",{enumerable:!0,get:function(){return u.Propagate}});let c=e.r(709917),h=e.r(325930);Object.defineProperty(r,"loadPackageDefinition",{enumerable:!0,get:function(){return h.loadPackageDefinition}}),Object.defineProperty(r,"makeClientConstructor",{enumerable:!0,get:function(){return h.makeClientConstructor}}),Object.defineProperty(r,"makeGenericClientConstructor",{enumerable:!0,get:function(){return h.makeClientConstructor}});let d=e.r(736063);Object.defineProperty(r,"Metadata",{enumerable:!0,get:function(){return d.Metadata}});let f=e.r(94152);Object.defineProperty(r,"Server",{enumerable:!0,get:function(){return f.Server}});let p=e.r(410898);Object.defineProperty(r,"ServerCredentials",{enumerable:!0,get:function(){return p.ServerCredentials}});let m=e.r(378078);Object.defineProperty(r,"StatusBuilder",{enumerable:!0,get:function(){return m.StatusBuilder}}),r.credentials={combineChannelCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),combineCallCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),createInsecure:o.ChannelCredentials.createInsecure,createSsl:o.ChannelCredentials.createSsl,createFromSecureContext:o.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:n.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:n.CallCredentials.createFromGoogleCredential,createEmpty:n.CallCredentials.createEmpty},r.closeClient=e=>e.close(),r.waitForClientReady=(e,t,r)=>e.waitForReady(t,r),r.loadObject=(e,t)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},r.load=(e,t,r)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},r.setLogger=e=>{c.setLogger(e)},r.setLogVerbosity=e=>{c.setLoggerVerbosity(e)},r.getClientChannel=e=>l.Client.prototype.getChannel.call(e);var g=e.r(129561);Object.defineProperty(r,"ListenerBuilder",{enumerable:!0,get:function(){return g.ListenerBuilder}}),Object.defineProperty(r,"RequesterBuilder",{enumerable:!0,get:function(){return g.RequesterBuilder}}),Object.defineProperty(r,"InterceptingCall",{enumerable:!0,get:function(){return g.InterceptingCall}}),Object.defineProperty(r,"InterceptorConfigurationError",{enumerable:!0,get:function(){return g.InterceptorConfigurationError}});var y=e.r(880064);Object.defineProperty(r,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return y.getChannelzServiceDefinition}}),Object.defineProperty(r,"getChannelzHandlers",{enumerable:!0,get:function(){return y.getChannelzHandlers}});var v=e.r(23135);Object.defineProperty(r,"addAdminServicesToServer",{enumerable:!0,get:function(){return v.addAdminServicesToServer}}),r.experimental=e.r(997682);let b=e.r(560848),S=e.r(641946),w=e.r(153391),C=e.r(233411),T=e.r(875401),E=e.r(557609),_=e.r(880064);(()=>{b.setup(),S.setup(),w.setup(),C.setup(),T.setup(),E.setup(),_.setup()})()},564153,643929,708825,401212,342585,918042,e=>{"use strict";let t,r,n=()=>void 0,i={NODE_CLIENT:!1},s=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},a=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},o={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,c=(3&i)<<4|a>>4,h=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(h=64)),n.push(r[u],r[c],r[h],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):a(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new l;let u=i<<2|s>>4;if(n.push(u),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let u=function(e){let t=s(e);return o.encodeByteArray(t,!0)},c=function(e){return u(e).replace(/\./g,"")},h=function(e){try{return o.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function d(){return"undefined"!=typeof self?self:e.g}let f=()=>d().__FIREBASE_DEFAULTS__,p=()=>{if("undefined"==typeof process||void 0===process.env)return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},m=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&h(e[1]);return t&&JSON.parse(t)},g=()=>{try{return n()||f()||p()||m()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},y=e=>g()?.emulatorHosts?.[e],v=e=>{let t=y(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},b=()=>g()?.config;class S{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function w(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function C(e){return(await fetch(e,{credentials:"include"})).ok}function T(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r={alg:"none",type:"JWT"},n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...e},o="";return[c(JSON.stringify(r)),c(JSON.stringify(a)),o].join(".")}function E(e,t){}function _(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function I(){return!1}function k(){let t=g()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function x(){return R()}function R(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function D(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function A(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function O(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function N(){let e=_();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function P(){return!k()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function M(){return!k()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function L(){try{return"object"==typeof indexedDB}catch(e){return!1}}function B(){return new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}})}let F="FirebaseError";class j extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=F,Object.setPrototypeOf(this,j.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,V.prototype.create)}}class V{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?q(i,r):"Error",a=`${this.serviceName}: ${s} (${n}).`;return new j(n,a,r)}}function q(e,t){return e.replace(z,(e,r)=>{let n=t[r];return null!=n?String(n):`<${r}?>`})}let z=/\{\$([^}]+)}/g;function U(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if($(r)&&$(s)){if(!U(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function $(e){return null!==e&&"object"==typeof e}function K(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function W(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function G(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function H(e,t){let r=new Q(e,t);return r.subscribe.bind(r)}class Q{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=J(e,["next","error","complete"])?e:{next:e,error:t,complete:r}).next&&(n.next=Y),void 0===n.error&&(n.error=Y),void 0===n.complete&&(n.complete=Y);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function J(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}function Y(){}function X(e){return e&&e._delegate?e._delegate:e}i.NODE_CLIENT=!0,e.s(["Deferred",()=>S,"ErrorFactory",()=>V,"FirebaseError",()=>j,"base64Decode",()=>h,"base64urlEncodeWithoutPadding",()=>c,"createMockUserToken",()=>T,"createSubscribe",()=>H,"deepEqual",()=>U,"extractQuerystring",()=>G,"getDefaultAppConfig",()=>b,"getDefaultEmulatorHost",()=>y,"getDefaultEmulatorHostnameAndPort",()=>v,"getGlobal",()=>d,"getModularInstance",()=>X,"getUA",()=>_,"isBrowser",()=>x,"isBrowserExtension",()=>A,"isCloudWorkstation",()=>w,"isCloudflareWorker",()=>D,"isIE",()=>N,"isIndexedDBAvailable",()=>L,"isMobileCordova",()=>I,"isReactNative",()=>O,"isSafari",()=>P,"isSafariOrWebkit",()=>M,"isWebWorker",()=>R,"pingServer",()=>C,"querystring",()=>K,"querystringDecode",()=>W,"updateEmulatorBanner",()=>E,"validateIndexedDBOpenable",()=>B],643929);class Z{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let ee="[DEFAULT]";class et{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new S;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(en(e))try{this.getOrInitializeService({instanceIdentifier:ee})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=ee){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ee){return this.instances.has(e)}getOptions(e=ee){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(r)??new Set;n.add(e),this.onInitCallbacks.set(r,n);let i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:er(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ee){return this.component?this.component.multipleInstances?e:ee:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function er(e){return e===ee?void 0:e}function en(e){return"EAGER"===e.instantiationMode}class ei{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new et(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}e.s(["Component",()=>Z,"ComponentContainer",()=>ei],708825);let es=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(tb||(tb={}));let ea={debug:tb.DEBUG,verbose:tb.VERBOSE,info:tb.INFO,warn:tb.WARN,error:tb.ERROR,silent:tb.SILENT},eo=tb.INFO,el={[tb.DEBUG]:"log",[tb.VERBOSE]:"log",[tb.INFO]:"info",[tb.WARN]:"warn",[tb.ERROR]:"error"},eu=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=el[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class ec{constructor(e){this.name=e,this._logLevel=eo,this._logHandler=eu,this._userLogHandler=null,es.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in tb))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ea[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,tb.DEBUG,...e),this._logHandler(this,tb.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,tb.VERBOSE,...e),this._logHandler(this,tb.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,tb.INFO,...e),this._logHandler(this,tb.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,tb.WARN,...e),this._logHandler(this,tb.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,tb.ERROR,...e),this._logHandler(this,tb.ERROR,...e)}}function eh(e){es.forEach(t=>{t.setLogLevel(e)})}function ed(e,t){for(let r of es){let n=null;t&&t.level&&(n=ea[t.level]),null===e?r.userLogHandler=null:r.userLogHandler=(t,r,...i)=>{let s=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");r>=(n??t.logLevel)&&e({level:tb[r].toLowerCase(),message:s,args:i,type:t.name})}}}e.s(["LogLevel",()=>tb,"Logger",()=>ec,"setLogLevel",()=>eh,"setUserLogHandler",()=>ed],401212);let ef=(e,t)=>t.some(t=>e instanceof t);function ep(){return t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function em(){return r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let eg=new WeakMap,ey=new WeakMap,ev=new WeakMap,eb=new WeakMap,eS=new WeakMap;function ew(e){let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(ek(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&eg.set(t,e)}).catch(()=>{}),eS.set(t,e),t}function eC(e){if(ey.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});ey.set(e,t)}let eT={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return ey.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ev.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return ek(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eE(e){eT=e(eT)}function e_(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?em().includes(e)?function(...t){return e.apply(ex(this),t),ek(eg.get(this))}:function(...t){return ek(e.apply(ex(this),t))}:function(t,...r){let n=e.call(ex(this),t,...r);return ev.set(n,t.sort?t.sort():[t]),ek(n)}}function eI(e){return"function"==typeof e?e_(e):(e instanceof IDBTransaction&&eC(e),ef(e,ep()))?new Proxy(e,eT):e}function ek(e){if(e instanceof IDBRequest)return ew(e);if(eb.has(e))return eb.get(e);let t=eI(e);return t!==e&&(eb.set(e,t),eS.set(t,e)),t}let ex=e=>eS.get(e);function eR(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t),o=ek(a);return n&&a.addEventListener("upgradeneeded",e=>{n(ek(a.result),e.oldVersion,e.newVersion,ek(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}let eD=["get","getKey","getAll","getAllKeys","count"],eA=["put","add","delete","clear"],eO=new Map;function eN(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eO.get(t))return eO.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=eA.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||eD.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return eO.set(t,s),s}eE(e=>({...e,get:(t,r,n)=>eN(t,r)||e.get(t,r,n),has:(t,r)=>!!eN(t,r)||e.has(t,r)}));class eP{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!eM(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}function eM(e){let t=e.getComponent();return t?.type==="VERSION"}let eL="@firebase/app",eB="0.14.7",eF=new ec("@firebase/app"),ej="12.8.0",eV="[DEFAULT]",eq={[eL]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},ez=new Map,eU=new Map,e$=new Map;function eK(e,t){try{e.container.addComponent(t)}catch(r){eF.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function eW(e,t){e.container.addOrOverwriteComponent(t)}function eG(e){let t=e.name;if(e$.has(t))return eF.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(e$.set(t,e),ez.values()))eK(r,e);for(let t of eU.values())eK(t,e);return!0}function eH(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function eQ(e,t,r=eV){eH(e,t).clearInstance(r)}function eJ(e){return void 0!==e.options}function eY(e){return!eJ(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function eX(e){return null!=e&&void 0!==e.settings}function eZ(){e$.clear()}let e0=new V("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class e1{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Z("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw e0.create("app-deleted",{appName:this._name})}}function e2(e,t){let r=h(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class e3 extends e1{constructor(e,t,r,n){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:r,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&e2(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&e2(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,te(eL,eB,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){e9(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw e0.create("server-app-deleted")}}let e6=ej;function e5(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n={name:eV,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw e0.create("bad-app-name",{appName:String(i)});if(r||(r=b()),!r)throw e0.create("no-options");let s=ez.get(i);if(s)if(U(r,s.options)&&U(n,s.config))return s;else throw e0.create("duplicate-app",{appName:i});let a=new ei(i);for(let e of e$.values())a.addComponent(e);let o=new e1(r,n,a);return ez.set(i,o),o}function e4(e,t={}){let r;if(x()&&!R())throw e0.create("invalid-server-app-environment");let n=t||{};if(e&&(eJ(e)?r=e.options:eY(e)?n=e:r=e),void 0===n.automaticDataCollectionEnabled&&(n.automaticDataCollectionEnabled=!0),r||(r=b()),!r)throw e0.create("no-options");let i={...n,...r};void 0!==i.releaseOnDeref&&delete i.releaseOnDeref;let s=e=>[...e].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0);if(void 0!==n.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw e0.create("finalization-registry-not-supported",{});let a=""+s(JSON.stringify(i)),o=eU.get(a);if(o)return o.incRefCount(n.releaseOnDeref),o;let l=new ei(a);for(let e of e$.values())l.addComponent(e);let u=new e3(r,n,a,l);return eU.set(a,u),u}function e8(e=eV){let t=ez.get(e);if(!t&&e===eV&&b())return e5();if(!t)throw e0.create("no-app",{appName:e});return t}function e7(){return Array.from(ez.values())}async function e9(e){let t=!1,r=e.name;ez.has(r)?(t=!0,ez.delete(r)):eU.has(r)&&0>=e.decRefCount()&&(eU.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function te(e,t,r){let n=eq[e]??e;r&&(n+=`-${r}`);let i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${n}" with version "${t}":`];i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eF.warn(e.join(" "));return}eG(new Z(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}function tt(e,t){if(null!==e&&"function"!=typeof e)throw e0.create("invalid-log-argument");ed(e,t)}function tr(e){eh(e)}let tn="firebase-heartbeat-database",ti=1,ts="firebase-heartbeat-store",ta=null;function to(){return ta||(ta=eR(tn,ti,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ts)}catch(e){console.warn(e)}}}).catch(e=>{throw e0.create("idb-open",{originalErrorMessage:e.message})})),ta}async function tl(e){try{let t=(await to()).transaction(ts),r=await t.objectStore(ts).get(tc(e));return await t.done,r}catch(e){if(e instanceof j)eF.warn(e.message);else{let t=e0.create("idb-get",{originalErrorMessage:e?.message});eF.warn(t.message)}}}async function tu(e,t){try{let r=(await to()).transaction(ts,"readwrite"),n=r.objectStore(ts);await n.put(t,tc(e)),await r.done}catch(e){if(e instanceof j)eF.warn(e.message);else{let t=e0.create("idb-set",{originalErrorMessage:e?.message});eF.warn(t.message)}}}function tc(e){return`${e.name}!${e.options.appId}`}let th=1024,td=30;class tf{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tg(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tp();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>td){let e=tv(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){eF.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=tp(),{heartbeatsToSend:t,unsentEntries:r}=tm(this._heartbeatsCache.heartbeats),n=c(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return eF.warn(e),""}}}function tp(){return new Date().toISOString().substring(0,10)}function tm(e,t=th){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),ty(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),ty(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class tg{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!L()&&B().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tl(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function ty(e){return c(JSON.stringify({version:2,heartbeats:e})).length}function tv(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(function(e){eG(new Z("platform-logger",e=>new eP(e),"PRIVATE")),eG(new Z("heartbeat",e=>new tf(e),"PRIVATE")),te(eL,eB,""),te(eL,eB,"esm2020"),te("fire-js","")})(""),e.s(["SDK_VERSION",()=>e6,"_DEFAULT_ENTRY_NAME",()=>eV,"_addComponent",()=>eK,"_addOrOverwriteComponent",()=>eW,"_apps",()=>ez,"_clearComponents",()=>eZ,"_components",()=>e$,"_getProvider",()=>eH,"_isFirebaseApp",()=>eJ,"_isFirebaseServerApp",()=>eX,"_isFirebaseServerAppSettings",()=>eY,"_registerComponent",()=>eG,"_removeServiceInstance",()=>eQ,"_serverApps",()=>eU,"deleteApp",()=>e9,"getApp",()=>e8,"getApps",()=>e7,"initializeApp",()=>e5,"initializeServerApp",()=>e4,"onLog",()=>tt,"registerVersion",()=>te,"setLogLevel",()=>tr],342585);var tb,tS,tw,tC,tT,tE="undefined"!=typeof globalThis?globalThis:e.g,t_={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function t(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function r(e,t){var r=s;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=t(e)}function n(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}(function(e,t){function r(){}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}})(e,function(){this.blockSize=-1}),e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,r){void 0===r&&(r=e.length);let n=r-this.blockSize,i=this.C,s=this.h,a=0;for(;a<r;){if(0==s)for(;a<=n;)t(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<r;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){t(this,i),s=0;break}}else for(;a<r;)if(i[s++]=e[a++],s==this.blockSize){t(this,i),s=0;break}}this.h=s,this.o+=r},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var i,s={};function a(e){return -128<=e&&e<128?r(e,function(e){return new n([0|e],e<0?-1:0)}):new n([0|e],e<0?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return u;if(e<0)return p(o(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new n(t,0)}function l(e,t){if(0==e.length)throw Error("number format error: empty string");if((t=t||10)<2||36<t)throw Error("radix out of range: "+t);if("-"==e.charAt(0))return p(l(e.substring(1),t));if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character');let r=o(Math.pow(t,8)),n=u;for(let s=0;s<e.length;s+=8){var i=Math.min(8,e.length-s);let a=parseInt(e.substring(s,s+i),t);i<8?(i=o(Math.pow(t,i)),n=n.j(i).add(o(a))):n=(n=n.j(r)).add(o(a))}return n}var u=a(0),c=a(1),h=a(0x1000000);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function p(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new n(r,~e.h).add(c)}function m(e,t){return e.add(p(t))}function g(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function v(e,t){if(d(t))throw Error("division by zero");if(d(e))return new y(u,u);if(f(e))return t=v(p(e),t),new y(p(t.g),p(t.h));if(f(t))return t=v(e,p(t)),new y(p(t.g),t.h);if(e.g.length>30){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var r=c,n=t;0>=n.l(e);)r=b(r),n=b(n);var i=S(r,1),s=S(n,1);for(n=S(n,2),r=S(r,2);!d(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=S(n,1),r=S(r,1)}return t=m(e,i.j(t)),new y(i,t)}for(i=u;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=o(r)).j(t);f(a)||a.l(e)>0;)r-=n,a=(s=o(r)).j(t);d(s)&&(s=c),i=i.add(s),e=m(e,a)}return new y(i,e)}function b(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new n(r,e.h)}function S(e,t){let r=t>>5;t%=32;let i=e.g.length-r,s=[];for(let n=0;n<i;n++)s[n]=t>0?e.i(n+r)>>>t|e.i(n+r+1)<<32-t:e.i(n+r);return new n(s,e.h)}(i=n.prototype).m=function(){if(f(this))return-p(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},i.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(f(this))return"-"+p(this).toString(e);let t=o(Math.pow(e,6));var r=this;let n="";for(;;){let i=v(r,t).g,s=(((r=m(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(d(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},i.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},i.l=function(e){return f(e=m(this,e))?-1:+!d(e)},i.abs=function(){return f(this)?p(this):this},i.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],i=0;for(let n=0;n<=t;n++){let t=i+(65535&this.i(n))+(65535&e.i(n)),s=(t>>>16)+(this.i(n)>>>16)+(e.i(n)>>>16);i=s>>>16,t&=65535,s&=65535,r[n]=s<<16|t}return new n(r,-0x80000000&r[r.length-1]?-1:0)},i.j=function(e){if(d(this)||d(e))return u;if(f(this))return f(e)?p(this).j(p(e)):p(p(this).j(e));if(f(e))return p(this.j(p(e)));if(0>this.l(h)&&0>e.l(h))return o(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var i=0;i<2*t;i++)r[i]=0;for(i=0;i<this.g.length;i++)for(let t=0;t<e.g.length;t++){let n=this.i(i)>>>16,s=65535&this.i(i),a=e.i(t)>>>16,o=65535&e.i(t);r[2*i+2*t]+=s*o,g(r,2*i+2*t),r[2*i+2*t+1]+=n*o,g(r,2*i+2*t+1),r[2*i+2*t+1]+=s*a,g(r,2*i+2*t+1),r[2*i+2*t+2]+=n*a,g(r,2*i+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new n(r,0)},i.B=function(e){return v(this,e).h},i.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new n(r,this.h&e.h)},i.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new n(r,this.h|e.h)},i.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new n(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,tw=t_.Md5=e,n.prototype.add=n.prototype.add,n.prototype.multiply=n.prototype.j,n.prototype.modulo=n.prototype.B,n.prototype.compare=n.prototype.l,n.prototype.toNumber=n.prototype.m,n.prototype.toString=n.prototype.toString,n.prototype.getBits=n.prototype.i,n.fromNumber=o,n.fromString=l,tS=t_.Integer=n}).apply(void 0!==tE?tE:"undefined"!=typeof self?self:{});var tI=e.i(224361),tk=e.i(254799),tx=e.i(360688),tR=e.i(405695);class tD{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}tD.UNAUTHENTICATED=new tD(null),tD.GOOGLE_CREDENTIALS=new tD("google-credentials-uid"),tD.FIRST_PARTY=new tD("first-party-uid"),tD.MOCK_USER=new tD("mock-user");let tA="12.8.0";function tO(e){tA=e}function tN(e){return(0,tI.inspect)(e,{depth:100})}let tP=new ec("@firebase/firestore");function tM(){return tP.logLevel}function tL(e){tP.setLogLevel(e)}function tB(e,...t){if(tP.logLevel<=tb.DEBUG){let r=t.map(tV);tP.debug(`Firestore (${tA}): ${e}`,...r)}}function tF(e,...t){if(tP.logLevel<=tb.ERROR){let r=t.map(tV);tP.error(`Firestore (${tA}): ${e}`,...r)}}function tj(e,...t){if(tP.logLevel<=tb.WARN){let r=t.map(tV);tP.warn(`Firestore (${tA}): ${e}`,...r)}}function tV(e){if("string"==typeof e)return e;try{return tN(e)}catch(t){return e}}function tq(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,tz(e,n,r)}function tz(e,t,r){let n=`FIRESTORE (${tA}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{let e=JSON.stringify(r);n+=" CONTEXT: "+e}catch(e){n+=" CONTEXT: "+r}throw tF(n),Error(n)}function tU(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||tz(t,i,n)}function t$(e,t){e||tq(57014,t)}function tK(e,t){return e}let tW="ok",tG="cancelled",tH="unknown",tQ="invalid-argument",tJ="deadline-exceeded",tY="not-found",tX="already-exists",tZ="permission-denied",t0="unauthenticated",t1="resource-exhausted",t2="failed-precondition",t3="aborted",t6="out-of-range",t5="unimplemented",t4="internal",t8="unavailable",t7="data-loss";class t9 extends j{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class re{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class rt{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class rr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(tD.UNAUTHENTICATED))}shutdown(){}}class rn{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ri{constructor(e){this.authProvider=e,this.currentUser=tD.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){tU(void 0===this.tokenListener,42304);let r=this.tokenCounter,n=e=>this.tokenCounter!==r?(r=this.tokenCounter,t(e)):Promise.resolve(),i=new re;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),i.resolve(),i=new re,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{tB("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),s())};this.authProvider.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.authProvider.getImmediate({optional:!0});e?a(e):(tB("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new re)}},0),s()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(t).then(t=>this.tokenCounter!==e?(tB("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(tU("string"==typeof t.accessToken,31837,{tokenData:t}),new rt(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return tU(null===e||"string"==typeof e,2055,{currentUid:e}),new tD(e)}}class rs{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=tD.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class ra{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new rs(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(tD.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ro{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rl{constructor(e,t){this.appCheckProvider=t,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,eX(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken)}start(e,t){tU(void 0===this.tokenListener,3512);let r=e=>{null!=e.error&&tB("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.latestAppCheckToken;return this.latestAppCheckToken=e.token,tB("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.tokenListener=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{tB("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.appCheckProvider.getImmediate({optional:!0});e?n(e):tB("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new ro(this.serverAppAppCheckToken));let e=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(e).then(e=>e?(tU("string"==typeof e.token,44558,{tokenResult:e}),this.latestAppCheckToken=e.token,new ro(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}class ru{getToken(){return Promise.resolve(new ro(""))}invalidateToken(){}start(e,t){}shutdown(){}}function rc(e){if(!e)return new rr;switch(e.type){case"firstParty":return new ra(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new t9(tQ,"makeAuthCredentialsProvider failed due to invalid credential type")}}function rh(e){return(0,tk.randomBytes)(e)}class rd{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",n=20;for(;r.length<n;){let i=rh(40);for(let s=0;s<i.length;++s)r.length<n&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function rf(e,t){return e<t?-1:+(e>t)}function rp(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return ry(r)===ry(i)?rf(r,i):ry(r)?1:-1}return rf(e.length,t.length)}let rm=55296,rg=57343;function ry(e){let t=e.charCodeAt(0);return t>=rm&&t<=rg}function rv(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}function rb(e){return e+"\0"}let rS="__name__";class rw{constructor(e,t,r){void 0===t?t=0:t>e.length&&tq(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&tq(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===rw.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof rw?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=rw.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return rf(e.length,t.length)}static compareSegments(e,t){let r=rw.isNumericId(e),n=rw.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?rw.extractNumericId(e).compare(rw.extractNumericId(t)):rp(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return tS.fromString(e.substring(4,e.length-2))}}class rC extends rw{construct(e,t,r){return new rC(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new t9(tQ,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new rC(t)}static emptyPath(){return new rC([])}}let rT=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rE extends rw{construct(e,t,r){return new rE(e,t,r)}static isValidIdentifier(e){return rT.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rE.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===rS}static keyField(){return new rE([rS])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new t9(tQ,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new t9(tQ,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new t9(tQ,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new t9(tQ,"Unterminated ` in path: "+e);return new rE(t)}static emptyPath(){return new rE([])}}class r_{constructor(e){this.path=e}static fromPath(e){return new r_(rC.fromString(e))}static fromName(e){return new r_(rC.fromString(e).popFirst(5))}static empty(){return new r_(rC.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===rC.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return rC.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new r_(new rC(e.slice()))}}function rI(e,t,r){if(!r)throw new t9(tQ,`Function ${e}() cannot be called with an empty ${t}.`)}function rk(e,t,r,n){if(!0===t&&!0===n)throw new t9(tQ,`${e} and ${r} cannot be used together.`)}function rx(e){if(!r_.isDocumentKey(e))throw new t9(tQ,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function rR(e){if(r_.isDocumentKey(e))throw new t9(tQ,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function rD(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function rA(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e)if(e instanceof Array)return"an array";else{let t=rO(e);return t?`a custom ${t} object`:"an object"}else if("function"==typeof e)return"a function";else return tq(12329,{type:typeof e})}function rO(e){return e.constructor?e.constructor.name:null}function rN(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t))if(t.name===e.constructor.name)throw new t9(tQ,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");else{let r=rA(e);throw new t9(tQ,`Expected type '${t.name}', but it was: ${r}`)}return e}function rP(e,t){if(t<=0)throw new t9(tQ,`Function ${e}() requires a positive number, but it was: ${t}.`)}function rM(e,t){let r={typeString:e};return t&&(r.value=t),r}function rL(e,t){let r;if(!rD(e))throw new t9(tQ,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new t9(tQ,r);return!0}let rB=-0xe7791f700,rF=1e6;class rj{static now(){return rj.fromMillis(Date.now())}static fromDate(e){return rj.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*rF);return new rj(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new t9(tQ,"Timestamp nanoseconds out of range: "+t);if(e<rB||e>=0x3afff44180)throw new t9(tQ,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/rF}_compareTo(e){return this.seconds===e.seconds?rf(this.nanoseconds,e.nanoseconds):rf(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:rj._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(rL(e,rj._jsonSchema))return new rj(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds-rB).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}rj._jsonSchemaVersion="firestore/timestamp/1.0",rj._jsonSchema={type:rM("string",rj._jsonSchemaVersion),seconds:rM("number"),nanoseconds:rM("number")};class rV{static fromTimestamp(e){return new rV(e)}static min(){return new rV(new rj(0,0))}static max(){return new rV(new rj(0x3afff4417f,1e9-1))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let rq=-1,rz=0;class rU{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function r$(e){return e.fields.find(e=>2===e.kind)}function rK(e){return e.fields.filter(e=>2!==e.kind)}function rW(e){let t=rK(e);return 0===t.length?0:t[t.length-1].kind}function rG(e,t){let r=rf(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=rJ(e.fields[n],t.fields[n])))return r;return rf(e.fields.length,t.fields.length)}function rH(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}rU.UNKNOWN_ID=-1;class rQ{constructor(e,t){this.fieldPath=e,this.kind=t}}function rJ(e,t){let r=rE.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:rf(e.kind,t.kind)}class rY{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new rY(rz,r0.min())}}function rX(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new r0(rV.fromTimestamp(1e9===n?new rj(r+1,0):new rj(r,n)),r_.empty(),t)}function rZ(e){return new r0(e.readTime,e.key,rq)}class r0{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new r0(rV.min(),r_.empty(),rq)}static max(){return new r0(rV.max(),r_.empty(),rq)}}function r1(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=r_.comparator(e.documentKey,t.documentKey))?r:rf(e.largestBatchId,t.largestBatchId)}let r2="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class r3{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function r6(e){if(e.code===t2&&e.message===r2)tB("LocalStore","Unexpectedly lost primary lease");else throw e}class r5{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return(this.callbackAttached&&tq(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new r5((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();if(t instanceof r5)return t;return r5.resolve(t)}catch(e){return r5.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):r5.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):r5.reject(t)}static resolve(e){return new r5((t,r)=>{t(e)})}static reject(e){return new r5((t,r)=>{r(e)})}static waitFor(e){return new r5((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=r5.resolve(!1);for(let r of e)t=t.next(e=>e?r5.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new r5((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new r5((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let r4="SimpleDb",r8=3;class r7{static open(e,t,r,n){try{return new r7(t,e.transaction(n,r))}catch(e){throw new nr(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new re,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new nr(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=t=>{let r=no(t.target.error);this.completionDeferred.reject(new nr(e,r))}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(tB(r4,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new ni(this.transaction.objectStore(e))}}class r9{static delete(e){return tB(r4,"Removing database:",e),ns(d().indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!L())return!1;if(r9.isMockPersistence())return!0;let e=_(),t=r9.getIOSVersion(e),r=0<t&&t<10,n=ne(e),i=0<n&&n<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0)&&!r&&!i}static isMockPersistence(){return"undefined"!=typeof process&&process.env?.USE_MOCK_PERSISTENCE==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,this.lastClosedDbVersion=null,12.2===r9.getIOSVersion(_())&&tF("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(e){return this.db||(tB(r4,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new nr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new t9(t2,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new t9(t2,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new nr(e,n))},n.onupgradeneeded=e=>{tB(r4,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.schemaConverter.createOrUpgrade(t,n.transaction,e.oldVersion,this.version).next(()=>{tB(r4,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=e=>this.versionchangelistener(e)),this.db}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.ensureDb(e);let t=r7.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.maybeCommit(),e)).catch(e=>(t.abort(e),r5.reject(e))).toPromise();return s.catch(()=>{}),await t.completionPromise,s}catch(r){let e=r,t="FirebaseError"!==e.name&&s<r8;if(tB(r4,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ne(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class nt{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return ns(this.dbCursor.delete())}}class nr extends t9{constructor(e,t){super(t8,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function nn(e){return"IndexedDbTransactionError"===e.name}class ni{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(tB(r4,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(tB(r4,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ns(r)}add(e){return tB(r4,"ADD",this.store.name,e,e),ns(this.store.add(e))}get(e){return ns(this.store.get(e)).next(t=>(void 0===t&&(t=null),tB(r4,"GET",this.store.name,e,t),t))}delete(e){return tB(r4,"DELETE",this.store.name,e),ns(this.store.delete(e))}count(){return tB(r4,"COUNT",this.store.name),ns(this.store.count())}loadAll(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new r5((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.iterateCursor(e,(e,r)=>{t.push(r)}).next(()=>t)}}loadFirst(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new r5((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}deleteAll(e,t){tB(r4,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let n=this.cursor(r);return this.iterateCursor(n,(e,t,r)=>r.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.iterateCursor(n,t)}iterateSerial(e){let t=this.cursor({});return new r5((r,n)=>{t.onerror=e=>{n(no(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}iterateCursor(e,t){let r=[];return new r5((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new nt(i),a=t(i.primaryKey,i.value,s);if(a instanceof r5){let e=a.catch(e=>(s.done(),r5.reject(e)));r.push(e)}s.isDone?n():null===s.skipToKey?i.continue():i.continue(s.skipToKey)}}).next(()=>r5.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),!e.index)return this.store.openCursor(e.range,t);{let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}}}function ns(e){return new r5((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(no(e.target.error))}})}let na=!1;function no(e){let t=r9.getIOSVersion(_());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new t9("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return na||(na=!0,setTimeout(()=>{throw e},0)),e}}return e}let nl="IndexBackfiller",nu=15e3,nc=6e4,nh=50;class nd{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(nu)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(e){tB(nl,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.backfiller.backfill();tB(nl,`Documents written: ${e}`)}catch(e){nn(e)?tB(nl,"Ignoring IndexedDB error during index backfill: ",e):await r6(e)}await this.schedule(nc)})}}class nf{constructor(e,t){this.localStore=e,this.persistence=t}async backfill(e=nh){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))}writeIndexEntries(e,t){let r=new Set,n=t,i=!0;return r5.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(!(null===t||r.has(t)))return tB(nl,`Processing collection: ${t}`),this.writeEntriesForCollectionGroup(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.getNewOffset(n,r)).next(r=>(tB(nl,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=rZ(t);r1(n,r)>0&&(r=n)}),new r0(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class np{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.setPreviousValue(e),this.writeNewSequenceNumber=e=>t.writeSequenceNumber(e))}setPreviousValue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e}}np.INVALID=-1;let nm="\x01",ng="\x01",ny="\x10",nv="\x11";function nb(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t=nw(t)),t=nS(e.get(r),t);return nw(t)}function nS(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+=nm+ny;break;case nm:r+=nm+nv;break;default:r+=n}}return r}function nw(e){return e+nm+ng}function nC(e){let t=e.length;if(tU(t>=2,64408,{path:e}),2===t)return tU(e.charAt(0)===nm&&e.charAt(1)===ng,56145,{path:e}),rC.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf(nm,s);switch((t<0||t>r)&&tq(50515,{path:e}),e.charAt(t+1)){case ng:let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case ny:i+=e.substring(s,t),i+="\0";break;case nv:i+=e.substring(s,t+1);break;default:tq(61167,{path:e})}s=t+2}return new rC(n)}let nT="remoteDocuments",nE="owner",n_="owner",nI="mutationQueues",nk="userId",nx="mutations",nR="batchId",nD="userMutationsIndex",nA=["userId","batchId"];function nO(e){return[e]}function nN(e,t){return[e,nb(t)]}function nP(e,t,r){return[e,nb(t),r]}let nM={},nL="documentMutations",nB="remoteDocumentsV14",nF=["prefixPath","collectionGroup","readTime","documentId"],nj="documentKeyIndex",nV=["prefixPath","collectionGroup","documentId"],nq="collectionGroupIndex",nz=["collectionGroup","readTime","prefixPath","documentId"],nU="remoteDocumentGlobal",n$="remoteDocumentGlobalKey",nK="targets",nW="targetId",nG="queryTargetsIndex",nH=["canonicalId","targetId"],nQ="targetDocuments",nJ=["targetId","path"],nY="documentTargetsIndex",nX=["path","targetId"],nZ="targetGlobalKey",n0="targetGlobal",n1="collectionParents",n2=["collectionId","parent"],n3="clientMetadata",n6="clientId",n5="bundles",n4="bundleId",n8="namedQueries",n7="name",n9="indexConfiguration",ie="indexId",it="collectionGroupIndex",ir="collectionGroup",ii="indexState",is=["indexId","uid"],ia="sequenceNumberIndex",io=["uid","sequenceNumber"],il="indexEntries",iu=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ic="documentKeyIndex",ih=["indexId","uid","orderedDocumentKey"],id="documentOverlays",ip=["userId","collectionPath","documentId"],im="collectionPathOverlayIndex",ig=["userId","collectionPath","largestBatchId"],iy="collectionGroupOverlayIndex",iv=["userId","collectionGroup","largestBatchId"],ib="globals",iS="name",iw=[nI,nx,nL,nT,nK,nE,n0,nQ,n3,nU,n1,n5,n8],iC=[...iw,id],iT=[nI,nx,nL,nB,nK,nE,n0,nQ,n3,nU,n1,n5,n8,id],iE=iT,i_=[...iE,n9,ii,il],iI=i_,ik=[...i_,ib],ix=ik;function iR(e){return 18===e?ix:17===e?ik:16===e?iI:15===e?i_:14===e?iE:13===e?iT:12===e?iC:11===e?iw:void tq(60245)}class iD extends r3{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}}function iA(e,t){let r=tK(e);return r9.getStore(r.simpleDbTransaction,t)}function iO(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function iN(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function iP(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}function iM(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class iL{constructor(e,t){this.comparator=e,this.root=t||iF.EMPTY}insert(e,t){return new iL(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,iF.BLACK,null,null))}remove(e){return new iL(this.comparator,this.root.remove(e,this.comparator).copy(null,null,iF.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new iB(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new iB(this.root,e,this.comparator,!1)}getReverseIterator(){return new iB(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new iB(this.root,e,this.comparator,!0)}}class iB{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else if(0===i){this.nodeStack.push(e);break}else this.nodeStack.push(e),e=this.isReverse?e.right:e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class iF{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:iF.RED,this.left=null!=n?n:iF.EMPTY,this.right=null!=i?i:iF.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new iF(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return iF.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key))if(n.right.isEmpty())return iF.EMPTY;else r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,iF.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,iF.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw tq(43730,{key:this.key,value:this.value});if(this.right.isRed())throw tq(14113,{key:this.key,value:this.value});let e=this.left.check();if(e===this.right.check())return e+ +!this.isRed();throw tq(27949)}}iF.EMPTY=null,iF.RED=!0,iF.BLACK=!1;class ij{constructor(){this.size=0}get key(){throw tq(57766)}get value(){throw tq(16141)}get color(){throw tq(16727)}get left(){throw tq(29726)}get right(){throw tq(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new iF(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}iF.EMPTY=new ij;class iV{constructor(e){this.comparator=e,this.data=new iL(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new iq(this.data.getIterator())}getIteratorFrom(e){return new iq(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof iV)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new iV(this.comparator);return t.data=e,t}}class iq{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function iz(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=iU(s),l=iU(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=iU(a)):t?(i(o),o=iU(s)):(o=iU(s),l=iU(a))}}function iU(e){return e.hasNext()?e.getNext():void 0}class i${constructor(e){this.fields=e,e.sort(rE.comparator)}static empty(){return new i$([])}unionWith(e){let t=new iV(rE.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new i$(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return rv(this.fields,e.fields,(e,t)=>e.isEqual(t))}}function iK(e){return Buffer.from(e,"base64").toString("binary")}function iW(e){return Buffer.from(e,"binary").toString("base64")}function iG(){return!0}class iH{constructor(e){this.binaryString=e}static fromBase64String(e){return new iH(iK(e))}static fromUint8Array(e){return new iH(iQ(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return iW(this.binaryString)}toUint8Array(){return iJ(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return rf(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}function iQ(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}function iJ(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}iH.EMPTY_BYTE_STRING=new iH("");let iY=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function iX(e){if(tU(!!e,39018),"string"==typeof e){let t=0,r=iY.exec(e);if(tU(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:iZ(e.seconds),nanos:iZ(e.nanos)}}function iZ(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function i0(e){return"string"==typeof e?iH.fromBase64String(e):iH.fromUint8Array(e)}let i1="server_timestamp",i2="__type__",i3="__previous_value__",i6="__local_write_time__";function i5(e){return(e?.mapValue?.fields||{})[i2]?.stringValue===i1}function i4(e,t){let r={fields:{[i2]:{stringValue:i1},[i6]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&i5(t)&&(t=i8(t)),t&&(r.fields[i3]=t),{mapValue:r}}function i8(e){let t=e.mapValue.fields[i3];return i5(t)?i8(t):t}function i7(e){let t=iX(e.mapValue.fields[i6].timestampValue);return new rj(t.seconds,t.nanos)}class i9{constructor(e,t,r,n,i,s,a,o,l,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u,this.apiKey=c}}let se="(default)";class st{constructor(e,t){this.projectId=e,this.database=t||se}static empty(){return new st("","")}get isDefaultDatabase(){return this.database===se}isEqual(e){return e instanceof st&&e.projectId===this.projectId&&e.database===this.database}}function sr(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new t9(tQ,'"projectId" not provided in firebase.initializeApp.');return new st(e.options.projectId,t)}let sn=-1;function si(e){return null==e}function ss(e){return 0===e&&1/e==-1/0}function sa(e){return"number"==typeof e&&Number.isInteger(e)&&!ss(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}let so="__type__",sl="__max__",su={mapValue:{fields:{__type__:{stringValue:sl}}}},sc="__vector__",sh="value",sd={nullValue:"NULL_VALUE"};function sf(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?i5(e)?4:sY(e)?0x1fffffffffffff:sQ(e)?10:11:tq(28295,{value:e})}function sp(e,t){if(e===t)return!0;let r=sf(e);if(r!==sf(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return i7(e).isEqual(i7(t));case 3:return sm(e,t);case 5:return e.stringValue===t.stringValue;case 6:return sy(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return sg(e,t);case 2:return sv(e,t);case 9:return rv(e.arrayValue.values||[],t.arrayValue.values||[],sp);case 10:case 11:return sb(e,t);default:return tq(52216,{left:e})}}function sm(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=iX(e.timestampValue),n=iX(t.timestampValue);return r.seconds===n.seconds&&r.nanos===n.nanos}function sg(e,t){return iZ(e.geoPointValue.latitude)===iZ(t.geoPointValue.latitude)&&iZ(e.geoPointValue.longitude)===iZ(t.geoPointValue.longitude)}function sy(e,t){return i0(e.bytesValue).isEqual(i0(t.bytesValue))}function sv(e,t){if("integerValue"in e&&"integerValue"in t)return iZ(e.integerValue)===iZ(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=iZ(e.doubleValue),n=iZ(t.doubleValue);return r===n?ss(r)===ss(n):isNaN(r)&&isNaN(n)}return!1}function sb(e,t){let r=e.mapValue.fields||{},n=t.mapValue.fields||{};if(iO(r)!==iO(n))return!1;for(let e in r)if(r.hasOwnProperty(e)&&(void 0===n[e]||!sp(r[e],n[e])))return!1;return!0}function sS(e,t){return void 0!==(e.values||[]).find(e=>sp(e,t))}function sw(e,t){if(e===t)return 0;let r=sf(e),n=sf(t);if(r!==n)return rf(r,n);switch(r){case 0:case 0x1fffffffffffff:return 0;case 1:return rf(e.booleanValue,t.booleanValue);case 2:return sC(e,t);case 3:return sT(e.timestampValue,t.timestampValue);case 4:return sT(i7(e),i7(t));case 5:return rp(e.stringValue,t.stringValue);case 6:return sI(e.bytesValue,t.bytesValue);case 7:return sE(e.referenceValue,t.referenceValue);case 8:return s_(e.geoPointValue,t.geoPointValue);case 9:return sk(e.arrayValue,t.arrayValue);case 10:return sx(e.mapValue,t.mapValue);case 11:return sR(e.mapValue,t.mapValue);default:throw tq(23264,{leftType:r})}}function sC(e,t){let r=iZ(e.integerValue||e.doubleValue),n=iZ(t.integerValue||t.doubleValue);return r<n?-1:r>n?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1}function sT(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return rf(e,t);let r=iX(e),n=iX(t),i=rf(r.seconds,n.seconds);return 0!==i?i:rf(r.nanos,n.nanos)}function sE(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=rf(r[e],n[e]);if(0!==t)return t}return rf(r.length,n.length)}function s_(e,t){let r=rf(iZ(e.latitude),iZ(t.latitude));return 0!==r?r:rf(iZ(e.longitude),iZ(t.longitude))}function sI(e,t){let r=i0(e),n=i0(t);return r.compareTo(n)}function sk(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=sw(r[e],n[e]);if(t)return t}return rf(r.length,n.length)}function sx(e,t){let r=e.fields||{},n=t.fields||{},i=r[sh]?.arrayValue,s=n[sh]?.arrayValue,a=rf(i?.values?.length||0,s?.values?.length||0);return 0!==a?a:sk(i,s)}function sR(e,t){if(e===su.mapValue&&t===su.mapValue)return 0;if(e===su.mapValue)return 1;if(t===su.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=rp(n[e],s[e]);if(0!==t)return t;let a=sw(r[n[e]],i[s[e]]);if(0!==a)return a}return rf(n.length,s.length)}function sD(e){return sA(e)}function sA(e){if("nullValue"in e)return"null";if("booleanValue"in e)return""+e.booleanValue;if("integerValue"in e)return""+e.integerValue;if("doubleValue"in e)return""+e.doubleValue;if("timestampValue"in e)return sN(e.timestampValue);else if("stringValue"in e)return e.stringValue;else if("bytesValue"in e)return sO(e.bytesValue);else if("referenceValue"in e)return sM(e.referenceValue);else if("geoPointValue"in e)return sP(e.geoPointValue);else if("arrayValue"in e)return sB(e.arrayValue);else if("mapValue"in e)return sL(e.mapValue);else return tq(61005,{value:e})}function sO(e){return i0(e).toBase64()}function sN(e){let t=iX(e);return`time(${t.seconds},${t.nanos})`}function sP(e){return`geo(${e.latitude},${e.longitude})`}function sM(e){return r_.fromName(e).toString()}function sL(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${sA(e.fields[i])}`;return r+"}"}function sB(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=sA(n);return t+"]"}function sF(e){switch(sf(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=i8(e);return t?16+sF(t):16;case 5:return 2*e.stringValue.length;case 6:return i0(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return sV(e.arrayValue);case 10:case 11:return sj(e.mapValue);default:throw tq(13486,{value:e})}}function sj(e){let t=0;return iN(e.fields,(e,r)=>{t+=e.length+sF(r)}),t}function sV(e){return(e.values||[]).reduce((e,t)=>e+sF(t),0)}function sq(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function sz(e){return!!e&&"integerValue"in e}function sU(e){return!!e&&"doubleValue"in e}function s$(e){return sz(e)||sU(e)}function sK(e){return!!e&&"arrayValue"in e}function sW(e){return!!e&&"nullValue"in e}function sG(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function sH(e){return!!e&&"mapValue"in e}function sQ(e){return(e?.mapValue?.fields||{})[so]?.stringValue===sc}function sJ(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return iN(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=sJ(r)),t}{if(!e.arrayValue)return{...e};let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=sJ(e.arrayValue.values[r]);return t}}function sY(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===sl}let sX={mapValue:{fields:{[so]:{stringValue:sc},[sh]:{arrayValue:{}}}}};function sZ(e){if("nullValue"in e)return sd;if("booleanValue"in e)return{booleanValue:!1};if("integerValue"in e||"doubleValue"in e)return{doubleValue:NaN};if("timestampValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in e)return{stringValue:""};else if("bytesValue"in e)return{bytesValue:""};else if("referenceValue"in e)return sq(st.empty(),r_.empty());else if("geoPointValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in e)return{arrayValue:{}};else if(!("mapValue"in e))return tq(35942,{value:e});else return sQ(e)?sX:{mapValue:{}}}function s0(e){if("nullValue"in e)return{booleanValue:!1};if("booleanValue"in e)return{doubleValue:NaN};if("integerValue"in e||"doubleValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in e)return{stringValue:""};if("stringValue"in e)return{bytesValue:""};else if("bytesValue"in e)return sq(st.empty(),r_.empty());else if("referenceValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in e)return{arrayValue:{}};else if("arrayValue"in e)return sX;else if(!("mapValue"in e))return tq(61959,{value:e});else return sQ(e)?{mapValue:{}}:su}function s1(e,t){let r=sw(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function s2(e,t){let r=sw(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class s3{constructor(e){this.value=e}static empty(){return new s3({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!sH(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=sJ(t)}setAll(e){let t=rE.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=sJ(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());sH(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return sp(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];sH(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(iN(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new s3(sJ(this.value))}}function s6(e){let t=[];return iN(e.fields,(e,r)=>{let n=new rE([e]);if(sH(r)){let e=s6(r.mapValue).fields;if(0===e.length)t.push(n);else for(let r of e)t.push(n.child(r))}else t.push(n)}),new i$(t)}class s5{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new s5(e,0,rV.min(),rV.min(),rV.min(),s3.empty(),0)}static newFoundDocument(e,t,r,n){return new s5(e,1,t,rV.min(),r,n,0)}static newNoDocument(e,t){return new s5(e,2,t,rV.min(),rV.min(),s3.empty(),0)}static newUnknownDocument(e,t){return new s5(e,3,t,rV.min(),rV.min(),s3.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(rV.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=s3.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=s3.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rV.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof s5&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new s5(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function s4(e,t,r){let n=t.data.field(e),i=r.data.field(e);return null!==n&&null!==i?sw(n,i):tq(42886)}class s8{constructor(e,t){this.position=e,this.inclusive=t}}function s7(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?r_.comparator(r_.fromName(a.referenceValue),r.key):sw(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function s9(e,t,r){let n=s7(e,t,r);return e.inclusive?n>=0:n>0}function ae(e,t,r){let n=s7(e,t,r);return e.inclusive?n<=0:n<0}function at(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!sp(e.position[r],t.position[r]))return!1;return!0}class ar{constructor(e,t="asc"){this.field=e,this.dir=t}}function an(e){return e.field.canonicalString()+e.dir}function ai(e){return`${e.field.canonicalString()} (${e.dir})`}function as(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class aa{}class ao extends aa{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){if(e.isKeyField())if("in"===t||"not-in"===t)return this.createKeyFieldInFilter(e,t,r);else return new aw(e,t,r);if("array-contains"===t)return new a_(e,r);if("in"===t)return new aI(e,r);if("not-in"===t)return new ak(e,r);if("array-contains-any"===t)return new ax(e,r);else return new ao(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new aC(e,r):new aT(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(sw(t,this.value)):null!==t&&sf(this.value)===sf(t)&&this.matchesComparison(sw(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return tq(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class al extends aa{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new al(e,t)}matches(e){return au(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function au(e){return"and"===e.op}function ac(e){return"or"===e.op}function ah(e){return ad(e)&&au(e)}function ad(e){for(let t of e.filters)if(t instanceof al)return!1;return!0}function af(e){if(e instanceof ao)return e.field.canonicalString()+e.op.toString()+sD(e.value);{if(ah(e))return e.filters.map(e=>af(e)).join(",");let t=e.filters.map(e=>af(e)).join(",");return`${e.op}(${t})`}}function ap(e,t){return e instanceof ao?am(e,t):e instanceof al?ag(e,t):void tq(19439)}function am(e,t){return t instanceof ao&&e.op===t.op&&e.field.isEqual(t.field)&&sp(e.value,t.value)}function ag(e,t){return t instanceof al&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,r,n)=>e&&ap(r,t.filters[n]),!0)}function ay(e,t){let r=e.filters.concat(t);return al.create(r,e.op)}function av(e){return e instanceof ao?aS(e):e instanceof al?ab(e):"Filter"}function ab(e){return e.op.toString()+" {"+e.getFilters().map(av).join(" ,")+"}"}function aS(e){return`${e.field.canonicalString()} ${e.op} ${sD(e.value)}`}class aw extends ao{constructor(e,t,r){super(e,t,r),this.key=r_.fromName(r.referenceValue)}matches(e){let t=r_.comparator(e.key,this.key);return this.matchesComparison(t)}}class aC extends ao{constructor(e,t){super(e,"in",t),this.keys=aE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class aT extends ao{constructor(e,t){super(e,"not-in",t),this.keys=aE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function aE(e,t){return(t.arrayValue?.values||[]).map(e=>r_.fromName(e.referenceValue))}class a_ extends ao{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return sK(t)&&sS(t.arrayValue,this.value)}}class aI extends ao{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&sS(this.value.arrayValue,t)}}class ak extends ao{constructor(e,t){super(e,"not-in",t)}matches(e){if(sS(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!sS(this.value.arrayValue,t)}}class ax extends ao{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!!sK(t)&&!!t.arrayValue.values&&t.arrayValue.values.some(e=>sS(this.value.arrayValue,e))}}class aR{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.memoizedCanonicalId=null}}function aD(e,t=null,r=[],n=[],i=null,s=null,a=null){return new aR(e,t,r,n,i,s,a)}function aA(e){let t=tK(e);if(null===t.memoizedCanonicalId){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>af(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>an(e)).join(","),si(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>sD(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>sD(e)).join(",")),t.memoizedCanonicalId=e}return t.memoizedCanonicalId}function aO(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>av(e)).join(", ")}]`),si(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>ai(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>sD(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>sD(e)).join(",")),`Target(${t})`}function aN(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!as(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!ap(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!at(e.startAt,t.startAt)&&at(e.endAt,t.endAt)}function aP(e){return r_.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function aM(e,t){return e.filters.filter(e=>e instanceof ao&&e.field.isEqual(t))}function aL(e,t){let r=r$(t);if(void 0===r)return null;for(let t of aM(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}function aB(e,t){let r=new Map;for(let n of rK(t))for(let t of aM(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}function aF(e,t){let r=[],n=!0;for(let i of rK(t)){let t=0===i.kind?aV(e,i.fieldPath,e.startAt):aq(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new s8(r,n)}function aj(e,t){let r=[],n=!0;for(let i of rK(t)){let t=0===i.kind?aq(e,i.fieldPath,e.endAt):aV(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new s8(r,n)}function aV(e,t,r){let n=sd,i=!0;for(let r of aM(e,t)){let e=sd,t=!0;switch(r.op){case"<":case"<=":e=sZ(r.value);break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=sd}0>s1({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>s1({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function aq(e,t,r){let n=su,i=!0;for(let r of aM(e,t)){let e=su,t=!0;switch(r.op){case">=":case">":e=s0(r.value),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=su}s2({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];s2({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function az(e){let t=new iV(rE.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}function aU(e){return null!==e.limit}class a${constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function aK(e,t,r,n,i,s,a,o){return new a$(e,t,r,n,i,s,a,o)}function aW(e){return new a$(e)}function aG(e,t){return new a$(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function aH(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function aQ(e){let t=new iV(rE.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}function aJ(e){return new a$(rC.emptyPath(),e)}function aY(e){return r_.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function aX(e){return null!==e.collectionGroup}function aZ(e){let t=tK(e);if(null===t.memoizedNormalizedOrderBy){t.memoizedNormalizedOrderBy=[];let e=new Set;for(let r of t.explicitOrderBy)t.memoizedNormalizedOrderBy.push(r),e.add(r.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";aQ(t).forEach(n=>{e.has(n.canonicalString())||n.isKeyField()||t.memoizedNormalizedOrderBy.push(new ar(n,r))}),e.has(rE.keyField().canonicalString())||t.memoizedNormalizedOrderBy.push(new ar(rE.keyField(),r))}return t.memoizedNormalizedOrderBy}function a0(e){let t=tK(e);return t.memoizedTarget||(t.memoizedTarget=a2(t,aZ(e))),t.memoizedTarget}function a1(e){let t=tK(e);return t.memoizedAggregateTarget||(t.memoizedAggregateTarget=a2(t,e.explicitOrderBy)),t.memoizedAggregateTarget}function a2(e,t){if("F"===e.limitType)return aD(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new ar(e.field,t)});let r=e.endAt?new s8(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new s8(e.startAt.position,e.startAt.inclusive):null;return aD(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function a3(e,t){let r=e.filters.concat([t]);return new a$(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function a6(e,t){let r=e.explicitOrderBy.concat([t]);return new a$(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function a5(e,t,r){return new a$(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function a4(e,t){return new a$(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}function a8(e,t){return new a$(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}function a7(e,t){return aN(a0(e),a0(t))&&e.limitType===t.limitType}function a9(e){return`${aA(a0(e))}|lt:${e.limitType}`}function oe(e){return`Query(target=${aO(a0(e))}; limitType=${e.limitType})`}function ot(e,t){return t.isFoundDocument()&&or(e,t)&&on(e,t)&&oi(e,t)&&os(e,t)}function or(e,t){let r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):r_.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}function on(e,t){for(let r of aZ(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}function oi(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}function os(e,t){return(!e.startAt||!!ae(e.startAt,aZ(e),t))&&(!e.endAt||!!s9(e.endAt,aZ(e),t))}function oa(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function oo(e){return(t,r)=>{let n=!1;for(let i of aZ(e)){let e=ol(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}function ol(e,t,r){let n=e.field.isKeyField()?r_.comparator(t.key,r.key):s4(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return -1*n;default:return tq(19790,{direction:e.dir})}}class ou{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n){this.inner[r]=[[e,t]],this.innerSize++;return}for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e)){n[r]=[e,t];return}n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){iN(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return iM(this.inner)}size(){return this.innerSize}}let oc=new iL(r_.comparator);function oh(){return oc}let od=new iL(r_.comparator);function of(...e){let t=od;for(let r of e)t=t.insert(r.key,r);return t}function op(){return ov()}function om(e){let t=od;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function og(){return ov()}function oy(){return ov()}function ov(){return new ou(e=>e.toString(),(e,t)=>e.isEqual(t))}let ob=new iL(r_.comparator);function oS(){return ob}let ow=new iV(r_.comparator);function oC(...e){let t=ow;for(let r of e)t=t.add(r);return t}let oT=new iV(rf);function oE(){return oT}function o_(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};else if(t===1/0)return{doubleValue:"Infinity"};else if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ss(t)?"-0":t}}function oI(e){return{integerValue:""+e}}function ok(e,t){return sa(t)?oI(t):o_(e,t)}class ox{constructor(){this._=void 0}}function oR(e,t,r){return e instanceof oN?i4(r,t):e instanceof oP?oM(e,t):e instanceof oL?oB(e,t):oj(e,t)}function oD(e,t,r){return e instanceof oP?oM(e,t):e instanceof oL?oB(e,t):r}function oA(e,t){return e instanceof oF?s$(t)?t:{integerValue:0}:null}function oO(e,t){return e instanceof oP&&t instanceof oP||e instanceof oL&&t instanceof oL?rv(e.elements,t.elements,sp):e instanceof oF&&t instanceof oF?sp(e.operand,t.operand):e instanceof oN&&t instanceof oN}class oN extends ox{}class oP extends ox{constructor(e){super(),this.elements=e}}function oM(e,t){let r=oq(t);for(let t of e.elements)r.some(e=>sp(e,t))||r.push(t);return{arrayValue:{values:r}}}class oL extends ox{constructor(e){super(),this.elements=e}}function oB(e,t){let r=oq(t);for(let t of e.elements)r=r.filter(e=>!sp(e,t));return{arrayValue:{values:r}}}class oF extends ox{constructor(e,t){super(),this.serializer=e,this.operand=t}}function oj(e,t){let r=oA(e,t),n=oV(r)+oV(e.operand);return sz(r)&&sz(e.operand)?oI(n):o_(e.serializer,n)}function oV(e){return iZ(e.integerValue||e.doubleValue)}function oq(e){return sK(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class oz{constructor(e,t){this.field=e,this.transform=t}}function oU(e,t){return e.field.isEqual(t.field)&&oO(e.transform,t.transform)}function o$(e,t){return void 0===e&&void 0===t||!!e&&!!t&&rv(e,t,(e,t)=>oU(e,t))}class oK{constructor(e,t){this.version=e,this.transformResults=t}}class oW{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new oW}static exists(e){return new oW(void 0,e)}static updateTime(e){return new oW(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function oG(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class oH{}function oQ(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)if(e.isNoDocument())return new o9(e.key,oW.none());else return new o0(e.key,e.data,oW.none());{let r=e.data,n=s3.empty(),i=new iV(rE.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new o3(e.key,n,new i$(i.toArray()),oW.none())}}function oJ(e,t,r){e instanceof o0?o1(e,t,r):e instanceof o3?o6(e,t,r):le(e,t,r)}function oY(e,t,r,n){return e instanceof o0?o2(e,t,r,n):e instanceof o3?o5(e,t,r,n):lt(e,t,r)}function oX(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=oA(n.transform,e||null);null!=i&&(null===r&&(r=s3.empty()),r.set(n.field,i))}return r||null}function oZ(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!o$(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class o0 extends oH{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}function o1(e,t,r){let n=e.value.clone(),i=o8(e.fieldTransforms,t,r.transformResults);n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}function o2(e,t,r,n){if(!oG(e.precondition,t))return r;let i=e.value.clone(),s=o7(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}class o3 extends oH{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function o6(e,t,r){if(!oG(e.precondition,t))return void t.convertToUnknownDocument(r.version);let n=o8(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(o4(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}function o5(e,t,r,n){if(!oG(e.precondition,t))return r;let i=o7(e.fieldTransforms,n,t),s=t.data;return(s.setAll(o4(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}function o4(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function o8(e,t,r){let n=new Map;tU(e.length===r.length,32656,{serverTransformResultCount:r.length,fieldTransformCount:e.length});for(let i=0;i<r.length;i++){let s=e[i],a=s.transform,o=t.data.field(s.field);n.set(s.field,oD(a,o,r[i]))}return n}function o7(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,oR(e,s,t))}return n}class o9 extends oH{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function le(e,t,r){t.convertToNoDocument(r.version).setHasCommittedMutations()}function lt(e,t,r){return oG(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}class lr extends oH{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ln{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&oJ(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=oY(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=oY(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=oy();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=oQ(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(rV.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),oC())}isEqual(e){return this.batchId===e.batchId&&rv(this.mutations,e.mutations,(e,t)=>oZ(e,t))&&rv(this.baseMutations,e.baseMutations,(e,t)=>oZ(e,t))}}class li{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){tU(e.mutations.length===r.length,58842,{mutationsSent:e.mutations.length,resultsReceived:r.length});let n=oS(),i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new li(e,t,r,n)}}class ls{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class la{constructor(e,t){this.count=e,this.unchangedNames=t}}function lo(e){switch(e){case tW:return tq(64938);case tG:case tH:case tJ:case t1:case t4:case t8:case t0:return!1;case tQ:case tY:case tX:case tZ:case t2:case t3:case t6:case t5:case t7:return!0;default:return tq(15467,{code:e})}}function ll(e){return lo(e)&&e!==t3}function lu(e){if(void 0===e)return tF("GRPC error has no .code"),tH;switch(e){case tC.OK:return tW;case tC.CANCELLED:return tG;case tC.UNKNOWN:return tH;case tC.DEADLINE_EXCEEDED:return tJ;case tC.RESOURCE_EXHAUSTED:return t1;case tC.INTERNAL:return t4;case tC.UNAVAILABLE:return t8;case tC.UNAUTHENTICATED:return t0;case tC.INVALID_ARGUMENT:return tQ;case tC.NOT_FOUND:return tY;case tC.ALREADY_EXISTS:return tX;case tC.PERMISSION_DENIED:return tZ;case tC.FAILED_PRECONDITION:return t2;case tC.ABORTED:return t3;case tC.OUT_OF_RANGE:return t6;case tC.UNIMPLEMENTED:return t5;case tC.DATA_LOSS:return t7;default:return tq(39323,{code:e})}}!function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS"}(tC||(tC={}));class lc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}let lh=null;function ld(e){if(lh)throw Error("a TestingHooksSpi instance is already set");lh=e}function lf(){return new tI.TextEncoder}function lp(){return new tI.TextDecoder("utf-8")}let lm=new tS([0xffffffff,0xffffffff],0);function lg(e){let t=lf().encode(e),r=new tw;return r.update(t),new Uint8Array(r.digest())}function ly(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new tS([r,n],0),new tS([i,s],0)]}class lv{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new lb(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new lb(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new lb(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=8*e.length-t,this.bitCountInInteger=tS.fromNumber(this.bitCount)}getBitIndex(e,t,r){let n=e.add(t.multiply(tS.fromNumber(r)));return 1===n.compare(lm)&&(n=new tS([n.getBits(0),n.getBits(1)],0)),n.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(0===this.bitCount)return!1;let[t,r]=ly(lg(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);if(!this.isBitSet(n))return!1}return!0}static create(e,t,r){let n=e%8==0?0:8-e%8,i=new lv(new Uint8Array(Math.ceil(e/8)),n,t);return r.forEach(e=>i.insert(e)),i}insert(e){if(0===this.bitCount)return;let[t,r]=ly(lg(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);this.setBit(n)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class lb extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class lS{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,lw.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new lS(rV.min(),n,new iL(rf),oh(),oC())}}class lw{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new lw(r,t,oC(),oC(),oC())}}class lC{constructor(e,t,r,n){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=n}}class lT{constructor(e,t){this.targetId=e,this.existenceFilter=t}}class lE{constructor(e,t,r=iH.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class l_{constructor(){this.pendingResponses=0,this.documentChanges=lR(),this._resumeToken=iH.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=oC(),t=oC(),r=oC();return this.documentChanges.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:tq(38017,{changeType:i})}}),new lw(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=lR()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,tU(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let lI="WatchChangeAggregator";class lk{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=oh(),this.pendingDocumentUpdatesByTarget=lx(),this.pendingDocumentTargetMapping=lx(),this.pendingTargetResets=new iL(rf)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:tq(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((e,r)=>{this.isActiveTarget(r)&&t(r)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,n=this.targetDataForActiveTarget(t);if(n){let i=n.target;if(aP(i))if(0===r){let e=new r_(i.path);this.removeDocumentFromTarget(t,e,s5.newNoDocument(e,rV.min()))}else tU(1===r,20013,{expectedCount:r});else{let n=this.getCurrentDocumentCountForTarget(t);if(n!==r){let r=this.parseBloomFilter(e),i=r?this.applyBloomFilter(r,e,n):1;if(0!==i){this.resetTarget(t);let e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,e)}lh?.notifyOnExistenceFilterMismatch(lD(n,e.existenceFilter,this.metadataProvider.getDatabaseId(),r,i))}}}}parseBloomFilter(e){let t,r,n=e.existenceFilter.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=i0(i).toUint8Array()}catch(e){if(e instanceof lc)return tj("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new lv(t,s,a)}catch(e){return e instanceof lb?tj("BloomFilter error: ",e):tj("Applying bloom filter failed: ",e),null}return 0===r.bitCount?null:r}applyBloomFilter(e,t,r){return 2*(t.existenceFilter.count!==r-this.filterRemovedDocuments(e,t.targetId))}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.metadataProvider.getDatabaseId(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;!e.mightContain(s)&&(this.removeDocumentFromTarget(t,r,null),n++)}),n}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((r,n)=>{let i=this.targetDataForActiveTarget(n);if(i){if(r.current&&aP(i.target)){let t=new r_(i.target.path);this.ensureDocumentUpdateByTarget(t).has(n)||this.targetContainsDocument(n,t)||this.removeDocumentFromTarget(n,t,s5.newNoDocument(t,e))}r.hasPendingChanges&&(t.set(n,r.toTargetChange()),r.clearPendingChanges())}});let r=oC();this.pendingDocumentTargetMapping.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.targetDataForActiveTarget(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.pendingDocumentUpdates.forEach((t,r)=>r.setReadTime(e));let n=new lS(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=oh(),this.pendingDocumentUpdatesByTarget=lx(),this.pendingDocumentTargetMapping=lx(),this.pendingTargetResets=new iL(rf),n}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=2*!!this.targetContainsDocument(e,t.key);this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(t.key,this.ensureDocumentUpdateByTarget(t.key).add(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let n=this.ensureTargetState(e);this.targetContainsDocument(e,t)?n.addDocumentChange(t,1):n.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).add(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new l_,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new iV(rf),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}ensureDocumentUpdateByTarget(e){let t=this.pendingDocumentUpdatesByTarget.get(e);return t||(t=new iV(rf),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(e,t)),t}isActiveTarget(e){let t=null!==this.targetDataForActiveTarget(e);return t||tB(lI,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new l_),this.metadataProvider.getRemoteKeysForTarget(e).forEach(t=>{this.removeDocumentFromTarget(e,t,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}}function lx(){return new iL(r_.comparator)}function lR(){return new iL(r_.comparator)}function lD(e,t,r,n,i){let s={localCacheCount:e,existenceFilterCount:t.count,databaseId:r.database,projectId:r.projectId},a=t.unchangedNames;return a&&(s.bloomFilter={applied:0===i,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>n?.mightContain(e)??!1}),s}let lA=(()=>{let e={};return e.asc="ASCENDING",e.desc="DESCENDING",e})(),lO=(()=>{let e={};return e["<"]="LESS_THAN",e["<="]="LESS_THAN_OR_EQUAL",e[">"]="GREATER_THAN",e[">="]="GREATER_THAN_OR_EQUAL",e["=="]="EQUAL",e["!="]="NOT_EQUAL",e["array-contains"]="ARRAY_CONTAINS",e.in="IN",e["not-in"]="NOT_IN",e["array-contains-any"]="ARRAY_CONTAINS_ANY",e})(),lN=(()=>{let e={};return e.and="AND",e.or="OR",e})();function lP(e,t){}class lM{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function lL(e){return new t9(void 0===e.code?tH:lu(e.code),e.message||"")}function lB(e,t){return e.useProto3Json||si(t)?t:{value:t}}function lF(e){let t;return si(t="object"==typeof e?e.value:e)?null:t}function lj(e,t){if(!e.useProto3Json)return{seconds:""+t.seconds,nanos:t.nanoseconds};{let e=new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),r=("000000000"+t.nanoseconds).slice(-9);return`${e}.${r}Z`}}function lV(e){let t=iX(e);return new rj(t.seconds,t.nanos)}function lq(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function lz(e,t){return e.useProto3Json?(tU(void 0===t||"string"==typeof t,58123),iH.fromBase64String(t||"")):(tU(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),iH.fromUint8Array(t||new Uint8Array))}function lU(e,t){return lj(e,t.toTimestamp())}function l$(e){return tU(!!e,49232),rV.fromTimestamp(lV(e))}function lK(e,t){return lW(e,t).canonicalString()}function lW(e,t){let r=lZ(e).child("documents");return void 0===t?r:r.child(t)}function lG(e){let t=rC.fromString(e);return tU(u$(t),10190,{key:t.toString()}),t}function lH(e,t){return lK(e.databaseId,t.path)}function lQ(e,t){let r=lG(t);if(r.get(1)!==e.databaseId.projectId)throw new t9(tQ,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new t9(tQ,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new r_(l0(r))}function lJ(e,t){return lK(e.databaseId,t)}function lY(e){let t=lG(e);return 4===t.length?rC.emptyPath():l0(t)}function lX(e){return new rC(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function lZ(e){return new rC(["projects",e.projectId,"databases",e.database])}function l0(e){return tU(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function l1(e,t,r){return{name:lH(e,t),fields:r.value.mapValue.fields}}function l2(e,t){return{name:lH(e,t.key),fields:t.data.value.mapValue.fields,updateTime:lj(e,t.version.toTimestamp()),createTime:lj(e,t.createTime.toTimestamp())}}function l3(e,t,r){let n=lQ(e,t.name),i=l$(t.updateTime),s=t.createTime?l$(t.createTime):rV.min(),a=new s3({mapValue:{fields:t.fields}}),o=s5.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function l6(e,t){tU(!!t.found,43571),lP(t.found.name),lP(t.found.updateTime);let r=lQ(e,t.found.name),n=l$(t.found.updateTime),i=t.found.createTime?l$(t.found.createTime):rV.min(),s=new s3({mapValue:{fields:t.found.fields}});return s5.newFoundDocument(r,n,i,s)}function l5(e,t){tU(!!t.missing,3894),tU(!!t.readTime,22933);let r=lQ(e,t.missing),n=l$(t.readTime);return s5.newNoDocument(r,n)}function l4(e,t){return"found"in t?l6(e,t):"missing"in t?l5(e,t):tq(7234,{result:t})}function l8(e,t){let r;if("targetChange"in t){lP(t.targetChange);let n=l7(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=lz(e,t.targetChange.resumeToken),a=t.targetChange.cause;r=new lE(n,i,s,a&&lL(a)||null)}else if("documentChange"in t){lP(t.documentChange);let n=t.documentChange;lP(n.document),lP(n.document.name),lP(n.document.updateTime);let i=lQ(e,n.document.name),s=l$(n.document.updateTime),a=n.document.createTime?l$(n.document.createTime):rV.min(),o=new s3({mapValue:{fields:n.document.fields}}),l=s5.newFoundDocument(i,s,a,o);r=new lC(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){lP(t.documentDelete);let n=t.documentDelete;lP(n.document);let i=lQ(e,n.document),s=n.readTime?l$(n.readTime):rV.min(),a=s5.newNoDocument(i,s);r=new lC([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){lP(t.documentRemove);let n=t.documentRemove;lP(n.document);let i=lQ(e,n.document);r=new lC([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return tq(11601,{change:t});lP(t.filter);let e=t.filter;lP(e.targetId);let{count:n=0,unchangedNames:i}=e,s=new la(n,i);r=new lT(e.targetId,s)}return r}function l7(e){if("NO_CHANGE"===e)return 0;if("ADD"===e)return 1;if("REMOVE"===e)return 2;if("CURRENT"===e)return 3;if("RESET"===e)return 4;else return tq(39313,{state:e})}function l9(e){if(!("targetChange"in e))return rV.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length||!t.readTime?rV.min():l$(t.readTime)}function ue(e,t){let r;if(t instanceof o0)r={update:l1(e,t.key,t.value)};else if(t instanceof o9)r={delete:lH(e,t.key)};else if(t instanceof o3)r={update:l1(e,t.key,t.data),updateMask:uz(t.fieldMask)};else{if(!(t instanceof lr))return tq(16599,{mutationType:t.type});r={verify:lH(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(t=>ua(e,t))),t.precondition.isNone||(r.currentDocument=ur(e,t.precondition)),r}function ut(e,t){let r=t.currentDocument?un(t.currentDocument):oW.none(),n=t.updateTransforms?t.updateTransforms.map(t=>uo(e,t)):[];if(t.update){lP(t.update.name);let i=lQ(e,t.update.name),s=new s3({mapValue:{fields:t.update.fields}});return t.updateMask?new o3(i,s,uU(t.updateMask),r,n):new o0(i,s,r,n)}return t.delete?new o9(lQ(e,t.delete),r):t.verify?new lr(lQ(e,t.verify),r):tq(1463,{proto:t})}function ur(e,t){return void 0!==t.updateTime?{updateTime:lU(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:tq(27497)}function un(e){return void 0!==e.updateTime?oW.updateTime(l$(e.updateTime)):void 0!==e.exists?oW.exists(e.exists):oW.none()}function ui(e,t){let r=e.updateTime?l$(e.updateTime):l$(t);return r.isEqual(rV.min())&&(r=l$(t)),new oK(r,e.transformResults||[])}function us(e,t){return e&&e.length>0?(tU(void 0!==t,14353),e.map(e=>ui(e,t))):[]}function ua(e,t){let r=t.transform;if(r instanceof oN)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof oP)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof oL)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof oF)return{fieldPath:t.field.canonicalString(),increment:r.operand};throw tq(20930,{transform:t.transform})}function uo(e,t){let r=null;return"setToServerValue"in t?(tU("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new oN):"appendMissingElements"in t?r=new oP(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new oL(t.removeAllFromArray.values||[]):"increment"in t?r=new oF(e,t.increment):tq(16584,{proto:t}),new oz(rE.fromServerFormat(t.fieldPath),r)}function ul(e,t){return{documents:[lJ(e,t.path)]}}function uu(e){let t=e.documents.length;return tU(1===t,1966,{count:t}),a0(aW(lY(e.documents[0])))}function uc(e,t){let r,n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(r=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=lJ(e,r);let s=uy(t.filters);s&&(n.structuredQuery.where=s);let a=uS(t.orderBy);a&&(n.structuredQuery.orderBy=a);let o=lB(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=uC(t.startAt)),t.endAt&&(n.structuredQuery.endAt=uT(t.endAt)),{queryTarget:n,parent:r}}function uh(e,t,r,n){let{queryTarget:i,parent:s}=uc(e,t),a={},o=[],l=0;return r.forEach(e=>{let t=n?e.alias:`aggregate_${l++}`;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:uO(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:uO(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},aliasMap:a,parent:s}}function ud(e){let t=lY(e.parent),r=e.structuredQuery,n=r.from?r.from.length:0,i=null;if(n>0){tU(1===n,65062);let e=r.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];r.where&&(s=uv(r.where));let a=[];r.orderBy&&(a=uw(r.orderBy));let o=null;r.limit&&(o=lF(r.limit));let l=null;r.startAt&&(l=uE(r.startAt));let u=null;return r.endAt&&(u=u_(r.endAt)),aK(t,i,a,s,o,"F",l,u)}function uf(e){return a0(ud(e))}function up(e,t){let r=um(t.purpose);return null==r?null:{"goog-listen-tags":r}}function um(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return tq(28987,{purpose:e})}}function ug(e,t){let r,n=t.target;if((r=aP(n)?{documents:ul(e,n)}:{query:uc(e,n).queryTarget}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=lq(e,t.resumeToken);let n=lB(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(rV.min())>0){r.readTime=lj(e,t.snapshotVersion.toTimestamp());let n=lB(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}function uy(e){if(0!==e.length)return uL(al.create(e,"and"))}function uv(e){let t=ub(e);return t instanceof al&&ah(t)?t.getFilters():[t]}function ub(e){return void 0!==e.unaryFilter?uj(e):void 0!==e.fieldFilter?uV(e):void 0!==e.compositeFilter?uq(e):tq(30097,{filter:e})}function uS(e){if(0!==e.length)return e.map(e=>uP(e))}function uw(e){return e.map(e=>uM(e))}function uC(e){return{before:e.inclusive,values:e.position}}function uT(e){return{before:!e.inclusive,values:e.position}}function uE(e){let t=!!e.before;return new s8(e.values||[],t)}function u_(e){let t=!e.before;return new s8(e.values||[],t)}function uI(e){return lA[e]}function uk(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function ux(e){return lO[e]}function uR(e){return lN[e]}function uD(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return tq(58110);default:return tq(50506)}}function uA(e){switch(e){case"AND":return"and";case"OR":return"or";default:return tq(1026)}}function uO(e){return{fieldPath:e.canonicalString()}}function uN(e){return rE.fromServerFormat(e.fieldPath)}function uP(e){return{field:uO(e.field),direction:uI(e.dir)}}function uM(e){return new ar(uN(e.field),uk(e.direction))}function uL(e){return e instanceof ao?uF(e):e instanceof al?uB(e):tq(54877,{filter:e})}function uB(e){let t=e.getFilters().map(e=>uL(e));return 1===t.length?t[0]:{compositeFilter:{op:uR(e.op),filters:t}}}function uF(e){if("=="===e.op){if(sG(e.value))return{unaryFilter:{field:uO(e.field),op:"IS_NAN"}};else if(sW(e.value))return{unaryFilter:{field:uO(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(sG(e.value))return{unaryFilter:{field:uO(e.field),op:"IS_NOT_NAN"}};else if(sW(e.value))return{unaryFilter:{field:uO(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:uO(e.field),op:ux(e.op),value:e.value}}}function uj(e){switch(e.unaryFilter.op){case"IS_NAN":let t=uN(e.unaryFilter.field);return ao.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=uN(e.unaryFilter.field);return ao.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=uN(e.unaryFilter.field);return ao.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=uN(e.unaryFilter.field);return ao.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return tq(61313);default:return tq(60726)}}function uV(e){return ao.create(uN(e.fieldFilter.field),uD(e.fieldFilter.op),e.fieldFilter.value)}function uq(e){return al.create(e.compositeFilter.filters.map(e=>ub(e)),uA(e.compositeFilter.op))}function uz(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function uU(e){return new i$((e.fieldPaths||[]).map(e=>rE.fromServerFormat(e)))}function u$(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function uK(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class uW{constructor(e,t,r,n,i=rV.min(),s=rV.min(),a=iH.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new uW(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new uW(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new uW(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new uW(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class uG{constructor(e){this.remoteSerializer=e}}function uH(e,t){let r;if(t.document)r=l3(e.remoteSerializer,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=r_.fromSegments(t.noDocument.path),n=uZ(t.noDocument.readTime);r=s5.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return tq(56709);let e=r_.fromSegments(t.unknownDocument.path),n=uZ(t.unknownDocument.version);r=s5.newUnknownDocument(e,n)}return t.readTime&&r.setReadTime(uY(t.readTime)),r}function uQ(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:uJ(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=l2(e.remoteSerializer,t);else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:uX(t.version)};else{if(!t.isUnknownDocument())return tq(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:uX(t.version)}}return n}function uJ(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function uY(e){let t=new rj(e[0],e[1]);return rV.fromTimestamp(t)}function uX(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function uZ(e){let t=new rj(e.seconds,e.nanoseconds);return rV.fromTimestamp(t)}function u0(e,t,r){let n=r.baseMutations.map(t=>ue(e.remoteSerializer,t)),i=r.mutations.map(t=>ue(e.remoteSerializer,t));return{userId:t,batchId:r.batchId,localWriteTimeMs:r.localWriteTime.toMillis(),baseMutations:n,mutations:i}}function u1(e,t){let r=(t.baseMutations||[]).map(t=>ut(e.remoteSerializer,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>ut(e.remoteSerializer,t)),i=rj.fromMillis(t.localWriteTimeMs);return new ln(t.batchId,i,r,n)}function u2(e){let t,r=uZ(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?uZ(e.lastLimboFreeSnapshotVersion):rV.min();return new uW(t=u6(e.query)?uu(e.query):uf(e.query),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,n,iH.fromBase64String(e.resumeToken))}function u3(e,t){let r,n=uX(t.snapshotVersion),i=uX(t.lastLimboFreeSnapshotVersion);r=aP(t.target)?ul(e.remoteSerializer,t.target):uc(e.remoteSerializer,t.target).queryTarget;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:aA(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function u6(e){return void 0!==e.documents}function u5(e){return{id:e.bundleId,createTime:uZ(e.createTime),version:e.version}}function u4(e){return{bundleId:e.id,createTime:uX(l$(e.createTime)),version:e.version}}function u8(e){return{name:e.name,query:u9(e.bundledQuery),readTime:uZ(e.readTime)}}function u7(e){return{name:e.name,readTime:uX(l$(e.readTime)),bundledQuery:e.bundledQuery}}function u9(e){let t=ud({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?a5(t,t.limit,"L"):t}function ce(e){return{name:e.name,query:u9(e.bundledQuery),readTime:l$(e.readTime)}}function ct(e){return{id:e.id,version:e.version,createTime:l$(e.createTime)}}function cr(e,t){return new ls(t.largestBatchId,ut(e.remoteSerializer,t.overlayMutation))}function cn(e,t,r){let[n,i,s]=ci(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:ue(e.remoteSerializer,r.mutation)}}function ci(e,t){let r=t.path.lastSegment();return[e,nb(t.path.popLast()),r]}function cs(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function ca(e,t){let r=t?new rY(t.sequenceNumber,new r0(uZ(t.readTime),new r_(nC(t.documentKey)),t.largestBatchId)):rY.empty(),n=e.fields.map(([e,t])=>new rQ(rE.fromServerFormat(e),t));return new rU(e.indexId,e.collectionGroup,n,r)}function co(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:uX(n.readTime),documentKey:nb(n.documentKey.path),largestBatchId:n.largestBatchId}}class cl{getBundleMetadata(e,t){return cu(e).get(t).next(e=>{if(e)return u5(e)})}saveBundleMetadata(e,t){return cu(e).put(u4(t))}getNamedQuery(e,t){return cc(e).get(t).next(e=>{if(e)return u8(e)})}saveNamedQuery(e,t){return cc(e).put(u7(t))}}function cu(e){return iA(e,n5)}function cc(e){return iA(e,n8)}class ch{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){return new ch(e,t.uid||"")}getOverlay(e,t){return cd(e).get(ci(this.userId,t)).next(e=>e?cr(this.serializer,e):null)}getOverlays(e,t){let r=og();return r5.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new ls(t,i);n.push(this.saveOverlay(e,s))}),r5.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(nb(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(cd(e).deleteAll(im,n))}),r5.waitFor(i)}getOverlaysForCollection(e,t,r){let n=og(),i=nb(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,1/0],!0);return cd(e).loadAll(im,s).next(e=>{for(let t of e){let e=cr(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=og(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return cd(e).iterate({index:iy,range:a},(e,t,r)=>{let a=cr(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}saveOverlay(e,t){return cd(e).put(cn(this.serializer,this.userId,t))}}function cd(e){return iA(e,id)}class cf{globalsStore(e){return iA(e,ib)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(e=>{let t=e?.value;return t?iH.fromUint8Array(t):iH.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}}let cp=5,cm=10,cg=13,cy=15,cv=20,cb=25,cS=30,cw=37,cC=45,cT=50,cE=53,c_=55,cI=60,ck=2;class cx{writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,cp);else if("booleanValue"in e)this.writeValueTypeLabel(t,cm),t.writeNumber(+!!e.booleanValue);else if("integerValue"in e)this.writeValueTypeLabel(t,cy),t.writeNumber(iZ(e.integerValue));else if("doubleValue"in e){let r=iZ(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,cg):(this.writeValueTypeLabel(t,cy),ss(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,cv),"string"==typeof r&&(r=iX(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,cS),t.writeBytes(i0(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,cC),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?sY(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):sQ(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):tq(19022,{indexValue:e})}writeIndexString(e,t){this.writeValueTypeLabel(t,cb),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};for(let e of(this.writeValueTypeLabel(t,c_),Object.keys(r)))this.writeIndexString(e,t),this.writeIndexValueAux(r[e],t)}writeIndexVector(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,cE);let n=sh,i=r[n].arrayValue?.values?.length||0;this.writeValueTypeLabel(t,cy),t.writeNumber(iZ(i)),this.writeIndexString(n,t),this.writeIndexValueAux(r[n],t)}writeIndexArray(e,t){let r=e.values||[];for(let e of(this.writeValueTypeLabel(t,cT),r))this.writeIndexValueAux(e,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,cw),r_.fromName(e).path.forEach(e=>{this.writeValueTypeLabel(t,cI),this.writeUnlabeledIndexString(e,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(ck)}}cx.INSTANCE=new cx;let cR="\uD800",cD="\uDBFF",cA=0,cO=255,cN=1,cP=255,cM=255,cL=0,cB=64,cF=8,cj=1024;function cV(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}function cq(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function cz(e){let t=0;for(let r=0;r<8;++r){let n=cq(255&e[r]);if(t+=n,8!==n)break}return t}function cU(e){return Math.ceil((cB-cz(e))/cF)}class c${constructor(){this.buffer=new Uint8Array(cj),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteAscending(e);else if(e<2048)this.writeByteAscending(960|e>>>6),this.writeByteAscending(128|63&e);else if(t<cR||cD<t)this.writeByteAscending(480|e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e);else{let e=t.codePointAt(0);this.writeByteAscending(240|e>>>18),this.writeByteAscending(128|63&e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteDescending(e);else if(e<2048)this.writeByteDescending(960|e>>>6),this.writeByteDescending(128|63&e);else if(t<cR||cD<t)this.writeByteDescending(480|e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e);else{let e=t.codePointAt(0);this.writeByteDescending(240|e>>>18),this.writeByteDescending(128|63&e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=cU(t);this.ensureAvailable(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}writeNumberDescending(e){let t=this.toOrderedBits(e),r=cU(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}writeInfinityAscending(){this.writeEscapedByteAscending(cP),this.writeEscapedByteAscending(cM)}writeInfinityDescending(){this.writeEscapedByteDescending(cP),this.writeEscapedByteDescending(cM)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=cV(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let e=1;e<t.length;++e)t[e]^=255*!!r;return t}writeByteAscending(e){let t=255&e;t===cA?(this.writeEscapedByteAscending(cA),this.writeEscapedByteAscending(cO)):t===cP?(this.writeEscapedByteAscending(cP),this.writeEscapedByteAscending(cL)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=255&e;t===cA?(this.writeEscapedByteDescending(cA),this.writeEscapedByteDescending(cO)):t===cP?(this.writeEscapedByteDescending(cP),this.writeEscapedByteDescending(cL)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(cA),this.writeEscapedByteAscending(cN)}writeSeparatorDescending(){this.writeEscapedByteDescending(cA),this.writeEscapedByteDescending(cN)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class cK{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class cW{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class cG{constructor(){this.orderedCode=new c$,this.ascending=new cK(this.orderedCode),this.descending=new cW(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return 0===e?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}class cH{constructor(e,t,r,n){this._indexId=e,this._documentKey=t,this._arrayValue=r,this._directionalValue=n}successor(){let e=this._directionalValue.length,t=0===e||255===this._directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this._directionalValue,0),t!==e?r.set([0],this._directionalValue.length):++r[r.length-1],new cH(this._indexId,this._documentKey,this._arrayValue,r)}dbIndexEntry(e,t,r){return{indexId:this._indexId,uid:e,arrayValue:cY(this._arrayValue),directionalValue:cY(this._directionalValue),orderedDocumentKey:cY(t),documentKey:r.path.toArray()}}dbIndexEntryKey(e,t,r){let n=this.dbIndexEntry(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function cQ(e,t){let r=e._indexId-t._indexId;return 0!==r||0!==(r=cJ(e._arrayValue,t._arrayValue))||0!==(r=cJ(e._directionalValue,t._directionalValue))?r:r_.comparator(e._documentKey,t._documentKey)}function cJ(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function cY(e){return M()?cZ(e):e}function cX(e){return"string"!=typeof e?e:c0(e)}function cZ(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}function c0(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}class c1{constructor(e){for(const t of(this.inequalityFilters=new iV((e,t)=>rE.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[],e.filters)){const e=t;e.isInequality()?this.inequalityFilters=this.inequalityFilters.add(e):this.equalityFilters.push(e)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(tU(e.collectionGroup===this.collectionId,49279),this.hasMultipleInequality)return!1;let t=r$(e);if(void 0!==t&&!this.hasMatchingEqualityFilter(t))return!1;let r=rK(e),n=new Set,i=0,s=0;for(;i<r.length;++i)if(this.hasMatchingEqualityFilter(r[i]))n=n.add(r[i].fieldPath.canonicalString());else break;if(i===r.length)return!0;if(this.inequalityFilters.size>0){let e=this.inequalityFilters.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.matchesFilter(e,t)||!this.matchesOrderBy(this.orderBys[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[s++],e))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new iV(rE.comparator),t=[];for(let r of this.equalityFilters)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new rQ(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new rQ(r.field,0))}for(let r of this.orderBys)!r.field.isKeyField()&&(e.has(r.field)||(e=e.add(r.field),t.push(new rQ(r.field,+("asc"!==r.dir)))));return new rU(rU.UNKNOWN_ID,this.collectionId,t,rY.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}matchesOrderBy(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function c2(e){if(tU(e instanceof ao||e instanceof al,20012),e instanceof ao)if(!(e instanceof aI))return e;else{let t=e.value.arrayValue?.values?.map(t=>ao.create(e.field,"==",t))||[];return al.create(t,"or")}let t=e.filters.map(e=>c2(e));return al.create(t,e.op)}function c3(e){if(0===e.getFilters().length)return[];let t=c7(c2(e));return(tU(c4(t),7391),c6(t)||c5(t))?[t]:t.getFilters()}function c6(e){return e instanceof ao}function c5(e){return e instanceof al&&ah(e)}function c4(e){return c6(e)||c5(e)||c8(e)}function c8(e){if(e instanceof al&&ac(e)){for(let t of e.getFilters())if(!c6(t)&&!c5(t))return!1;return!0}return!1}function c7(e){if(tU(e instanceof ao||e instanceof al,34018),e instanceof ao)return e;if(1===e.filters.length)return c7(e.filters[0]);let t=e.filters.map(e=>c7(e)),r=al.create(t,e.op);return c4(r=hn(r))?r:(tU(r instanceof al,64498),tU(au(r),40251),tU(r.filters.length>1,57927),r.filters.reduce((e,t)=>c9(e,t)))}function c9(e,t){let r;return tU(e instanceof ao||e instanceof al,38388),tU(t instanceof ao||t instanceof al,25473),hn(r=e instanceof ao?t instanceof ao?he(e,t):hr(e,t):t instanceof ao?hr(t,e):ht(e,t))}function he(e,t){return al.create([e,t],"and")}function ht(e,t){if(tU(e.filters.length>0&&t.filters.length>0,48005),au(e)&&au(t))return ay(e,t.getFilters());let r=ac(e)?e:t,n=ac(e)?t:e,i=r.filters.map(e=>c9(e,n));return al.create(i,"or")}function hr(e,t){if(au(t))return ay(t,e.getFilters());{let r=t.filters.map(t=>c9(e,t));return al.create(r,"or")}}function hn(e){if(tU(e instanceof ao||e instanceof al,11850),e instanceof ao)return e;let t=e.getFilters();if(1===t.length)return hn(t[0]);if(ad(e))return e;let r=t.map(e=>hn(e)),n=[];return(r.forEach(t=>{t instanceof ao?n.push(t):t instanceof al&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length)?n[0]:al.create(n,e.op)}class hi{constructor(){this.collectionParentIndex=new hs}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),r5.resolve()}getCollectionParents(e,t){return r5.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return r5.resolve()}deleteFieldIndex(e,t){return r5.resolve()}deleteAllFieldIndexes(e){return r5.resolve()}createTargetIndexes(e,t){return r5.resolve()}getDocumentsMatchingTarget(e,t){return r5.resolve(null)}getIndexType(e,t){return r5.resolve(0)}getFieldIndexes(e,t){return r5.resolve([])}getNextCollectionGroupToUpdate(e){return r5.resolve(null)}getMinOffset(e,t){return r5.resolve(r0.min())}getMinOffsetFromCollectionGroup(e,t){return r5.resolve(r0.min())}updateCollectionGroup(e,t,r){return r5.resolve()}updateIndexEntries(e,t){return r5.resolve()}}class hs{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new iV(rC.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new iV(rC.comparator)).toArray()}}let ha="IndexedDbIndexManager",ho=new Uint8Array(0);class hl{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new hs,this.targetToDnfSubTargets=new ou(e=>aA(e),(e,t)=>aN(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let i={collectionId:r,parent:nb(n)};return hu(e).put(i)}return r5.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[rb(t),""],!1,!0);return hu(e).loadAll(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(nC(n.parent))}return r})}addFieldIndex(e,t){let r=hh(e),n=cs(t);delete n.indexId;let i=r.add(n);if(!t.indexState)return i.next();{let r=hd(e);return i.next(e=>{r.put(co(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}}deleteFieldIndex(e,t){let r=hh(e),n=hd(e),i=hc(e);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=hh(e),r=hc(e),n=hd(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>n.deleteAll())}createTargetIndexes(e,t){return r5.forEach(this.getSubTargets(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new c1(t).buildTargetIndex();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=hc(e),n=!0,i=new Map;return r5.forEach(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(!n)return r5.resolve(null);{let e=oC(),n=[];return r5.forEach(i,(i,s)=>{tB(ha,`Using index ${rH(i)} to execute ${aA(t)}`);let a=aL(s,i),o=aB(s,i),l=aF(s,i),u=aj(s,i),c=this.encodeBound(i,s,l),h=this.encodeBound(i,s,u),d=this.encodeValues(i,s,o),f=this.generateIndexRanges(i.indexId,a,c,l.inclusive,h,u.inclusive,d);return r5.forEach(f,i=>r.loadFirst(i,t.limit).next(t=>{t.forEach(t=>{let r=r_.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(t=0===e.filters.length?[e]:c3(al.create(e.filters,"and")).map(t=>aD(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t)),t}generateIndexRanges(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let c=0;c<o;++c){let o=t?this.encodeSingleElement(t[c/l]):ho,h=this.generateLowerBound(e,o,r[c%l],n),d=this.generateUpperBound(e,o,i[c%l],s),f=a.map(t=>this.generateLowerBound(e,o,t,!0));u.push(...this.createRange(h,d,f))}return u}generateLowerBound(e,t,r,n){let i=new cH(e,r_.empty(),t,r);return n?i:i.successor()}generateUpperBound(e,t,r,n){let i=new cH(e,r_.empty(),t,r);return n?i.successor():i}getFieldIndex(e,t){let r=new c1(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.servedByIndex(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.getSubTargets(t);return r5.forEach(n,t=>this.getFieldIndex(e,t).next(e=>{e?0!==r&&e.fields.length<az(t)&&(r=1):r=0})).next(()=>aU(t)&&n.length>1&&2===r?1:r)}encodeDirectionalElements(e,t){let r=new cG;for(let n of rK(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.forKind(n.kind);cx.INSTANCE.writeIndexValue(e,i)}return r.encodedBytes()}encodeSingleElement(e){let t=new cG;return cx.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new cG;return cx.INSTANCE.writeIndexValue(sq(this.databaseId,t),r.forKind(rW(e))),r.encodedBytes()}encodeValues(e,t,r){if(null===r)return[];let n=[];n.push(new cG);let i=0;for(let s of rK(e)){let e=r[i++];for(let r of n)if(this.isInFilter(t,s.fieldPath)&&sK(e))n=this.expandIndexValues(n,s,e);else{let t=r.forKind(s.kind);cx.INSTANCE.writeIndexValue(e,t)}}return this.getEncodedBytes(n)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new cG;n.seed(r.encodedBytes()),cx.INSTANCE.writeIndexValue(e,n.forKind(t.kind)),i.push(n)}return i}isInFilter(e,t){return!!e.filters.find(e=>e instanceof ao&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=hh(e),n=hd(e);return(t?r.loadAll(it,IDBKeyRange.bound(t,t)):r.loadAll()).next(e=>{let t=[];return r5.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{t.push(ca(e,r))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:rf(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=hh(e),i=hd(e);return this.getNextSequenceNumber(e).next(e=>n.loadAll(it,IDBKeyRange.bound(t,t)).next(t=>r5.forEach(t,t=>i.put(co(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return r5.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?r5.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),r5.forEach(i,r=>this.getExistingIndexEntries(e,t,r).next(t=>{let i=this.computeIndexEntries(n,r);return t.isEqual(i)?r5.resolve():this.updateEntries(e,n,r,t,i)}))))})}addIndexEntry(e,t,r,n){return hc(e).put(n.dbIndexEntry(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}deleteIndexEntry(e,t,r,n){return hc(e).delete(n.dbIndexEntryKey(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}getExistingIndexEntries(e,t,r){let n=hc(e),i=new iV(cQ);return n.iterate({index:ic,range:IDBKeyRange.only([r.indexId,this.uid,cY(this.encodeDirectionalKey(r,t))])},(e,n)=>{i=i.add(new cH(r.indexId,t,cX(n.arrayValue),cX(n.directionalValue)))}).next(()=>i)}computeIndexEntries(e,t){let r=new iV(cQ),n=this.encodeDirectionalElements(t,e);if(null==n)return r;let i=r$(t);if(null!=i){let s=e.data.field(i.fieldPath);if(sK(s))for(let i of s.arrayValue.values||[])r=r.add(new cH(t.indexId,e.key,this.encodeSingleElement(i),n))}else r=r.add(new cH(t.indexId,e.key,ho,n));return r}updateEntries(e,t,r,n,i){tB(ha,"Updating index entries for document '%s'",t.key);let s=[];return iz(n,i,cQ,n=>{s.push(this.addIndexEntry(e,t,r,n))},n=>{s.push(this.deleteIndexEntry(e,t,r,n))}),r5.waitFor(s)}getNextSequenceNumber(e){let t=1;return hd(e).iterate({index:ia,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>cQ(e,t)).filter((e,t,r)=>!t||0!==cQ(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=cQ(i,e),s=cQ(i,t);if(0===r)n[0]=e.successor();else if(r>0&&s<0)n.push(i),n.push(i.successor());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.isRangeMatchable(n[e],n[e+1]))return[];let t=n[e].dbIndexEntryKey(this.uid,ho,r_.empty()),r=n[e+1].dbIndexEntryKey(this.uid,ho,r_.empty());i.push(IDBKeyRange.bound(t,r))}return i}isRangeMatchable(e,t){return cQ(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(hf)}getMinOffset(e,t){return r5.mapArray(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>e||tq(44426))).next(hf)}}function hu(e){return iA(e,n1)}function hc(e){return iA(e,il)}function hh(e){return iA(e,n9)}function hd(e){return iA(e,ii)}function hf(e){tU(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>r1(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new r0(t.readTime,t.documentKey,r)}function hp(e,t,r){let n=e.store(nx),i=e.store(nL),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.iterate({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{tU(1===o,47070,{batchId:r.batchId})}));let u=[];for(let e of r.mutations){let n=nP(t,e.key.path,r.batchId);s.push(i.delete(n)),u.push(e.key)}return r5.waitFor(s).next(()=>u)}function hm(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else if(e.noDocument)t=e.noDocument;else throw tq(14731);return JSON.stringify(t).length}class hg{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.documentKeysByBatchId={}}static forUser(e,t,r,n){return tU(""!==e.uid,64387),new hg(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return hb(e).iterate({index:nD,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=hS(e),s=hb(e);return s.add({}).next(a=>{tU("number"==typeof a,49019);let o=new ln(a,t,r,n),l=u0(this.serializer,this.userId,o),u=[],c=new iV((e,t)=>rf(e.canonicalString(),t.canonicalString()));for(let e of n){let t=nP(this.userId,e.key.path,a);c=c.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,nM))}return c.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=o.keys()}),r5.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return hb(e).get(t).next(e=>e?(tU(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),u1(this.serializer,e)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?r5.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(e=>{if(!e)return null;{let r=e.keys();return this.documentKeysByBatchId[t]=r,r}})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return hb(e).iterate({index:nD,range:n},(e,t,n)=>{t.userId===this.userId&&(tU(t.batchId>=r,47524,{nextBatchId:r}),i=u1(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=sn;return hb(e).iterate({index:nD,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,sn],[this.userId,1/0]);return hb(e).loadAll(nD,t).next(e=>e.map(e=>u1(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=nN(this.userId,t.path),n=IDBKeyRange.lowerBound(r),i=[];return hS(e).iterate({range:n},(r,n,s)=>{let[a,o,l]=r,u=nC(o);return a===this.userId&&t.path.isEqual(u)?hb(e).get(l).next(e=>{if(!e)throw tq(61480,{indexKey:r,batchId:l});tU(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(u1(this.serializer,e))}):void s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new iV(rf),n=[];return t.forEach(t=>{let i=nN(this.userId,t.path),s=IDBKeyRange.lowerBound(i),a=hS(e).iterate({range:s},(e,n,i)=>{let[s,a,o]=e,l=nC(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),r5.waitFor(n).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=nN(this.userId,r),s=IDBKeyRange.lowerBound(i),a=new iV(rf);return hS(e).iterate({range:s},(e,t,i)=>{let[s,o,l]=e,u=nC(o);s===this.userId&&r.isPrefixOf(u)?u.length===n&&(a=a.add(l)):i.done()}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],n=[];return t.forEach(t=>{n.push(hb(e).get(t).next(e=>{if(null===e)throw tq(35274,{batchId:t});tU(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(u1(this.serializer,e))}))}),r5.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return hp(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),r5.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return r5.resolve();let r=IDBKeyRange.lowerBound(nO(this.userId)),n=[];return hS(e).iterate({range:r},(e,t,r)=>{if(e[0]!==this.userId)return void r.done();{let t=nC(e[1]);n.push(t)}}).next(()=>{tU(0===n.length,56720,{danglingKeys:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return hy(e,this.userId,t)}getMutationQueueMetadata(e){return hw(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:sn,lastStreamToken:""})}}function hy(e,t,r){let n=nN(t,r.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return hS(e).iterate({range:s,keysOnly:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function hv(e,t){let r=!1;return hw(e).iterateSerial(n=>hy(e,n,t).next(e=>(e&&(r=!0),r5.resolve(!e)))).next(()=>r)}function hb(e){return iA(e,nx)}function hS(e){return iA(e,nL)}function hw(e){return iA(e,nI)}let hC=2;class hT{constructor(e){this.lastId=e}next(){return this.lastId+=hC,this.lastId}static forTargetCache(){return new hT(2-hC)}static forSyncEngine(){return new hT(1-hC)}}class hE{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new hT(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(e=>rV.fromTimestamp(new rj(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.saveMetadata(e,n)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>h_(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(t=>(tU(t.targetCount>0,8065),t.targetCount-=1,this.saveMetadata(e,t)))}removeTargets(e,t,r){let n=0,i=[];return h_(e).iterate((s,a)=>{let o=u2(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>r5.waitFor(i)).next(()=>n)}forEachTarget(e,t){return h_(e).iterate((e,r)=>{t(u2(r))})}retrieveMetadata(e){return hI(e).get(nZ).next(e=>(tU(null!==e,2888),e))}saveMetadata(e,t){return hI(e).put(nZ,t)}saveTargetData(e,t){return h_(e).put(u3(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(e=>e.targetCount)}getTargetData(e,t){let r=aA(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),i=null;return h_(e).iterate({range:n,index:nG},(e,r,n)=>{let s=u2(r);aN(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=hk(e);return t.forEach(t=>{let s=nb(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),r5.waitFor(n)}removeMatchingKeys(e,t,r){let n=hk(e);return r5.forEach(t,t=>{let i=nb(t.path);return r5.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=hk(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=hk(e),i=oC();return n.iterate({range:r,keysOnly:!0},(e,t,r)=>{let n=new r_(nC(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=nb(t.path),n=IDBKeyRange.bound([r],[rb(r)],!1,!0),i=0;return hk(e).iterate({index:nY,keysOnly:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}getTargetDataForTarget(e,t){return h_(e).get(t).next(e=>e?u2(e):null)}}function h_(e){return iA(e,nK)}function hI(e){return iA(e,n0)}function hk(e){return iA(e,nQ)}let hx={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},hR=-1,hD=0x2800000;class hA{static withCacheSize(e){return new hA(e,hA.DEFAULT_COLLECTION_PERCENTILE,hA.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}hA.DEFAULT_COLLECTION_PERCENTILE=10,hA.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hA.DEFAULT=new hA(hD,hA.DEFAULT_COLLECTION_PERCENTILE,hA.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hA.DISABLED=new hA(hR,0,0);let hO="LruGarbageCollector",hN=1048576,hP=6e4,hM=3e5;function hL([e,t],[r,n]){let i=rf(e,r);return 0===i?rf(t,n):i}class hB{constructor(e){this.maxElements=e,this.buffer=new iV(hL),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>hL(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class hF{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==hR&&this.scheduleGC(hP)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(e){tB(hO,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){nn(e)?tB(hO,"Ignoring IndexedDB error during garbage collection: ",e):await r6(e)}await this.scheduleGC(hM)})}}class hj{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return r5.resolve(np.INVALID);let r=new hB(t);return this.delegate.forEachTarget(e,e=>r.addElement(e.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,e=>r.addElement(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===hR?(tB("LruGarbageCollector","Garbage collection skipped; disabled"),r5.resolve(hx)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(tB("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),hx):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,n,i,s,a,o,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(tB("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(l=Date.now(),tM()<=tb.DEBUG&&tB("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${n} in ${a-s}ms
	Removed ${i} targets in ${o-a}ms
	Removed ${e} documents in ${l-o}ms
Total Duration: ${l-u}ms`),r5.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}function hV(e,t){return new hj(e,t)}class hq{constructor(e,t){this.db=e,this.garbageCollector=hV(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(e,r)=>t(r))}addReference(e,t,r){return h$(e,r)}removeReference(e,t,r){return h$(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return h$(e,t)}isPinned(e,t){return hv(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.forEachOrphanedDocument(e,(s,a)=>{if(a<=t){let t=this.isPinned(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,rV.min()),hk(e).delete(hz(s))))});n.push(t)}}).next(()=>r5.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return h$(e,t)}forEachOrphanedDocument(e,t){let r,n=hk(e),i=np.INVALID;return n.iterate({index:nY},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==np.INVALID&&t(new r_(nC(r)),i),i=a,r=s):i=np.INVALID}).next(()=>{i!==np.INVALID&&t(new r_(nC(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function hz(e){return[0,nb(e.path)]}function hU(e,t){return{targetId:0,path:nb(e.path),sequenceNumber:t}}function h$(e,t){return hk(e).put(hU(t,e.currentSequenceNumber))}class hK{constructor(){this.changes=new ou(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,s5.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?r5.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class hW{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return hJ(e).put(r)}removeEntry(e,t,r){return hJ(e).delete(hX(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=s5.newInvalidDocument(t);return hJ(e).iterate({index:nj,range:IDBKeyRange.only(hY(t))},(e,n)=>{r=this.maybeDecodeDocument(t,n)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:s5.newInvalidDocument(t)};return hJ(e).iterate({index:nj,range:IDBKeyRange.only(hY(t))},(e,n)=>{r={document:this.maybeDecodeDocument(t,n),size:hm(n)}}).next(()=>r)}getEntries(e,t){let r=oh();return this.forEachDbEntry(e,t,(e,t)=>{let n=this.maybeDecodeDocument(e,t);r=r.insert(e,n)}).next(()=>r)}getSizedEntries(e,t){let r=oh(),n=new iL(r_.comparator);return this.forEachDbEntry(e,t,(e,t)=>{let i=this.maybeDecodeDocument(e,t);r=r.insert(e,i),n=n.insert(e,hm(t))}).next(()=>({documents:r,sizeMap:n}))}forEachDbEntry(e,t,r){if(t.isEmpty())return r5.resolve();let n=new iV(h0);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(hY(n.first()),hY(n.last())),s=n.getIterator(),a=s.getNext();return hJ(e).iterate({index:nj,range:i},(e,t,n)=>{let i=r_.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>h0(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.skip(hY(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),uJ(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return hJ(e).loadAll(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=oh();for(let i of e){let e=this.maybeDecodeDocument(r_.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(ot(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=oh(),s=hZ(t,r),a=hZ(t,r0.max());return hJ(e).iterate({index:nq,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.maybeDecodeDocument(r_.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new hH(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return hQ(e).get(n$).next(e=>(tU(!!e,20021),e))}setMetadata(e,t){return hQ(e).put(n$,t)}maybeDecodeDocument(e,t){if(t){let e=uH(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(rV.min())))return e}return s5.newInvalidDocument(e)}}function hG(e){return new hW(e)}class hH extends hK{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new ou(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new iV((e,t)=>rf(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.documentStates.get(i);if(t.push(this.documentCache.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=uQ(this.documentCache.serializer,s);n=n.add(i.path.popLast());let l=hm(o);r+=l-a.size,t.push(this.documentCache.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=uQ(this.documentCache.serializer,s.convertToNoDocument(rV.min()));t.push(this.documentCache.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.documentCache.updateMetadata(e,r)),r5.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(e=>(this.documentStates.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:e,sizeMap:t})=>(t.forEach((t,r)=>{this.documentStates.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function hQ(e){return iA(e,nU)}function hJ(e){return iA(e,nB)}function hY(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function hX(e,t){let r=e.path.toArray();return[r.slice(0,r.length-2),r[r.length-2],uJ(t),r[r.length-1]]}function hZ(e,t){let r=t.documentKey.path.toArray();return[e,uJ(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function h0(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=rf(r[e],n[e]))return i;return(i=rf(r.length,n.length))||(i=rf(r[r.length-2],n[n.length-2]))?i:rf(r[r.length-1],n[n.length-1])}let h1=18;class h2{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class h3{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&oY(r.mutation,e,i$.empty(),rj.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,oC()).next(()=>t))}getLocalViewOfDocuments(e,t,r=oC()){let n=og();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=of();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=og();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,oC()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=oh(),s=ov(),a=op();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof o3)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),oY(a.mutation,t,a.mutation.getFieldMask(),rj.now())):s.set(t.key,i$.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new h2(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=ov(),n=new iL((e,t)=>e-t),i=oC();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||i$.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||oC()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=oy();l.forEach(e=>{if(!i.has(e)){let n=oQ(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return r5.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return aY(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):aX(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):r5.resolve(og()),a=rq,o=i;return s.next(t=>r5.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t))?r5.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)})).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,oC())).next(e=>({batchId:a,changes:om(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new r_(t)).next(e=>{let t=of();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=of();return this.indexManager.getCollectionParents(e,i).next(a=>r5.forEach(a,a=>{let o=aG(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,s5.newInvalidDocument(n)))});let r=of();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&oY(s.mutation,n,i$.empty(),rj.now()),ot(t,n)&&(r=r.insert(e,n))}),r})}}class h6{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return r5.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,ct(t)),r5.resolve()}getNamedQuery(e,t){return r5.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,ce(t)),r5.resolve()}}class h5{constructor(){this.overlays=new iL(r_.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return r5.resolve(this.overlays.get(t))}getOverlays(e,t){let r=og();return r5.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.saveOverlay(e,t,n)}),r5.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.overlayByBatchId.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.overlayByBatchId.delete(r)),r5.resolve()}getOverlaysForCollection(e,t,r){let n=og(),i=t.length+1,s=new r_(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return r5.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new iL((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=og(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=og(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return r5.resolve(a)}saveOverlay(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.overlayByBatchId.get(n.largestBatchId).delete(r.key);this.overlayByBatchId.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new ls(t,r));let i=this.overlayByBatchId.get(t);void 0===i&&(i=oC(),this.overlayByBatchId.set(t,i)),this.overlayByBatchId.set(t,i.add(r.key))}}class h4{constructor(){this.sessionToken=iH.EMPTY_BYTE_STRING}getSessionToken(e){return r5.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,r5.resolve()}}class h8{constructor(){this.refsByKey=new iV(h7.compareByKey),this.refsByTarget=new iV(h7.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new h7(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.removeRef(new h7(e,t))}removeReferences(e,t){e.forEach(e=>this.removeReference(e,t))}removeReferencesForId(e){let t=new r_(new rC([])),r=new h7(t,e),n=new h7(t,e+1),i=[];return this.refsByTarget.forEachInRange([r,n],e=>{this.removeRef(e),i.push(e.key)}),i}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new r_(new rC([])),r=new h7(t,e),n=new h7(t,e+1),i=oC();return this.refsByTarget.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new h7(e,0),r=this.refsByKey.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class h7{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return r_.comparator(e.key,t.key)||rf(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return rf(e.targetOrBatchId,t.targetOrBatchId)||r_.comparator(e.key,t.key)}}class h9{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new iV(h7.compareByKey)}checkEmpty(e){return r5.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new ln(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new h7(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return r5.resolve(s)}lookupMutationBatch(e,t){return r5.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=this.indexOfBatchId(r),i=n<0?0:n;return r5.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return r5.resolve(0===this.mutationQueue.length?sn:this.nextBatchId-1)}getAllMutationBatches(e){return r5.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new h7(t,0),n=new h7(t,1/0),i=[];return this.batchesByDocumentKey.forEachInRange([r,n],e=>{let t=this.findMutationBatch(e.targetOrBatchId);i.push(t)}),r5.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new iV(rf);return t.forEach(e=>{let t=new h7(e,0),n=new h7(e,1/0);this.batchesByDocumentKey.forEachInRange([t,n],e=>{r=r.add(e.targetOrBatchId)})}),r5.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;r_.isDocumentKey(i)||(i=i.child(""));let s=new h7(new r_(i),0),a=new iV(rf);return this.batchesByDocumentKey.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.targetOrBatchId)),!0)},s),r5.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(e=>{let r=this.findMutationBatch(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){tU(0===this.indexOfExistingBatchId(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.batchesByDocumentKey;return r5.forEach(t.mutations,n=>{let i=new h7(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.batchesByDocumentKey=r})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new h7(t,0),n=this.batchesByDocumentKey.firstAfterOrEqual(r);return r5.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,r5.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}let de="-9223372036854775808";function dt(){return new iL(r_.comparator)}class dr{constructor(e){this.sizer=e,this.docs=dt(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return r5.resolve(r?r.document.mutableCopy():s5.newInvalidDocument(t))}getEntries(e,t){let r=oh();return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():s5.newInvalidDocument(e))}),r5.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=oh(),s=t.path,a=new r_(s.child("__id"+de+"__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;!(e.path.length>s.length+1||0>=r1(rZ(a),r))&&(n.has(a.key)||ot(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return r5.resolve(i)}getAllFromCollectionGroup(e,t,r,n){tq(9500)}forEachDocumentKey(e,t){return r5.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new di(this)}getSize(e){return r5.resolve(this.size)}}function dn(e){return new dr(e)}class di extends hK{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.documentCache.addEntry(e,n)):this.documentCache.removeEntry(r)}),r5.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}}class ds{constructor(e){this.persistence=e,this.targets=new ou(e=>aA(e),aN),this.lastRemoteSnapshotVersion=rV.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new h8,this.targetCount=0,this.targetIdGenerator=hT.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((e,r)=>t(r)),r5.resolve()}getLastRemoteSnapshotVersion(e){return r5.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return r5.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),r5.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),r5.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new hT(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,r5.resolve()}updateTargetData(e,t){return this.saveTargetData(t),r5.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,r5.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.targets.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.targets.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),r5.waitFor(i).next(()=>n)}getTargetCount(e){return r5.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return r5.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),r5.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),r5.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),r5.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return r5.resolve(r)}containsKey(e,t){return r5.resolve(this.references.containsKey(t))}}let da="MemoryPersistence";class dl{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new np(0),this._started=!1,this._started=!0,this.globalsCache=new h4,this.referenceDelegate=e(this),this.targetCache=new ds(this);const r=e=>this.referenceDelegate.documentSize(e);this.indexManager=new hi,this.remoteDocumentCache=dn(r),this.serializer=new uG(t),this.bundleCache=new h6(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new h5,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new h9(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){tB(da,"Starting transaction:",e);let n=new du(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(n).next(e=>this.referenceDelegate.onTransactionCommitted(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}mutationQueuesContainKey(e,t){return r5.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}}class du extends r3{constructor(e){super(),this.currentSequenceNumber=e}}class dc{constructor(e){this.persistence=e,this.localViewReferences=new h8,this._orphanedDocuments=null}static factory(e){return new dc(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw tq(60996)}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),r5.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),r5.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),r5.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(e=>this.orphanedDocuments.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.orphanedDocuments.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return r5.forEach(this.orphanedDocuments,r=>{let n=r_.fromPath(r);return this.isReferenced(e,n).next(e=>{e||t.removeEntry(n,rV.min())})}).next(()=>(this._orphanedDocuments=null,t.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(e=>{e?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return r5.or([()=>r5.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}}class dh{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new ou(e=>nb(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=hV(this,t)}static factory(e,t){return new dh(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return r5.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return r5.forEach(this.orphanedSequenceNumbers,(r,n)=>this.isPinned(e,r,n).next(e=>e?r5.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.forEachDocumentKey(e,n=>this.isPinned(e,n,t).next(e=>{e||(r++,i.removeEntry(n,rV.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),r5.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),r5.resolve()}removeReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),r5.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),r5.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=sF(e.data.value)),t}isPinned(e,t,r){return r5.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.orphanedSequenceNumbers.get(t);return r5.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class dd{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,n){let i=new r7("createOrUpgrade",t);r<1&&n>=1&&(dp(e),dm(e),dS(e),dy(e));let s=r5.resolve();return r<3&&n>=3&&(0!==r&&(dw(e),dS(e)),s=s.next(()=>dT(i))),r<4&&n>=4&&(0!==r&&(s=s.next(()=>dg(e,i))),s=s.next(()=>{dE(e)})),r<5&&n>=5&&(s=s.next(()=>this.removeAcknowledgedMutations(i))),r<6&&n>=6&&(s=s.next(()=>(db(e),this.addDocumentGlobal(i)))),r<7&&n>=7&&(s=s.next(()=>this.ensureSequenceNumbers(i))),r<8&&n>=8&&(s=s.next(()=>this.createCollectionParentIndex(e,i))),r<9&&n>=9&&(s=s.next(()=>{dC(e)})),r<10&&n>=10&&(s=s.next(()=>this.rewriteCanonicalIds(i))),r<11&&n>=11&&(s=s.next(()=>{d_(e),dI(e)})),r<12&&n>=12&&(s=s.next(()=>{dx(e)})),r<13&&n>=13&&(s=s.next(()=>dv(e)).next(()=>this.rewriteRemoteDocumentCache(e,i)).next(()=>e.deleteObjectStore(nT))),r<14&&n>=14&&(s=s.next(()=>this.runOverlayMigration(e,i))),r<15&&n>=15&&(s=s.next(()=>dk(e))),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(ii).clear()}).next(()=>{t.objectStore(il).clear()})),r<17&&n>=17&&(s=s.next(()=>{dR(e)})),r<18&&n>=18&&M()&&(s=s.next(()=>{t.objectStore(ii).clear()}).next(()=>{t.objectStore(il).clear()})),s}addDocumentGlobal(e){let t=0;return e.store(nT).iterate((e,r)=>{t+=hm(r)}).next(()=>{let r={byteSize:t};return e.store(nU).put(n$,r)})}removeAcknowledgedMutations(e){let t=e.store(nI),r=e.store(nx);return t.loadAll().next(t=>r5.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,sn],[t.userId,t.lastAcknowledgedBatchId]);return r.loadAll(nD,n).next(r=>r5.forEach(r,r=>{tU(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=u1(this.serializer,r);return hp(e,t.userId,n).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(nQ),r=e.store(nT);return e.store(n0).get(nZ).next(e=>{let n=r=>t.put({targetId:0,path:nb(r),sequenceNumber:e.highestListenSequenceNumber}),i=[];return r.iterate((e,r)=>{let s=new rC(e),a=df(s);i.push(t.get(a).next(e=>e?r5.resolve():n(s)))}).next(()=>r5.waitFor(i))})}createCollectionParentIndex(e,t){e.createObjectStore(n1,{keyPath:n2});let r=t.store(n1),n=new hs,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:nb(n)})}};return t.store(nT).iterate({keysOnly:!0},(e,t)=>i(new rC(e).popLast())).next(()=>t.store(nL).iterate({keysOnly:!0},([e,t,r],n)=>i(nC(t).popLast())))}rewriteCanonicalIds(e){let t=e.store(nK);return t.iterate((e,r)=>{let n=u2(r),i=u3(this.serializer,n);return t.put(i)})}rewriteRemoteDocumentCache(e,t){let r=t.store(nT),n=[];return r.iterate((e,r)=>{let i=t.store(nB),s=dD(r).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>r5.waitFor(n))}runOverlayMigration(e,t){let r=t.store(nx),n=hG(this.serializer),i=new dl(dc.factory,this.serializer.remoteSerializer);return r.loadAll().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??oC();u1(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),r5.forEach(r,(e,r)=>{let s=new tD(r),a=ch.forUser(this.serializer,s),o=i.getIndexManager(s);return new h3(n,hg.forUser(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new iD(t,np.INVALID),e).next()})})}}function df(e){return[0,nb(e)]}function dp(e){e.createObjectStore(nE)}function dm(e){e.createObjectStore(nI,{keyPath:nk}),e.createObjectStore(nx,{keyPath:nR,autoIncrement:!0}).createIndex(nD,nA,{unique:!0}),e.createObjectStore(nL)}function dg(e,t){return t.store(nx).loadAll().next(r=>{e.deleteObjectStore(nx),e.createObjectStore(nx,{keyPath:nR,autoIncrement:!0}).createIndex(nD,nA,{unique:!0});let n=t.store(nx),i=r.map(e=>n.put(e));return r5.waitFor(i)})}function dy(e){e.createObjectStore(nT)}function dv(e){let t=e.createObjectStore(nB,{keyPath:nF});t.createIndex(nj,nV),t.createIndex(nq,nz)}function db(e){e.createObjectStore(nU)}function dS(e){e.createObjectStore(nQ,{keyPath:nJ}).createIndex(nY,nX,{unique:!0}),e.createObjectStore(nK,{keyPath:nW}).createIndex(nG,nH,{unique:!0}),e.createObjectStore(n0)}function dw(e){e.deleteObjectStore(nQ),e.deleteObjectStore(nK),e.deleteObjectStore(n0)}function dC(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}function dT(e){let t=e.store(n0),r={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:rV.min().toTimestamp(),targetCount:0};return t.put(nZ,r)}function dE(e){e.createObjectStore(n3,{keyPath:n6})}function d_(e){e.createObjectStore(n5,{keyPath:n4})}function dI(e){e.createObjectStore(n8,{keyPath:n7})}function dk(e){e.createObjectStore(n9,{keyPath:ie,autoIncrement:!0}).createIndex(it,ir,{unique:!1}),e.createObjectStore(ii,{keyPath:is}).createIndex(ia,io,{unique:!1}),e.createObjectStore(il,{keyPath:iu}).createIndex(ic,ih,{unique:!1})}function dx(e){let t=e.createObjectStore(id,{keyPath:ip});t.createIndex(im,ig,{unique:!1}),t.createIndex(iy,iv,{unique:!1})}function dR(e){e.createObjectStore(ib,{keyPath:iS})}function dD(e){return e.document?new r_(rC.fromString(e.document.name).popFirst(5)):e.noDocument?r_.fromSegments(e.noDocument.path):e.unknownDocument?r_.fromSegments(e.unknownDocument.path):tq(36783)}let dA="IndexedDbPersistence",dO=18e5,dN=5e3,dP=4e3,dM="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",dL="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",dB="firestore_zombie",dF="main";class dj{constructor(e,t,r,n,i,s,a,o,l,u,c=h1){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=i,this.window=s,this.document=a,this.sequenceNumberSyncer=l,this.forceOwningTab=u,this.schemaVersion=c,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=-1/0,this.primaryStateListener=e=>Promise.resolve(),!dj.isAvailable())throw new t9(t5,dL);this.referenceDelegate=new hq(this,n),this.dbName=t+dF,this.serializer=new uG(o),this.simpleDb=new r9(this.dbName,this.schemaVersion,new dd(this.serializer)),this.globalsCache=new cf,this.targetCache=new hE(this.referenceDelegate,this.serializer),this.remoteDocumentCache=hG(this.serializer),this.bundleCache=new cl,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===u&&tF(dA,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new t9(t2,dM);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new np(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>dq(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(e=>{e||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(t=>this.isPrimary&&!t?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):!!t&&this.acquireOrExtendPrimaryLease(e).next(()=>!0))).catch(e=>{if(nn(e))return tB(dA,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return tB(dA,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return dV(e).get(n_).next(e=>r5.resolve(this.isLocalClient(e)))}removeClientMetadata(e){return dq(e).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,dO)){this.lastGarbageCollectionTime=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=iA(e,n3);return t.loadAll().next(e=>{let r=this.filterActiveClients(e,dO),n=e.filter(e=>-1===r.indexOf(e));return r5.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",dP,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return!!e&&e.ownerId===this.clientId}canActAsPrimary(e){return this.forceOwningTab?r5.resolve(!0):dV(e).get(n_).next(t=>{if(null!==t&&this.isWithinAge(t.leaseTimestampMs,dN)&&!this.isClientZombied(t.ownerId)){if(this.isLocalClient(t)&&this.networkEnabled)return!0;if(!this.isLocalClient(t)){if(!t.allowTabSynchronization)throw new t9(t2,dM);return!1}}return!!this.networkEnabled&&!!this.inForeground||dq(e).loadAll().next(e=>void 0===this.filterActiveClients(e,dN).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&tB(dA,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[nE,n3],e=>{let t=new iD(e,np.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(e,t){return e.filter(e=>this.isWithinAge(e.updateTimeMs,t)&&!this.isClientZombied(e.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>dq(e).loadAll().next(e=>this.filterActiveClients(e,dO).map(e=>e.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return hg.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new hl(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return ch.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){let n;tB(dA,"Starting transaction:",e);let i="readonly"===t?"readonly":"readwrite",s=iR(this.schemaVersion);return this.simpleDb.runTransaction(e,i,s,i=>(n=new iD(i,this.listenSequence?this.listenSequence.next():np.INVALID),"readwrite-primary"===t)?this.verifyPrimaryLease(n).next(e=>!!e||this.canActAsPrimary(n)).next(t=>{if(!t)throw tF(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new t9(t2,r2);return r(n)}).next(e=>this.acquireOrExtendPrimaryLease(n).next(()=>e)):this.verifyAllowTabSynchronization(n).next(()=>r(n))).then(e=>(n.raiseOnCommittedEvent(),e))}verifyAllowTabSynchronization(e){return dV(e).get(n_).next(e=>{if(null!==e&&this.isWithinAge(e.leaseTimestampMs,dN)&&!this.isClientZombied(e.ownerId)&&!this.isLocalClient(e)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!e.allowTabSynchronization))throw new t9(t2,dM)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return dV(e).put(n_,t)}static isAvailable(){return r9.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=dV(e);return t.get(n_).next(e=>this.isLocalClient(e)?(tB(dA,"Releasing primary lease."),t.delete(n_)):r5.resolve())}isWithinAge(e,t){let r=Date.now(),n=r-t,i=r;return!(e<n)&&(!(e>i)||(tF(`Detected an update time that is in the future: ${e} > ${i}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){"function"==typeof this.window?.addEventListener&&(this.windowUnloadHandler=()=>{this.markClientZombied();let e=/(?:Version|Mobile)\/1[456]/;P()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){try{let t=this.webStorage?.getItem(this.zombiedClientLocalStorageKey(e))!==null;return tB(dA,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return tF(dA,"Failed to get zombied client id.",e),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){tF("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}}zombiedClientLocalStorageKey(e){return`${dB}_${this.persistenceKey}_${e}`}}function dV(e){return iA(e,nE)}function dq(e){return iA(e,n3)}function dz(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}async function dU(e){if(!r9.isAvailable())return Promise.resolve();let t=e+dF;await r9.delete(t)}function d$(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])}function dK(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}let dW="LocalStore",dG=3e8;class dH{constructor(e,t,r,n){this.persistence=e,this.queryEngine=t,this.serializer=n,this.targetDataByTarget=new iL(rf),this.targetIdByTarget=new ou(e=>aA(e),aN),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new h3(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}}function dQ(e,t,r,n){return new dH(e,t,r,n)}async function dJ(e,t){let r=tK(e);return await r.persistence.runTransaction("Handle user change","readonly",e=>{let n;return r.mutationQueue.getAllMutationBatches(e).next(i=>(n=i,r.initializeUserComponents(t),r.mutationQueue.getAllMutationBatches(e))).next(t=>{let i=[],s=[],a=oC();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return r.localDocuments.getDocuments(e,a).next(e=>({affectedDocuments:e,removedBatchIds:i,addedBatchIds:s}))})})}function dY(e,t){let r,n,i=tK(e),s=rj.now(),a=t.reduce((e,t)=>e.add(t.key),oC());return i.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=oh(),l=oC();return i.remoteDocuments.getEntries(e,a).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(e,o)).next(n=>{r=n;let a=[];for(let e of t){let t=oX(e,r.get(e.key).overlayedDocument);null!=t&&a.push(new o3(e.key,t,s6(t.value.mapValue),oW.exists(!0)))}return i.mutationQueue.addMutationBatch(e,s,a,t)}).next(t=>{n=t;let s=t.applyToLocalDocumentSet(r,l);return i.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:n.batchId,changes:om(r)}))}function dX(e,t){let r=tK(e);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n=t.batch.keys(),i=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});return fn(r,e,t,i).next(()=>i.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,dZ(t))).next(()=>r.localDocuments.getDocuments(e,n))})}function dZ(e){let t=oC();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}function d0(e,t){let r=tK(e);return r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(tU(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))})}function d1(e){let t=tK(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}function d2(e){let t=tK(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.targetCache.getLastRemoteSnapshotVersion(e))}function d3(e,t){let r=tK(e),n=t.snapshotVersion,i=r.targetDataByTarget;return r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=r.targetDataByTarget;let a=[];t.targetChanges.forEach((s,o)=>{let l=i.get(o);if(!l)return;a.push(r.targetCache.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.targetCache.addMatchingKeys(e,s.addedDocuments,o)));let u=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?u=u.withResumeToken(iH.EMPTY_BYTE_STRING,rV.min()).withLastLimboFreeSnapshotVersion(rV.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,n)),i=i.insert(o,u),d5(l,u,s)&&a.push(r.targetCache.updateTargetData(e,u))});let o=oh(),l=oC();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(d6(e,s,t.documentUpdates).next(e=>{o=e.changedDocuments,l=e.existenceChangedKeys})),!n.isEqual(rV.min())){let t=r.targetCache.getLastRemoteSnapshotVersion(e).next(t=>r.targetCache.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return r5.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.targetDataByTarget=i,e))}function d6(e,t,r){let n=oC(),i=oC();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=oh();return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(rV.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):tB(dW,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{changedDocuments:n,existenceChangedKeys:i}})}function d5(e,t,r){return!!(0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=dG)||r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size>0}async function d4(e,t){let r=tK(e);try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>r5.forEach(t,t=>r5.forEach(t.addedKeys,n=>r.persistence.referenceDelegate.addReference(e,t.targetId,n)).next(()=>r5.forEach(t.removedKeys,n=>r.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))}catch(e){if(nn(e))tB(dW,"Failed to update sequence numbers: "+e);else throw e}for(let e of t){let t=e.targetId;if(!e.fromCache){let e=r.targetDataByTarget.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.targetDataByTarget=r.targetDataByTarget.insert(t,i)}}}function d8(e,t){let r=tK(e);return r.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=sn),r.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function d7(e,t){let r=tK(e);return r.persistence.runTransaction("read document","readonly",e=>r.localDocuments.getDocument(e,t))}function d9(e,t){let r=tK(e);return r.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return r.targetCache.getTargetData(e,t).next(i=>i?(n=i,r5.resolve(n)):r.targetCache.allocateTargetId(e).next(i=>(n=new uW(t,i,"TargetPurposeListen",e.currentSequenceNumber),r.targetCache.addTargetData(e,n).next(()=>n))))}).then(e=>{let n=r.targetDataByTarget.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(r.targetDataByTarget=r.targetDataByTarget.insert(e.targetId,e),r.targetIdByTarget.set(t,e.targetId)),e})}function fe(e,t,r){let n=tK(e),i=n.targetIdByTarget.get(r);return void 0!==i?r5.resolve(n.targetDataByTarget.get(i)):n.targetCache.getTargetData(t,r)}async function ft(e,t,r){let n=tK(e),i=n.targetDataByTarget.get(t),s=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",s,e=>n.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(nn(e))tB(dW,`Failed to update sequence numbers for target ${t}: ${e}`);else throw e}n.targetDataByTarget=n.targetDataByTarget.remove(t),n.targetIdByTarget.delete(i.target)}function fr(e,t,r){let n=tK(e),i=rV.min(),s=oC();return n.persistence.runTransaction("Execute query","readwrite",e=>fe(n,e,a0(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,n.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>n.queryEngine.getDocumentsMatchingQuery(e,t,r?i:rV.min(),r?s:oC())).next(e=>(fu(n,oa(t),e),{documents:e,remoteKeys:s})))}function fn(e,t,r,n){let i=r.batch,s=i.keys(),a=r5.resolve();return s.forEach(e=>{a=a.next(()=>n.getEntry(t,e)).next(t=>{let s=r.docVersions.get(e);tU(null!==s,48541),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,r),t.isValidDocument()&&(t.setReadTime(r.commitVersion),n.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}function fi(e,t){let r=tK(e),n=tK(r.mutationQueue);return r.persistence.runTransaction("Lookup mutation documents","readonly",e=>n.lookupMutationKeys(e,t).next(t=>t?r.localDocuments.getDocuments(e,t):r5.resolve(null)))}function fs(e,t){tK(tK(e,dH).mutationQueue).removeCachedMutationKeys(t)}function fa(e){return tK(tK(e,dH).persistence).getActiveClients()}function fo(e,t){let r=tK(e),n=tK(r.targetCache),i=r.targetDataByTarget.get(t);return i?Promise.resolve(i.target):r.persistence.runTransaction("Get target data","readonly",e=>n.getTargetDataForTarget(e,t).next(e=>e?e.target:null))}function fl(e,t){let r=tK(e),n=r.collectionGroupReadTime.get(t)||rV.min();return r.persistence.runTransaction("Get new document changes","readonly",e=>r.remoteDocuments.getAllFromCollectionGroup(e,t,rX(n,rq),Number.MAX_SAFE_INTEGER)).then(e=>(fu(r,t,e),e))}function fu(e,t,r){let n=e.collectionGroupReadTime.get(t)||rV.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.collectionGroupReadTime.set(t,n)}function fc(e){return a0(aW(rC.fromString(`__bundle__/docs/${e}`)))}async function fh(e,t,r,n){let i=tK(e),s=oC(),a=oh();for(let e of r){let r=t.toDocumentKey(e.metadata.name);e.document&&(s=s.add(r));let n=t.toMutableDocument(e);n.setReadTime(t.toSnapshotVersion(e.metadata.readTime)),a=a.insert(r,n)}let o=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=await d9(i,fc(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>d6(e,o,a).next(t=>(o.apply(e),t)).next(t=>i.targetCache.removeMatchingKeysForTargetId(e,l.targetId).next(()=>i.targetCache.addMatchingKeys(e,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.changedDocuments,t.existenceChangedKeys)).next(()=>t.changedDocuments)))}function fd(e,t){let r=tK(e),n=l$(t.createTime);return r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.bundleCache.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(n)>=0)}function ff(e,t){let r=tK(e);return r.persistence.runTransaction("Save bundle","readwrite",e=>r.bundleCache.saveBundleMetadata(e,t))}function fp(e,t){let r=tK(e);return r.persistence.runTransaction("Get named query","readonly",e=>r.bundleCache.getNamedQuery(e,t))}async function fm(e,t,r=oC()){let n=await d9(e,a0(u9(t.bundledQuery))),i=tK(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{let s=l$(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return i.bundleCache.saveNamedQuery(e,t);let a=n.withResumeToken(iH.EMPTY_BYTE_STRING,s);return i.targetDataByTarget=i.targetDataByTarget.insert(a.targetId,a),i.targetCache.updateTargetData(e,a).next(()=>i.targetCache.removeMatchingKeysForTargetId(e,n.targetId)).next(()=>i.targetCache.addMatchingKeys(e,r,n.targetId)).next(()=>i.bundleCache.saveNamedQuery(e,t))})}async function fg(e,t){let r=tK(e),n=r.indexManager,i=[];return r.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(r=>d$(r,t,rG,t=>{i.push(n.addFieldIndex(e,t))},t=>{i.push(n.deleteFieldIndex(e,t))})).next(()=>r5.waitFor(i)))}function fy(e,t){tK(e).queryEngine.indexAutoCreationEnabled=t}function fv(e){let t=tK(e),r=t.indexManager;return t.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}class fb{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}let fS=100;function fw(){return P()?8:ne(_())>0?6:4}class fC{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=fS,this.relativeIndexReadCostPerDocument=fw()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.performQueryUsingIndex(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.performQueryUsingRemoteKeys(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new fb;return this.executeFullCollectionScan(e,t,r).next(n=>{if(i.result=n,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,r,n.size)})}).next(()=>i.result)}createCacheIndexes(e,t,r,n){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(tM()<=tb.DEBUG&&tB("QueryEngine","SDK will not create cache indexes for query:",oe(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),r5.resolve()):(tM()<=tb.DEBUG&&tB("QueryEngine","Query:",oe(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*n)?(tM()<=tb.DEBUG&&tB("QueryEngine","The SDK decides to create cache indexes for query:",oe(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,a0(t))):r5.resolve()}performQueryUsingIndex(e,t){if(aH(t))return r5.resolve(null);let r=a0(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=a0(t=a5(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=oC(...n);return this.localDocumentsView.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.applyQuery(t,n);return this.needsRefill(t,s,i,r.readTime)?this.performQueryUsingIndex(e,a5(t,null,"F")):this.appendRemainingResults(e,s,t,r)}))})))}performQueryUsingRemoteKeys(e,t,r,n){return aH(t)||n.isEqual(rV.min())?r5.resolve(null):this.localDocumentsView.getDocuments(e,r).next(i=>{let s=this.applyQuery(t,i);return this.needsRefill(t,s,r,n)?r5.resolve(null):(tM()<=tb.DEBUG&&tB("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),oe(t)),this.appendRemainingResults(e,s,t,rX(n,rq)).next(e=>e))})}applyQuery(e,t){let r=new iV(oo(e));return t.forEach((t,n)=>{ot(e,n)&&(r=r.add(n))}),r}needsRefill(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}executeFullCollectionScan(e,t,r){return tM()<=tb.DEBUG&&tB("QueryEngine","Using full collection scan to execute query:",oe(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,r0.min(),r)}appendRemainingResults(e,t,r,n){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let fT="firestore_clients";function fE(e,t){return`${fT}_${e}_${t}`}let f_="firestore_mutations";function fI(e,t,r){let n=`${f_}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let fk="firestore_targets";function fx(e,t){return`${fk}_${e}_${t}`}let fR="firestore_online_state";function fD(e){return`${fR}_${e}`}let fA="firestore_bundle_loaded_v2";function fO(e){return`${fA}_${e}`}let fN="firestore_sequence_number";function fP(e){return`${fN}_${e}`}let fM="SharedClientState";class fL{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static fromWebStorageEntry(e,t,r){let n,i=JSON.parse(r),s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return(s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(n=new t9(i.error.code,i.error.message)),s)?new fL(e,t,i.state,n):(tF(fM,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class fB{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r,n=JSON.parse(t),i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return(i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new t9(n.error.code,n.error.message)),i)?new fB(e,n.state,r):(tF(fM,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class fF{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=oE();for(let e=0;n&&e<r.activeTargetIds.length;++e)n=sa(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new fF(e,i):(tF(fM,`Failed to parse client data for instance '${e}': ${t}`),null)}}class fj{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new fj(t.clientId,t.onlineState):(tF(fM,`Failed to parse online state: ${e}`),null)}}class fV{constructor(){this.activeTargetIds=oE()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class fq{constructor(e,t,r,n,i){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new iL(rf),this.started=!1,this.earlyEvents=[];const s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.localClientStorageKey=fE(this.persistenceKey,this.localClientId),this.sequenceNumberKey=fP(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new fV),this.clientStateKeyRe=RegExp(`^${fT}_${s}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${f_}_${s}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${fk}_${s}_(\\d+)$`),this.onlineStateKey=fD(this.persistenceKey),this.bundleLoadedKey=fO(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}async start(){for(let e of(await this.syncEngine.getActiveClients())){if(e===this.localClientId)continue;let t=this.getItem(fE(this.persistenceKey,e));if(t){let r=fF.fromWebStorageEntry(e,t);r&&(this.activeClients=this.activeClients.insert(r.clientId,r))}}this.persistClientState();let e=this.storage.getItem(this.onlineStateKey);if(e){let t=this.fromWebStorageOnlineState(e);t&&this.handleOnlineStateEvent(t)}for(let e of this.earlyEvents)this.handleWebStorageEvent(e);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(fx(this.persistenceKey,e));if(t){let n=fB.fromWebStorageEntry(e,t);n&&(r=n.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(fx(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.removeMutationState(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return tB(fM,"READ",e,t),t}setItem(e,t){tB(fM,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){tB(fM,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(tB(fM,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void tF("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueRetryable(async()=>{if(!this.started)return void this.earlyEvents.push(t);if(null!==t.key){if(this.clientStateKeyRe.test(t.key))if(null!=t.newValue){let e=this.fromWebStorageClientState(t.key,t.newValue);if(e)return this.handleClientStateEvent(e.clientId,e)}else{let e=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(e,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(e)return this.handleMutationBatchEvent(e)}}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(e)return this.handleQueryTargetEvent(e)}}else if(t.key===this.onlineStateKey){if(null!==t.newValue){let e=this.fromWebStorageOnlineState(t.newValue);if(e)return this.handleOnlineStateEvent(e)}}else if(t.key===this.sequenceNumberKey){let e=fz(t.newValue);e!==np.INVALID&&this.sequenceNumberHandler(e)}else if(t.key===this.bundleLoadedKey){let e=this.fromWebStoreBundleLoadedState(t.newValue);await Promise.all(e.map(e=>this.syncEngine.synchronizeWithChangedDocuments(e)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let n=new fL(this.currentUser,e,t,r),i=fI(this.persistenceKey,this.currentUser,e);this.setItem(i,n.toWebStorageJSON())}removeMutationState(e){let t=fI(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let n=fx(this.persistenceKey,e),i=new fB(e,t,r);this.setItem(n,i.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return fF.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return fL.fromWebStorageEntry(new tD(i),n,t)}fromWebStorageQueryTargetMetadata(e,t){let r=Number(this.queryTargetKeyRe.exec(e)[1]);return fB.fromWebStorageEntry(r,t)}fromWebStorageOnlineState(e){return fj.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}async handleMutationBatchEvent(e){return e.user.uid!==this.currentUser.uid?void tB(fM,`Ignoring mutation for non-active user ${e.user.uid}`):this.syncEngine.applyBatchState(e.batchId,e.state,e.error)}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),n=this.extractActiveQueryTargets(this.activeClients),i=this.extractActiveQueryTargets(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.applyActiveTargetsChange(s,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=oE();return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}function fz(e){let t=np.INVALID;if(null!=e)try{let r=JSON.parse(e);tU("number"==typeof r,30636,{seqString:e}),t=r}catch(e){tF(fM,"Failed to read sequence number from WebStorage",e)}return t}class fU{constructor(){this.localState=new fV,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new fV,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class f${addCallback(e){}shutdown(){}}class fK{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}}let fW=null;function fG(){return 0x10000000+Math.round(0x80000000*Math.random())}function fH(){return null===fW?fW=fG():fW++,"0x"+fW.toString(16)}function fQ(e){return new Promise((t,r)=>{e((e,n)=>{e?r(e):t(n)})})}let fJ="1.9.15",fY="GrpcConnection",fX=`gl-node/${process.versions.node} fire/${tA} grpc/${fJ}`;function fZ(e,t,r,n,i){tU(null===t||"OAuth"===t.type,36936);let s=new tx.Metadata;return t&&t.headers.forEach((e,t)=>s.set(t,e)),r&&r.headers.forEach((e,t)=>s.set(t,e)),n&&s.set("X-Firebase-GMPID",n),s.set("X-Goog-Api-Client",fX),s.set("Google-Cloud-Resource-Prefix",e),s.set("x-goog-request-params",e),i&&s.set("X-Goog-Api-Key",i),s}class f0{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){tB(fY,"Creating Firestore stub.");let e=this.databaseInfo.ssl?tx.credentials.createSsl():tx.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,n,i){let s=fH(),a=this.ensureActiveStub(),o=fZ(this.databasePath,n,i,this.databaseInfo.appId,this.databaseInfo.apiKey),l={database:this.databasePath,...r};return fQ(t=>(tB(fY,`RPC '${e}' ${s} invoked with request:`,r),a[e](l,o,(r,n)=>{r?(tB(fY,`RPC '${e}' ${s} failed with error:`,r),t(new t9(lu(r.code),r.message))):(tB(fY,`RPC '${e}' ${s} completed with response:`,n),t(void 0,n))})))}invokeStreamingRPC(e,t,r,n,i,s){let a=fH(),o=[],l=new re;tB(fY,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),c=fZ(this.databasePath,n,i,this.databaseInfo.appId,this.databaseInfo.apiKey),h={...r,database:this.databasePath},d=u[e](h,c),f=!1;return d.on("data",t=>{tB(fY,`RPC ${e} ${a} received result:`,t),o.push(t),void 0!==s&&o.length===s&&(f=!0,l.resolve(o))}),d.on("end",()=>{tB(fY,`RPC '${e}' ${a} completed.`),f||(f=!0,l.resolve(o))}),d.on("error",t=>{tB(fY,`RPC '${e}' ${a} failed with error:`,t);let r=lu(t.code);l.reject(new t9(r,t.message))}),l.promise}openStream(e,t,r){let n=fH(),i=this.ensureActiveStub(),s=fZ(this.databasePath,t,r,this.databaseInfo.appId,this.databaseInfo.apiKey),a=i[e](s),o=!1,l=e=>{o||(o=!0,u.callOnClose(e),a.end())},u=new fK({sendFn:t=>{if(o)tB(fY,`RPC '${e}' stream ${n} not sending because gRPC stream is closed:`,t);else{tB(fY,`RPC '${e}' stream ${n} sending:`,t);try{a.write(t)}catch(e){throw tF("Failure sending:",t),tF("Error:",e),e}}},closeFn:()=>{tB(fY,`RPC '${e}' stream ${n} closed locally via close().`),l()}}),c=!1;return a.on("data",t=>{o||(tB(fY,`RPC '${e}' stream ${n} received:`,t),c||(u.callOnConnected(),c=!0),u.callOnMessage(t))}),a.on("end",()=>{tB(fY,`RPC '${e}' stream ${n} ended.`),l()}),a.on("error",t=>{o||(tj(fY,`RPC '${e}' stream ${n} error. Code:`,t.code,"Message:",t.message),l(new t9(lu(t.code),t.message)))}),tB(fY,`Opening RPC '${e}' stream ${n} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let f1={google:{nested:{protobuf:{options:{go_package:"github.com/golang/protobuf/protoc-gen-go/descriptor;descriptor",java_package:"com.google.protobuf",java_outer_classname:"DescriptorProtos",csharp_namespace:"Google.Protobuf.Reflection",objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2},options:{type:"ExtensionRangeOptions",id:3}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},ExtensionRangeOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3},reservedRange:{rule:"repeated",type:"EnumReservedRange",id:4},reservedName:{rule:"repeated",type:"string",id:5}},nested:{EnumReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5,options:{default:!1}},serverStreaming:{type:"bool",id:6,options:{default:!1}}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10,options:{default:!1}},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27,options:{default:!1}},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16,options:{default:!1}},javaGenericServices:{type:"bool",id:17,options:{default:!1}},pyGenericServices:{type:"bool",id:18,options:{default:!1}},phpGenericServices:{type:"bool",id:42,options:{default:!1}},deprecated:{type:"bool",id:23,options:{default:!1}},ccEnableArenas:{type:"bool",id:31,options:{default:!1}},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},swiftPrefix:{type:"string",id:39},phpClassPrefix:{type:"string",id:40},phpNamespace:{type:"string",id:41},phpMetadataNamespace:{type:"string",id:44},rubyPackage:{type:"string",id:45},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1,options:{default:!1}},noStandardDescriptorAccessor:{type:"bool",id:2,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[8,8],[9,9]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},weak:{type:"bool",id:10,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[5,5]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},idempotencyLevel:{type:"IdempotencyLevel",id:34,options:{default:"IDEMPOTENCY_UNKNOWN"}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],nested:{IdempotencyLevel:{values:{IDEMPOTENCY_UNKNOWN:0,NO_SIDE_EFFECTS:1,IDEMPOTENT:2}}}},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Empty:{fields:{}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},Duration:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"cloud.google.com/go/firestore/apiv1/firestorepb;firestorepb",java_multiple_files:!0,java_outer_classname:"QueryProfileProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue","fieldReferenceValue","functionValue","pipelineValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6},fieldReferenceValue:{type:"string",id:19},functionValue:{type:"Function",id:20},pipelineValue:{type:"Pipeline",id:21}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Function:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}},Pipeline:{fields:{stages:{rule:"repeated",type:"Stage",id:1}},nested:{Stage:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},ExecutePipeline:{requestType:"ExecutePipelineRequest",responseType:"ExecutePipelineResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:executePipeline","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:executePipeline",body:"*"}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},ExecutePipelineRequest:{oneofs:{pipelineType:{oneof:["structuredPipeline"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredPipeline:{type:"StructuredPipeline",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},ExecutePipelineResponse:{fields:{transaction:{type:"bytes",id:1},results:{rule:"repeated",type:"Document",id:2},executionTime:{type:"google.protobuf.Timestamp",id:3}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredPipeline:{fields:{pipeline:{type:"Pipeline",id:1},options:{keyType:"string",type:"Value",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}},Avg:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}},ExplainOptions:{fields:{analyze:{type:"bool",id:1,options:{"(google.api.field_behavior)":"OPTIONAL"}}}},ExplainMetrics:{fields:{planSummary:{type:"PlanSummary",id:1},executionStats:{type:"ExecutionStats",id:2}}},PlanSummary:{fields:{indexesUsed:{rule:"repeated",type:"google.protobuf.Struct",id:1}}},ExecutionStats:{fields:{resultsReturned:{type:"int64",id:1},executionDuration:{type:"google.protobuf.Duration",id:3},readOperations:{type:"int64",id:4},debugStats:{type:"google.protobuf.Struct",id:5}}}}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api;api",java_multiple_files:!0,java_outer_classname:"LaunchStageProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:0x44f2530,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1},fullyDecodeReservedExpansion:{type:"bool",id:2}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{selector:{type:"string",id:1},get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},body:{type:"string",id:7},responseBody:{type:"string",id:12},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}},LaunchStage:{values:{LAUNCH_STAGE_UNSPECIFIED:0,UNIMPLEMENTED:6,PRELAUNCH:7,EARLY_ACCESS:1,ALPHA:2,BETA:3,GA:4,DEPRECATED:5}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var f2={nested:f1},f3=Object.freeze({__proto__:null,nested:f1,default:f2});let f6={longs:String,enums:String,defaults:!0,oneofs:!1};function f5(){let e=tR.fromJSON(f3,f6);return tx.loadPackageDefinition(e)}function f4(e){return new f0(f5(),e)}function f8(){return new f$}function f7(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function f9(){return null}function pe(e){return new lM(e,!1)}let pt="ExponentialBackoff",pr=1e3,pn=1.5,pi=6e4;class ps{constructor(e,t,r=pr,n=pn,i=pi){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=n,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),n=Math.max(0,t-r);n>0&&tB(pt,`Backing off for ${n} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,n,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}let pa="PersistentStream",po=6e4,pl=1e4;class pu{constructor(e,t,r,n,i,s,a,o){this.queue=e,this.idleTimerId=r,this.healthTimerId=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new ps(e,t)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){(this.responseCount=0,4===this.state)?this.performBackoff():this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,po,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(e,t){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==e?this.backoff.reset():t&&t.code===t1?(tF(t.toString()),tF("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===t0&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,await this.listener.onClose(t)}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.closeCount===t&&this.startStream(e,r)},t=>{e(()=>{let e=new t9(tH,"Fetching auth token failed: "+t.message);return this.handleStreamClose(e)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,pl,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(e=>{r(()=>this.handleStreamClose(e))}),this.stream.onMessage(e=>{r(()=>1==++this.responseCount?this.onFirst(e):this.onNext(e))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(e){return tB(pa,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(tB(pa,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class pc extends pu{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=l8(this.serializer,e),r=l9(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=lX(this.serializer),t.addTarget=ug(this.serializer,e);let r=up(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=lX(this.serializer),t.removeTarget=e,this.sendRequest(t)}}class ph extends pu{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return tU(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,tU(!e.writeResults||0===e.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(e){tU(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=us(e.writeResults,e.commitTime),r=l$(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=lX(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>ue(this.serializer,e))};this.sendRequest(t)}}class pd{}class pf extends pd{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new t9(t2,"The client has already been terminated.")}invokeRPC(e,t,r,n){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.invokeRPC(e,lW(t,r),n,i,s)).catch(e=>{if("FirebaseError"===e.name)throw e.code===t0&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new t9(tH,e.toString())})}invokeStreamingRPC(e,t,r,n,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.invokeStreamingRPC(e,lW(t,r),n,s,a,i)).catch(e=>{if("FirebaseError"===e.name)throw e.code===t0&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new t9(tH,e.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function pp(e,t,r,n){return new pf(e,t,r,n)}async function pm(e,t){let r=tK(e),n={writes:t.map(e=>ue(r.serializer,e))};await r.invokeRPC("Commit",r.serializer.databaseId,rC.emptyPath(),n)}async function pg(e,t){let r=tK(e),n={documents:t.map(e=>lH(r.serializer,e))},i=await r.invokeStreamingRPC("BatchGetDocuments",r.serializer.databaseId,rC.emptyPath(),n,t.length),s=new Map;i.forEach(e=>{let t=l4(r.serializer,e);s.set(t.key.toString(),t)});let a=[];return t.forEach(e=>{let t=s.get(e.toString());tU(!!t,55234,{key:e}),a.push(t)}),a}async function py(e,t,r){let n=tK(e),{request:i,aliasMap:s,parent:a}=uh(n.serializer,a1(t),r);n.connection.shouldResourcePathBeIncludedInRequest||delete i.parent;let o=(await n.invokeStreamingRPC("RunAggregationQuery",n.serializer.databaseId,a,i,1)).filter(e=>!!e.result);tU(1===o.length,64727);let l=o[0].result?.aggregateFields;return Object.keys(l).reduce((e,t)=>(e[s[t]]=l[t],e),{})}function pv(e,t,r){let n=tK(e);return n.verifyInitialized(),new ph(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}function pb(e,t,r){let n=tK(e);return n.verifyInitialized(),new pc(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}let pS="OnlineStateTracker",pw=1,pC=1e4;class pT{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",pC,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${pC/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=pw&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${pw} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(tF(t),this.shouldWarnClientIsOffline=!1):tB(pS,t)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}let pE="RemoteStore",p_=10;class pI{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(e=>{r.enqueueAndForget(async()=>{pj(this)&&(tB(pE,"Restarting streams for network reachability change."),await p5(this))})}),this.onlineStateTracker=new pT(r,n)}}function pk(e,t,r,n,i){return new pI(e,t,r,n,i)}function px(e){let t=tK(e);return t.offlineCauses.delete(0),pR(t)}async function pR(e){if(pj(e))for(let t of e.onNetworkStatusChange)await t(!0)}async function pD(e){let t=tK(e);t.offlineCauses.add(0),await pA(t),t.onlineStateTracker.set("Offline")}async function pA(e){for(let t of e.onNetworkStatusChange)await t(!1)}async function pO(e){let t=tK(e);tB(pE,"RemoteStore shutting down."),t.offlineCauses.add(5),await pA(t),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown")}function pN(e,t){let r=tK(e);!r.listenTargets.has(t.targetId)&&(r.listenTargets.set(t.targetId,t),pF(r)?pB(r):p7(r).isOpen()&&pM(r,t))}function pP(e,t){let r=tK(e),n=p7(r);r.listenTargets.delete(t),n.isOpen()&&pL(r,t),0===r.listenTargets.size&&(n.isOpen()?n.markIdle():pj(r)&&r.onlineStateTracker.set("Unknown"))}function pM(e,t){if(e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(rV.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}p7(e).watch(t)}function pL(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),p7(e).unwatch(t)}function pB(e){e.watchChangeAggregator=new lk({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),getTargetDataForTarget:t=>e.listenTargets.get(t)||null,getDatabaseId:()=>e.datastore.serializer.databaseId}),p7(e).start(),e.onlineStateTracker.handleWatchStreamStart()}function pF(e){return pj(e)&&!p7(e).isStarted()&&e.listenTargets.size>0}function pj(e){return 0===tK(e).offlineCauses.size}function pV(e){e.watchChangeAggregator=void 0}async function pq(e){e.onlineStateTracker.set("Online")}async function pz(e){e.listenTargets.forEach((t,r)=>{pM(e,t)})}async function pU(e,t){pV(e),pF(e)?(e.onlineStateTracker.handleWatchStreamFailure(t),pB(e)):e.onlineStateTracker.set("Unknown")}async function p$(e,t,r){if(e.onlineStateTracker.set("Online"),t instanceof lE&&2===t.state&&t.cause){try{await pH(e,t)}catch(r){tB(pE,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await pK(e,r)}return}if(t instanceof lC?e.watchChangeAggregator.handleDocumentChange(t):t instanceof lT?e.watchChangeAggregator.handleExistenceFilter(t):e.watchChangeAggregator.handleTargetChange(t),!r.isEqual(rV.min()))try{let t=await d2(e.localStore);r.compareTo(t)>=0&&await pG(e,r)}catch(t){tB(pE,"Failed to raise snapshot:",t),await pK(e,t)}}async function pK(e,t,r){if(nn(t))e.offlineCauses.add(1),await pA(e),e.onlineStateTracker.set("Offline"),r||(r=()=>d2(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{tB(pE,"Retrying IndexedDB access"),await r(),e.offlineCauses.delete(1),await pR(e)});else throw t}function pW(e,t){return t().catch(r=>pK(e,r,t))}function pG(e,t){let r=e.watchChangeAggregator.createRemoteEvent(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){let i=e.listenTargets.get(n);i&&e.listenTargets.set(n,i.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{let n=e.listenTargets.get(t);n&&(e.listenTargets.set(t,n.withResumeToken(iH.EMPTY_BYTE_STRING,n.snapshotVersion)),pL(e,t),pM(e,new uW(n.target,t,r,n.sequenceNumber)))}),e.remoteSyncer.applyRemoteEvent(r)}async function pH(e,t){let r=t.cause;for(let n of t.targetIds)e.listenTargets.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.listenTargets.delete(n),e.watchChangeAggregator.removeTarget(n))}async function pQ(e){let t=tK(e),r=p9(t),n=t.writePipeline.length>0?t.writePipeline[t.writePipeline.length-1].batchId:sn;for(;pJ(t);)try{let e=await d8(t.localStore,n);if(null===e){0===t.writePipeline.length&&r.markIdle();break}n=e.batchId,pY(t,e)}catch(e){await pK(t,e)}pX(t)&&pZ(t)}function pJ(e){return pj(e)&&e.writePipeline.length<p_}function pY(e,t){e.writePipeline.push(t);let r=p9(e);r.isOpen()&&r.handshakeComplete&&r.writeMutations(t.mutations)}function pX(e){return pj(e)&&!p9(e).isStarted()&&e.writePipeline.length>0}function pZ(e){p9(e).start()}async function p0(e){p9(e).writeHandshake()}async function p1(e){let t=p9(e);for(let r of e.writePipeline)t.writeMutations(r.mutations)}async function p2(e,t,r){let n=e.writePipeline.shift(),i=li.from(n,t,r);await pW(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await pQ(e)}async function p3(e,t){t&&p9(e).handshakeComplete&&await p6(e,t),pX(e)&&pZ(e)}async function p6(e,t){if(ll(t.code)){let r=e.writePipeline.shift();p9(e).inhibitBackoff(),await pW(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await pQ(e)}}async function p5(e){let t=tK(e);t.offlineCauses.add(4),await pA(t),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),await pR(t)}async function p4(e,t){let r=tK(e);r.asyncQueue.verifyOperationInProgress(),tB(pE,"RemoteStore received new credentials");let n=pj(r);r.offlineCauses.add(3),await pA(r),n&&r.onlineStateTracker.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.offlineCauses.delete(3),await pR(r)}async function p8(e,t){let r=tK(e);t?(r.offlineCauses.delete(2),await pR(r)):t||(r.offlineCauses.add(2),await pA(r),r.onlineStateTracker.set("Unknown"))}function p7(e){return e.watchStream||(e.watchStream=pb(e.datastore,e.asyncQueue,{onConnected:pq.bind(null,e),onOpen:pz.bind(null,e),onClose:pU.bind(null,e),onWatchChange:p$.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.watchStream.inhibitBackoff(),pF(e)?pB(e):e.onlineStateTracker.set("Unknown")):(await e.watchStream.stop(),pV(e))})),e.watchStream}function p9(e){return e.writeStream||(e.writeStream=pv(e.datastore,e.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:p0.bind(null,e),onClose:p3.bind(null,e),onHandshakeComplete:p1.bind(null,e),onMutationResult:p2.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.writeStream.inhibitBackoff(),await pQ(e)):(await e.writeStream.stop(),e.writePipeline.length>0&&(tB(pE,`Stopping write stream with ${e.writePipeline.length} pending writes`),e.writePipeline=[]))})),e.writeStream}let me="AsyncQueue";class mt{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new re,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new mt(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new t9(tG,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function mr(e,t){if(tF(me,`${t}: ${e}`),nn(e))return new t9(t8,`${t}: ${e}`);throw e}class mn{static emptySet(e){return new mn(e.comparator)}constructor(e){e?this.comparator=(t,r)=>e(t,r)||r_.comparator(t.key,r.key):this.comparator=(e,t)=>r_.comparator(e.key,t.key),this.keyedMap=of(),this.sortedSet=new iL(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof mn)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return(this.forEach(t=>{e.push(t.toString())}),0===e.length)?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new mn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class mi{constructor(){this.changeMap=new iL(r_.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}0!==e.type&&3===r.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==r.type?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):tq(63341,{change:e,oldChange:r})}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}}class ms{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new ms(e,t,mn.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!a7(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class ma{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}}function mo(){return new ml}class ml{constructor(){this.queries=mu(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){my(this,new t9(t3,"Firestore shutting down"))}}function mu(){return new ou(e=>a9(e),a7)}async function mc(e,t){let r=tK(e),n=3,i=t.query,s=r.queries.get(i);s?!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(n=2):(s=new ma,n=+!t.listensToRemoteStore());try{switch(n){case 0:s.viewSnap=await r.onListen(i,!0);break;case 1:s.viewSnap=await r.onListen(i,!1);break;case 2:await r.onFirstRemoteStoreListen(i)}}catch(r){let e=mr(r,`Initialization of query '${oe(t.query)}' failed`);t.onError(e);return}r.queries.set(i,s),s.listeners.push(t),t.applyOnlineStateChange(r.onlineState),s.viewSnap&&t.onViewSnapshot(s.viewSnap)&&mv(r)}async function mh(e,t){let r=tK(e),n=t.query,i=3,s=r.queries.get(n);if(s){let e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),0===s.listeners.length?i=+!t.listensToRemoteStore():!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(i=2))}switch(i){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function md(e,t){let r=tK(e),n=!1;for(let e of t){let t=e.query,i=r.queries.get(t);if(i){for(let t of i.listeners)t.onViewSnapshot(e)&&(n=!0);i.viewSnap=e}}n&&mv(r)}function mf(e,t,r){let n=tK(e),i=n.queries.get(t);if(i)for(let e of i.listeners)e.onError(r);n.queries.delete(t)}function mp(e,t){let r=tK(e);r.onlineState=t;let n=!1;r.queries.forEach((e,r)=>{for(let e of r.listeners)e.applyOnlineStateChange(t)&&(n=!0)}),n&&mv(r)}function mm(e,t){tK(e).snapshotsInSyncListeners.add(t),t.next()}function mg(e,t){tK(e).snapshotsInSyncListeners.delete(t)}function my(e,t){let r=tK(e),n=r.queries;r.queries=mu(),n.forEach((e,r)=>{for(let e of r.listeners)e.onError(t)})}function mv(e){e.snapshotsInSyncListeners.forEach(e=>{e.next()})}!function(e){e.Default="default",e.Cache="cache"}(tT||(tT={}));class mb{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new ms(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r="Offline"!==t;return(!this.options.waitForSyncWhenOnline||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return(!!e.syncStateChanged||!!t)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(e){e=ms.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==tT.Cache}}class mS{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=n}static fromSnapshot(e,t){let r=oC(),n=oC();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new mS(e,t.fromCache,r,n)}}class mw{constructor(e){this.serializer=e}toDocumentKey(e){return lQ(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?l3(this.serializer,e.document,!1):s5.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return l$(e)}}class mC{constructor(e,t){this.bundleMetadata=e,this.serializer=t,this._queries=[],this._documents=[],this.collectionGroups=new Set,this.progress=mT(e)}get queries(){return this._queries}get documents(){return this._documents}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this._queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this._documents.push({metadata:e.payload.documentMetadata}),!e.payload.documentMetadata.exists&&++t;let r=rC.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this._documents[this._documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}getQueryDocumentMapping(e){let t=new Map,r=new mw(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.toDocumentKey(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||oC()).add(e);t.set(r,n)}}return t}async completeAndStoreAsync(e){let t=await fh(e,new mw(this.serializer),this._documents,this.bundleMetadata.id),r=this.getQueryDocumentMapping(this.documents);for(let t of this._queries)await fm(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:t}}}function mT(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}function mE(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class m_{constructor(e){this.key=e}}class mI{constructor(e){this.key=e}}class mk{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=oC(),this.mutatedKeys=oC(),this.docComparator=oo(e),this.documentSet=new mn(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new mi,n=t?t.documentSet:this.documentSet,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),c=ot(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations),f=!1;u&&c?u.data.isEqual(c.data)?h!==d&&(r.track({type:3,doc:c}),f=!0):!this.shouldWaitForSyncedDocument(u,c)&&(r.track({type:2,doc:c}),f=!0,(o&&this.docComparator(c,o)>0||l&&0>this.docComparator(c,l))&&(a=!0)):!u&&c?(r.track({type:0,doc:c}),f=!0):u&&!c&&(r.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(c?(s=s.add(c),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{documentSet:s,changeSet:r,needsRefill:a,mutatedKeys:i}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let s=e.changeSet.getChanges();s.sort((e,t)=>mx(e.type,t.type)||this.docComparator(e.doc,t.doc)),this.applyTargetChange(r),n=n??!1;let a=t&&!n?this.updateLimboDocuments():[],o=+!!(0===this.limboDocuments.size&&this.current&&!n),l=o!==this.syncState;return(this.syncState=o,0!==s.length||l)?{snapshot:new ms(this.query,e.documentSet,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),limboChanges:a}:{limboChanges:a}}applyOnlineStateChange(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new mi,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations}applyTargetChange(e){e&&(e.addedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.delete(e)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=oC(),this.documentSet.forEach(e=>{this.shouldBeInLimbo(e.key)&&(this.limboDocuments=this.limboDocuments.add(e.key))});let t=[];return e.forEach(e=>{this.limboDocuments.has(e)||t.push(new mI(e))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new m_(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=oC();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return ms.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function mx(e,t){let r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return tq(20277,{change:e})}};return r(e)-r(t)}let mR="SyncEngine";class mD{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class mA{constructor(e){this.key=e,this.receivedDocument=!1}}class mO{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.syncEngineListener={},this.queryViewsByQuery=new ou(e=>a9(e),a7),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new iL(r_.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new h8,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=hT.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function mN(e,t,r,n,i,s,a){let o=new mO(e,t,r,n,i,s);return a&&(o._isPrimaryClient=!0),o}async function mP(e,t,r=!0){let n,i=ga(e),s=i.queryViewsByQuery.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.computeInitialSnapshot()):n=await mL(i,t,r,!0),n}async function mM(e,t){let r=ga(e);await mL(r,t,!0,!1)}async function mL(e,t,r,n){let i,s=await d9(e.localStore,a0(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await mB(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&pN(e.remoteStore,s),i}async function mB(e,t,r,n,i){e.applyDocChanges=(t,r,n)=>m3(e,t,r,n);let s=await fr(e.localStore,t,!0),a=new mk(t,s.remoteKeys),o=a.computeDocChanges(s.documents),l=lw.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);mZ(e,r,u.limboChanges);let c=new mD(t,r,a);return e.queryViewsByQuery.set(t,c),e.queriesByTarget.has(r)?e.queriesByTarget.get(r).push(t):e.queriesByTarget.set(r,[t]),u.snapshot}async function mF(e,t,r){let n=tK(e),i=n.queryViewsByQuery.get(t),s=n.queriesByTarget.get(i.targetId);if(s.length>1){n.queriesByTarget.set(i.targetId,s.filter(e=>!a7(e,t))),n.queryViewsByQuery.delete(t);return}n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await ft(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),r&&pP(n.remoteStore,i.targetId),mY(n,i.targetId)}).catch(r6)):(mY(n,i.targetId),await ft(n.localStore,i.targetId,!0))}async function mj(e,t){let r=tK(e),n=r.queryViewsByQuery.get(t),i=r.queriesByTarget.get(n.targetId);r.isPrimaryClient&&1===i.length&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),pP(r.remoteStore,n.targetId))}async function mV(e,t,r){let n=go(e);try{let e=await dY(n.localStore,t);n.sharedClientState.addPendingMutation(e.batchId),mQ(n,e.batchId,r),await m2(n,e.changes),await pQ(n.remoteStore)}catch(t){let e=mr(t,"Failed to persist write");r.reject(e)}}async function mq(e,t){let r=tK(e);try{let e=await d3(r.localStore,t);t.targetChanges.forEach((e,t)=>{let n=r.activeLimboResolutionsByTarget.get(t);n&&(tU(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?n.receivedDocument=!0:e.modifiedDocuments.size>0?tU(n.receivedDocument,14607):e.removedDocuments.size>0&&(tU(n.receivedDocument,42227),n.receivedDocument=!1))}),await m2(r,e,t)}catch(e){await r6(e)}}function mz(e,t,r){let n=tK(e);if(n.isPrimaryClient&&0===r||!n.isPrimaryClient&&1===r){let e=[];n.queryViewsByQuery.forEach((r,n)=>{let i=n.view.applyOnlineStateChange(t);i.snapshot&&e.push(i.snapshot)}),mp(n.eventManager,t),e.length&&n.syncEngineListener.onWatchChange(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function mU(e,t,r){let n=tK(e);n.sharedClientState.updateQueryState(t,"rejected",r);let i=n.activeLimboResolutionsByTarget.get(t),s=i&&i.key;if(s){let e=new iL(r_.comparator);e=e.insert(s,s5.newNoDocument(s,rV.min()));let r=oC().add(s),i=new lS(rV.min(),new Map,new iL(rf),e,r);await mq(n,i),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(s),n.activeLimboResolutionsByTarget.delete(t),m1(n)}else await ft(n.localStore,t,!1).then(()=>mY(n,t,r)).catch(r6)}async function m$(e,t){let r=tK(e),n=t.batch.batchId;try{let e=await dX(r.localStore,t);mJ(r,n,null),mG(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await m2(r,e)}catch(e){await r6(e)}}async function mK(e,t,r){let n=tK(e);try{let e=await d0(n.localStore,t);mJ(n,t,r),mG(n,t),n.sharedClientState.updateMutationState(t,"rejected",r),await m2(n,e)}catch(e){await r6(e)}}async function mW(e,t){let r=tK(e);pj(r.remoteStore)||tB(mR,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let e=await d1(r.localStore);if(e===sn)return void t.resolve();let n=r.pendingWritesCallbacks.get(e)||[];n.push(t),r.pendingWritesCallbacks.set(e,n)}catch(r){let e=mr(r,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function mG(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(e=>{e.resolve()}),e.pendingWritesCallbacks.delete(t)}function mH(e,t){e.pendingWritesCallbacks.forEach(e=>{e.forEach(e=>{e.reject(new t9(tG,t))})}),e.pendingWritesCallbacks.clear()}function mQ(e,t,r){let n=e.mutationUserCallbacks[e.currentUser.toKey()];n||(n=new iL(rf)),n=n.insert(t,r),e.mutationUserCallbacks[e.currentUser.toKey()]=n}function mJ(e,t,r){let n=tK(e),i=n.mutationUserCallbacks[n.currentUser.toKey()];if(i){let e=i.get(t);e&&(r?e.reject(r):e.resolve(),i=i.remove(t)),n.mutationUserCallbacks[n.currentUser.toKey()]=i}}function mY(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.queriesByTarget.get(t)))e.queryViewsByQuery.delete(n),r&&e.syncEngineListener.onWatchError(n,r);e.queriesByTarget.delete(t),e.isPrimaryClient&&e.limboDocumentRefs.removeReferencesForId(t).forEach(t=>{e.limboDocumentRefs.containsKey(t)||mX(e,t)})}function mX(e,t){e.enqueuedLimboResolutions.delete(t.path.canonicalString());let r=e.activeLimboTargetsByKey.get(t);null!==r&&(pP(e.remoteStore,r),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(r),m1(e))}function mZ(e,t,r){for(let n of r)n instanceof m_?(e.limboDocumentRefs.addReference(n.key,t),m0(e,n)):n instanceof mI?(tB(mR,"Document no longer in limbo: "+n.key),e.limboDocumentRefs.removeReference(n.key,t),e.limboDocumentRefs.containsKey(n.key)||mX(e,n.key)):tq(19791,{limboChange:n})}function m0(e,t){let r=t.key,n=r.path.canonicalString();e.activeLimboTargetsByKey.get(r)||e.enqueuedLimboResolutions.has(n)||(tB(mR,"New document in limbo: "+r),e.enqueuedLimboResolutions.add(n),m1(e))}function m1(e){for(;e.enqueuedLimboResolutions.size>0&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){let t=e.enqueuedLimboResolutions.values().next().value;e.enqueuedLimboResolutions.delete(t);let r=new r_(rC.fromString(t)),n=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(n,new mA(r)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(r,n),pN(e.remoteStore,new uW(a0(aW(r.path)),n,"TargetPurposeLimboResolution",np.INVALID))}}async function m2(e,t,r){let n=tK(e),i=[],s=[],a=[];n.queryViewsByQuery.isEmpty()||(n.queryViewsByQuery.forEach((e,o)=>{a.push(n.applyDocChanges(o,t,r).then(e=>{if((e||r)&&n.isPrimaryClient){let t=e?!e.fromCache:r?.targetChanges.get(o.targetId)?.current;n.sharedClientState.updateQueryState(o.targetId,t?"current":"not-current")}if(e){i.push(e);let t=mS.fromSnapshot(o.targetId,e);s.push(t)}}))}),await Promise.all(a),n.syncEngineListener.onWatchChange(i),await d4(n.localStore,s))}async function m3(e,t,r,n){let i=t.view.computeDocChanges(r);i.needsRefill&&(i=await fr(e.localStore,t.query,!1).then(({documents:e})=>t.view.computeDocChanges(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return mZ(e,t.targetId,o.limboChanges),o.snapshot}async function m6(e,t){let r=tK(e);if(!r.currentUser.isEqual(t)){tB(mR,"User change. New user:",t.toKey());let e=await dJ(r.localStore,t);r.currentUser=t,mH(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await m2(r,e.affectedDocuments)}}function m5(e,t){let r=tK(e),n=r.activeLimboResolutionsByTarget.get(t);if(n&&n.receivedDocument)return oC().add(n.key);{let e=oC(),n=r.queriesByTarget.get(t);if(!n)return e;for(let t of n){let n=r.queryViewsByQuery.get(t);e=e.unionWith(n.view.syncedDocuments)}return e}}async function m4(e,t){let r=tK(e),n=await fr(r.localStore,t.query,!0),i=t.view.synchronizeWithPersistedState(n);return r.isPrimaryClient&&mZ(r,t.targetId,i.limboChanges),i}async function m8(e,t){let r=tK(e);return fl(r.localStore,t).then(e=>m2(r,e))}async function m7(e,t,r,n){let i=tK(e),s=await fi(i.localStore,t);null===s?tB(mR,"Cannot apply mutation batch with id: "+t):("pending"===r?await pQ(i.remoteStore):"acknowledged"===r||"rejected"===r?(mJ(i,t,n||null),mG(i,t),fs(i.localStore,t)):tq(6720,"Unknown batchState",{batchState:r}),await m2(i,s))}async function m9(e,t){let r=tK(e);if(ga(r),go(r),!0===t&&!0!==r._isPrimaryClient){let e=r.sharedClientState.getAllActiveQueryTargets(),t=await gt(r,e.toArray());for(let e of(r._isPrimaryClient=!0,await p8(r.remoteStore,!0),t))pN(r.remoteStore,e)}else if(!1===t&&!1!==r._isPrimaryClient){let e=[],t=Promise.resolve();r.queriesByTarget.forEach((n,i)=>{r.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(mY(r,i),ft(r.localStore,i,!0))),pP(r.remoteStore,i)}),await t,await gt(r,e),ge(r),r._isPrimaryClient=!1,await p8(r.remoteStore,!1)}}function ge(e){let t=tK(e);t.activeLimboResolutionsByTarget.forEach((e,r)=>{pP(t.remoteStore,r)}),t.limboDocumentRefs.removeAllReferences(),t.activeLimboResolutionsByTarget=new Map,t.activeLimboTargetsByKey=new iL(r_.comparator)}async function gt(e,t,r){let n=tK(e),i=[],s=[];for(let e of t){let t,r=n.queriesByTarget.get(e);if(r&&0!==r.length)for(let e of(t=await d9(n.localStore,a0(r[0])),r)){let t=n.queryViewsByQuery.get(e),r=await m4(n,t);r.snapshot&&s.push(r.snapshot)}else{let r=await fo(n.localStore,e);t=await d9(n.localStore,r),await mB(n,gr(r),e,!1,t.resumeToken)}i.push(t)}return n.syncEngineListener.onWatchChange(s),i}function gr(e){return aK(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function gn(e){return fa(tK(e).localStore)}async function gi(e,t,r,n){let i=tK(e);if(i._isPrimaryClient)return void tB(mR,"Ignoring unexpected query state notification.");let s=i.queriesByTarget.get(t);if(s&&s.length>0)switch(r){case"current":case"not-current":{let e=await fl(i.localStore,oa(s[0])),n=lS.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,iH.EMPTY_BYTE_STRING);await m2(i,e,n);break}case"rejected":await ft(i.localStore,t,!0),mY(i,t,n);break;default:tq(64155,r)}}async function gs(e,t,r){let n=ga(e);if(n._isPrimaryClient){for(let e of t){if(n.queriesByTarget.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){tB(mR,"Adding an already active target "+e);continue}let t=await fo(n.localStore,e),r=await d9(n.localStore,t);await mB(n,gr(t),r.targetId,!1,r.resumeToken),pN(n.remoteStore,r)}for(let e of r)n.queriesByTarget.has(e)&&await ft(n.localStore,e,!1).then(()=>{pP(n.remoteStore,e),mY(n,e)}).catch(r6)}}function ga(e){let t=tK(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=mq.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=m5.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=mU.bind(null,t),t.syncEngineListener.onWatchChange=md.bind(null,t.eventManager),t.syncEngineListener.onWatchError=mf.bind(null,t.eventManager),t}function go(e){let t=tK(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=m$.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=mK.bind(null,t),t}function gl(e,t,r){let n=tK(e);gu(n,t,r).then(e=>{n.sharedClientState.notifyBundleLoaded(e)})}async function gu(e,t,r){try{let n=await t.getMetadata();if(await fd(e.localStore,n))return await t.close(),r._completeWith(mE(n)),Promise.resolve(new Set);r._updateProgress(mT(n));let i=new mC(n,t.serializer),s=await t.nextElement();for(;s;){let e=await i.addSizedElement(s);e&&r._updateProgress(e),s=await t.nextElement()}let a=await i.completeAndStoreAsync(e.localStore);return await m2(e,a.changedDocs,void 0),await ff(e.localStore,n),r._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(e){return tj(mR,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}}class gc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=pe(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return dQ(this.persistence,new fC,e.initialUser,this.serializer)}createPersistence(e){return new dl(dc.factory,this.serializer)}createSharedClientState(e){return new fU}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}gc.provider={build:()=>new gc};class gh extends gc{constructor(e){super(),this.cacheSizeBytes=e}createGarbageCollectionScheduler(e,t){return tU(this.persistence.referenceDelegate instanceof dh,46915),new hF(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createPersistence(e){let t=void 0!==this.cacheSizeBytes?hA.withCacheSize(this.cacheSizeBytes):hA.DEFAULT;return new dl(e=>dh.factory(e,t),this.serializer)}}class gd extends gc{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.onlineComponentProvider.initialize(this,e),await go(this.onlineComponentProvider.syncEngine),await pQ(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return dQ(this.persistence,new fC,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new hF(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new nf(t,this.persistence);return new nd(e.asyncQueue,r)}createPersistence(e){let t=dz(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?hA.withCacheSize(this.cacheSizeBytes):hA.DEFAULT;return new dj(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,f7(),f9(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new fU}}class gf extends gd{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof fq&&(this.sharedClientState.syncEngine={applyBatchState:m7.bind(null,t),applyTargetState:gi.bind(null,t),applyActiveTargetsChange:gs.bind(null,t),getActiveClients:gn.bind(null,t),synchronizeWithChangedDocuments:m8.bind(null,t)},await this.sharedClientState.start()),await this.persistence.setPrimaryStateListener(async e=>{await m9(this.onlineComponentProvider.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){let t=f7();if(!fq.isAvailable(t))throw new t9(t5,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=dz(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new fq(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class gp{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>mz(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=m6.bind(null,this.syncEngine),await p8(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return mo()}createDatastore(e){let t=pe(e.databaseInfo.databaseId),r=f4(e.databaseInfo);return pp(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return pk(this.localStore,this.datastore,e.asyncQueue,e=>mz(this.syncEngine,e,0),f8())}createSyncEngine(e,t){return mN(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await pO(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}gp.provider={build:()=>new gp};let gm=10240;function gg(e,t=gm){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}function gy(e,t){if(!(e instanceof Uint8Array))throw new t9(tQ,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${rA(e)}`);return gg(e,t)}class gv{constructor(e){this.observer=e,this.muted=!1}next(e){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):tF("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class gb{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}}class gS{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new re,this.buffer=new Uint8Array,this.textDecoder=lp(),this.nextElementImpl().then(e=>{e&&e.isBundleMetadata()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.payload)}`))},e=>this.metadata.reject(e))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let e=await this.readLength();if(null===e)return null;let t=this.textDecoder.decode(e),r=Number(t);return isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`),new gb(JSON.parse(await this.readJsonString(r)),e.length+r)}indexOfOpenBracket(){return this.buffer.findIndex(e=>123===e)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async readJsonString(e){for(;this.buffer.length<e;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}raiseError(e){throw this.reader.cancel(),Error(`Invalid bundle format: ${e}`)}async pullMoreDataToBuffer(){let e=await this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}function gw(e,t){return new gS(e,t)}class gC{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.nextElement();if(r&&r.isBundleMetadata())this.metadata=r;else throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.payload)}`);do null!==(r=this.nextElement())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}getElements(){return this.elements}nextElement(){if(this.cursor===this.bundleData.length)return null;let e=this.readLength();return new gb(JSON.parse(this.readJsonString(e)),e)}readJsonString(e){if(this.cursor+e>this.bundleData.length)throw new t9(t4,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}readLength(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}function gT(e,t){return new gC(e,t)}class gE{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new t9(tQ,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await pg(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new o9(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=r_.fromPath(t);this.mutations.push(new lr(r,this.precondition(r)))}),await pm(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=rV.min();else throw tq(50498,{documentName:e.constructor.name});let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new t9(t3,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return this.writtenDocs.has(e.toString())||!t?oW.none():t.isEqual(rV.min())?oW.exists(!1):oW.updateTime(t)}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return oW.exists(!0);if(t.isEqual(rV.min()))throw new t9(tQ,"Can't update a document that doesn't exist.");return oW.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class g_{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.attemptsRemaining=r.maxAttempts,this.backoff=new ps(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(async()=>{let e=new gE(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.handleTransactionError(e)}))}).catch(e=>{this.handleTransactionError(e)})})}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);if(si(t)||!t.catch||!t.then)return this.deferred.reject(Error("Transaction callback must return a Promise")),null;return t}catch(e){return this.deferred.reject(e),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e?.name==="FirebaseError"){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!lo(t)}return!1}}let gI="FirestoreClient",gk=100,gx=11,gR=20,gD=22;class gA{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=n,this.user=tD.UNAUTHENTICATED,this.clientId=rd.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{tB(gI,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(tB(gI,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:gk}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new re;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=mr(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function gO(e,t){e.asyncQueue.verifyOperationInProgress(),tB(gI,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await dJ(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function gN(e,t){e.asyncQueue.verifyOperationInProgress();let r=await gM(e);tB(gI,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>p4(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>p4(t.remoteStore,r)),e._onlineComponents=t}function gP(e){return"FirebaseError"===e.name?e.code===t2||e.code===t5:!("undefined"!=typeof DOMException&&e instanceof DOMException)||e.code===gD||e.code===gR||e.code===gx}async function gM(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){tB(gI,"Using user provided OfflineComponentProvider");try{await gO(e,e._uninitializedComponentsProvider._offline)}catch(r){let t=r;if(!gP(t))throw t;tj("Error using user provided cache. Falling back to memory cache: "+t),await gO(e,new gc)}}else tB(gI,"Using default OfflineComponentProvider"),await gO(e,new gh(void 0));return e._offlineComponents}async function gL(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(tB(gI,"Using user provided OnlineComponentProvider"),await gN(e,e._uninitializedComponentsProvider._online)):(tB(gI,"Using default OnlineComponentProvider"),await gN(e,new gp))),e._onlineComponents}function gB(e){return gM(e).then(e=>e.persistence)}function gF(e){return gM(e).then(e=>e.localStore)}function gj(e){return gL(e).then(e=>e.remoteStore)}function gV(e){return gL(e).then(e=>e.syncEngine)}function gq(e){return gL(e).then(e=>e.datastore)}async function gz(e){let t=await gL(e),r=t.eventManager;return r.onListen=mP.bind(null,t.syncEngine),r.onUnlisten=mF.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=mM.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=mj.bind(null,t.syncEngine),r}function gU(e){return e.asyncQueue.enqueue(async()=>{let t=await gB(e),r=await gj(e);return t.setNetworkEnabled(!0),px(r)})}function g$(e){return e.asyncQueue.enqueue(async()=>{let t=await gB(e),r=await gj(e);return t.setNetworkEnabled(!1),pD(r)})}function gK(e){let t=new re;return e.asyncQueue.enqueueAndForget(async()=>mW(await gV(e),t)),t.promise}function gW(e,t,r,n){let i=new gv(n),s=new mb(t,i,r);return e.asyncQueue.enqueueAndForget(async()=>mc(await gz(e),s)),()=>{i.mute(),e.asyncQueue.enqueueAndForget(async()=>mh(await gz(e),s))}}function gG(e,t){let r=new re;return e.asyncQueue.enqueueAndForget(async()=>g1(await gF(e),t,r)),r.promise}function gH(e,t,r={}){let n=new re;return e.asyncQueue.enqueueAndForget(async()=>g2(await gz(e),e.asyncQueue,t,r,n)),n.promise}function gQ(e,t){let r=new re;return e.asyncQueue.enqueueAndForget(async()=>g3(await gF(e),t,r)),r.promise}function gJ(e,t,r={}){let n=new re;return e.asyncQueue.enqueueAndForget(async()=>g6(await gz(e),e.asyncQueue,t,r,n)),n.promise}function gY(e,t,r){let n=new re;return e.asyncQueue.enqueueAndForget(async()=>{try{let i=await gq(e);n.resolve(py(i,t,r))}catch(e){n.reject(e)}}),n.promise}function gX(e,t){let r=new re;return e.asyncQueue.enqueueAndForget(async()=>mV(await gV(e),t,r)),r.promise}function gZ(e,t){let r=new gv(t);return e.asyncQueue.enqueueAndForget(async()=>mm(await gz(e),r)),()=>{r.mute(),e.asyncQueue.enqueueAndForget(async()=>mg(await gz(e),r))}}function g0(e,t,r){let n=new re;return e.asyncQueue.enqueueAndForget(async()=>{let i=await gq(e);new g_(e.asyncQueue,i,r,t,n).run()}),n.promise}async function g1(e,t,r){try{let n=await d7(e,t);n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new t9(t8,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=mr(n,`Failed to get document '${t} from cache`);r.reject(e)}}function g2(e,t,r,n,i){let s=new gv({next:o=>{s.mute(),t.enqueueAndForget(()=>mh(e,a));let l=o.docs.has(r);!l&&o.fromCache?i.reject(new t9(t8,"Failed to get document because the client is offline.")):l&&o.fromCache&&n&&"server"===n.source?i.reject(new t9(t8,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new mb(aW(r.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return mc(e,a)}async function g3(e,t,r){try{let n=await fr(e,t,!0),i=new mk(t,n.remoteKeys),s=i.computeDocChanges(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=mr(n,`Failed to execute query '${t} against cache`);r.reject(e)}}function g6(e,t,r,n,i){let s=new gv({next:r=>{s.mute(),t.enqueueAndForget(()=>mh(e,a)),r.fromCache&&"server"===n.source?i.reject(new t9(t8,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(r)},error:e=>i.reject(e)}),a=new mb(r,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return mc(e,a)}function g5(e,t,r,n){let i=g8(r,pe(t));e.asyncQueue.enqueueAndForget(async()=>{gl(await gV(e),i,n)})}function g4(e,t){return e.asyncQueue.enqueue(async()=>fp(await gF(e),t))}function g8(e,t){let r;return gw(gy(r="string"==typeof e?lf().encode(e):e),t)}function g7(e,t){return gT(e,t)}function g9(e,t){return e.asyncQueue.enqueue(async()=>fg(await gF(e),t))}function ye(e,t){return e.asyncQueue.enqueue(async()=>fy(await gF(e),t))}function yt(e){return e.asyncQueue.enqueue(async()=>fv(await gF(e)))}function yr(e,t){return e.timeoutSeconds===t.timeoutSeconds}function yn(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let yi="ComponentProvider",ys=new Map;function ya(e){let t=ys.get(e);t&&(tB(yi,"Removing Datastore"),ys.delete(e),t.terminate())}function yo(e,t,r,n,i){return new i9(e,t,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,yn(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,n)}let yl="firestore.googleapis.com",yu=!0,yc=5,yh=30,yd=!0;class yf{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new t9(tQ,"Can't provide ssl option if host option is not set");this.host=yl,this.ssl=yu}else this.host=e.host,this.ssl=e.ssl??yu;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=hD;else if(e.cacheSizeBytes!==hR&&e.cacheSizeBytes<hN)throw new t9(tQ,`cacheSizeBytes must be at least ${hN}`);else this.cacheSizeBytes=e.cacheSizeBytes;rk("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=yd:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yn(e.experimentalLongPollingOptions??{}),yp(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&yr(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}function yp(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new t9(tQ,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<yc)throw new t9(tQ,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is ${yc})`);if(e.timeoutSeconds>yh)throw new t9(tQ,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is ${yh})`)}}class ym{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yf({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new t9(t2,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new t9(t2,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yf(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=rc(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return ya(this),Promise.resolve()}}function yg(e,t,r,n={}){e=rN(e,ym);let i=w(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&(C(`https://${o}`),E("Firestore",!0)),s.host!==yl&&s.host!==o&&tj("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!U(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=tD.MOCK_USER;else{t=T(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new t9(tQ,"mockUserToken must contain 'sub' or 'user_id' field!");r=new tD(i)}e._authCredentials=new rn(new rt(t,r))}}class yy{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new yy(this.firestore,e,this._query)}}class yv{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yb(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new yv(this.firestore,e,this._key)}toJSON(){return{type:yv._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(rL(t,yv._jsonSchema))return new yv(e,r||null,new r_(rC.fromString(t.referencePath)))}}yv._jsonSchemaVersion="firestore/documentReference/1.0",yv._jsonSchema={type:rM("string",yv._jsonSchemaVersion),referencePath:rM("string")};class yb extends yy{constructor(e,t,r){super(e,t,aW(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new yv(this.firestore,null,new r_(e))}withConverter(e){return new yb(this.firestore,e,this._path)}}function yS(e,t,...r){if(e=X(e),rI("collection","path",t),e instanceof ym){let n=rC.fromString(t,...r);return rR(n),new yb(e,null,n)}{if(!(e instanceof yv)&&!(e instanceof yb))throw new t9(tQ,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(rC.fromString(t,...r));return rR(n),new yb(e.firestore,null,n)}}function yw(e,t){if(e=rN(e,ym),rI("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new t9(tQ,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new yy(e,null,aJ(t))}function yC(e,t,...r){if(e=X(e),1==arguments.length&&(t=rd.newId()),rI("doc","path",t),e instanceof ym){let n=rC.fromString(t,...r);return rx(n),new yv(e,null,new r_(n))}{if(!(e instanceof yv)&&!(e instanceof yb))throw new t9(tQ,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(rC.fromString(t,...r));return rx(n),new yv(e.firestore,e instanceof yb?e.converter:null,new r_(n))}}function yT(e,t){return e=X(e),t=X(t),(e instanceof yv||e instanceof yb)&&(t instanceof yv||t instanceof yb)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function yE(e,t){return e=X(e),t=X(t),e instanceof yy&&t instanceof yy&&e.firestore===t.firestore&&a7(e._query,t._query)&&e.converter===t.converter}let y_="AsyncQueue";class yI{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new ps(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new re;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(nn(e))tB(y_,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(e=>{throw this.failure=e,this.operationInProgress=!1,tF("INTERNAL UNHANDLED ERROR: ",yk(e)),e}).then(e=>(this.operationInProgress=!1,e))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let n=mt.createAndSchedule(this,e,t,r,e=>this.removeDelayedOperation(e));return this.delayedOperations.push(n),n}verifyNotFailed(){this.failure&&tq(47125,{messageOrStack:yk(this.failure)})}verifyOperationInProgress(){}async drain(){let e;do e=this.tail,await e;while(e!==this.tail)}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{for(let t of(this.delayedOperations.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.delayedOperations))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}}function yk(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class yx{constructor(){this._progressObserver={},this._taskCompletionResolver=new re,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}let yR=hR;class yD extends ym{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new yI,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new yI(e),this._firestoreClient=void 0,await e}}}function yA(e,t,r){r||(r=se);let n=eH(e,"firestore");if(n.isInitialized(r)){let e=n.getImmediate({identifier:r});if(U(n.getOptions(r),t))return e;throw new t9(t2,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new t9(tQ,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&t.cacheSizeBytes!==yR&&t.cacheSizeBytes<hN)throw new t9(tQ,`cacheSizeBytes must be at least ${hN}`);return t.host&&w(t.host)&&C(t.host),n.initialize({options:t,instanceIdentifier:r})}function yO(e,t){let r="object"==typeof e?e:e8(),n="string"==typeof e?e:t||se,i=eH(r,"firestore").getImmediate({identifier:n});if(!i._initialized){let e=v("firestore");e&&yg(i,...e)}return i}function yN(e){if(e._terminated)throw new t9(t2,"The client has already been terminated.");return e._firestoreClient||yP(e),e._firestoreClient}function yP(e){let t=e._freezeSettings(),r=yo(e._databaseId,e._app?.options.appId||"",e._persistenceKey,e._app?.options.apiKey,t);!e._componentsProvider&&t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new gA(e._authCredentials,e._appCheckCredentials,e._queue,r,e._componentsProvider&&yM(e._componentsProvider))}function yM(e){let t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}function yL(e,t){tj("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=e._freezeSettings();return yF(e,gp.provider,{build:e=>new gd(e,r.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}async function yB(e){tj("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();yF(e,gp.provider,{build:e=>new gf(e,t.cacheSizeBytes)})}function yF(e,t,r){if((e=rN(e,yD))._firestoreClient||e._terminated)throw new t9(t2,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new t9(t2,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:r},yP(e)}function yj(e){if(e._initialized&&!e._terminated)throw new t9(t2,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new re;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await dU(dz(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function yV(e){return gK(yN(e=rN(e,yD)))}function yq(e){return gU(yN(e=rN(e,yD)))}function yz(e){return g$(yN(e=rN(e,yD)))}function yU(e){return eQ(e.app,"firestore",e._databaseId.database),e._delete()}function y$(e,t){let r=yN(e=rN(e,yD)),n=new yx;return g5(r,e._databaseId,t,n),n}function yK(e,t){return g4(yN(e=rN(e,yD)),t).then(t=>t?new yy(e,null,t.query):null)}class yW{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class yG{constructor(e){this._byteString=e}static fromBase64String(e){try{return new yG(iH.fromBase64String(e))}catch(e){throw new t9(tQ,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new yG(iH.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:yG._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(rL(e,yG._jsonSchema))return yG.fromBase64String(e.bytes)}}yG._jsonSchemaVersion="firestore/bytes/1.0",yG._jsonSchema={type:rM("string",yG._jsonSchemaVersion),bytes:rM("string")};class yH{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new t9(tQ,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new rE(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function yQ(){return new yH(rS)}class yJ{constructor(e){this._methodName=e}}class yY{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new t9(tQ,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new t9(tQ,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return rf(this._lat,e._lat)||rf(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:yY._jsonSchemaVersion}}static fromJSON(e){if(rL(e,yY._jsonSchema))return new yY(e.latitude,e.longitude)}}yY._jsonSchemaVersion="firestore/geoPoint/1.0",yY._jsonSchema={type:rM("string",yY._jsonSchemaVersion),latitude:rM("number"),longitude:rM("number")};class yX{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return dK(this._values,e._values)}toJSON(){return{type:yX._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(rL(e,yX._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new yX(e.vectorValues);throw new t9(tQ,"Expected 'vectorValues' field to be a number array")}}}yX._jsonSchemaVersion="firestore/vectorValue/1.0",yX._jsonSchema={type:rM("string",yX._jsonSchemaVersion),vectorValues:rM("object")};let yZ=/^__.*__$/;class y0{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new o3(e,this.data,this.fieldMask,t,this.fieldTransforms):new o0(e,this.data,t,this.fieldTransforms)}}class y1{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new o3(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function y2(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw tq(40011,{dataSource:e})}}class y3{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new y3({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return vy(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(y2(this.dataSource)&&yZ.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class y6{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||pe(e)}createContext(e,t,r,n=!1){return new y3({dataSource:e,methodName:t,targetDoc:r,path:rE.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function y5(e){let t=e._freezeSettings(),r=pe(e._databaseId);return new y6(e._databaseId,!!t.ignoreUndefinedProperties,r)}function y4(e,t,r,n,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);vf("Data must be an object, but it was:",l,n);let u=vo(n,l);if(s.merge)a=new i$(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=vp(t,n,r);if(!l.contains(i))throw new t9(tQ,`Field '${i}' is specified in your field mask but missing from your input data.`);vv(e,i)||e.push(i)}a=new i$(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new y0(new s3(u),a,o)}class y8 extends yJ{_toFieldTransform(e){if(2===e.dataSource)e.fieldMask.push(e.path);else if(1===e.dataSource)throw e.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof y8}}function y7(e,t,r){return new y3({dataSource:3,targetDoc:t.settings.targetDoc,methodName:e._methodName,arrayElement:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class y9 extends yJ{_toFieldTransform(e){return new oz(e.path,new oN)}isEqual(e){return e instanceof y9}}class ve extends yJ{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=y7(this,e,!0),r=new oP(this._elements.map(e=>va(e,t)));return new oz(e.path,r)}isEqual(e){return e instanceof ve&&U(this._elements,e._elements)}}class vt extends yJ{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=y7(this,e,!0),r=new oL(this._elements.map(e=>va(e,t)));return new oz(e.path,r)}isEqual(e){return e instanceof vt&&U(this._elements,e._elements)}}class vr extends yJ{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new oF(e.serializer,ok(e.serializer,this._operand));return new oz(e.path,t)}isEqual(e){return e instanceof vr&&this._operand===e._operand}}function vn(e,t,r,n){let i=e.createContext(1,t,r);vf("Data must be an object, but it was:",i,n);let s=[],a=s3.empty();return iN(n,(e,n)=>{let o=vg(t,e,r);n=X(n);let l=i.childContextForFieldPath(o);if(n instanceof y8)s.push(o);else{let e=va(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new y1(a,new i$(s),i.fieldTransforms)}function vi(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[vp(t,n,r)],l=[i];if(s.length%2!=0)throw new t9(tQ,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(vp(t,s[e])),l.push(s[e+1]);let u=[],c=s3.empty();for(let e=o.length-1;e>=0;--e)if(!vv(u,o[e])){let t=o[e],r=l[e];r=X(r);let n=a.childContextForFieldPath(t);if(r instanceof y8)u.push(t);else{let e=va(r,n);null!=e&&(u.push(t),c.set(t,e))}}return new y1(c,new i$(u),a.fieldTransforms)}function vs(e,t,r,n=!1){return va(r,e.createContext(n?4:3,t))}function va(e,t){if(vd(e=X(e)))return vf("Unsupported field value:",t,e),vo(e,t);if(e instanceof yJ)return vu(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),!(e instanceof Array))return vc(e,t);if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return vl(e,t)}function vo(e,t){let r={};return iM(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):iN(e,(e,n)=>{let i=va(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function vl(e,t){let r=[],n=0;for(let i of e){let e=va(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}function vu(e,t){if(!y2(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}function vc(e,t){if(null===(e=X(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return ok(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=rj.fromDate(e);return{timestampValue:lj(t.serializer,r)}}else if(e instanceof rj){let r=new rj(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:lj(t.serializer,r)}}else if(e instanceof yY)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};else if(e instanceof yG)return{bytesValue:lq(t.serializer,e._byteString)};else if(e instanceof yv){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:lK(e.firestore._databaseId||t.databaseId,e._key.path)}}else if(e instanceof yX)return vh(e,t);else if(uK(e))return e._toProto(t.serializer);else throw t.createError(`Unsupported field value: ${rA(e)}`)}function vh(e,t){return{mapValue:{fields:{[so]:{stringValue:sc},[sh]:{arrayValue:{values:(e instanceof yX?e.toArray():e).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return o_(t.serializer,e)})}}}}}}function vd(e){return"object"==typeof e&&null!==e&&!(e instanceof Array)&&!(e instanceof Date)&&!(e instanceof rj)&&!(e instanceof yY)&&!(e instanceof yG)&&!(e instanceof yv)&&!(e instanceof yJ)&&!(e instanceof yX)&&!uK(e)}function vf(e,t,r){if(!vd(r)||!rD(r)){let n=rA(r);if("an object"===n)throw t.createError(e+" a custom object");throw t.createError(e+" "+n)}}function vp(e,t,r){if((t=X(t))instanceof yH)return t._internalPath;if("string"==typeof t)return vg(e,t);throw vy("Field path arguments must be of type string or ",e,!1,void 0,r)}let vm=RegExp("[~\\*/\\[\\]]");function vg(e,t,r){if(t.search(vm)>=0)throw vy(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new yH(...t.split("."))._internalPath}catch(n){throw vy(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function vy(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new t9(tQ,o+e+l)}function vv(e,t){return e.some(e=>e.isEqual(t))}class vb{convertValue(e,t="none"){switch(sf(e)){case 0:return null;case 1:return e.booleanValue;case 2:return iZ(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(i0(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw tq(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return iN(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new yX(e.fields?.[sh].arrayValue?.values?.map(e=>iZ(e.doubleValue)))}convertGeoPoint(e){return new yY(iZ(e.latitude),iZ(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=i8(e);if(null==r)return null;return this.convertValue(r,t);case"estimate":return this.convertTimestamp(i7(e));default:return null}}convertTimestamp(e){let t=iX(e);return new rj(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=rC.fromString(e);tU(u$(r),9688,{name:e});let n=new st(r.get(1),r.get(3)),i=new r_(r.popFirst(5));return n.isEqual(t)||tF(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class vS extends vb{constructor(e){super(),this.firestore=e}convertBytes(e){return new yG(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new yv(this.firestore,null,t)}}function vw(){return new y8("deleteField")}function vC(){return new y9("serverTimestamp")}function vT(...e){return new ve("arrayUnion",e)}function vE(...e){return new vt("arrayRemove",e)}function v_(e){return new vr("increment",e)}function vI(e){return new yX(e)}function vk(e){let t=yN(rN(e.firestore,yD)),r=t._onlineComponents?.datastore.serializer;return void 0===r?null:uc(r,a0(e._query)).queryTarget}function vx(e,t){let r=iP(t,(e,t)=>new yW(t,e.aggregateType,e._internalFieldPath)),n=yN(rN(e.firestore,yD)),i=n._onlineComponents?.datastore.serializer;return void 0===i?null:uh(i,a1(e._query),r,!0).request}let vR="@firebase/firestore",vD="4.10.0";function vA(e,t=!0){tO(e6),eG(new Z("firestore",(e,{instanceIdentifier:r,options:n})=>{let i=e.getProvider("app").getImmediate(),s=new yD(new ri(e.getProvider("auth-internal")),new rl(i,e.getProvider("app-check-internal")),sr(i,r),i);return n={useFetchStreams:t,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),te(vR,vD,e),te(vR,vD,"esm2020")}class vO{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class vN{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new s3({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class vP{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new yv(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let e=new vM(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(vp("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class vM extends vP{data(){return super.data()}}function vL(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new t9(t5,"limitToLast() queries require specifying at least one orderBy() clause")}class vB{}class vF extends vB{}function vj(e,t,...r){let n=[];for(let i of(t instanceof vB&&n.push(t),bi(n=n.concat(r)),n))e=i._apply(e);return e}class vV extends vF{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new vV(e,t,r)}_apply(e){let t=this._parse(e);return be(e._query,t),new yy(e.firestore,e.converter,a3(e._query,t))}_parse(e){let t=y5(e.firestore);return v3(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function vq(e,t,r){let n=t,i=vp("where",e);return vV._create(i,n,r)}class vz extends vB{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new vz(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:al.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(bt(e._query,t),new yy(e.firestore,e.converter,a3(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function vU(...e){return e.forEach(e=>bn("or",e)),vz._create("or",e)}function v$(...e){return e.forEach(e=>bn("and",e)),vz._create("and",e)}class vK extends vF{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new vK(e,t)}_apply(e){let t=v6(e._query,this._field,this._direction);return new yy(e.firestore,e.converter,a6(e._query,t))}}function vW(e,t="asc"){let r=t,n=vp("orderBy",e);return vK._create(n,r)}class vG extends vF{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new vG(e,t,r)}_apply(e){return new yy(e.firestore,e.converter,a5(e._query,this._limit,this._limitType))}}function vH(e){return rP("limit",e),vG._create("limit",e,"F")}function vQ(e){return rP("limitToLast",e),vG._create("limitToLast",e,"L")}class vJ extends vF{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new vJ(e,t,r)}_apply(e){let t=v2(e,this.type,this._docOrFields,this._inclusive);return new yy(e.firestore,e.converter,a4(e._query,t))}}function vY(...e){return vJ._create("startAt",e,!0)}function vX(...e){return vJ._create("startAfter",e,!1)}class vZ extends vF{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new vZ(e,t,r)}_apply(e){let t=v2(e,this.type,this._docOrFields,this._inclusive);return new yy(e.firestore,e.converter,a8(e._query,t))}}function v0(...e){return vZ._create("endBefore",e,!1)}function v1(...e){return vZ._create("endAt",e,!0)}function v2(e,t,r,n){if(r[0]=X(r[0]),r[0]instanceof vP)return v5(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=y5(e.firestore);return v4(e._query,e.firestore._databaseId,i,t,r,n)}}function v3(e,t,r,n,i,s,a){let o;if(i.isKeyField())if("array-contains"===s||"array-contains-any"===s)throw new t9(tQ,`Invalid Query. You can't perform '${s}' queries on documentId().`);else if("in"===s||"not-in"===s){v7(a,s);let t=[];for(let r of a)t.push(v8(n,e,r));o={arrayValue:{values:t}}}else o=v8(n,e,a);else("in"===s||"not-in"===s||"array-contains-any"===s)&&v7(a,s),o=vs(r,t,a,"in"===s||"not-in"===s);return ao.create(i,s,o)}function v6(e,t,r){if(null!==e.startAt)throw new t9(tQ,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new t9(tQ,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ar(t,r)}function v5(e,t,r,n,i){if(!n)throw new t9(tY,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of aZ(e))if(r.field.isKeyField())s.push(sq(t,n.key));else{let e=n.data.field(r.field);if(i5(e))throw new t9(tQ,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==e)s.push(e);else{let e=r.field.canonicalString();throw new t9(tQ,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}}return new s8(s,i)}function v4(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new t9(tQ,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new t9(tQ,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!aX(e)&&-1!==l.indexOf("/"))throw new t9(tQ,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(rC.fromString(l));if(!r_.isDocumentKey(r))throw new t9(tQ,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new r_(r);o.push(sq(t,i))}else{let e=vs(r,n,l);o.push(e)}}return new s8(o,s)}function v8(e,t,r){if("string"==typeof(r=X(r))){if(""===r)throw new t9(tQ,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!aX(t)&&-1!==r.indexOf("/"))throw new t9(tQ,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(rC.fromString(r));if(!r_.isDocumentKey(n))throw new t9(tQ,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return sq(e,new r_(n))}if(r instanceof yv)return sq(e,r._key);throw new t9(tQ,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${rA(r)}.`)}function v7(e,t){if(!Array.isArray(e)||0===e.length)throw new t9(tQ,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function v9(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function be(e,t){let r=br(e.filters,v9(t.op));if(null!==r)if(r===t.op)throw new t9(tQ,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`);else throw new t9(tQ,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function bt(e,t){let r=e;for(let e of t.getFlattenedFilters())be(r,e),r=a3(r,e)}function br(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}function bn(e,t){if(!(t instanceof vV)&&!(t instanceof vz))throw new t9(tQ,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function bi(e){let t=e.filter(e=>e instanceof vz).length,r=e.filter(e=>e instanceof vV).length;if(t>1||t>0&&r>0)throw new t9(tQ,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}function bs(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class ba extends vb{constructor(e){super(),this.firestore=e}convertBytes(e){return new yG(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new yv(this.firestore,null,t)}}function bo(e){return new vO("sum",vp("sum",e))}function bl(e){return new vO("avg",vp("average",e))}function bu(){return new vO("count")}function bc(e,t){return e instanceof vO&&t instanceof vO&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function bh(e,t){return yE(e.query,t.query)&&U(e.data(),t.data())}function bd(e){return bf(e,{count:bu()})}function bf(e,t){let r=rN(e.firestore,yD),n=yN(r),i=iP(t,(e,t)=>new yW(t,e.aggregateType,e._internalFieldPath));return gY(n,e._query,i).then(t=>bp(r,e,t))}function bp(e,t,r){return new vN(t,new vS(e),r)}class bm{constructor(e){this.kind="memory",this._onlineComponentProvider=gp.provider,e?.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new gh(void 0)}}toJSON(){return{kind:this.kind}}}class bg{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=b_(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class by{constructor(){this.kind="memoryEager",this._offlineComponentProvider=gc.provider}toJSON(){return{kind:this.kind}}}class bv{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new gh(e)}}toJSON(){return{kind:this.kind}}}function bb(){return new by}function bS(e){return new bv(e?.cacheSizeBytes)}function bw(e){return new bm(e)}function bC(e){return new bg(e)}class bT{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=gp.provider,this._offlineComponentProvider={build:t=>new gd(t,e?.cacheSizeBytes,this.forceOwnership)}}}class bE{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=gp.provider,this._offlineComponentProvider={build:t=>new gf(t,e?.cacheSizeBytes)}}}function b_(e){return new bT(e?.forceOwnership)}function bI(){return new bE}let bk=lf();function bx(e){let t=JSON.stringify(e),r=bk.encode(t).byteLength;return`${r}${t}`}bx({metadata:{id:"test-bundle",createTime:{seconds:0x5e0be105,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),bx({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),bx({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),bx({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),bx({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),bx({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),bx({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:0x5ec5a5f3,nanos:191164e3}}}),bx({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:0x5ec5a5f3,nanos:543063e3}}});let bR=1;class bD{constructor(e,t){this.firestore=e,this.bundleId=t,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new rj(0,0),this.databaseId=e._databaseId,this.serializer=new lM(this.databaseId,!0),this.userDataReader=new y6(this.databaseId,!0,this.serializer)}addBundleDocument(e,t){let r=this.documents.get(e.documentPath),n=r?.metadata.queries,i=e.readTime,s=r?.metadata.readTime?lV(r.metadata.readTime):null,a=!i&&null==s,o=void 0!==i&&(null==s||s<i);if((a||o)&&this.documents.set(e.documentPath,{document:this.toBundleDocument(e),metadata:{name:lH(this.serializer,e.documentKey),readTime:i?lj(this.serializer,i):void 0,exists:e.documentExists}}),i&&i>this.latestReadTime&&(this.latestReadTime=i),t){let r=this.documents.get(e.documentPath);r.metadata.queries=n||[],r.metadata.queries.push(t)}}addBundleQuery(e){if(this.namedQueries.has(e.name))throw Error(`Query name conflict: ${name} has already been added.`);let t=new rj(0,0);for(let r of e.docBundleDataArray)this.addBundleDocument(r,e.name),r.readTime&&r.readTime>t&&(t=r.readTime);let r=uc(this.serializer,a0(e.query)),n={parent:e.parent,structuredQuery:r.queryTarget.structuredQuery};this.namedQueries.set(e.name,{name:e.name,bundledQuery:n,readTime:lj(this.serializer,t)})}toBundleDocument(e){let t=this.userDataReader.createContext(4,"internal toBundledDocument"),r=vo(e.documentData,t);return{name:lH(this.serializer,e.documentKey),fields:r.mapValue.fields,updateTime:lj(this.serializer,e.versionTime),createTime:lj(this.serializer,e.createdTime)}}lengthPrefixedString(e){let t=JSON.stringify(e),r=bk.encode(t).byteLength;return`${r}${t}`}build(){let e="";for(let t of this.namedQueries.values())e+=this.lengthPrefixedString({namedQuery:t});for(let t of this.documents.values()){let r=t.metadata;e+=this.lengthPrefixedString({documentMetadata:r});let n=t.document;n&&(e+=this.lengthPrefixedString({document:n}))}let t={id:this.bundleId,createTime:lj(this.serializer,this.latestReadTime),version:bR,totalDocuments:this.documents.size,totalBytes:bk.encode(e).length};return this.lengthPrefixedString({metadata:t})+e}}function bA(e,t,r,n){let i=new bD(e,rd.newId());return i.addBundleDocument(bN(n,r,t)),i.build()}function bO(e,t,r,n,i,s,a){let o=[];for(let e=0;e<s.length;e++)o.push(bN(i[e],a[e],s[e]));let l={name:r,query:t,parent:n,docBundleDataArray:o},u=new bD(e,r);return u.addBundleQuery(l),u.build()}function bN(e,t,r){return{documentData:t,documentKey:r.mutableCopy().key,documentPath:e,documentExists:!0,createdTime:r.createTime.toTimestamp(),readTime:r.readTime.toTimestamp(),versionTime:r.version.toTimestamp()}}let bP="NOT SUPPORTED";class bM{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class bL extends vP{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);{let t=new bF(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}}}get(e,t={}){if(this._document){let r=this._document.data.field(vp("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new t9(t2,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};if(t.type=bL._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument())return t;let r=this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous");return t.bundle=bA(this._firestore,e,r,this.ref.path),t}}function bB(e,t,r){if(rL(t,bL._jsonSchema)){if(t.bundle===bP)throw new t9(tQ,"The provided JSON object was created in a client environment, which is not supported.");let n=pe(e._databaseId),i=g7(t.bundle,n),s=i.getElements(),a=new mC(i.getMetadata(),n);for(let e of s)a.addSizedElement(e);let o=a.documents;if(1!==o.length)throw new t9(tQ,`Expected bundle data to contain 1 document, but it contains ${o.length} documents.`);let l=l3(n,o[0].document),u=new r_(rC.fromString(t.bundleName));return new bL(e,new ba(e),u,l,new bM(!1,!1),r||null)}}bL._jsonSchemaVersion="firestore/documentSnapshot/1.0",bL._jsonSchema={type:rM("string",bL._jsonSchemaVersion),bundleSource:rM("string","DocumentSnapshot"),bundleName:rM("string"),bundle:rM("string")};class bF extends bL{data(e={}){return super.data(e)}}class bj{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new bM(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new bF(this._firestore,this._userDataWriter,r.key,r,new bM(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new t9(tQ,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=bq(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new t9(t2,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=bj._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=rd.newId();let t=this._firestore._databaseId.database,r=this._firestore._databaseId.projectId,n=`projects/${r}/databases/${t}/documents`,i=[],s=[],a=[];return this.docs.forEach(e=>{null!==e._document&&(i.push(e._document),s.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),a.push(e.ref.path))}),e.bundle=bO(this._firestore,this.query._query,e.bundleName,n,a,i,s),e}}function bV(e,t,r){if(rL(t,bj._jsonSchema)){if(t.bundle===bP)throw new t9(tQ,"The provided JSON object was created in a client environment, which is not supported.");let n=pe(e._databaseId),i=g7(t.bundle,n),s=i.getElements(),a=new mC(i.getMetadata(),n);for(let e of s)a.addSizedElement(e);if(1!==a.queries.length)throw new t9(tQ,`Snapshot data expected 1 query but found ${a.queries.length} queries.`);let o=u9(a.queries[0].bundledQuery),l=a.documents,u=new mn;l.map(e=>{let t=l3(n,e.document);u=u.add(t)});let c=ms.fromInitialDocuments(o,u,oC(),!1,!1),h=new yy(e,r||null,o);return new bj(e,new ba(e),h,c)}}function bq(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new bF(e._firestore,e._userDataWriter,r.doc.key,r.doc,new bM(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new bF(e._firestore,e._userDataWriter,t.doc.key,t.doc,new bM(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:bz(t.type),doc:n,oldIndex:i,newIndex:s}})}}function bz(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return tq(61501,{type:e})}}function bU(e,t){return e instanceof bL&&t instanceof bL?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof bj&&t instanceof bj&&e._firestore===t._firestore&&yE(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}bj._jsonSchemaVersion="firestore/querySnapshot/1.0",bj._jsonSchema={type:rM("string",bj._jsonSchemaVersion),bundleSource:rM("string","QuerySnapshot"),bundleName:rM("string"),bundle:rM("string")};let b$={maxAttempts:5};function bK(e){if(e.maxAttempts<1)throw new t9(tQ,"Max attempts must be at least 1")}class bW{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=y5(e)}set(e,t,r){this._verifyNotCommitted();let n=bG(e,this._firestore),i=bs(n.converter,t,r),s=y4(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,oW.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=bG(e,this._firestore);return i="string"==typeof(t=X(t))||t instanceof yH?vi(this._dataReader,"WriteBatch.update",s._key,t,r,n):vn(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,oW.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=bG(e,this._firestore);return this._mutations=this._mutations.concat(new o9(t._key,oW.none())),this}commit(){return(this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0)?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new t9(t2,"A write batch can no longer be used after commit() has been called.")}}function bG(e,t){if((e=X(e)).firestore===t)return e;throw new t9(tQ,"Provided document reference is from a different Firestore instance.")}class bH{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=y5(e)}get(e){let t=bG(e,this._firestore),r=new ba(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return tq(24041);let n=e[0];if(n.isFoundDocument())return new vP(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new vP(this._firestore,r,t._key,null,t.converter);throw tq(18433,{doc:n})})}set(e,t,r){let n=bG(e,this._firestore),i=bs(n.converter,t,r),s=y4(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=bG(e,this._firestore);return i="string"==typeof(t=X(t))||t instanceof yH?vi(this._dataReader,"Transaction.update",s._key,t,r,n):vn(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=bG(e,this._firestore);return this._transaction.delete(t._key),this}}class bQ extends bH{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=bG(e,this._firestore),r=new vS(this._firestore);return super.get(e).then(e=>new bL(this._firestore,r,t._key,e._document,new bM(!1,!1),t.converter))}}function bJ(e,t,r){e=rN(e,yD);let n={...b$,...r};return bK(n),g0(yN(e),r=>t(new bQ(e,r)),n)}function bY(e){return bX(e,["next","error","complete"])}function bX(e,t){if("object"!=typeof e||null===e)return!1;let r=e;for(let e of t)if(e in r&&"function"==typeof r[e])return!0;return!1}function bZ(e){e=rN(e,yv);let t=rN(e.firestore,yD);return gH(yN(t),e._key).then(r=>Sn(t,e,r))}function b0(e){e=rN(e,yv);let t=rN(e.firestore,yD),r=yN(t),n=new vS(t);return gG(r,e._key).then(r=>new bL(t,n,e._key,r,new bM(null!==r&&r.hasLocalMutations,!0),e.converter))}function b1(e){e=rN(e,yv);let t=rN(e.firestore,yD);return gH(yN(t),e._key,{source:"server"}).then(r=>Sn(t,e,r))}function b2(e){e=rN(e,yy);let t=rN(e.firestore,yD),r=yN(t),n=new vS(t);return vL(e._query),gJ(r,e._query).then(r=>new bj(t,n,e,r))}function b3(e){e=rN(e,yy);let t=rN(e.firestore,yD),r=yN(t),n=new vS(t);return gQ(r,e._query).then(r=>new bj(t,n,e,r))}function b6(e){e=rN(e,yy);let t=rN(e.firestore,yD),r=yN(t),n=new vS(t);return gJ(r,e._query,{source:"server"}).then(r=>new bj(t,n,e,r))}function b5(e,t,r){e=rN(e,yv);let n=rN(e.firestore,yD),i=bs(e.converter,t,r),s=y4(y5(n),"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,oW.none());return Sr(n,[s])}function b4(e,t,r,...n){let i;e=rN(e,yv);let s=rN(e.firestore,yD),a=y5(s);return Sr(s,[(i="string"==typeof(t=X(t))||t instanceof yH?vi(a,"updateDoc",e._key,t,r,n):vn(a,"updateDoc",e._key,t)).toMutation(e._key,oW.exists(!0))])}function b8(e){return Sr(rN(e.firestore,yD),[new o9(e._key,oW.none())])}function b7(e,t){let r=rN(e.firestore,yD),n=yC(e),i=bs(e.converter,t);return Sr(r,[y4(y5(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,oW.exists(!1))]).then(()=>n)}function b9(e,...t){let r,n,i;e=X(e);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof t[0]||bY(t[a])||(s=t[a++]);let o={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(bY(t[a])){let e=t[a];t[a]=e.next?.bind(e),t[a+1]=e.error?.bind(e),t[a+2]=e.complete?.bind(e)}if(e instanceof yv)n=rN(e.firestore,yD),i=aW(e._key.path),r={next:r=>{t[a]&&t[a](Sn(n,e,r))},error:t[a+1],complete:t[a+2]};else{let s=rN(e,yy);n=rN(s.firestore,yD),i=s._query;let o=new vS(n);r={next:e=>{t[a]&&t[a](new bj(n,o,s,e))},error:t[a+1],complete:t[a+2]},vL(e._query)}return gW(yN(n),i,o,r)}function Se(e,t,...r){let n,i=X(e),s=Si(t);if(s.error)throw new t9(tQ,s.error);let a=0;if("object"!=typeof r[0]||bY(r[a])||(n=r[a++]),"QuerySnapshot"===s.bundleSource){let e=null;if("object"==typeof r[a]&&bY(r[a])){let t=r[a++];e={next:t.next,error:t.error,complete:t.complete}}else e={next:r[a++],error:r[a++],complete:r[a++]};return Sa(i,s,n,e,r[a])}if("DocumentSnapshot"===s.bundleSource){let e=null;if("object"==typeof r[a]&&bY(r[a])){let t=r[a++];e={next:t.next,error:t.error,complete:t.complete}}else e={next:r[a++],error:r[a++],complete:r[a++]};return Ss(i,s,n,e,r[a])}throw new t9(tQ,`unsupported bundle source: ${s.bundleSource}`)}function St(e,t){return gZ(yN(e=rN(e,yD)),bY(t)?t:{next:t})}function Sr(e,t){return gX(yN(e),t)}function Sn(e,t,r){let n=r.docs.get(t._key),i=new vS(e);return new bL(e,i,t._key,n,new bM(r.hasPendingWrites,r.fromCache),t.converter)}function Si(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}function Ss(e,t,r,n,i){let s,a=!1;return y$(e,t.bundle).then(()=>{a||(s=b9(new yv(e,i||null,r_.fromPath(t.bundleName)),r||{},n))}).catch(e=>(n.error&&n.error(e),()=>{})),()=>{!a&&(a=!0,s&&s())}}function Sa(e,t,r,n,i){let s,a=!1;return y$(e,t.bundle).then(()=>yK(e,t.bundleName)).then(e=>{if(e&&!a){let t=e;i&&t.withConverter(i),s=b9(e,r||{},n)}}).catch(e=>(n.error&&n.error(e),()=>{})),()=>{!a&&(a=!0,s&&s())}}function So(e){return yN(e=rN(e,yD)),new bW(e,t=>Sr(e,t))}function Sl(e,t){let r=yN(e=rN(e,yD));return r._uninitializedComponentsProvider&&"memory"!==r._uninitializedComponentsProvider._offline.kind?g9(r,Su(t)):(tj("Cannot enable indexes when persistence is disabled"),Promise.resolve())}function Su(e){let t="string"==typeof e?Sc(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=Sh(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=vg("setIndexConfiguration",Sh(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new rQ(e,2)):"ASCENDING"===t.order?n.push(new rQ(e,0)):"DESCENDING"===t.order&&n.push(new rQ(e,1))}r.push(new rU(rU.UNKNOWN_ID,t,n,rY.empty()))}return r}function Sc(e){try{return JSON.parse(e)}catch(e){throw new t9(tQ,"Failed to parse JSON: "+e?.message)}}function Sh(e,t){if("string"!=typeof e[t])throw new t9(tQ,"Missing string value for: "+t);return e[t]}class Sd{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function Sf(e){e=rN(e,yD);let t=Sv.get(e);if(t)return t;let r=yN(e);if(r._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;let n=new Sd(e);return Sv.set(e,n),n}function Sp(e){Sy(e,!0)}function Sm(e){Sy(e,!1)}function Sg(e){yt(yN(e._firestore)).then(e=>tB("deleting all persistent cache indexes succeeded")).catch(e=>tj("deleting all persistent cache indexes failed",e))}function Sy(e,t){ye(yN(e._firestore),t).then(e=>tB(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>tj(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let Sv=new WeakMap;class Sb{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return SS.instance.onExistenceFilterMismatch(e)}}class SS{constructor(){this.existenceFilterMismatchCallbacksById=new Map}static get instance(){return Sw||ld(Sw=new SS),Sw}notifyOnExistenceFilterMismatch(e){this.existenceFilterMismatchCallbacksById.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.existenceFilterMismatchCallbacksById;return r.set(t,e),()=>r.delete(t)}}let Sw=null;vA("node"),e.s(["AggregateField",()=>vO,"AggregateQuerySnapshot",()=>vN,"DocumentSnapshot",()=>bL,"PersistentCacheIndexManager",()=>Sd,"QueryCompositeFilterConstraint",()=>vz,"QueryConstraint",()=>vF,"QueryDocumentSnapshot",()=>bF,"QueryEndAtConstraint",()=>vZ,"QueryFieldFilterConstraint",()=>vV,"QueryLimitConstraint",()=>vG,"QueryOrderByConstraint",()=>vK,"QuerySnapshot",()=>bj,"QueryStartAtConstraint",()=>vJ,"SnapshotMetadata",()=>bM,"Transaction",()=>bQ,"WriteBatch",()=>bW,"_TestingHooks",()=>Sb,"addDoc",()=>b7,"aggregateFieldEqual",()=>bc,"aggregateQuerySnapshotEqual",()=>bh,"and",()=>v$,"average",()=>bl,"count",()=>bu,"deleteAllPersistentCacheIndexes",()=>Sg,"deleteDoc",()=>b8,"disablePersistentCacheIndexAutoCreation",()=>Sm,"documentSnapshotFromJSON",()=>bB,"enablePersistentCacheIndexAutoCreation",()=>Sp,"endAt",()=>v1,"endBefore",()=>v0,"executeWrite",()=>Sr,"getAggregateFromServer",()=>bf,"getCountFromServer",()=>bd,"getDoc",()=>bZ,"getDocFromCache",()=>b0,"getDocFromServer",()=>b1,"getDocs",()=>b2,"getDocsFromCache",()=>b3,"getDocsFromServer",()=>b6,"getPersistentCacheIndexManager",()=>Sf,"limit",()=>vH,"limitToLast",()=>vQ,"memoryEagerGarbageCollector",()=>bb,"memoryLocalCache",()=>bw,"memoryLruGarbageCollector",()=>bS,"onSnapshot",()=>b9,"onSnapshotResume",()=>Se,"onSnapshotsInSync",()=>St,"or",()=>vU,"orderBy",()=>vW,"persistentLocalCache",()=>bC,"persistentMultipleTabManager",()=>bI,"persistentSingleTabManager",()=>b_,"query",()=>vj,"querySnapshotFromJSON",()=>bV,"runTransaction",()=>bJ,"setDoc",()=>b5,"setIndexConfiguration",()=>Sl,"snapshotEqual",()=>bU,"startAfter",()=>vX,"startAt",()=>vY,"sum",()=>bo,"updateDoc",()=>b4,"where",()=>vq,"writeBatch",()=>So],744723),e.s([],564153),e.i(744723),e.s(["AbstractUserDataWriter",()=>vb,"AggregateField",()=>vO,"AggregateQuerySnapshot",()=>vN,"Bytes",()=>yG,"CACHE_SIZE_UNLIMITED",()=>yR,"CollectionReference",()=>yb,"DocumentReference",()=>yv,"DocumentSnapshot",()=>bL,"FieldPath",()=>yH,"FieldValue",()=>yJ,"Firestore",()=>yD,"FirestoreError",()=>t9,"GeoPoint",()=>yY,"LoadBundleTask",()=>yx,"PersistentCacheIndexManager",()=>Sd,"Query",()=>yy,"QueryCompositeFilterConstraint",()=>vz,"QueryConstraint",()=>vF,"QueryDocumentSnapshot",()=>bF,"QueryEndAtConstraint",()=>vZ,"QueryFieldFilterConstraint",()=>vV,"QueryLimitConstraint",()=>vG,"QueryOrderByConstraint",()=>vK,"QuerySnapshot",()=>bj,"QueryStartAtConstraint",()=>vJ,"SnapshotMetadata",()=>bM,"Timestamp",()=>rj,"Transaction",()=>bQ,"VectorValue",()=>yX,"WriteBatch",()=>bW,"_AutoId",()=>rd,"_ByteString",()=>iH,"_DatabaseId",()=>st,"_DocumentKey",()=>r_,"_EmptyAppCheckTokenProvider",()=>ru,"_EmptyAuthCredentialsProvider",()=>rr,"_FieldPath",()=>rE,"_TestingHooks",()=>Sb,"_cast",()=>rN,"_debugAssert",()=>t$,"_internalAggregationQueryToProtoRunAggregationQueryRequest",()=>vx,"_internalQueryToProtoQueryTarget",()=>vk,"_isBase64Available",()=>iG,"_logWarn",()=>tj,"_validateIsNotUsedTogether",()=>rk,"addDoc",()=>b7,"aggregateFieldEqual",()=>bc,"aggregateQuerySnapshotEqual",()=>bh,"and",()=>v$,"arrayRemove",()=>vE,"arrayUnion",()=>vT,"average",()=>bl,"clearIndexedDbPersistence",()=>yj,"collection",()=>yS,"collectionGroup",()=>yw,"connectFirestoreEmulator",()=>yg,"count",()=>bu,"deleteAllPersistentCacheIndexes",()=>Sg,"deleteDoc",()=>b8,"deleteField",()=>vw,"disableNetwork",()=>yz,"disablePersistentCacheIndexAutoCreation",()=>Sm,"doc",()=>yC,"documentId",()=>yQ,"documentSnapshotFromJSON",()=>bB,"enableIndexedDbPersistence",()=>yL,"enableMultiTabIndexedDbPersistence",()=>yB,"enableNetwork",()=>yq,"enablePersistentCacheIndexAutoCreation",()=>Sp,"endAt",()=>v1,"endBefore",()=>v0,"ensureFirestoreConfigured",()=>yN,"executeWrite",()=>Sr,"getAggregateFromServer",()=>bf,"getCountFromServer",()=>bd,"getDoc",()=>bZ,"getDocFromCache",()=>b0,"getDocFromServer",()=>b1,"getDocs",()=>b2,"getDocsFromCache",()=>b3,"getDocsFromServer",()=>b6,"getFirestore",()=>yO,"getPersistentCacheIndexManager",()=>Sf,"increment",()=>v_,"initializeFirestore",()=>yA,"limit",()=>vH,"limitToLast",()=>vQ,"loadBundle",()=>y$,"memoryEagerGarbageCollector",()=>bb,"memoryLocalCache",()=>bw,"memoryLruGarbageCollector",()=>bS,"namedQuery",()=>yK,"onSnapshot",()=>b9,"onSnapshotResume",()=>Se,"onSnapshotsInSync",()=>St,"or",()=>vU,"orderBy",()=>vW,"persistentLocalCache",()=>bC,"persistentMultipleTabManager",()=>bI,"persistentSingleTabManager",()=>b_,"query",()=>vj,"queryEqual",()=>yE,"querySnapshotFromJSON",()=>bV,"refEqual",()=>yT,"runTransaction",()=>bJ,"serverTimestamp",()=>vC,"setDoc",()=>b5,"setIndexConfiguration",()=>Sl,"setLogLevel",()=>tL,"snapshotEqual",()=>bU,"startAfter",()=>vX,"startAt",()=>vY,"sum",()=>bo,"terminate",()=>yU,"updateDoc",()=>b4,"vector",()=>vI,"waitForPendingWrites",()=>yV,"where",()=>vq,"writeBatch",()=>So],918042)}];

//# sourceMappingURL=5c86f_ef91a48c._.js.map