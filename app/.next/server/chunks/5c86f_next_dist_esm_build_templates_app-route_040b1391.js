module.exports=[617030,e=>{"use strict";var t=e.i(906661),a=e.i(276806),r=e.i(981990),n=e.i(707163),s=e.i(893013),i=e.i(416393),o=e.i(418829),c=e.i(907831),l=e.i(787414),d=e.i(251948),u=e.i(254140),p=e.i(847739),m=e.i(877290),g=e.i(195428),h=e.i(114365),f=e.i(193695);e.i(495983);var y=e.i(56931),w=e.i(758910);e.i(564153);var v=e.i(918042);let x=[{name:"WordPress",category:"cms",patterns:["wp-content","wp-includes","/wp-json/"],type:"script"},{name:"Webflow",category:"cms",patterns:["data-wf-page","data-wf-site"],type:"dom"},{name:"GTM",category:"analytics",patterns:["googletagmanager.com/gtm.js","gtm.start"],type:"script"},{name:"Meta Pixel",category:"analytics",patterns:["connect.facebook.net/en_US/fbevents.js","fbq("],type:"script"},{name:"Hotjar",category:"analytics",patterns:["static.hotjar.com","hjid"],type:"script"},{name:"ActiveCampaign",category:"marketing",patterns:["activecampaign.com","ac_enable_site_tracking"],type:"script"},{name:"Klaviyo",category:"marketing",patterns:["static.klaviyo.com","klaviyo.js"],type:"script"},{name:"Stripe",category:"payments",patterns:["js.stripe.com","stripe-checkout"],type:"script"},{name:"Hotmart",category:"payments",patterns:["hotmart.com","pay.hotmart.com"],type:"script"},{name:"Kiwify",category:"payments",patterns:["kiwify.com.br","pay.kiwify.com.br"],type:"script"},{name:"Eduzz",category:"payments",patterns:["eduzz.com","sun.eduzz.com"],type:"script"},{name:"TikTok Pixel",category:"analytics",patterns:["analytics.tiktok.com/i18n/pixel/sdk.js","ttq.load"],type:"script"},{name:"Google Ads",category:"marketing",patterns:["googleadservices.com/pagead/conversion.js","gtag('config', 'AW-"],type:"script"},{name:"Cloudflare",category:"infrastructure",patterns:["__cfduid","cf-ray","cloudflare"],type:"header"}];class R{static discover(e,t){let a={analytics:[],marketing:[],payments:[],infrastructure:[],updatedAt:v.Timestamp.now()};for(let r of x){let n=!1;switch(r.type){case"script":case"dom":case"meta":n=r.patterns.some(t=>"string"==typeof t?e.includes(t):t.test(e));break;case"header":n=r.patterns.some(e=>{let a=Object.values(t).join(" ").toLowerCase(),r=Object.keys(t).join(" ").toLowerCase(),n=`${r} ${a}`;return"string"==typeof e?n.includes(e.toLowerCase()):e.test(n)})}if(n)if("cms"===r.category)a.cms=r.name;else{let e=a[r.category];e.includes(r.name)||e.push(r.name)}}return a}}class S{static identifyPageType(e){let t=e.toLowerCase();return t.includes("/checkout")||t.includes("/pay")||t.includes("/cart")?"checkout":t.includes("/obrigado")||t.includes("/thank-you")||t.includes("/success")||t.includes("/confirmacao")?"thank_you":t.includes("/vsl")||t.includes("/video")||t.includes("/aula")?"vsl":t.includes("/upsell")||t.includes("/downsell")||t.includes("/offer")?"upsell":t.includes("/lp")||t.includes("/landing")||t.includes("/venda")?"landing_page":"other"}static sanitizeUrl(e){try{let t=new URL(e);["token","auth","key","session","sid","uid","email","user","password","pass","secret","fbclid","gclid","msclkid","utm_source","utm_medium","utm_campaign","utm_term","utm_content","aff","affiliate","ref"].forEach(e=>t.searchParams.delete(e));let a=t.toString();return a.endsWith("/")&&"/"!==t.pathname&&(a=a.slice(0,-1)),a}catch(t){return e}}static generateStoragePath(e,t,a){return`brands/${e}/competitors/${t}/${a}.png`}}var A=e.i(474065);e.i(608612);var E=e.i(949620);async function k(e,t,a="image/png"){if(!A.storage)throw Error("Firebase Storage não inicializado. Verifique as variáveis de ambiente.");let r=(0,E.ref)(A.storage,t);try{let t=await (0,E.uploadBytes)(r,e,{contentType:a});return await (0,E.getDownloadURL)(t.ref)}catch(e){throw console.error(`[uploadBufferToStorage] Erro ao enviar arquivo para ${t}:`,e),e}}var b=e.i(591760),T=e.i(910153);class C{static USER_AGENT="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 (NETECMT SpyAgent/1.0)";static async isAllowedByRobots(e){try{let t=new URL(e),a=`${t.protocol}//${t.host}/robots.txt`,r=await fetch(a,{headers:{"User-Agent":this.USER_AGENT}});if(!r.ok)return!0;let n=(await r.text()).split("\n"),s=!1,i=!1;for(let e of n){let a=e.trim().toLowerCase();if(a.startsWith("user-agent:")){let e=a.split(":")[1].trim();s="*"===e||"netecmt spyagent"===e||"netecmt"===e}else if(s&&a.startsWith("disallow:")){let e=a.split(":")[1].trim();e&&t.pathname.startsWith(e)&&(i=!0)}else if(s&&a.startsWith("allow:")){let e=a.split(":")[1].trim();e&&t.pathname.startsWith(e)&&(i=!1)}}return!i}catch(t){return console.warn(`[SpyAgent] Error checking robots.txt for ${e}:`,t),!0}}static async scan(e){let t=Date.now(),a=e.websiteUrl;try{if(!await this.isAllowedByRobots(a))throw Error(`Access denied by robots.txt for ${a}`);let r=await fetch(a,{headers:{"User-Agent":this.USER_AGENT}});if(!r.ok)throw Error(`Failed to fetch URL: ${r.status} ${r.statusText}`);let n=await r.text(),s={};r.headers.forEach((e,t)=>{s[t]=e});let i=R.discover(n,s);return{competitorId:e.id,url:a,success:!0,techStack:i,assetsFound:0,durationMs:Date.now()-t,scannedAt:Date.now()}}catch(r){return console.error(`[SpyAgent] Error scanning ${a}:`,r),{competitorId:e.id,url:a,success:!1,techStack:{},assetsFound:0,durationMs:Date.now()-t,error:r instanceof Error?r.message:"Unknown error",scannedAt:Date.now()}}}static async trackFunnel(t){let a,{default:r}=await e.A(415157),n=await e.A(716873),s=[];try{a=await r.launch({args:n.default.args,defaultViewport:n.default.defaultViewport,executablePath:await n.default.executablePath(),headless:n.default.headless});let e=await a.newPage();if(await e.setUserAgent(this.USER_AGENT),!await this.isAllowedByRobots(t.websiteUrl))throw Error(`Access denied by robots.txt for ${t.websiteUrl}`);await e.evaluateOnNewDocument(()=>{window.addEventListener("DOMContentLoaded",()=>{let e=document.createElement("style");e.innerHTML=`
            input[type="password"], 
            input[name*="card"], 
            input[name*="cvv"], 
            input[name*="email"], 
            input[name*="phone"],
            .user-profile, 
            .account-balance, 
            [data-pii] {
              filter: blur(10px) !important;
              opacity: 0.3 !important;
            }
          `,document.head.appendChild(e)})});let i=t.websiteUrl;await e.goto(i,{waitUntil:"networkidle2",timeout:3e4});let o=await e.screenshot({fullPage:!0,type:"png"}),c=(0,T.v4)(),l=S.generateStoragePath(t.brandId,t.id,c),d=await k(o,l),u={brandId:t.brandId,competitorId:t.id,type:"screenshot",url:S.sanitizeUrl(i),pageType:S.identifyPageType(i),capturedAt:v.Timestamp.now(),storagePath:l,publicUrl:d,version:1},p=await (0,b.createIntelligenceAsset)(t.brandId,t.id,u);return s.push({id:p,...u}),s}catch(e){throw console.error(`[SpyAgent] Error tracking funnel for ${t.websiteUrl}:`,e),e}finally{a&&await a.close()}}}var P=e.i(675229),U=e.i(413263),N=e.i(653936);class ${static async generate(e,t,a){var r,n;let s,i;if(console.log(`[DossierGenerator] Iniciando gera\xe7\xe3o para ${t.name}...`),!t.techStack)throw Error("Tech Stack é necessária para gerar o dossiê.");let o=(r=t.name,n=t.techStack,s=a.map(e=>`- [${e.pageType.toUpperCase()}] URL: ${e.url}`).join("\n"),i=[n.cms?`CMS: ${n.cms}`:null,n.analytics.length>0?`Analytics: ${n.analytics.join(", ")}`:null,n.marketing.length>0?`Marketing: ${n.marketing.join(", ")}`:null,n.payments.length>0?`Payments: ${n.payments.join(", ")}`:null,n.infrastructure.length>0?`Infrastructure: ${n.infrastructure.join(", ")}`:null].filter(Boolean).join("\n"),`
Voc\xea \xe9 um Analista de Intelig\xeancia Competitiva s\xeanior. Sua tarefa \xe9 gerar um Dossi\xea Estrat\xe9gico sobre o concorrente "${r}".

### DADOS COLETADOS:
**Infraestrutura T\xe9cnica (Tech Stack):**
${i||"Nenhuma tecnologia detectada."}

**Ativos de Funil Identificados:**
${s||"Nenhum ativo específico coletado."}

### SUA TAREFA:
Gere uma an\xe1lise profunda e estruturada em JSON seguindo exatamente o formato abaixo:

{
  "headline": "Uma frase que resume a estrat\xe9gia principal deste concorrente",
  "offerType": "Tipo de oferta (ex: High Ticket Service, SaaS Subscription, Low Ticket Info-product)",
  "visualStyle": ["Lista de adjetivos sobre o estilo visual, ex: Minimalista, Agressivo, Corporativo"],
  "swot": {
    "strengths": ["M\xednimo 3 for\xe7as baseadas na tech stack ou funil"],
    "weaknesses": ["M\xednimo 3 fraquezas ou gaps identificados"],
    "opportunities": ["M\xednimo 2 oportunidades para nossa marca superar este concorrente"],
    "threats": ["M\xednimo 2 amea\xe7as que este concorrente representa"]
  },
  "executiveSummary": "Um par\xe1grafo de 3-4 linhas resumindo a maturidade digital e o foco de convers\xe3o deste concorrente."
}

### REGRAS CR\xcdTICAS:
1. Responda APENAS o JSON.
2. Seja espec\xedfico. Se usam ActiveCampaign, fale sobre automa\xe7\xe3o de e-mail. Se usam Hotmart, fale sobre foco em infoprodutos.
3. A an\xe1lise deve ser em Portugu\xeas.
`),c=JSON.parse(await (0,P.generateWithGemini)(o,{responseMimeType:"application/json",temperature:.3})),l={brandId:e,competitorId:t.id,type:"funnel_map",url:t.websiteUrl,pageType:"other",capturedAt:v.Timestamp.now(),storagePath:"",version:1,analysis:{headline:c.headline,offerType:c.offerType,visualStyle:c.visualStyle,techDetected:[t.techStack.cms,...t.techStack.analytics,...t.techStack.marketing,...t.techStack.payments].filter(Boolean)}},d=await (0,b.createIntelligenceAsset)(e,t.id,l);return await this.indexToPinecone(e,t.id,d,c),c}static async indexToPinecone(e,t,a,r){let n=`
      Dossi\xea do Concorrente: ${r.headline}
      Tipo de Oferta: ${r.offerType}
      Resumo Executivo: ${r.executiveSummary}
      SWOT - For\xe7as: ${r.swot.strengths.join(", ")}
      SWOT - Fraquezas: ${r.swot.weaknesses.join(", ")}
    `,[s]=await (0,N.generateEmbeddingsBatch)([n]),i={id:`dossier-${a}`,values:s,metadata:{brandId:e,competitorId:t,assetId:a,type:"competitor_insight",subType:"swot_analysis",content:n,collectedAt:Date.now()}};await (0,U.upsertToPinecone)([i],{namespace:`brand-${e}`})}}async function j(e){try{let{brandId:t,competitorId:a,action:r}=await e.json();if(!t||!a)return w.NextResponse.json({error:"brandId and competitorId are required"},{status:400});let n=await (0,b.getCompetitorProfile)(t,a);if(!n)return w.NextResponse.json({error:"Competitor not found"},{status:404});if("track"===r){let e=await C.trackFunnel(n);return w.NextResponse.json({message:"Funnel tracking completed",assetsCount:e.length,assets:e.map(e=>({id:e.id,url:e.url,pageType:e.pageType}))})}if("dossier"===r){let e=await (0,b.getCompetitorAssets)(t,a),r=await $.generate(t,n,e);return w.NextResponse.json({message:"Dossier generated successfully",dossier:r})}let s=await C.scan(n);if(!s.success)return w.NextResponse.json({error:s.error||"Scan failed"},{status:500});return await (0,b.updateCompetitorProfile)(t,a,{techStack:{...s.techStack,updatedAt:v.Timestamp.now()},lastSpyScan:v.Timestamp.now()}),w.NextResponse.json({message:"Scan completed successfully",techStack:s.techStack,durationMs:s.durationMs})}catch(e){return console.error("[API Spy Scan] Error:",e),w.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["POST",()=>j,"dynamic",0,"force-dynamic"],850297);var _=e.i(850297);let O=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/intelligence/spy/route",pathname:"/api/intelligence/spy",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/OneDrive/Desktop/CURSOR/CONSELHO DE FUNIL/app/src/app/api/intelligence/spy/route.ts",nextConfigOutput:"",userland:_}),{workAsyncStorage:I,workUnitAsyncStorage:D,serverHooks:M}=O;function H(){return(0,r.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:D})}async function L(e,t,r){O.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/intelligence/spy/route";w=w.replace(/\/index$/,"")||"/";let v=await O.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:x,params:R,nextConfig:S,parsedUrl:A,isDraftMode:E,prerenderManifest:k,routerServerContext:b,isOnDemandRevalidate:T,revalidateOnlyGenerated:C,resolvedPathname:P,clientReferenceManifest:U,serverActionsManifest:N}=v,$=(0,o.normalizeAppPath)(w),j=!!(k.dynamicRoutes[$]||k.routes[P]),_=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,A,!1):t.end("This page could not be found"),null);if(j&&!E){let e=!!k.routes[P],t=k.dynamicRoutes[$];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await _();throw new f.NoFallbackError}}let I=null;!j||O.isDev||E||(I="/index"===(I=P)?"/":I);let D=!0===O.isDev||!j,M=j&&!D;N&&U&&(0,i.setManifestsSingleton)({page:w,clientReferenceManifest:U,serverActionsManifest:N});let H=e.method||"GET",L=(0,s.getTracer)(),q=L.getActiveScopeSpan(),F={params:R,prerenderManifest:k,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,n)=>O.onRequestError(e,t,r,n,b)},sharedContext:{buildId:x}},W=new c.NodeNextRequest(e),G=new c.NodeNextResponse(t),z=l.NextRequestAdapter.fromNodeNextRequest(W,(0,l.signalFromNodeResponse)(t));try{let i=async e=>O.handle(z,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=L.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${H} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${w}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),c=async n=>{var s,c;let l=async({previousCacheEntry:a})=>{try{if(!o&&T&&C&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await i(n);e.fetchMetrics=F.renderOpts.fetchMetrics;let c=F.renderOpts.pendingWaitUntil;c&&r.waitUntil&&(r.waitUntil(c),c=void 0);let l=F.renderOpts.collectedTags;if(!j)return await (0,p.sendResponse)(W,G,s,F.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(s.headers);l&&(t[h.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,r=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:T})},!1,b),t}},d=await O.handleResponse({req:e,nextConfig:S,cacheKey:I,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:C,responseGenerator:l,waitUntil:r.waitUntil,isMinimalMode:o});if(!j)return null;if((null==d||null==(s=d.value)?void 0:s.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(c=d.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",T?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&j||f.delete(h.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,g.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(W,G,new Response(d.value.body,{headers:f,status:d.value.status||200})),null};q?await c(q):await L.withPropagatedContext(e.headers,()=>L.trace(d.BaseServerSpan.handleRequest,{spanName:`${H} ${w}`,kind:s.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},c))}catch(t){if(t instanceof f.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:$,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:T})},!1,b),j)throw t;return await (0,p.sendResponse)(W,G,new Response(null,{status:500})),null}}e.s(["handler",()=>L,"patchFetch",()=>H,"routeModule",()=>O,"serverHooks",()=>M,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>D],617030)}];

//# sourceMappingURL=5c86f_next_dist_esm_build_templates_app-route_040b1391.js.map