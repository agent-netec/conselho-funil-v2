module.exports=[198547,e=>{"use strict";var t=e.i(906661),a=e.i(276806),r=e.i(981990),n=e.i(707163),o=e.i(893013),i=e.i(416393),s=e.i(418829),l=e.i(907831),d=e.i(787414),c=e.i(251948),p=e.i(254140),u=e.i(847739),g=e.i(877290),m=e.i(195428),h=e.i(114365),f=e.i(193695);e.i(495983);var E=e.i(56931),R=e.i(758910),v=e.i(346414),A=e.i(813106),y=e.i(328668);async function C(e){try{let t=await e.json(),{prompt:a,type:r,platform:n,format:o,safeZone:i,brandId:s,userId:l,aspectRatio:d="16:9",imageSize:c="2K",adjustPrompt:p,editOf:u}=t,g=p||a;if(!g)return R.NextResponse.json({error:"Prompt is required"},{status:400});if(!l)return R.NextResponse.json({error:"userId is required for credit management"},{status:400});let m=process.env.GOOGLE_AI_API_KEY;if(!m)return R.NextResponse.json({error:"GOOGLE_AI_API_KEY nÃ£o configurada"},{status:500});let h=!t.generateVariants,f=null,E=[],C=[],w="Professional and modern",x=!1;if(s){if(console.log(`ðŸ” Buscando BrandKit e Assets para a marca: ${s}`),f=await (0,A.getBrand)(s),f?.brandKit){let e=f.brandKit;C=[e.colors.primary,e.colors.secondary,e.colors.accent].filter(Boolean),w=e.visualStyle||w,x=!!e.logoLock?.locked,e.logoLock?.variants?.primary?.url&&E.push(e.logoLock.variants.primary.url)}let e=(await (0,y.getBrandAssets)(s)).filter(e=>("image"===e.type||e.mimeType?.startsWith("image/"))&&"image/svg+xml"!==e.mimeType&&e.isApprovedForAI&&"ready"===e.status).slice(0,3).map(e=>e.url);E=[...E,...e]}console.log(`ðŸŽ¨ Preparando gera\xe7\xe3o [${r}] com ${E.length} refer\xeancias, aspect ${d}, size ${c}`);let N="Rim lighting, Cinematic lighting, Studio soft box, High-key lighting for clarity",O="Rule of thirds, Leading lines, Negative space for copy placement, Eye-level framing",T="8k resolution, highly detailed, photorealistic, sharp focus, F-stop 1.8, Depth of field",$=x?"CRITICAL: KEEP THE LOGO IDENTICAL AS PROVIDED IN REFERENCES. PLACE PROMINENTLY.":"Incorporate brand logo style naturally.",I=new v.GoogleGenerativeAI(m),P=n?`Plataforma: ${n}, Formato: ${o||"n/a"}, Safe Zone: ${i||"n/a"}`:"",S=`
Voc\xea \xe9 um diretor de arte s\xeanior. Gere EXATAMENTE um JSON array com 3 strings de prompts detalhados para IA Generativa: ["v1","v2","v3"].
Cada prompt deve aplicar rigorosamente o Framework C.H.A.P.E.U:
1. [C] Contexto: Integrar plataforma ${P} e objetivo de convers\xe3o.
2. [H] Hierarquia: Definir ordem visual clara (Jornada do Olhar).
3. [A] Atmosfera: Estilo "${w}", ilumina\xe7\xe3o cinematogr\xe1fica e tom emocional.
4. [P] Paleta & Props: Usar paleta (${C.join(", ")||"n/a"}), logo (${$}) e props estrat\xe9gicos.
5. [E] Estrutura: Composi\xe7\xe3o baseada em camadas e profundidade, respeitando Safe Zones.
6. [U] \xdanica A\xe7\xe3o: Espa\xe7o negativo planejado para Headline e CTA.

Heur\xedsticas t\xe9cnicas: ${N}, ${O}, ${T}.
Briefing base: ${g}.
Retorne apenas o JSON array de strings.`,_=[];if(h)_=[`${g} | ${N} | ${O} | ${T} | ${$}`],console.log("âœ¨ Usando modo de geraÃ§Ã£o Ãºnica para acelerar resposta.");else try{let e=I.getGenerativeModel({model:"gemini-3-flash-preview"}),t=await e.generateContent(S),a=t.response?.text?.();if(a)try{let e=JSON.parse(a);Array.isArray(e)&&e.length>=3&&(_=e.slice(0,3).map(e=>String(e)))}catch(e){console.warn("âš ï¸ Resposta do Flash nÃ£o pÃ´de ser parseada como JSON.",e)}}catch(e){console.warn("âš ï¸ Falha ao gerar variaÃ§Ãµes no Flash, caindo para fallback.",e)}0===_.length&&(_=[`[STANDARD] ${g} | ${N} | ${O} | ${T} | ${$}`],h||_.push(`[ALTERNATIVE] ${g} | cinematic mood | ${O} | ${$}`,`[CREATIVE] ${g} | bold contrast, experimental angles | ${T} | ${$}`));let b=`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-image-preview:generateContent?key=${m}`,D=u?await (async()=>{try{let e=await fetch(u);if(!e.ok)return null;let t=e.headers.get("content-type")||"image/png";return{inlineData:{data:Buffer.from(await e.arrayBuffer()).toString("base64"),mimeType:t}}}catch(e){return console.warn("âš ï¸ NÃ£o foi possÃ­vel carregar imagem para ediÃ§Ã£o.",e),null}})():null,H=await Promise.all(E.slice(0,3).map(async e=>{try{let t=await fetch(e);if(!t.ok)return null;let a=t.headers.get("content-type")||"image/png";if(a.includes("svg"))return console.warn("âš ï¸ Ignorando referÃªncia SVG: nÃ£o suportado pela API de GeraÃ§Ã£o."),null;return{inlineData:{data:Buffer.from(await t.arrayBuffer()).toString("base64"),mimeType:a}}}catch(e){return console.warn("âš ï¸ Falha ao carregar referÃªncia de imagem.",e),null}}));console.log("ðŸš€ Enviando variaÃ§Ãµes em PARALELO para Gemini 3 Pro Image (NanoBanana Pro)...");let L=_.map(async(e,t)=>{try{let a=[{role:"user",parts:[{text:`${e}

[LOGO_RULE]: ${$}
[REFERENCES]: ${E.join(", ")}`},...H.filter(Boolean),...D?[D]:[]]}],r=await fetch(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:a,generationConfig:{responseModalities:["IMAGE"],imageConfig:{aspectRatio:d,imageSize:c}},safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]})});if(!r.ok){let e=await r.text();return console.error(`âŒ [Gemini 3 Image] Erro na variante ${t+1}:`,e),null}let n=await r.json(),o=n?.candidates?.[0]?.content?.parts?.find(e=>e.inlineData)?.inlineData||n?.content?.parts?.find(e=>e.inlineData)?.inlineData;if(!o?.data)return console.warn(`âš ï¸ Gemini Image API did not return inline image data for variant ${t+1}`),null;let i=o.mimeType||"image/png",s=`data:${i};base64,${o.data}`,l=n?.candidates?.[0]?.content?.role==="model"&&n?.candidates?.[0]?.content?.parts?.[0]?.id?n.candidates[0].content.parts[0].id:`gmi_${Date.now()}_${t}`;return{url:s,processId:l,promptUsed:e,checklist:{legibility200x112:"pending",contrast:"pending",ctaClear:"pending"},model:"gemini-3-pro-image-preview"}}catch(e){return console.error(`âŒ Erro em variante ${t+1}:`,e),null}}),U=(await Promise.all(L)).filter(e=>null!==e);if(0===U.length)throw Error("Todas as variaÃ§Ãµes de geraÃ§Ã£o de imagem falharam.");try{await (0,A.updateUserUsage)(l,-5),console.log(`[Design] 5 cr\xe9ditos decrementados para usu\xe1rio: ${l}`)}catch(e){console.error("[Design] Erro ao atualizar crÃ©ditos:",e)}return R.NextResponse.json({success:!0,imageUrl:U[0]?.url,processId:U[0]?.processId,images:U,version:"11.24.5-parallel",metadata:{type:r,aspectRatio:d,imageSize:c,promptVariants:_,imageReferences:E,usingBrandAssets:E.length>0,model:"gemini-3-pro-image-preview"}})}catch(e){return console.error("Google Image Generation Error:",e),R.NextResponse.json({error:"Failed to generate image via Google AI",details:String(e)},{status:500})}}e.s(["POST",()=>C,"dynamic",0,"force-dynamic","runtime",0,"nodejs"],641267);var w=e.i(641267);let x=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/design/generate/route",pathname:"/api/design/generate",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/OneDrive/Desktop/CURSOR/CONSELHO DE FUNIL/app/src/app/api/design/generate/route.ts",nextConfigOutput:"",userland:w}),{workAsyncStorage:N,workUnitAsyncStorage:O,serverHooks:T}=x;function $(){return(0,r.patchFetch)({workAsyncStorage:N,workUnitAsyncStorage:O})}async function I(e,t,r){x.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/design/generate/route";R=R.replace(/\/index$/,"")||"/";let v=await x.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:A,params:y,nextConfig:C,parsedUrl:w,isDraftMode:N,prerenderManifest:O,routerServerContext:T,isOnDemandRevalidate:$,revalidateOnlyGenerated:I,resolvedPathname:P,clientReferenceManifest:S,serverActionsManifest:_}=v,b=(0,s.normalizeAppPath)(R),D=!!(O.dynamicRoutes[b]||O.routes[P]),H=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,w,!1):t.end("This page could not be found"),null);if(D&&!N){let e=!!O.routes[P],t=O.dynamicRoutes[b];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await H();throw new f.NoFallbackError}}let L=null;!D||x.isDev||N||(L="/index"===(L=P)?"/":L);let U=!0===x.isDev||!D,G=D&&!U;_&&S&&(0,i.setManifestsSingleton)({page:R,clientReferenceManifest:S,serverActionsManifest:_});let k=e.method||"GET",B=(0,o.getTracer)(),M=B.getActiveScopeSpan(),j={params:y,prerenderManifest:O,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,n)=>x.onRequestError(e,t,r,n,T)},sharedContext:{buildId:A}},F=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),q=d.NextRequestAdapter.fromNodeNextRequest(F,(0,d.signalFromNodeResponse)(t));try{let i=async e=>x.handle(q,j).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=B.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${k} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${R}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let d=async({previousCacheEntry:a})=>{try{if(!s&&$&&I&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(n);e.fetchMetrics=j.renderOpts.fetchMetrics;let l=j.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let d=j.renderOpts.collectedTags;if(!D)return await (0,u.sendResponse)(F,K,o,j.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[h.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==j.renderOpts.collectedRevalidate&&!(j.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&j.renderOpts.collectedRevalidate,r=void 0===j.renderOpts.collectedExpire||j.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:j.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:G,isOnDemandRevalidate:$})},!1,T),t}},c=await x.handleResponse({req:e,nextConfig:C,cacheKey:L,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:O,isRoutePPREnabled:!1,isOnDemandRevalidate:$,revalidateOnlyGenerated:I,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:s});if(!D)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",$?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,g.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&D||f.delete(h.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,m.getCacheControlHeader)(c.cacheControl)),await (0,u.sendResponse)(F,K,new Response(c.value.body,{headers:f,status:c.value.status||200})),null};M?await l(M):await B.withPropagatedContext(e.headers,()=>B.trace(c.BaseServerSpan.handleRequest,{spanName:`${k} ${R}`,kind:o.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:b,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:G,isOnDemandRevalidate:$})},!1,T),D)throw t;return await (0,u.sendResponse)(F,K,new Response(null,{status:500})),null}}e.s(["handler",()=>I,"patchFetch",()=>$,"routeModule",()=>x,"serverHooks",()=>T,"workAsyncStorage",()=>N,"workUnitAsyncStorage",()=>O],198547)}];

//# sourceMappingURL=5c86f_next_dist_esm_build_templates_app-route_aedaf258.js.map