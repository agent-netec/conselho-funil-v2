{"version":3,"sources":["../../../../../../../../OneDrive/Desktop/CURSOR/CONSELHO%20DE%20FUNIL/app/src/lib/constants.ts","../../../../../../../../OneDrive/Desktop/CURSOR/CONSELHO%20DE%20FUNIL/app/src/lib/ai/prompts/ads-generation.ts","../../../../../../../../OneDrive/Desktop/CURSOR/CONSELHO%20DE%20FUNIL/app/src/lib/firebase/config.ts","../../../../../../../../OneDrive/Desktop/CURSOR/CONSELHO%20DE%20FUNIL/app/src/lib/ai/embeddings.ts"],"sourcesContent":["import type { Counselor, CounselorId } from '@/types';\r\n\r\n// ============================================\r\n// COUNSELORS REGISTRY - Fonte √önica de Verdade\r\n// ============================================\r\n\r\nexport const COUNSELORS_REGISTRY: Record<CounselorId, Counselor> = {\r\n  // Funnel Counselors\r\n  russell_brunson: {\r\n    id: 'russell_brunson',\r\n    name: 'Russell Brunson',\r\n    expertise: 'Arquitetura de Funil',\r\n    color: '#6366f1', // indigo\r\n    icon: 'üéØ',\r\n  },\r\n  dan_kennedy: {\r\n    id: 'dan_kennedy',\r\n    name: 'Dan Kennedy',\r\n    expertise: 'Oferta & Copy',\r\n    color: '#8b5cf6', // violet\r\n    icon: '‚úçÔ∏è',\r\n  },\r\n  frank_kern: {\r\n    id: 'frank_kern',\r\n    name: 'Frank Kern',\r\n    expertise: 'Psicologia & Comportamento',\r\n    color: '#ec4899', // pink\r\n    icon: 'üß†',\r\n  },\r\n  sam_ovens: {\r\n    id: 'sam_ovens',\r\n    name: 'Sam Ovens',\r\n    expertise: 'Aquisi√ß√£o & Qualifica√ß√£o',\r\n    color: '#14b8a6', // teal\r\n    icon: 'üé£',\r\n  },\r\n  ryan_deiss: {\r\n    id: 'ryan_deiss',\r\n    name: 'Ryan Deiss',\r\n    expertise: 'LTV & Reten√ß√£o',\r\n    color: '#f97316', // orange\r\n    icon: 'üìà',\r\n  },\r\n  perry_belcher: {\r\n    id: 'perry_belcher',\r\n    name: 'Perry Belcher',\r\n    expertise: 'Monetiza√ß√£o Simples',\r\n    color: '#84cc16', // lime\r\n    icon: 'üí∞',\r\n  },\r\n\r\n  // Social Counselors\r\n  lia_haberman: {\r\n    id: 'lia_haberman',\r\n    name: 'Lia Haberman',\r\n    expertise: 'Algoritmo & Mudan√ßas',\r\n    color: '#06b6d4', // cyan\r\n    icon: 'üìä',\r\n  },\r\n  rachel_karten: {\r\n    id: 'rachel_karten',\r\n    name: 'Rachel Karten',\r\n    expertise: 'Criativo & Hooks',\r\n    color: '#f43f5e', // rose\r\n    icon: 'ü™ù',\r\n  },\r\n  nikita_beer: {\r\n    id: 'nikita_beer',\r\n    name: 'Nikita Beer',\r\n    expertise: 'Viraliza√ß√£o & Trends',\r\n    color: '#8b5cf6', // violet\r\n    icon: 'üöÄ',\r\n  },\r\n  justin_welsh: {\r\n    id: 'justin_welsh',\r\n    name: 'Justin Welsh',\r\n    expertise: 'Funil Social',\r\n    color: '#10b981', // emerald\r\n    icon: '‚õìÔ∏è',\r\n  },\r\n\r\n  // Copy Counselors\r\n  eugene_schwartz: {\r\n    id: 'eugene_schwartz',\r\n    name: 'Eugene Schwartz',\r\n    expertise: 'Consci√™ncia de Mercado',\r\n    specialty: 'Estrutura de copy para diferentes est√°gios de consci√™ncia',\r\n    color: '#6366f1', // indigo\r\n    icon: 'üéØ',\r\n  },\r\n  claude_hopkins: {\r\n    id: 'claude_hopkins',\r\n    name: 'Claude Hopkins',\r\n    expertise: 'M√©todo Cient√≠fico',\r\n    specialty: 'Testes, medi√ß√£o, prova social',\r\n    color: '#3b82f6', // blue\r\n    icon: 'üî¨',\r\n  },\r\n  gary_halbert: {\r\n    id: 'gary_halbert',\r\n    name: 'Gary Halbert',\r\n    expertise: 'Headlines & Psicologia',\r\n    specialty: 'Headlines que prendem, curiosidade, especificidade',\r\n    color: '#f59e0b', // amber\r\n    icon: '‚ö°',\r\n  },\r\n  joseph_sugarman: {\r\n    id: 'joseph_sugarman',\r\n    name: 'Joseph Sugarman',\r\n    expertise: 'Narrativa & Estrutura',\r\n    specialty: 'Storytelling, transi√ß√µes, long-form copy',\r\n    color: '#8b5cf6', // violet\r\n    icon: 'üìñ',\r\n  },\r\n  dan_kennedy_copy: {\r\n    id: 'dan_kennedy_copy',\r\n    name: 'Dan Kennedy',\r\n    expertise: 'Oferta & Urg√™ncia',\r\n    specialty: 'Ofertas irresist√≠veis, garantia, urg√™ncia real',\r\n    color: '#10b981', // emerald\r\n    icon: 'üí∞',\r\n  },\r\n  david_ogilvy: {\r\n    id: 'david_ogilvy',\r\n    name: 'David Ogilvy',\r\n    expertise: 'Brand Premium',\r\n    specialty: 'Pesquisa, diferencia√ß√£o, big idea',\r\n    color: '#64748b', // slate\r\n    icon: 'üëî',\r\n  },\r\n  john_carlton: {\r\n    id: 'john_carlton',\r\n    name: 'John Carlton',\r\n    expertise: 'Voz Aut√™ntica',\r\n    specialty: 'Autenticidade, fluxo natural, conversa√ß√£o',\r\n    color: '#ec4899', // pink\r\n    icon: 'üé§',\r\n  },\r\n  drayton_bird: {\r\n    id: 'drayton_bird',\r\n    name: 'Drayton Bird',\r\n    expertise: 'Simplicidade & Efici√™ncia',\r\n    specialty: 'Benef√≠cio claro, direto, resposta direta',\r\n    color: '#14b8a6', // teal\r\n    icon: '‚úÇÔ∏è',\r\n  },\r\n  frank_kern_copy: {\r\n    id: 'frank_kern_copy',\r\n    name: 'Frank Kern',\r\n    expertise: 'Fluxo de Vendas',\r\n    specialty: 'Sequ√™ncias, automa√ß√£o, comportamento',\r\n    color: '#f97316', // orange\r\n    icon: 'üîÑ',\r\n  },\r\n\r\n  // Ads Counselors\r\n  justin_brooke: {\r\n    id: 'justin_brooke',\r\n    name: 'Justin Brooke',\r\n    expertise: 'Estrat√©gia & Escala',\r\n    color: '#3b82f6', // blue\r\n    icon: 'üìä',\r\n  },\r\n  nicholas_kusmich: {\r\n    id: 'nicholas_kusmich',\r\n    name: 'Nicholas Kusmich',\r\n    expertise: 'Meta Ads & Contexto',\r\n    color: '#2563eb', // blue-600\r\n    icon: 'üéØ',\r\n  },\r\n  jon_loomer: {\r\n    id: 'jon_loomer',\r\n    name: 'Jon Loomer',\r\n    expertise: 'Analytics & T√©cnico',\r\n    color: '#1d4ed8', // blue-700\r\n    icon: '‚öôÔ∏è',\r\n  },\r\n  savannah_sanchez: {\r\n    id: 'savannah_sanchez',\r\n    name: 'Savannah Sanchez',\r\n    expertise: 'TikTok & UGC',\r\n    color: '#0ea5e9', // sky\r\n    icon: 'üì±',\r\n  },\r\n  design_director: {\r\n    id: 'design_director',\r\n    name: 'Diretor de Design',\r\n    expertise: 'Dire√ß√£o de Arte & Briefing',\r\n    color: '#a855f7', // purple-500\r\n    icon: 'üé®',\r\n  },\r\n};\r\n\r\n// Retrocompatibilidade (Deprecated)\r\n/** @deprecated Use COUNSELORS_REGISTRY */\r\nexport const COUNSELORS = COUNSELORS_REGISTRY;\r\n/** @deprecated Use COUNSELORS_REGISTRY */\r\nexport const COPY_COUNSELORS = COUNSELORS_REGISTRY;\r\n\r\n// Navigation groups and items\r\nexport interface NavItem {\r\n  id: string;\r\n  label: string;\r\n  href: string;\r\n  icon: string;\r\n  aliases?: string[];\r\n  sub_items?: string[];\r\n}\r\n\r\nexport interface NavGroup {\r\n  id: string;\r\n  label: string;\r\n  description?: string;\r\n  icon: string;\r\n  items: NavItem[];\r\n}\r\n\r\nexport const NAV_GROUPS: NavGroup[] = [\r\n  {\r\n    id: 'intelligence',\r\n    label: 'Intelig√™ncia',\r\n    description: 'Dados e insights que alimentam a estrat√©gia',\r\n    icon: 'Brain',\r\n    items: [\r\n      { id: 'intelligence-dashboard', label: 'Dashboard', href: '/intelligence', icon: 'LayoutDashboard' },\r\n      { id: 'discovery', label: 'Discovery', href: '/intelligence/discovery', icon: 'Search', sub_items: ['Keywords', 'Spy Agent'] },\r\n      { id: 'attribution', label: 'Atribui√ß√£o', href: '/intelligence/attribution', icon: 'GitBranch' },\r\n      { id: 'ltv', label: 'LTV & Reten√ß√£o', href: '/intelligence/ltv', icon: 'TrendingUp' },\r\n      { id: 'journey', label: 'Jornada do Lead', href: '/intelligence/journey', icon: 'Map' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'strategy',\r\n    label: 'Estrat√©gia',\r\n    description: 'Planejamento e arquitetura de convers√£o',\r\n    icon: 'Compass',\r\n    items: [\r\n      { id: 'funnels', label: 'Funis', href: '/funnels', icon: 'Target' },\r\n      { id: 'offer-lab', label: 'Offer Lab', href: '/intelligence/offer-lab', icon: 'Beaker' },\r\n      { id: 'funnel-autopsy', label: 'Funnel Autopsy', href: '/strategy/autopsy', icon: 'Stethoscope' },\r\n      { id: 'copy-chat', label: 'Copywriting', href: '/chat?mode=copy', icon: 'PencilLine' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'execution',\r\n    label: 'Execu√ß√£o',\r\n    description: 'Opera√ß√£o e implementa√ß√£o de ativos',\r\n    icon: 'Zap',\r\n    items: [\r\n      { id: 'campaigns', label: 'Campanhas', href: '/campaigns', icon: 'Rocket', aliases: ['/campaign'] },\r\n      { id: 'ads-chat', label: 'Ads & Tr√°fego', href: '/chat?mode=ads', icon: 'Megaphone' },\r\n      { id: 'social', label: 'Social', href: '/social', icon: 'Share2' },\r\n      { id: 'social-inbox', label: 'Social Inbox', href: '/social-inbox', icon: 'Inbox' },\r\n      { id: 'automation', label: 'Automa√ß√£o', href: '/automation', icon: 'Cpu' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'management',\r\n    label: 'Gest√£o',\r\n    description: 'Governan√ßa de marca e ativos',\r\n    icon: 'ShieldCheck',\r\n    items: [\r\n      { id: 'brands', label: 'Marcas', href: '/brands', icon: 'Building' },\r\n      { id: 'brand-hub', label: 'Brand Hub', href: '/brand-hub', icon: 'Palette' },\r\n      { id: 'assets', label: 'Biblioteca de Ativos', href: '/assets', icon: 'FolderKanban' },\r\n      { id: 'vault', label: 'Vault', href: '/vault', icon: 'Database' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'system',\r\n    label: 'Sistema',\r\n    icon: 'Settings',\r\n    items: [\r\n      { id: 'settings', label: 'Configura√ß√µes', href: '/settings', icon: 'Settings' },\r\n      { id: 'integrations', label: 'Integra√ß√µes', href: '/integrations', icon: 'PlugZap' },\r\n    ],\r\n  },\r\n];\r\n\r\n// Retrocompatibilidade para NAV_ITEMS (Flattened list)\r\nexport const NAV_ITEMS = NAV_GROUPS.flatMap(group => group.items);\r\n\r\n// Status badges\r\nexport const STATUS_COLORS: Record<string, string> = {\r\n  draft: 'bg-gray-500',\r\n  generating: 'bg-blue-500',\r\n  review: 'bg-yellow-500',\r\n  approved: 'bg-green-500',\r\n  adjusting: 'bg-orange-500',\r\n  executing: 'bg-purple-500',\r\n  completed: 'bg-emerald-500',\r\n  killed: 'bg-red-500',\r\n};\r\n\r\n// Decision colors\r\nexport const DECISION_COLORS = {\r\n  EXECUTAR: 'bg-green-500 text-white',\r\n  AJUSTAR: 'bg-amber-500 text-white',\r\n  MATAR: 'bg-red-500 text-white',\r\n} as const;\r\n\r\n// Copy Types with labels\r\nexport const COPY_TYPES = {\r\n  headline: { label: 'Headlines', icon: 'üì∞', description: 'Headlines por est√°gio de consci√™ncia' },\r\n  email_sequence: { label: 'Emails', icon: 'üìß', description: 'Sequ√™ncia de emails de follow-up' },\r\n  offer_copy: { label: 'Oferta', icon: 'üí∞', description: 'Copy de oferta completa' },\r\n  vsl_script: { label: 'VSL Script', icon: 'üé¨', description: 'Script de Video Sales Letter' },\r\n  ad_creative: { label: 'An√∫ncios', icon: 'üì±', description: 'Copy para Meta, Google, etc' },\r\n  landing_page: { label: 'Landing Page', icon: 'üõ¨', description: 'Copy de p√°gina de vendas' },\r\n} as const;\r\n\r\n// Awareness stages with labels\r\nexport const AWARENESS_STAGES = {\r\n  unaware: { label: 'Inconsciente', description: 'N√£o sabe que tem problema', copyLength: 'Muito longa' },\r\n  problem_aware: { label: 'Consciente do Problema', description: 'Sabe que tem problema', copyLength: 'M√©dia' },\r\n  solution_aware: { label: 'Consciente da Solu√ß√£o', description: 'Sabe que existem solu√ß√µes', copyLength: 'M√©dia' },\r\n  product_aware: { label: 'Consciente do Produto', description: 'Conhece seu produto', copyLength: 'Curta' },\r\n  most_aware: { label: 'Mais Consciente', description: 'J√° conhece bem', copyLength: 'Muito curta' },\r\n} as const;\r\n\r\n// Chat modes configuration\r\nexport const CHAT_MODES = {\r\n  general: {\r\n    id: 'general',\r\n    label: 'Conselho',\r\n    title: 'Conselho',\r\n    subtitle: '23 especialistas',\r\n    placeholder: 'Pergunte ao Conselho...',\r\n    footer: 'Pressione Enter para enviar, Shift+Enter para nova linha',\r\n    accentColor: 'emerald',\r\n    counselors: [\r\n      'russell_brunson', 'dan_kennedy', 'frank_kern', 'sam_ovens', 'ryan_deiss', 'perry_belcher',\r\n      'eugene_schwartz', 'claude_hopkins', 'gary_halbert', 'joseph_sugarman', 'david_ogilvy', \r\n      'john_carlton', 'drayton_bird', 'frank_kern_copy', 'lia_haberman', 'rachel_karten', \r\n      'nikita_beer', 'justin_welsh', 'justin_brooke', 'nicholas_kusmich', 'jon_loomer', \r\n      'savannah_sanchez'\r\n    ] as CounselorId[],\r\n  },\r\n  funnel: {\r\n    id: 'funnel',\r\n    label: 'Funil',\r\n    title: 'Conselho de Funil',\r\n    subtitle: '6 especialistas',\r\n    placeholder: 'Pergunte sobre arquitetura de funis...',\r\n    footer: 'üéØ Consultando: Russell Brunson, Dan Kennedy, Frank Kern, Sam Ovens, Ryan Deiss, Perry Belcher',\r\n    accentColor: 'indigo',\r\n    counselors: [\r\n      'russell_brunson', 'dan_kennedy', 'frank_kern', 'sam_ovens', 'ryan_deiss', 'perry_belcher'\r\n    ] as CounselorId[],\r\n  },\r\n  copy: {\r\n    id: 'copy',\r\n    label: 'Copy',\r\n    title: 'Conselho de Copy',\r\n    subtitle: '9 copywriters',\r\n    placeholder: 'Pergunte sobre copy e persuas√£o...',\r\n    footer: '‚úçÔ∏è Consultando: Schwartz, Hopkins, Halbert, Sugarman, Ogilvy, Carlton, Bird, Kern',\r\n    accentColor: 'amber',\r\n    counselors: [\r\n      'eugene_schwartz', 'claude_hopkins', 'gary_halbert', 'joseph_sugarman', 'david_ogilvy', \r\n      'john_carlton', 'drayton_bird', 'frank_kern_copy', 'dan_kennedy_copy'\r\n    ] as CounselorId[],\r\n  },\r\n  social: {\r\n    id: 'social',\r\n    label: 'Social',\r\n    title: 'Conselho Social',\r\n    subtitle: '4 especialistas',\r\n    placeholder: 'Pergunte sobre redes sociais e viraliza√ß√£o...',\r\n    footer: 'üöÄ Consultando: Lia Haberman, Rachel Karten, Nikita Beer, Justin Welsh',\r\n    accentColor: 'rose',\r\n    counselors: [\r\n      'lia_haberman', 'rachel_karten', 'nikita_beer', 'justin_welsh'\r\n    ] as CounselorId[],\r\n  },\r\n  ads: {\r\n    id: 'ads',\r\n    label: 'Ads',\r\n    title: 'Conselho de Ads',\r\n    subtitle: '4 especialistas',\r\n    placeholder: 'Pergunte sobre tr√°fego e escala...',\r\n    footer: 'üìä Consultando: Justin Brooke, Nicholas Kusmich, Jon Loomer, Savannah Sanchez',\r\n    accentColor: 'blue',\r\n    counselors: [\r\n      'justin_brooke', 'nicholas_kusmich', 'jon_loomer', 'savannah_sanchez'\r\n    ] as CounselorId[],\r\n  },\r\n  design: {\r\n    id: 'design',\r\n    label: 'Design',\r\n    title: 'Conselho de Design',\r\n    subtitle: 'Diretor de Design',\r\n    placeholder: 'Pe√ßa um briefing de design ou prompt para o NanoBanana...',\r\n    footer: 'üé® Consultando: Diretor de Design especializado em Thumbnails, Carross√©is e Est√°ticos',\r\n    accentColor: 'purple',\r\n    counselors: [\r\n      'design_director'\r\n    ] as CounselorId[],\r\n  },\r\n  party: {\r\n    id: 'party',\r\n    label: 'Party Mode',\r\n    title: 'Alto Conselho',\r\n    subtitle: 'M√∫ltiplos Especialistas',\r\n    placeholder: 'Inicie uma delibera√ß√£o entre especialistas...',\r\n    footer: 'üéâ Party Mode: Selecione os especialistas para o debate',\r\n    accentColor: 'purple',\r\n    counselors: [] as CounselorId[], // Ser√° preenchido dinamicamente\r\n  },\r\n} as const;\r\n","import { CampaignContext } from '@/types/campaign';\r\nimport { COUNSELORS_REGISTRY } from '@/lib/constants';\r\n\r\nexport const ADS_GENERATION_RULES = `\r\n## REGRAS DE OURO - CONSELHO DE ADS\r\n1. **CONGRU√äNCIA**: A estrat√©gia de tr√°fego deve seguir rigorosamente a \"Golden Thread\" (Funil -> Copy -> Social -> Design).\r\n2. **ESPECIFICIDADE**: Defina p√∫blicos, canais e estruturas de campanha reais (CBO/ABO, segmenta√ß√£o por interesses, lookalike).\r\n3. **M√âTRICAS 2026**: Utilize benchmarks atualizados de CPC, CTR e ROAS para 2026.\r\n4. **FORMATO**: Retorne APENAS o JSON v√°lido seguindo a estrutura solicitada.\r\n5. **INSIGHTS**: Forne√ßa justificativas t√©cnicas baseadas nos especialistas.\r\n`;\r\n\r\nexport function buildAdsGenerationPrompt(campaign: CampaignContext, context?: { ragContext?: string; brandContext?: string }): string {\r\n  const adsCounselors = [\r\n    COUNSELORS_REGISTRY.justin_brooke,\r\n    COUNSELORS_REGISTRY.nicholas_kusmich,\r\n    COUNSELORS_REGISTRY.jon_loomer,\r\n    COUNSELORS_REGISTRY.savannah_sanchez\r\n  ];\r\n\r\n  return `Voc√™ √© o Conselho de Ads, um sistema de intelig√™ncia composto por 4 mestres do tr√°fego pago e escala:\r\n\r\n${adsCounselors.map((c, i) => `${i + 1}. **${c.name}** ‚Äî ${c.expertise}`).join('\\n')}\r\n\r\n## THE GOLDEN THREAD: MANIFESTO DA CAMPANHA\r\n\r\n### 1. O C√âREBRO (FUNIL)\r\n- **Tipo:** ${campaign.funnel?.type}\r\n- **Objetivo:** ${campaign.funnel?.mainGoal}\r\n- **P√∫blico:** ${campaign.funnel?.targetAudience}\r\n- **Resumo:** ${campaign.funnel?.summary}\r\n\r\n### 2. A VOZ (COPY)\r\n- **Big Idea:** ${campaign.copywriting?.bigIdea}\r\n- **Tone:** ${campaign.copywriting?.tone}\r\n- **Headlines:** ${campaign.copywriting?.headlines.join(' | ')}\r\n- **Benef√≠cios:** ${campaign.copywriting?.keyBenefits.join(', ')}\r\n\r\n### 3. A ATEN√á√ÉO (SOCIAL)\r\n- **Canais:** ${campaign.social?.platforms.join(', ')}\r\n- **Hooks:** ${campaign.social?.hooks.map(h => `[${h.platform}] ${h.content}`).join(' | ')}\r\n\r\n### 4. O VISUAL (DESIGN)\r\n- **Estilo:** ${campaign.design?.visualStyle}\r\n- **Cores:** ${campaign.design?.preferredColors.join(', ')}\r\n- **Prompts:** ${campaign.design?.visualPrompts.join(' | ')}\r\n\r\n${context?.ragContext ? `## CONHECIMENTO ESTRAT√âGICO (ADS PLAYBOOKS)\\n${context.ragContext}\\n` : ''}\r\n${context?.brandContext ? `## CONHECIMENTO DA MARCA\\n${context.brandContext}\\n` : ''}\r\n\r\n## TAREFA: GERAR ESTRAT√âGIA DE ADS (ESCALA)\r\n\r\nSua tarefa √© ler todo o manifesto acima e projetar a estrutura de escala desta campanha. \r\nN√£o invente dados que contradigam a copy ou o design. \r\nSe o Copywriter definiu uma Big Idea, o Ad deve ser o ve√≠culo dessa ideia.\r\n\r\n## FORMATO DE SA√çDA (JSON)\r\n\r\n{\r\n  \"audiences\": [\"Audi√™ncia 1 (ex: Lookalike 1% Compradores)\", \"Audi√™ncia 2 (Interesses em X)\", \"Audi√™ncia 3 (Retargeting)\"],\r\n  \"channels\": [\"Meta Ads\", \"Google Search\", \"TikTok Ads\"],\r\n  \"suggestedBudget\": \"R$ X.XXX,XX / m√™s\",\r\n  \"performanceBenchmarks\": {\r\n    \"targetCPC\": 1.50,\r\n    \"targetCTR\": 1.2,\r\n    \"targetCPA\": 45.00\r\n  },\r\n  \"strategyRationale\": \"Explica√ß√£o t√©cnica de como os canais e p√∫blicos se conectam ao funil.\",\r\n  \"counselorInsights\": [\r\n    {\r\n      \"counselor\": \"Justin Brooke\",\r\n      \"insight\": \"Conselho sobre escala e distribui√ß√£o de verba.\"\r\n    },\r\n    {\r\n      \"counselor\": \"Nicholas Kusmich\",\r\n      \"insight\": \"Conselho sobre segmenta√ß√£o e contexto no Meta.\"\r\n    }\r\n  ]\r\n}\r\n\r\n${ADS_GENERATION_RULES}`;\r\n}\r\n","// US-28.01: Mocks robustos para evitar crashes durante o build est√°tico da Next.js\r\nconst mockInternal = {\r\n  container: {\r\n    get: () => ({}),\r\n  }\r\n};\r\n\r\nconst mockService = {\r\n  currentUser: null,\r\n  onAuthStateChanged: () => () => {},\r\n  signOut: async () => {},\r\n  getApp: () => ({ container: mockInternal.container }),\r\n  app: { container: mockInternal.container },\r\n  INTERNAL: mockInternal,\r\n  container: mockInternal.container,\r\n  collection: () => ({ doc: () => ({ get: async () => ({ exists: () => false }) }) }),\r\n  doc: () => ({ get: async () => ({ exists: () => false }) }),\r\n  ref: () => ({ put: async () => ({}) }),\r\n};\r\n\r\n// Global mocks for Firebase SDK internal access\r\nif (typeof global !== 'undefined') {\r\n  (global as any).firebase = (global as any).firebase || { INTERNAL: mockInternal };\r\n  (global as any).firebaseApp = (global as any).firebaseApp || mockService;\r\n  (global as any)._firebaseApp = (global as any)._firebaseApp || mockService;\r\n  (global as any).firebaseInternalContainer = mockInternal.container;\r\n}\r\n\r\n// US-28.01: Detect build phase more reliably\r\nconst isBuild = typeof window === 'undefined' && \r\n  (process.env.NEXT_PHASE === 'phase-production-build' || process.env.NODE_ENV === 'production');\r\n\r\nlet appInstance: any = null;\r\nlet authInstance: any = null;\r\nlet dbInstance: any = null;\r\nlet storageInstance: any = null;\r\n\r\nfunction initialize() {\r\n  if (isBuild) return;\r\n  if (appInstance) return;\r\n\r\n  try {\r\n    const { initializeApp, getApps } = require('firebase/app');\r\n    const { getAuth } = require('firebase/auth');\r\n    const { initializeFirestore, CACHE_SIZE_UNLIMITED } = require('firebase/firestore');\r\n    const { getStorage } = require('firebase/storage');\r\n\r\n    const apiKey = (process.env.NEXT_PUBLIC_FIREBASE_API_KEY ?? '').trim();\r\n    const firebaseConfig = {\r\n      apiKey,\r\n      authDomain: (process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN ?? '').trim(),\r\n      projectId: (process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID ?? '').trim(),\r\n      storageBucket: (process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET ?? '').trim(),\r\n      messagingSenderId: (process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID ?? '').trim(),\r\n      appId: (process.env.NEXT_PUBLIC_FIREBASE_APP_ID ?? '').trim(),\r\n    };\r\n\r\n    if (apiKey) {\r\n      appInstance = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0];\r\n      if (appInstance && process.env.SKIP_AUTH !== '1') {\r\n        authInstance = getAuth(appInstance);\r\n        dbInstance = initializeFirestore(appInstance, {\r\n          experimentalForceLongPolling: true,\r\n          cacheSizeBytes: CACHE_SIZE_UNLIMITED,\r\n        });\r\n        storageInstance = getStorage(appInstance);\r\n      }\r\n    }\r\n  } catch (e) {\r\n    // Silently fail during build\r\n  }\r\n}\r\n\r\n// Export as getters to ensure they are not evaluated too early and can be mocked\r\nexport const auth = isBuild ? mockService : (initialize(), authInstance || mockService);\r\nexport const db = isBuild ? mockService : (initialize(), dbInstance || mockService);\r\nexport const storage = isBuild ? mockService : (initialize(), storageInstance || mockService);\r\n// Default export should also be a mock during build to avoid \"Cannot read properties of null (reading 'container')\"\r\nexport default isBuild ? mockService : (initialize(), appInstance || mockService);\r\n","import { GoogleGenerativeAI } from '@google/generative-ai';\r\nimport { \r\n  doc, \r\n  getDoc, \r\n  setDoc, \r\n  Timestamp \r\n} from 'firebase/firestore';\r\nimport { db } from '../firebase/config';\r\n\r\n/**\r\n * Get Gemini API Key - reads from environment variable at runtime\r\n */\r\nfunction getGeminiApiKey(): string | undefined {\r\n  // Acesso direto para garantir que o Next.js/Turbopack fa√ßa a inje√ß√£o no cliente\r\n  const public_key = (process.env.NEXT_PUBLIC_GOOGLE_AI_API_KEY ?? '').trim();\r\n  const private_key = (process.env.GOOGLE_AI_API_KEY ?? '').trim();\r\n  \r\n  const key = public_key || private_key;\r\n  \r\n  if (!key && typeof window !== 'undefined') {\r\n    console.error('‚ùå [Embeddings] NEXT_PUBLIC_GOOGLE_AI_API_KEY n√£o encontrada no bundle do navegador. Verifique se o servidor foi reiniciado ap√≥s editar o .env.local.');\r\n  }\r\n  \r\n  return key;\r\n}\r\n\r\n/**\r\n * Simple hashing function for cache keys\r\n */\r\nasync function getCacheKey(text: string): Promise<string> {\r\n  const msgUint8 = new TextEncoder().encode(text.trim().toLowerCase());\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\r\n}\r\n\r\n/**\r\n * Generates an embedding for a given text using Gemini's text-embedding-004 model.\r\n * Includes a Firestore cache to reduce costs and latency.\r\n * \r\n * @param text - The input text to embed.\r\n * @returns A promise that resolves to an array of numbers (768 dimensions).\r\n * @throws Error if the API key is missing or the request fails.\r\n */\r\nexport async function generateEmbedding(text: string): Promise<number[]> {\r\n  // Se preferir evitar o SDK (que vem falhando com API_KEY_INVALID), usamos o endpoint direto.\r\n  const apiKey = getGeminiApiKey();\r\n  if (!apiKey) {\r\n    throw new Error('GOOGLE_AI_API_KEY not configured for embeddings');\r\n  }\r\n\r\n  const startTime = Date.now();\r\n  const cacheKey = await getCacheKey(text);\r\n  \r\n  // 1. Check Cache (Firestore)\r\n  try {\r\n    const cacheRef = doc(db, 'query_cache', cacheKey);\r\n    const cacheSnap = await getDoc(cacheRef);\r\n    \r\n    if (cacheSnap.exists()) {\r\n      const data = cacheSnap.data();\r\n      const ttl = 30 * 24 * 60 * 60 * 1000; // 30 days\r\n      const isExpired = (Timestamp.now().toMillis() - data.createdAt.toMillis()) > ttl;\r\n      \r\n      if (!isExpired) {\r\n        console.log(`[Embeddings] Cache HIT for key: ${cacheKey.substring(0, 8)} (${Date.now() - startTime}ms)`);\r\n        return data.embedding;\r\n      }\r\n    }\r\n  } catch (cacheError) {\r\n    console.warn('[Embeddings] Cache read error:', cacheError);\r\n  }\r\n\r\n  // 2. Cache MISS - Call API\r\n  try {\r\n    // RESOLU√á√ÉO DEFINITIVA (Dandara/Kai): \r\n    // 1. text-embedding-004 e embedding-001 via SDK (@google/generative-ai) est√£o retornando API_KEY_INVALID \r\n    //    mesmo com chaves v√°lidas, possivelmente por deprecia√ß√£o ou conflito de headers do SDK.\r\n    // 2. A chamada direta via fetch para 'gemini-embedding-001' ignorando o SDK funciona 100%.\r\n    // 3. Mantemos o fetch direto como padr√£o para garantir estabilidade do RAG.\r\n    \r\n    console.log(`[Embeddings] Calling text-embedding-004 with dimensionality: 768`);\r\n    const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/text-embedding-004:embedContent', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'x-goog-api-key': apiKey,\r\n      },\r\n      body: JSON.stringify({\r\n        model: 'models/text-embedding-004',\r\n        content: { parts: [{ text }] },\r\n        outputDimensionality: 768,\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errTxt = await response.text();\r\n      throw new Error(`Embedding API failed: ${response.status} ${errTxt}`);\r\n    }\r\n\r\n    const result = await response.json();\r\n    const embedding = result?.embedding?.values;\r\n    if (!Array.isArray(embedding)) {\r\n      throw new Error('Embedding API returned no values');\r\n    }\r\n    \r\n    // 3. Save to Cache (Async)\r\n    const cacheRef = doc(db, 'query_cache', cacheKey);\r\n    setDoc(cacheRef, {\r\n      query: text.substring(0, 500), // Store snippet for debugging\r\n      embedding,\r\n      createdAt: Timestamp.now(),\r\n    }).catch(err => console.error('[Embeddings] Cache write error:', err));\r\n\r\n    console.log(`[Embeddings] Cache MISS - API called (${Date.now() - startTime}ms)`);\r\n    return embedding;\r\n  } catch (error) {\r\n    console.error('[Embeddings] Error generating embedding:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Generates embeddings for a batch of texts.\r\n * Handles partial cache hits to minimize API usage.\r\n * Includes TTL check (30 days).\r\n * \r\n * @param texts - Array of strings to embed.\r\n * @returns A promise that resolves to an array of number arrays.\r\n */\r\nexport async function generateEmbeddingsBatch(texts: string[]): Promise<number[][]> {\r\n  const startTime = Date.now();\r\n  const results: (number[] | null)[] = new Array(texts.length).fill(null);\r\n  const missIndices: number[] = [];\r\n  const missTexts: string[] = [];\r\n  const ttl = 30 * 24 * 60 * 60 * 1000; // 30 days\r\n  const nowMillis = Timestamp.now().toMillis();\r\n\r\n  // 1. Check Cache for each text\r\n  for (let i = 0; i < texts.length; i++) {\r\n    const text = texts[i];\r\n    const cacheKey = await getCacheKey(text);\r\n    \r\n    try {\r\n      const cacheRef = doc(db, 'query_cache', cacheKey);\r\n      const cacheSnap = await getDoc(cacheRef);\r\n      \r\n      if (cacheSnap.exists()) {\r\n        const data = cacheSnap.data();\r\n        const isExpired = (nowMillis - data.createdAt.toMillis()) > ttl;\r\n        \r\n        if (!isExpired) {\r\n          results[i] = data.embedding;\r\n          continue;\r\n        }\r\n      }\r\n    } catch (err) {\r\n      // Ignore cache errors and treat as miss\r\n    }\r\n    \r\n    missIndices.push(i);\r\n    missTexts.push(text);\r\n  }\r\n\r\n  if (missTexts.length === 0) {\r\n    console.log(`[Embeddings] Batch Cache HIT (100%) - ${texts.length} items (${Date.now() - startTime}ms)`);\r\n    return results as number[][];\r\n  }\r\n\r\n  // 2. Call API for MISSES\r\n  const apiKey = getGeminiApiKey();\r\n  if (!apiKey) {\r\n    throw new Error('GOOGLE_AI_API_KEY not configured for embeddings');\r\n  }\r\n\r\n  const genAI = new GoogleGenerativeAI(apiKey);\r\n  const model = genAI.getGenerativeModel({ model: \"text-embedding-004\" });\r\n\r\n  try {\r\n    console.log(`[Embeddings] Batch Cache MISS - Calling API for ${missTexts.length}/${texts.length} items`);\r\n    \r\n    // Process in chunks of 90 (Google AI API limit is 100, we use 90 to be safe and avoid overhead issues)\r\n    // ST-11.23 Hotfix: Avoid \"at most 100 requests\" error\r\n    const BATCH_SIZE = 90;\r\n    const newEmbeddings: number[][] = [];\r\n    \r\n    for (let i = 0; i < missTexts.length; i += BATCH_SIZE) {\r\n      const batchTexts = missTexts.slice(i, i + BATCH_SIZE);\r\n      console.log(`[Embeddings] Processing API sub-batch ${i / BATCH_SIZE + 1} (${batchTexts.length} items)`);\r\n      \r\n      // Switching to fetch to avoid SDK inconsistencies (Ref: generateEmbedding)\r\n      const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/text-embedding-004:batchEmbedContents', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'x-goog-api-key': apiKey,\r\n        },\r\n        body: JSON.stringify({\r\n          requests: batchTexts.map((text) => ({\r\n            model: 'models/text-embedding-004',\r\n            content: { parts: [{ text }] },\r\n            outputDimensionality: 768\r\n          })),\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errTxt = await response.text();\r\n        throw new Error(`Batch Embedding API failed: ${response.status} ${errTxt}`);\r\n      }\r\n\r\n      const batchResult = await response.json();\r\n      \r\n      if (!batchResult.embeddings || !Array.isArray(batchResult.embeddings)) {\r\n        throw new Error('Batch Embedding API returned invalid format');\r\n      }\r\n\r\n      newEmbeddings.push(...batchResult.embeddings.map((e: any) => e.values));\r\n    }\r\n    \r\n    // 3. Save new embeddings to Cache and update results\r\n    for (let i = 0; i < missIndices.length; i++) {\r\n      const originalIdx = missIndices[i];\r\n      const embedding = newEmbeddings[i];\r\n      const text = missTexts[i];\r\n      results[originalIdx] = embedding;\r\n      \r\n      const cacheKey = await getCacheKey(text);\r\n      const cacheRef = doc(db, 'query_cache', cacheKey);\r\n      setDoc(cacheRef, {\r\n        query: text.substring(0, 500),\r\n        embedding,\r\n        createdAt: Timestamp.now(),\r\n      }).catch(err => console.error('[Embeddings] Cache write error:', err));\r\n    }\r\n\r\n    console.log(`[Embeddings] Batch completed (${Date.now() - startTime}ms)`);\r\n    return results as number[][];\r\n  } catch (error) {\r\n    console.error('[Embeddings] Error generating batch embeddings:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"+CAMO,IAAM,EAAsD,CAEjE,gBAAiB,CACf,GAAI,kBACJ,KAAM,kBACN,UAAW,uBACX,MAAO,UACP,KAAM,IACR,EACA,YAAa,CACX,GAAI,cACJ,KAAM,cACN,UAAW,gBACX,MAAO,UACP,KAAM,IACR,EACA,WAAY,CACV,GAAI,aACJ,KAAM,aACN,UAAW,6BACX,MAAO,UACP,KAAM,IACR,EACA,UAAW,CACT,GAAI,YACJ,KAAM,YACN,UAAW,2BACX,MAAO,UACP,KAAM,IACR,EACA,WAAY,CACV,GAAI,aACJ,KAAM,aACN,UAAW,iBACX,MAAO,UACP,KAAM,IACR,EACA,cAAe,CACb,GAAI,gBACJ,KAAM,gBACN,UAAW,sBACX,MAAO,UACP,KAAM,IACR,EAGA,aAAc,CACZ,GAAI,eACJ,KAAM,eACN,UAAW,uBACX,MAAO,UACP,KAAM,IACR,EACA,cAAe,CACb,GAAI,gBACJ,KAAM,gBACN,UAAW,mBACX,MAAO,UACP,KAAM,IACR,EACA,YAAa,CACX,GAAI,cACJ,KAAM,cACN,UAAW,uBACX,MAAO,UACP,KAAM,IACR,EACA,aAAc,CACZ,GAAI,eACJ,KAAM,eACN,UAAW,eACX,MAAO,UACP,KAAM,IACR,EAGA,gBAAiB,CACf,GAAI,kBACJ,KAAM,kBACN,UAAW,yBACX,UAAW,4DACX,MAAO,UACP,KAAM,IACR,EACA,eAAgB,CACd,GAAI,iBACJ,KAAM,iBACN,UAAW,oBACX,UAAW,gCACX,MAAO,UACP,KAAM,IACR,EACA,aAAc,CACZ,GAAI,eACJ,KAAM,eACN,UAAW,yBACX,UAAW,qDACX,MAAO,UACP,KAAM,GACR,EACA,gBAAiB,CACf,GAAI,kBACJ,KAAM,kBACN,UAAW,wBACX,UAAW,2CACX,MAAO,UACP,KAAM,IACR,EACA,iBAAkB,CAChB,GAAI,mBACJ,KAAM,cACN,UAAW,oBACX,UAAW,iDACX,MAAO,UACP,KAAM,IACR,EACA,aAAc,CACZ,GAAI,eACJ,KAAM,eACN,UAAW,gBACX,UAAW,oCACX,MAAO,UACP,KAAM,IACR,EACA,aAAc,CACZ,GAAI,eACJ,KAAM,eACN,UAAW,gBACX,UAAW,4CACX,MAAO,UACP,KAAM,IACR,EACA,aAAc,CACZ,GAAI,eACJ,KAAM,eACN,UAAW,4BACX,UAAW,2CACX,MAAO,UACP,KAAM,IACR,EACA,gBAAiB,CACf,GAAI,kBACJ,KAAM,aACN,UAAW,kBACX,UAAW,uCACX,MAAO,UACP,KAAM,IACR,EAGA,cAAe,CACb,GAAI,gBACJ,KAAM,gBACN,UAAW,sBACX,MAAO,UACP,KAAM,IACR,EACA,iBAAkB,CAChB,GAAI,mBACJ,KAAM,mBACN,UAAW,sBACX,MAAO,UACP,KAAM,IACR,EACA,WAAY,CACV,GAAI,aACJ,KAAM,aACN,UAAW,sBACX,MAAO,UACP,KAAM,IACR,EACA,iBAAkB,CAChB,GAAI,mBACJ,KAAM,mBACN,UAAW,eACX,MAAO,UACP,KAAM,IACR,EACA,gBAAiB,CACf,GAAI,kBACJ,KAAM,oBACN,UAAW,6BACX,MAAO,UACP,KAAM,IACR,CACF,EA0BsC,AA+Db,CA9DvB,CACE,GAAI,eACJ,MAAO,eACP,YAAa,8CACb,KAAM,QACN,MAAO,CACL,CAAE,GAAI,yBAA0B,MAAO,YAAa,KAAM,gBAAiB,KAAM,iBAAkB,EACnG,CAAE,GAAI,YAAa,MAAO,YAAa,KAAM,0BAA2B,KAAM,SAAU,UAAW,CAAC,WAAY,YAAY,AAAC,EAC7H,CAAE,GAAI,cAAe,MAAO,aAAc,KAAM,4BAA6B,KAAM,WAAY,EAC/F,CAAE,GAAI,MAAO,MAAO,iBAAkB,KAAM,oBAAqB,KAAM,YAAa,EACpF,CAAE,GAAI,UAAW,MAAO,kBAAmB,KAAM,wBAAyB,KAAM,KAAM,EAE1F,AADG,EAEH,CACE,GAAI,WACJ,MAAO,aACP,YAAa,0CACb,KAAM,UACN,MAAO,CACL,CAAE,GAAI,UAAW,MAAO,QAAS,KAAM,WAAY,KAAM,QAAS,EAClE,CAAE,GAAI,YAAa,MAAO,YAAa,KAAM,0BAA2B,KAAM,QAAS,EACvF,CAAE,GAAI,iBAAkB,MAAO,iBAAkB,KAAM,oBAAqB,KAAM,aAAc,EAChG,CAAE,GAAI,YAAa,MAAO,cAAe,KAAM,kBAAmB,KAAM,YAAa,EACtF,AACH,EACA,CACE,GAAI,YACJ,MAAO,WACP,YAAa,qCACb,KAAM,MACN,MAAO,CACL,CAAE,GAAI,YAAa,MAAO,YAAa,KAAM,aAAc,KAAM,SAAU,QAAS,CAAC,YAAY,AAAC,EAClG,CAAE,GAAI,WAAY,MAAO,gBAAiB,KAAM,iBAAkB,KAAM,WAAY,EACpF,CAAE,GAAI,SAAU,MAAO,SAAU,KAAM,UAAW,KAAM,QAAS,EACjE,CAAE,GAAI,eAAgB,MAAO,eAAgB,KAAM,gBAAiB,KAAM,OAAQ,EAClF,CAAE,GAAI,aAAc,MAAO,YAAa,KAAM,cAAe,KAAM,KAAM,EAC1E,AACH,EACA,CACE,GAAI,aACJ,MAAO,SACP,YAAa,+BACb,KAAM,cACN,MAAO,CACL,CAAE,GAAI,SAAU,MAAO,SAAU,KAAM,UAAW,KAAM,UAAW,EACnE,CAAE,GAAI,YAAa,MAAO,YAAa,KAAM,aAAc,KAAM,SAAU,EAC3E,CAAE,GAAI,SAAU,MAAO,uBAAwB,KAAM,UAAW,KAAM,cAAe,EACrF,CAAE,GAAI,QAAS,MAAO,QAAS,KAAM,SAAU,KAAM,UAAW,EACjE,AACH,EACA,CACE,GAAI,SACJ,MAAO,UACP,KAAM,WACN,MAAO,CACL,CAAE,GAAI,WAAY,MAAO,gBAAiB,KAAM,YAAa,KAAM,UAAW,EAC9E,CAAE,GAAI,eAAgB,MAAO,cAAe,KAAM,gBAAiB,KAAM,SAAU,EACpF,AACH,EACD,CAGmC,OAAO,CAAC,GAAS,EAAM,KAAK,4BAgChC,CAC9B,QAAS,CAAE,MAAO,eAAgB,YAAa,4BAA6B,WAAY,aAAc,EACtG,cAAe,CAAE,MAAO,yBAA0B,YAAa,wBAAyB,WAAY,OAAQ,EAC5G,eAAgB,CAAE,MAAO,wBAAyB,YAAa,4BAA6B,WAAY,OAAQ,EAChH,cAAe,CAAE,MAAO,wBAAyB,YAAa,sBAAuB,WAAY,OAAQ,EACzG,WAAY,CAAE,MAAO,kBAAmB,YAAa,iBAAkB,WAAY,aAAc,CACnG,sBAzH+B,iBAyGL,CACxB,SAAU,CAAE,MAAO,YAAa,KAAM,KAAM,YAAa,sCAAuC,EAChG,eAAgB,CAAE,MAAO,SAAU,KAAM,KAAM,YAAa,kCAAmC,EAC/F,WAAY,CAAE,MAAO,SAAU,KAAM,KAAM,YAAa,yBAA0B,EAClF,WAAY,CAAE,MAAO,aAAc,KAAM,KAAM,YAAa,8BAA+B,EAC3F,YAAa,CAAE,MAAO,WAAY,KAAM,KAAM,YAAa,6BAA8B,EACzF,aAAc,CAAE,MAAO,eAAgB,KAAM,KAAM,YAAa,0BAA2B,CAC7F,qCClTO,IAAM,EAAuB,CAAC;;;;;;;AAOrC,CAAC,CAEM,SAAS,EAAyB,CAAyB,CAAE,CAAwD,EAC1H,IAAM,EAAgB,CACpB,EAAoB,aAAa,CACjC,EAAoB,gBAAgB,CACpC,EAAoB,UAAU,CAC9B,EAAoB,gBAAgB,CACrC,CAED,MAAO,CAAC;;AAEV,EAAE,EAAc,GAAG,CAAC,CAAC,EAAG,IAAM,CAAA,EAAG,EAAI,EAAE,IAAI,EAAE,EAAE,IAAI,CAAC,KAAK,EAAE,EAAE,SAAS,CAAA,CAAE,EAAE,IAAI,CAAC,MAAM;;;;;YAKzE,EAAE,EAAS,MAAM,EAAE,KAAK;gBACpB,EAAE,EAAS,MAAM,EAAE,SAAS;kBAC7B,EAAE,EAAS,MAAM,EAAE,eAAe;cACnC,EAAE,EAAS,MAAM,EAAE,QAAQ;;;gBAGzB,EAAE,EAAS,WAAW,EAAE,QAAQ;YACpC,EAAE,EAAS,WAAW,EAAE,KAAK;iBACxB,EAAE,EAAS,WAAW,EAAE,UAAU,KAAK,OAAO;qBAC7C,EAAE,EAAS,WAAW,EAAE,YAAY,KAAK,MAAM;;;cAGnD,EAAE,EAAS,MAAM,EAAE,UAAU,KAAK,MAAM;aACzC,EAAE,EAAS,MAAM,EAAE,MAAM,IAAI,GAAK,CAAC,CAAC,EAAE,EAAE,QAAQ,CAAC,EAAE,EAAE,EAAE,OAAO,CAAA,CAAE,EAAE,KAAK,OAAO;;;cAG7E,EAAE,EAAS,MAAM,EAAE,YAAY;aAChC,EAAE,EAAS,MAAM,EAAE,gBAAgB,KAAK,MAAM;eAC5C,EAAE,EAAS,MAAM,EAAE,cAAc,KAAK,OAAO;;AAE5D,EAAE,GAAS,WAAa,CAAC;AAA6C,EAAE,EAAQ,UAAU,CAAC;AAAE,CAAC,CAAG,GAAG;AACpG,EAAE,GAAS,aAAe,CAAC;AAA0B,EAAE,EAAQ,YAAY,CAAC;AAAE,CAAC,CAAG,GAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgCrF,EAAE,EAAA,CAAsB,AACxB,67CChFA,IAAM,EAAe,CACnB,UAAW,CACT,IAAK,IAAM,AAAC,GAAC,CAAC,AAChB,CACF,EAEM,EAAc,CAClB,YAAa,KACb,mBAAoB,IAAM,KAAO,EACjC,QAAS,UAAa,EACtB,OAAQ,IAAM,CAAC,CAAE,UAAW,EAAa,SAAS,AAAC,CAAC,EACpD,IAAK,CAAE,UAAW,EAAa,SAAS,AAAC,EACzC,SAAU,EACV,UAAW,EAAa,SAAS,CACjC,WAAY,IAAM,CAAC,CAAE,IAAK,IAAM,CAAC,CAAE,IAAK,UAAY,AAAC,CAAE,OAAQ,IAAM,EAAM,CAAC,CAAE,CAAC,CAAE,CAAC,EAClF,IAAK,IAAM,CAAC,CAAE,IAAK,UAAY,AAAC,CAAE,OAAQ,KAAM,EAAM,CAAC,CAAE,CAAC,CAC1D,IAAK,IAAM,CAAC,CAAE,IAAK,UAAY,AAAC,EAAC,CAAC,CAAE,CAAC,AACvC,CAIE,CAAA,EAAA,CAAA,CAAgB,QAAQ,CAAG,EAAA,CAAA,CAAgB,QAAQ,EAAI,CAAE,SAAU,CAAa,EAChF,EAAA,CAAA,CAAgB,WAAW,CAAG,EAAA,CAAA,CAAgB,WAAW,EAAI,EAC7D,EAAA,CAAA,CAAgB,YAAY,CAAG,EAAA,CAAA,CAAgB,YAAY,EAAI,EAC/D,EAAA,CAAA,CAAgB,yBAAyB,CAAG,EAAa,SAAS,CAKjE,QAAQ,GAAG,CAAC,UAAU,KAAK,QA6CF,cAAc,AACT,MA9CyB,QA8CX,eC5E/C,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,MD6BmF,EC7BnF,IAAA,EAAA,EAAA,CAAA,CAAA,AD6B+F,QCvB/F,EAAA,EAAA,CAAA,CAAA,QAKA,SAAS,IAEP,IAAM,EAAa,CAAC,QAAQ,GAAG,CAAC,6BAA6B,EAAI,EAAA,CAAE,CAAE,IAAI,GACnE,EAAc,AAAC,SAAQ,GAAG,CAAC,iBAAiB,EAAI,EAAA,CAAE,CAAE,IAAI,GAQ9D,OANY,AAML,GANmB,CAO5B,CAKA,eAAe,EAAY,CAAY,EACrC,IAAM,EAAW,IAAI,cAAc,MAAM,CAAC,EAAK,IAAI,GAAG,WAAW,IAGjE,OADkB,AACX,MADiB,IAAI,CAAC,IAAI,WAAW,AADzB,MAAM,OAAO,MAAM,CAAC,MAAM,CAAC,UAAW,KAExC,GAAG,CAAC,GAAK,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,EAAG,MAAM,IAAI,CAAC,GAClE,CAUO,eAAe,EAAkB,CAAY,EAElD,IAAM,EAAS,IACf,GAAI,CAAC,EACH,MADW,AACL,AAAI,MAAM,mDAGlB,IAAM,EAAY,KAAK,GAAG,GACpB,EAAW,MAAM,EAAY,GAGnC,GAAI,CACF,IAAM,EAAW,CAAA,EAAA,EAAA,GAAA,AAAG,EAAC,EAAA,EAAE,CAAE,cAAe,GAClC,EAAY,MAAM,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,GAE/B,GAAI,EAAU,MAAM,GAAI,CACtB,IAAM,EAAO,EAAU,IAAI,GAI3B,GAAI,CAAC,CAFc,EAAA,QAEH,CAFY,CAAC,GAAG,GAAG,QAAQ,GAAK,EAAK,SAAS,CAAC,QAAQ,GAD3D,EACiE,GAD5D,CAC4D,EAI3E,EALoB,KAAK,AAIzB,KAJ8B,GAItB,GAJ4B,AAIzB,CAAC,CAAC,QAJiC,wBAID,EAAE,EAAS,SAAS,CAAC,EAAG,GAAG,EAAE,EAAE,KAAK,GAAG,GAAK,EAAU,GAAG,CAAC,EAChG,EAAK,SAAS,AAEzB,CACF,CAAE,MAAO,EAAY,CACnB,QAAQ,IAAI,CAAC,iCAAkC,EACjD,CAGA,GAAI,CAOF,QAAQ,GAAG,CAAC,CAAC,gEAAgE,CAAC,EAC9E,IAAM,EAAW,MAAM,MAAM,0FAA2F,CACtH,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,iBAAkB,CACpB,EACA,KAAM,KAAK,SAAS,CAAC,CACnB,MAAO,4BACP,QAAS,CAAE,MAAO,CAAC,MAAE,CAAK,EAAE,AAAC,EAC7B,qBAAsB,GACxB,EACF,GAEA,GAAI,CAAC,EAAS,EAAE,CAAE,CAChB,IAAM,EAAS,MAAM,EAAS,IAAI,EAClC,OAAM,AAAI,MAAM,CAAC,sBAAsB,EAAE,EAAS,MAAM,CAAC,CAAC,EAAE,EAAA,CAAQ,CACtE,CAEA,IAAM,EAAS,MAAM,EAAS,IAAI,GAC5B,EAAY,GAAQ,WAAW,OACrC,GAAI,CAAC,MAAM,OAAO,CAAC,GACjB,MAAM,AAAI,GADmB,GACb,oCAIlB,IAAM,EAAW,CAAA,EAAA,EAAA,GAAA,AAAG,EAAC,EAAA,EAAE,CAAE,cAAe,GAQxC,MAPA,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,EAAU,CACf,MAAO,EAAK,SAAS,CAAC,EAAG,eACzB,EACA,UAAW,EAAA,SAAS,CAAC,GAAG,EAC1B,GAAG,KAAK,CAAC,GAAO,QAAQ,KAAK,CAAC,kCAAmC,IAEjE,QAAQ,GAAG,CAAC,CAAC,sCAAsC,EAAE,KAAK,GAAG,GAAK,EAAU,GAAG,CAAC,EACzE,CACT,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,2CAA4C,GACpD,CACR,CACF,CAUO,eAAe,EAAwB,CAAe,EAC3D,IAAM,EAAY,KAAK,GAAG,GACpB,EAA+B,AAAI,MAAM,EAAM,MAAM,EAAE,IAAI,CAAC,MAC5D,EAAwB,EAAE,CAC1B,EAAsB,EAAE,CAExB,EAAY,EAAA,SAAS,CAAC,GAAG,GAAG,QAAQ,GAG1C,IAAK,IAAI,EAAI,EAAG,EAAI,EAAM,MAAM,CAAE,IAAK,CACrC,IAAM,EAAO,CAAK,CAAC,EAAE,CACf,EAAW,MAAM,EAAY,GAEnC,GAAI,CACF,IAAM,EAAW,CAAA,EAAA,EAAA,GAAA,AAAG,EAAC,EAAA,EAAE,CAAE,cAAe,GAClC,EAAY,MAAM,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,GAE/B,GAAI,EAAU,MAAM,GAAI,CACtB,IAAM,EAAO,EAAU,IAAI,GAG3B,GAAI,CAAC,CAFc,EAAY,EAAK,SAAS,CAAC,QAAQ,GAdhD,EAcsD,GAdjD,CAciD,EAE5C,CACd,CAAO,AAjBO,CAiBN,EAAE,CAAG,CAjBM,CAiBD,IAjBM,KAiBG,CAjBG,AAkB9B,QACF,CACF,CACF,AArB8C,CAqB5C,MAAO,EAAK,CAEd,CAEA,EAAY,IAAI,CAAC,GACjB,EAAU,IAAI,CAAC,EACjB,CAEA,GAAyB,GAAG,CAAxB,EAAU,MAAM,CAElB,OADA,QAAQ,GAAG,CAAC,CAAC,sCAAsC,EAAE,EAAM,MAAM,CAAC,QAAQ,EAAE,KAAK,GAAG,GAAK,EAAU,GAAG,CAAC,EAChG,EAIT,IAAM,EAAS,IACf,GAAI,CAAC,EACH,MADW,AACL,AAAI,MAAM,mDAGJ,AACA,IADI,EAAA,kBAAkB,CAAC,GACjB,kBAAkB,CAAC,CAAE,MAAO,oBAAqB,GAErE,GAAI,CACF,QAAQ,GAAG,CAAC,CAAC,gDAAgD,EAAE,EAAU,MAAM,CAAC,CAAC,EAAE,EAAM,MAAM,CAAC,MAAM,CAAC,EAKvG,IAAM,EAA4B,EAAE,CAEpC,IAAK,IAAI,EAAI,EAAG,EAAI,EAAU,MAAM,CAAE,KAAK,CAAY,CACrD,IAAM,EAAa,EAAU,KAAK,CAAC,EAAG,IAAI,EAC1C,QAAQ,GAAG,CAAC,CAAC,sCAAsC,EAAE,EALpC,EAKwC,CAAa,EAAE,EAAE,EAAE,EAAW,MAAM,CAAC,OAAO,CAAC,EAGtG,IAAM,EAAW,MAAM,MAAM,gGAAiG,CAC5H,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,iBAAkB,CACpB,EACA,KAAM,KAAK,SAAS,CAAC,CACnB,SAAU,EAAW,GAAG,CAAC,AAAC,IAAU,CAClC,EADiC,IAC1B,4BACP,QAAS,CAAE,MAAO,CAAC,MAAE,CAAK,EAAE,AAAC,EAC7B,qBAAsB,IACxB,CAAC,CACH,EACF,GAEA,GAAI,CAAC,EAAS,EAAE,CAAE,CAChB,IAAM,EAAS,MAAM,EAAS,IAAI,EAClC,OAAM,AAAI,MAAM,CAAC,4BAA4B,EAAE,EAAS,MAAM,CAAC,CAAC,EAAE,EAAA,CAAQ,CAC5E,CAEA,IAAM,EAAc,MAAM,EAAS,IAAI,GAEvC,GAAI,CAAC,EAAY,UAAU,EAAI,CAAC,MAAM,OAAO,CAAC,EAAY,UAAU,EAClE,CADqE,KAC/D,AAAI,MAAM,+CAGlB,EAAc,IAAI,IAAI,EAAY,UAAU,CAAC,GAAG,CAAC,AAAC,GAAW,EAAE,MAAM,EACvE,CAGA,IAAK,IAAI,EAAI,EAAG,EAAI,EAAY,MAAM,CAAE,IAAK,CAC3C,IAAM,EAAc,CAAW,CAAC,EAAE,CAC5B,EAAY,CAAa,CAAC,EAAE,CAC5B,EAAO,CAAS,CAAC,EAAE,CACzB,CAAO,CAAC,EAAY,CAAG,EAEvB,IAAM,EAAW,MAAM,EAAY,GAC7B,EAAW,CAAA,EAAA,EAAA,GAAA,AAAG,EAAC,EAAA,EAAE,CAAE,cAAe,GACxC,CAAA,EAAA,EAAA,MAAM,AAAN,EAAO,EAAU,CACf,MAAO,EAAK,SAAS,CAAC,EAAG,eACzB,EACA,UAAW,EAAA,SAAS,CAAC,GAAG,EAC1B,GAAG,KAAK,CAAC,GAAO,QAAQ,KAAK,CAAC,kCAAmC,GACnE,CAGA,OADA,QAAQ,GAAG,CAAC,CAAC,8BAA8B,EAAE,KAAK,GAAG,GAAK,EAAU,GAAG,CAAC,EACjE,CACT,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,kDAAmD,GAC3D,CACR,CACF"}