module.exports=[328668,e=>{"use strict";e.i(564153);var t=e.i(918042),a=e.i(474065);e.i(608612);var r=e.i(949620);async function n(e){return s(e)}async function o(e){return(await (0,t.addDoc)((0,t.collection)(a.db,"brand_assets"),{...e,isApprovedForAI:e.isApprovedForAI??!1})).id}async function i(e){let r=(0,t.query)((0,t.collection)(a.db,"brand_assets"),(0,t.where)("brandId","==",e),(0,t.orderBy)("createdAt","desc"));return(await (0,t.getDocs)(r)).docs.map(e=>({id:e.id,...e.data()}))}async function s(e){let r=(0,t.doc)(a.db,"brand_assets",e),n=await (0,t.getDoc)(r);return n.exists()?{id:n.id,...n.data()}:null}async function c(e,r,n){let o=(0,t.doc)(a.db,"brand_assets",e),i={status:r};"ready"===r&&(i.processedAt=t.Timestamp.now()),n&&(i.processingError=n),await (0,t.updateDoc)(o,i)}async function d(e,r){let n=(0,t.doc)(a.db,"brand_assets",e);await (0,t.updateDoc)(n,r)}e.i(569157),(0,r.getStorage)(a.default),e.i(382396),e.s(["createAsset",()=>o,"fetchBrandAsset",()=>n,"getAsset",()=>s,"getBrandAssets",()=>i,"updateAssetStatus",()=>c,"updateBrandAsset",()=>d],328668)},382396,e=>{"use strict";var t=e.i(474065);e.i(564153);var a=e.i(918042);async function r(e,r,n,o){try{let i=(0,a.collection)(t.db,"brands",e,"audit_logs");await (0,a.addDoc)(i,{action:r,details:n,userId:o,createdAt:a.Timestamp.now()})}catch(e){console.error("Failed to log audit:",e)}}async function n(e,n,o,i){var s;let c=(0,a.doc)(t.db,"brands",e),d=await (0,a.getDoc)(c);if(!d.exists())throw Error("Marca n√£o encontrada");let l=d.data();if(l.brandKit?.logoLock?.locked)throw Error("Logo Lock ativo: Desbloqueie o BrandKit para alterar os logos oficiais.");"svg"===o.format&&o.svgRaw&&(o.svgRaw=(s=o.svgRaw)?s.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/on\w+="[^"]*"/gi,"").replace(/on\w+='[^']*'/gi,"").replace(/javascript:[^"']*/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/<object\b[^<]*(?:(?!<\/object>)<[^<]*)*<\/object>/gi,"").trim():"");let g={...l.brandKit?.logoLock,variants:{...l.brandKit?.logoLock?.variants,[n]:o},updatedAt:a.Timestamp.now()};await (0,a.updateDoc)(c,{"brandKit.logoLock":g,updatedAt:a.Timestamp.now()}),await r(e,`UPDATE_LOGO_${n.toUpperCase()}`,{asset:o},i)}async function o(e,n,o){let i=(0,a.doc)(t.db,"brands",e);await (0,a.updateDoc)(i,{"brandKit.logoLock.locked":n,"brandKit.logoLock.updatedAt":a.Timestamp.now(),updatedAt:a.Timestamp.now()}),await r(e,n?"LOCK_LOGOS":"UNLOCK_LOGOS",{locked:n},o)}e.s(["toggleLogoLock",()=>o,"updateLogoLock",()=>n])},653936,e=>{"use strict";var t=e.i(346414);e.i(564153);var a=e.i(918042),r=e.i(474065);function n(){let e=(process.env.NEXT_PUBLIC_GOOGLE_AI_API_KEY??"").trim(),t=(process.env.GOOGLE_AI_API_KEY??"").trim();return e||t}async function o(e){let t=new TextEncoder().encode(e.trim().toLowerCase());return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}async function i(e){let t=n();if(!t)throw Error("GOOGLE_AI_API_KEY not configured for embeddings");let i=Date.now(),s=await o(e);try{let e=(0,a.doc)(r.db,"query_cache",s),t=await (0,a.getDoc)(e);if(t.exists()){let e=t.data();if(!(a.Timestamp.now().toMillis()-e.createdAt.toMillis()>2592e6))return console.log(`[Embeddings] Cache HIT for key: ${s.substring(0,8)} (${Date.now()-i}ms)`),e.embedding}}catch(e){console.warn("[Embeddings] Cache read error:",e)}try{console.log("[Embeddings] Calling text-embedding-004 with dimensionality: 768");let n=await fetch("https://generativelanguage.googleapis.com/v1beta/models/text-embedding-004:embedContent",{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":t},body:JSON.stringify({model:"models/text-embedding-004",content:{parts:[{text:e}]},outputDimensionality:768})});if(!n.ok){let e=await n.text();throw Error(`Embedding API failed: ${n.status} ${e}`)}let o=await n.json(),c=o?.embedding?.values;if(!Array.isArray(c))throw Error("Embedding API returned no values");let d=(0,a.doc)(r.db,"query_cache",s);return(0,a.setDoc)(d,{query:e.substring(0,500),embedding:c,createdAt:a.Timestamp.now()}).catch(e=>console.error("[Embeddings] Cache write error:",e)),console.log(`[Embeddings] Cache MISS - API called (${Date.now()-i}ms)`),c}catch(e){throw console.error("[Embeddings] Error generating embedding:",e),e}}async function s(e){let i=Date.now(),s=Array(e.length).fill(null),c=[],d=[],l=a.Timestamp.now().toMillis();for(let t=0;t<e.length;t++){let n=e[t],i=await o(n);try{let e=(0,a.doc)(r.db,"query_cache",i),n=await (0,a.getDoc)(e);if(n.exists()){let e=n.data();if(!(l-e.createdAt.toMillis()>2592e6)){s[t]=e.embedding;continue}}}catch(e){}c.push(t),d.push(n)}if(0===d.length)return console.log(`[Embeddings] Batch Cache HIT (100%) - ${e.length} items (${Date.now()-i}ms)`),s;let g=n();if(!g)throw Error("GOOGLE_AI_API_KEY not configured for embeddings");new t.GoogleGenerativeAI(g).getGenerativeModel({model:"text-embedding-004"});try{console.log(`[Embeddings] Batch Cache MISS - Calling API for ${d.length}/${e.length} items`);let t=[];for(let e=0;e<d.length;e+=90){let a=d.slice(e,e+90);console.log(`[Embeddings] Processing API sub-batch ${e/90+1} (${a.length} items)`);let r=await fetch("https://generativelanguage.googleapis.com/v1beta/models/text-embedding-004:batchEmbedContents",{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":g},body:JSON.stringify({requests:a.map(e=>({model:"models/text-embedding-004",content:{parts:[{text:e}]},outputDimensionality:768}))})});if(!r.ok){let e=await r.text();throw Error(`Batch Embedding API failed: ${r.status} ${e}`)}let n=await r.json();if(!n.embeddings||!Array.isArray(n.embeddings))throw Error("Batch Embedding API returned invalid format");t.push(...n.embeddings.map(e=>e.values))}for(let e=0;e<c.length;e++){let n=c[e],i=t[e],l=d[e];s[n]=i;let g=await o(l),u=(0,a.doc)(r.db,"query_cache",g);(0,a.setDoc)(u,{query:l.substring(0,500),embedding:i,createdAt:a.Timestamp.now()}).catch(e=>console.error("[Embeddings] Cache write error:",e))}return console.log(`[Embeddings] Batch completed (${Date.now()-i}ms)`),s}catch(e){throw console.error("[Embeddings] Error generating batch embeddings:",e),e}}e.s(["generateEmbedding",()=>i,"generateEmbeddingsBatch",()=>s])},413263,e=>{"use strict";function t(){let e=process.env.PINECONE_API_KEY,t=process.env.PINECONE_INDEX||process.env.PINECONE_INDEX_NAME||"cf-dev-assets",a=process.env.PINECONE_HOST||process.env.PINECONE_HOST_URL;if(!e)throw Error("PINECONE_API_KEY ausente.");return{apiKey:e,indexName:t,host:a}}let a=null,r=null;async function n(){if(a)return a;let{apiKey:r}=t(),{Pinecone:n}=await e.A(465660);return a=new n({apiKey:r})}async function o(){if(r)return r;let{indexName:e,host:a}=t(),o=await n();return o?r=a?o.index(e,a):o.index(e):null}async function i(e,t={}){if(!e?.length)return{upserted:0};let a=await o();if(!a)return{upserted:0};let r=t.namespace?a.namespace(t.namespace):a;return await r.upsert(e),{upserted:e.length}}async function s(e){let{vector:t,topK:a=10,namespace:r,filter:n}=e,i=await o();if(!i)return{matches:[]};let s=r?i.namespace(r):i;return await s.query({vector:t,topK:a,filter:n,includeMetadata:!0})}async function c(){let{indexName:e}=t(),a=await o(),r=await n();if(!a||!r)return null;let i=await a.describeIndexStats();return await r.describeIndex(e),{status:"connected",index:e,totalVectors:i.totalRecordCount??0}}e.s(["checkPineconeHealth",()=>c,"getPineconeClient",()=>n,"getPineconeIndex",()=>o,"queryPinecone",()=>s,"upsertToPinecone",()=>i])},569157,e=>{"use strict";e.i(564153);var t=e.i(918042),a=e.i(474065);e.i(653137),e.i(653936),e.i(413263);var r=e.i(317036);class n{static getCollectionPath(e){return`brands/${e}/secrets`}static async saveToken(e,n){let o=(0,t.doc)(a.db,this.getCollectionPath(e),`token_${n.provider}`),i={...n,accessToken:(0,r.encrypt)(n.accessToken),refreshToken:n.refreshToken?(0,r.encrypt)(n.refreshToken):void 0,updatedAt:t.Timestamp.now()};await (0,t.setDoc)(o,i)}static async getToken(e,n){let o=(0,t.doc)(a.db,this.getCollectionPath(e),`token_${n}`),i=await (0,t.getDoc)(o);if(!i.exists())return null;let s=i.data();return{...s,accessToken:(0,r.decrypt)(s.accessToken),refreshToken:s.refreshToken?(0,r.decrypt)(s.refreshToken):void 0}}static isTokenExpiring(e){let t=Date.now();return e.expiresAt.toMillis()-t<864e5}}e.s(["MonaraTokenVault",()=>n],569157)}];

//# sourceMappingURL=OneDrive_Desktop_CURSOR_CONSELHO%20DE%20FUNIL_app_src_lib_7e258e87._.js.map