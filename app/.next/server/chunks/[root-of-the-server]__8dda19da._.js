module.exports=[193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},224361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},605365,(e,t,r)=>{t.exports=e.x("process",()=>require("process"))},446786,(e,t,r)=>{t.exports=e.x("os",()=>require("os"))},254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},921517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},688947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},792509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},653137,e=>{"use strict";e.i(564153);var t=e.i(918042);let r={maxRetries:3,initialDelay:1e3,maxDelay:1e4,factor:2},n=["aborted","deadline-exceeded","resource-exhausted","unavailable","internal"];async function a(e,o={}){let s,{maxRetries:i,initialDelay:c,maxDelay:l,factor:d}={...r,...o},u=c;for(let r=0;r<=i;r++)try{return await e()}catch(e){if(s=e,!(e instanceof t.FirestoreError&&n.includes(e.code))||r===i)break;console.warn(`[Resilience] Falha na opera\xe7\xe3o (tentativa ${r+1}/${i+1}). Erro: ${e.code}. Tentando novamente em ${u}ms...`),await new Promise(e=>setTimeout(e,u)),u=Math.min(u*d,l)}throw console.error("[Resilience] Operação falhou permanentemente após retries.",s),s}e.s(["withResilience",()=>a])},666680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},653936,e=>{"use strict";var t=e.i(346414);e.i(564153);var r=e.i(918042),n=e.i(474065);function a(){let e=(process.env.NEXT_PUBLIC_GOOGLE_AI_API_KEY??"").trim(),t=(process.env.GOOGLE_AI_API_KEY??"").trim();return e||t}async function o(e){let t=new TextEncoder().encode(e.trim().toLowerCase());return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}async function s(e){let t=a();if(!t)throw Error("GOOGLE_AI_API_KEY not configured for embeddings");let s=Date.now(),i=await o(e);try{let e=(0,r.doc)(n.db,"query_cache",i),t=await (0,r.getDoc)(e);if(t.exists()){let e=t.data();if(!(r.Timestamp.now().toMillis()-e.createdAt.toMillis()>2592e6))return console.log(`[Embeddings] Cache HIT for key: ${i.substring(0,8)} (${Date.now()-s}ms)`),e.embedding}}catch(e){console.warn("[Embeddings] Cache read error:",e)}try{console.log("[Embeddings] Calling text-embedding-004 with dimensionality: 768");let a=await fetch("https://generativelanguage.googleapis.com/v1beta/models/text-embedding-004:embedContent",{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":t},body:JSON.stringify({model:"models/text-embedding-004",content:{parts:[{text:e}]},outputDimensionality:768})});if(!a.ok){let e=await a.text();throw Error(`Embedding API failed: ${a.status} ${e}`)}let o=await a.json(),c=o?.embedding?.values;if(!Array.isArray(c))throw Error("Embedding API returned no values");let l=(0,r.doc)(n.db,"query_cache",i);return(0,r.setDoc)(l,{query:e.substring(0,500),embedding:c,createdAt:r.Timestamp.now()}).catch(e=>console.error("[Embeddings] Cache write error:",e)),console.log(`[Embeddings] Cache MISS - API called (${Date.now()-s}ms)`),c}catch(e){throw console.error("[Embeddings] Error generating embedding:",e),e}}async function i(e){let s=Date.now(),i=Array(e.length).fill(null),c=[],l=[],d=r.Timestamp.now().toMillis();for(let t=0;t<e.length;t++){let a=e[t],s=await o(a);try{let e=(0,r.doc)(n.db,"query_cache",s),a=await (0,r.getDoc)(e);if(a.exists()){let e=a.data();if(!(d-e.createdAt.toMillis()>2592e6)){i[t]=e.embedding;continue}}}catch(e){}c.push(t),l.push(a)}if(0===l.length)return console.log(`[Embeddings] Batch Cache HIT (100%) - ${e.length} items (${Date.now()-s}ms)`),i;let u=a();if(!u)throw Error("GOOGLE_AI_API_KEY not configured for embeddings");new t.GoogleGenerativeAI(u).getGenerativeModel({model:"text-embedding-004"});try{console.log(`[Embeddings] Batch Cache MISS - Calling API for ${l.length}/${e.length} items`);let t=[];for(let e=0;e<l.length;e+=90){let r=l.slice(e,e+90);console.log(`[Embeddings] Processing API sub-batch ${e/90+1} (${r.length} items)`);let n=await fetch("https://generativelanguage.googleapis.com/v1beta/models/text-embedding-004:batchEmbedContents",{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":u},body:JSON.stringify({requests:r.map(e=>({model:"models/text-embedding-004",content:{parts:[{text:e}]},outputDimensionality:768}))})});if(!n.ok){let e=await n.text();throw Error(`Batch Embedding API failed: ${n.status} ${e}`)}let a=await n.json();if(!a.embeddings||!Array.isArray(a.embeddings))throw Error("Batch Embedding API returned invalid format");t.push(...a.embeddings.map(e=>e.values))}for(let e=0;e<c.length;e++){let a=c[e],s=t[e],d=l[e];i[a]=s;let u=await o(d),m=(0,r.doc)(n.db,"query_cache",u);(0,r.setDoc)(m,{query:d.substring(0,500),embedding:s,createdAt:r.Timestamp.now()}).catch(e=>console.error("[Embeddings] Cache write error:",e))}return console.log(`[Embeddings] Batch completed (${Date.now()-s}ms)`),i}catch(e){throw console.error("[Embeddings] Error generating batch embeddings:",e),e}}e.s(["generateEmbedding",()=>s,"generateEmbeddingsBatch",()=>i])},413263,e=>{"use strict";function t(){let e=process.env.PINECONE_API_KEY,t=process.env.PINECONE_INDEX||process.env.PINECONE_INDEX_NAME||"cf-dev-assets",r=process.env.PINECONE_HOST||process.env.PINECONE_HOST_URL;if(!e)throw Error("PINECONE_API_KEY ausente.");return{apiKey:e,indexName:t,host:r}}let r=null,n=null;async function a(){if(r)return r;let{apiKey:n}=t(),{Pinecone:a}=await e.A(465660);return r=new a({apiKey:n})}async function o(){if(n)return n;let{indexName:e,host:r}=t(),o=await a();return o?n=r?o.index(e,r):o.index(e):null}async function s(e,t={}){if(!e?.length)return{upserted:0};let r=await o();if(!r)return{upserted:0};let n=t.namespace?r.namespace(t.namespace):r;return await n.upsert(e),{upserted:e.length}}async function i(e){let{vector:t,topK:r=10,namespace:n,filter:a}=e,s=await o();if(!s)return{matches:[]};let i=n?s.namespace(n):s;return await i.query({vector:t,topK:r,filter:a,includeMetadata:!0})}async function c(){let{indexName:e}=t(),r=await o(),n=await a();if(!r||!n)return null;let s=await r.describeIndexStats();return await n.describeIndex(e),{status:"connected",index:e,totalVectors:s.totalRecordCount??0}}e.s(["checkPineconeHealth",()=>c,"getPineconeClient",()=>a,"getPineconeIndex",()=>o,"queryPinecone",()=>i,"upsertToPinecone",()=>s])},910153,e=>{"use strict";var t=e.i(666680);let r={randomUUID:t.randomUUID},n=new Uint8Array(256),a=n.length,o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));e.s(["v4",0,function(e,s,i){if(r.randomUUID&&!s&&!e)return r.randomUUID();var c=e,l=i;let d=(c=c||{}).random??c.rng?.()??(a>n.length-16&&((0,t.randomFillSync)(n),a=0),n.slice(a,a+=16));if(d.length<16)throw Error("Random bytes length must be >= 16");if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,s){if((l=l||0)<0||l+16>s.length)throw RangeError(`UUID byte range ${l}:${l+15} is out of buffer bounds`);for(let e=0;e<16;++e)s[l+e]=d[e];return s}return function(e,t=0){return(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase()}(d)}],910153)},591760,e=>{"use strict";e.i(564153);var t=e.i(918042),r=e.i(474065),n=e.i(653137);async function a(e,n){let a=(0,t.doc)(r.db,"brands",e,"intelligence","competitors",n),o=await (0,t.getDoc)(a);return o.exists()?{id:o.id,...o.data()}:null}async function o(e,a,o){let s=(0,t.doc)(r.db,"brands",e,"intelligence","competitors",a);await (0,n.withResilience)(async()=>{await (0,t.updateDoc)(s,{...o,updatedAt:t.Timestamp.now()})})}async function s(e,n,a){let o=(0,t.collection)(r.db,"brands",e,"intelligence","competitors",n,"assets");return(await (0,t.addDoc)(o,{...a,version:1})).id}async function i(e,n){let a=(0,t.collection)(r.db,"brands",e,"intelligence","competitors",n,"assets"),o=(0,t.query)(a,(0,t.orderBy)("capturedAt","desc"));return(await (0,t.getDocs)(o)).docs.map(e=>({id:e.id,...e.data()}))}async function c(e){let n=t.Timestamp.now(),a=function(e,r){let n=r.toDate(),a=30;switch(e){case"mention":a=30;break;case"trend":a=90;break;case"competitor":a=60;break;case"news":a=14}return n.setDate(n.getDate()+a),t.Timestamp.fromDate(n)}(e.type,n),o=e.content.textHash||await l(e.content.text),s={brandId:e.brandId,type:e.type,status:"raw",source:e.source,content:{...e.content,textHash:o},metrics:e.metrics,collectedAt:n,expiresAt:a,version:1},i=(0,t.collection)(r.db,"brands",e.brandId,"intelligence");return(await (0,t.addDoc)(i,s)).id}async function l(e){return e.substring(0,10)+e.length}e.s(["createIntelligenceAsset",()=>s,"createIntelligenceDocument",()=>c,"getCompetitorAssets",()=>i,"getCompetitorProfile",()=>a,"updateCompetitorProfile",()=>o])},415157,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_puppeteer-core_c3f7e23f._.js"].map(t=>e.l(t))).then(()=>t(209635)))},716873,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_@sparticuz_chromium-min_34fc60a3._.js"].map(t=>e.l(t))).then(()=>t(973969)))},465660,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__a13a3d25._.js","server/chunks/5c86f_@pinecone-database_pinecone_dist_b1d5c4a9._.js"].map(t=>e.l(t))).then(()=>t(432229)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__8dda19da._.js.map